webpackJsonp([15],{111:function(t,e,r){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.HwContactSdk=void 0;var u=r(135),o=a(u),c=r(4),i=a(c),s=r(1857),f=n(s),d=r(820),l=n(d),p=r(632),v=n(p),h=r(1858),m=n(h),g=r(1859),C=r(1862),x=n(C),b=r(1863);e.HwContactSdk=function t(){(0,i.default)(this,t),(0,o.default)(this,f),(0,o.default)(this,l),(0,o.default)(this,v),(0,o.default)(this,m),(0,o.default)(this,g.euaserver.getApiList()),(0,o.default)(this,x),(0,o.default)(this,(0,b.getContactApiList)())}},131:function(t,e,r){t.exports={default:r(151),__esModule:!0}},132:function(t,e,r){t.exports=r(0)(45)},133:function(t,e,r){t.exports=r(0)(47)},135:function(t,e,r){t.exports=r(0)(562)},139:function(t,e,r){t.exports=r(0)(57)},140:function(t,e){"function"==typeof Object.create?t.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(t,e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}},141:function(t,e,r){t.exports=r(0)(238)},142:function(t,e,r){"use strict";e.__esModule=!0;var n=r(159),a=function(t){return t&&t.__esModule?t:{default:t}}(n);e.default=function(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return(0,a.default)(t)}},143:function(t,e,r){t.exports=r(0)(620)},146:function(t,e,r){var n=r(10),a=r(8),u=r(148);t.exports=function(t,e){var r=(a.Object||{})[t]||Object[t],o={};o[t]=e(r),n(n.S+n.F*u(function(){r(1)}),"Object",o)}},147:function(t,e,r){t.exports={default:r(178),__esModule:!0}},148:function(t,e,r){t.exports=r(0)(59)},149:function(t,e,r){t.exports={default:r(168),__esModule:!0}},151:function(t,e,r){r(152),t.exports=r(8).Object.getPrototypeOf},152:function(t,e,r){var n=r(141),a=r(153);r(146)("getPrototypeOf",function(){return function(t){return a(n(t))}})},153:function(t,e,r){t.exports=r(0)(585)},154:function(t,e,r){t.exports=r(0)(86)},155:function(t,e,r){t.exports=r(0)(84)},157:function(t,e,r){t.exports=r(0)(196)},158:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var a=r(184),u=n(a),o=r(149),c=n(o);e.default=function(){function t(t,e){var r=[],n=!0,a=!1,u=void 0;try{for(var o,i=(0,c.default)(t);!(n=(o=i.next()).done)&&(r.push(o.value),!e||r.length!==e);n=!0);}catch(t){a=!0,u=t}finally{try{!n&&i.return&&i.return()}finally{if(a)throw u}}return r}return function(e,r){if(Array.isArray(e))return e;if((0,u.default)(Object(e)))return t(e,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},159:function(t,e,r){t.exports={default:r(173),__esModule:!0}},164:function(t,e,r){t.exports=r(0)(80)},168:function(t,e,r){r(23),r(22),t.exports=r(169)},169:function(t,e,r){var n=r(9),a=r(26);t.exports=r(8).getIterator=function(t){var e=a(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return n(e.call(t))}},173:function(t,e,r){r(22),r(174),t.exports=r(8).Array.from},174:function(t,e,r){"use strict";var n=r(11),a=r(10),u=r(141),o=r(31),c=r(32),i=r(27),s=r(175),f=r(26);a(a.S+a.F*!r(33)(function(t){Array.from(t)}),"Array",{from:function(t){var e,r,a,d,l=u(t),p="function"==typeof this?this:Array,v=arguments.length,h=v>1?arguments[1]:void 0,m=void 0!==h,g=0,C=f(l);if(m&&(h=n(h,v>2?arguments[2]:void 0,2)),void 0==C||p==Array&&c(C))for(e=i(l.length),r=new p(e);e>g;g++)s(r,g,m?h(l[g],g):l[g]);else for(d=C.call(l),r=new p;!(a=d.next()).done;g++)s(r,g,m?o(d,h,[a.value,g],!0):a.value);return r.length=g,r}})},175:function(t,e,r){"use strict";var n=r(25),a=r(176);t.exports=function(t,e,r){e in t?n.f(t,e,a(0,r)):t[e]=r}},176:function(t,e,r){t.exports=r(0)(79)},178:function(t,e,r){r(179),t.exports=r(8).Object.keys},179:function(t,e,r){var n=r(141),a=r(164);r(146)("keys",function(){return function(t){return a(n(t))}})},184:function(t,e,r){t.exports={default:r(185),__esModule:!0}},185:function(t,e,r){r(23),r(22),t.exports=r(186)},1857:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=coreLogger.getLogger("logic")("contactGroup/contact/dealData");e.getRecentContactList=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var e=$getState(),r=e.myInfo,a=e.recent.recentList,u=t.filterContacts,o=void 0===u?[]:u;return n.info("getRecentContactList"),a.filter(function(t){return!coreIm.isGroup(t.chat_type)&&!isNullOrEmpty(t.contact)&&t.contact.account!==r.account&&isNullOrEmpty(o.query({account:t.account}))}).map(function(t){return t.contact})}catch(t){n.error("getRecentContactList",t)}},e.getFriendList=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{var e=$getState(),r=e.myInfo,a=e.contactGroups.contactUserList,u=t.filterContacts,o=void 0===u?[]:u;return n.info("getFriendList"),a.filter(function(t){return t.account!==r.account&&isNullOrEmpty(o.query({account:t.account}))})}catch(t){n.error("getFriendList",t)}}},1858:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.togglePageList=void 0;var a=r(1),u=n(a),o=r(2),c=n(o);e.togglePageList=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:$dispatch(coreUi.updateMobileListContent(e));case 1:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}()},1859:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.euaserver=void 0;var a=r(135),u=n(a),o=r(142),c=n(o),i=r(131),s=n(i),f=r(4),d=n(f),l=r(132),p=n(l),v=r(133),h=n(v),m=r(69),g=n(m),C=r(1),x=n(C),b=r(2),y=n(b),w=r(1860),_=n(w),k=r(1861),A=coreLogger.getLogger("logic")("login/euaserver"),E=function(){var t=(0,y.default)(x.default.mark(function t(){var e,r,n,a,u,o,c,i,s,f,d,l,p,v,h,m,g,C,b,y;return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,coreAccount.getLoginModel();case 2:if(e=t.sent,!e.isSupportAS){t.next=5;break}return t.abrupt("return",coreCommon.ATOMIC_ACTION_RESULT.SUCCESS);case 5:return t.next=7,T();case 7:if(t.sent){t.next=9;break}return t.abrupt("return");case 9:return coreUt.utEventStart({eventId:constant.EVENT_ID.UT_LOGIN,extraTrackKey:constant.UT_LOGIN_SERVER_NAME.UT_EAB_SERVER,params:[constant.UT_LOGIN_SERVER_NAME.UT_EAB_SERVER]}),A.info("<account_login><8_eua>begin, start eabserverLogin"),t.next=13,coreTup.getEUAInstance();case 13:return r=t.sent,t.next=16,coreAccount.getLoginModel();case 16:return n=t.sent,a=n.account,u=n.eabUri,o=n.groupServer,c=n.serverUportalAddress,i=n.serverUportalPort,s=n.isSupportProxy,f=n.proxyAddress,d=n.proxyPort,l=n.proxyAccount,p=n.authToken,v=n.isResume,t.next=30,coreSecurity.getPasswordManager();case 30:return h=t.sent,t.next=33,h.getPassword("proxyPassword");case 33:return m=t.sent,s||(f=null,d=null,l=null,m=null),g=window.CLIENTCONFIG.EAB_SEARCH_NUM||20,A.info("eabserverLogin eaddrConfig"),t.next=39,appService.getAvatarPath(a);case 39:return C=t.sent,b={ServerType:3,HttpServerAddr:u||"https://"+c+":"+i+"/services",AvatarServerAddr:o||"https://"+c+":"+i+"/headportrait",PageCount:g,UserName:a,Token:p,AvatarFilePath:C,HttpsVerifyMode:0,HttpTimeOut:10,RCSType:1,CertFilePath:"",ProxyIpAddr:f,ProxyPort:parseInt(d),ProxyAuthUserName:l,ProxyAuthPassword:m},t.next=43,r.eaddrConfig(b);case 43:if(!(y=t.sent)||0!==y.result){t.next=51;break}return A.info("<account_login><8_eua>end ok, eabserverLogin success"),coreCommon.dispatchModuleEvent("login",{event:"eua",code:0}),coreUt.utEventFinish({eventId:constant.EVENT_ID.UT_LOGIN,extraTrackKey:constant.UT_LOGIN_SERVER_NAME.UT_EAB_SERVER,resultParams:[1,v?1:0],isTrackTimeCosts:!0}),t.abrupt("return",coreCommon.ATOMIC_ACTION_RESULT.SUCCESS);case 51:return A.error("e<account_login><8_eua>end failed, abserverLogin failed"),coreCommon.dispatchModuleEvent("login",{event:"eua",code:y}),coreUt.utEventFinish({eventId:constant.EVENT_ID.UT_LOGIN,extraTrackKey:constant.UT_LOGIN_SERVER_NAME.UT_EAB_SERVER,resultParams:[0,y.result,v?1:0],isTrackTimeCosts:!0}),t.abrupt("return",coreCommon.ATOMIC_ACTION_RESULT.FAILED);case 55:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}(),L=new coreCommon.AtomicAction("eabserverLoginAtomic",E),I=function(t){var e=t&&t.result||t&&t.param&&t.param.result;if(!isNullOrEmpty(e))switch(e){case constant.ERROR_SEARCHINFO_CODE.EADDR_SUCCESS:return!0;case constant.ERROR_SEARCHINFO_CODE.EADDR_FAIL_AUTH:case constant.ERROR_SEARCHINFO_CODE.EADDR_FAIL_TOKEN:O()}return A.error("EUA request error, reason:",e),!1},S=function(t){return t.forEach(function(t){N(t)}),A.debug("convert2uuid entry22",t),t},N=function(t){$getState().login.isSupportAS&&t.hasOwnProperty("id")?(t.show_account=t.account,t.account=t.id,delete t.id):t.show_account=t.account},O=function(){coreAccount.actionRefreshToken()},T=function(){var t=(0,y.default)(x.default.mark(function t(){var e;return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,coreAccount.getLoginModel();case 2:if(e=t.sent,!window.CLIENTCONFIG.ISBIGWIN&&e.useEab){t.next=5;break}return t.abrupt("return",!1);case 5:return t.abrupt("return",!0);case 6:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}(),D=function(){var t=(0,y.default)(x.default.mark(function t(){return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,T();case 2:if(t.sent){t.next=5;break}return A.warn("EUA module is not enabled"),t.abrupt("return",!1);case 5:return t.abrupt("return",!0);case 6:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}(),U=function(){var t=(0,y.default)(x.default.mark(function t(e){var r,n,a,u,o,c,i,s=e.method,f=void 0===s?"":s,d=e.path,l=void 0===d?"":d,p=e.header,v=void 0===p?{}:p,h=e.body,m=void 0===h?"":h;return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return A.debug("constructEUAParams",{method:f,path:l,header:v,body:m}),t.next=3,coreAccount.getLoginModel();case 3:if(r=t.sent,n=r.authToken,a=r.serverUportalAddress,u=r.serverUportalPort,o=r.displayAccount,c="https://"+a+":"+u,"/"===l[0]?c+=l:c=c+"/rest/usg/abs/v1/"+l,""!==n){t.next=13;break}return A.error("invalid authToken for EUA Request."),t.abrupt("return",null);case 13:return i={url:c,type:constant.REQUEST_TYPE.GET,header:{Authorization:"Basic "+n,"X-Request-Operator":$getState().myInfo.show_account||o||""},body:m},""!==m&&(i.type=constant.REQUEST_TYPE.POST,i.header["Content-Type"]="application/json"),v.hasOwnProperty("contentType")&&(i.header["Content-Type"]=v.contentType),""!==f&&(i.type=constant.REQUEST_TYPE[f]),v.hasOwnProperty("etag")&&(i.header["if-none-match"]=v.etag),t.abrupt("return",i);case 19:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),G=function(){var t=(0,y.default)(x.default.mark(function t(){var e,r,n,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",c=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,f=arguments.length>6&&void 0!==arguments[6]&&arguments[6];return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e="user/_search",s=f?200:window.CLIENTCONFIG.EAB_SEARCH_NUM,r=parseInt(a/s)+1,n=(0,g.default)({pageIndex:r,pageSize:s,searchKey:o,deptCode:u,querySubDept:c,searchScope:i}),t.abrupt("return",U({path:e,body:n}));case 5:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}(),M=function(){var t=(0,y.default)(x.default.mark(function t(){var e,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],c=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,G(a,n,u,o,2,0,c);case 2:if(e=t.sent){t.next=5;break}return t.abrupt("return",null);case 5:return t.next=7,F(e);case 7:return r=t.sent,r&&r.hasOwnProperty("data")&&(r.data=q(S(r.data))),t.abrupt("return",r);case 10:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}(),R=function(){var t=(0,y.default)(x.default.mark(function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e="user/_detail",t.abrupt("return",U({path:e,body:r}));case 2:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}(),P=function(){var t=(0,y.default)(x.default.mark(function t(e){var r,n,a,u,o=e.id,c=void 0===o?"":o,i=e.downloadPath,s=void 0===i?"":i,f=e.uploadPath,d=void 0===f?"":f,l=e.size,p=void 0===l?"":l,v=e.etag,h=void 0===v?"":v,m=e.contentType,g=void 0===m?"":m,C=e.method,b=void 0===C?"":C;return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return A.debug("constructHeadPortraitParams",{id:c,downloadPath:s,uploadPath:d,size:p,etag:h,contentType:g,method:b}),r="headportrait",""!==c?(r=r+"?id="+c,""!==p&&(r=r+"&size="+p)):""!==p&&(r=r+"?size="+p),n={},""!==h&&(n.etag=h),""!==g?n.contentType=g:""!==d&&(a=d.split(".").pop().toLowerCase(),n.contentType="png"===a?"image/png":"image/jpeg"),b=d?"POST":b,t.next=9,U({path:r,header:n,method:b});case 9:return u=t.sent,u.auth_mode=0,u.filePath=s||d,t.abrupt("return",u);case 13:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),F=function(){var t=(0,y.default)(x.default.mark(function t(e){var r,n,a,u=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Noop;return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,coreAccount.getLoginModel();case 2:if(r=t.sent,r.isSupportAS){t.next=7;break}return A.info("this enviroment is not supported."),u(-1,"not as enviroment"),t.abrupt("return",null);case 7:return t.next=9,coreHttp.sendSyncRequest(e);case 9:if(n=t.sent){t.next=14;break}return A.error("Eua Request Failed, invalid response."),u(-1,"tup invalid response"),t.abrupt("return",null);case 14:if(n.hasOwnProperty("result")&&0===n.result){t.next=18;break}return A.error("Eua Request Failed, result: "+(n.result?n.result:"Unknown Reason.")),u(n.result,"tup or net error"),t.abrupt("return",null);case 18:if(a={},!n.hasOwnProperty("param")||!n.param.hasOwnProperty("resp_code")){t.next=40;break}if(n.param.hasOwnProperty("recv_body")&&n.param.recv_body){t.next=24;break}return A.info("Eua Request Failed, recv_body is null."),u(-1,"server recv_body is null"),t.abrupt("return",null);case 24:a={};try{a=JSON.parse(n.param.recv_body)}catch(t){A.error("parse fail"),a.requestId="Unknown"}if(A.info("Eua Request requestId: ",a.requestId,"; rsp: "+n.param.resp_code),401!==n.param.resp_code){t.next=34;break}return O(),A.error("Eua Request Failed, rsp: "+n.param.resp_code),u(n.param.resp_code,"server token error"),t.abrupt("return",null);case 34:if(304===n.param.resp_code||200===n.param.resp_code){t.next=38;break}return A.error("Eua Request Failed, rsp: "+n.param.resp_code),u(n.param.resp_code,"server unknown error"),t.abrupt("return",null);case 38:t.next=43;break;case 40:return A.error("Eua Request Failed, rsp: missing param or resp_code."),u(-1,"server missing param or resp_code"),t.abrupt("return",null);case 43:if("000000000"===a.returnCode){t.next=47;break}return A.info("Eua Request Failed, return Message: "+(a.returnMessage?a.returnMessage.split(".").pop():"")),u(a.returnCode,"server "+a.returnMessage),t.abrupt("return",null);case 47:return A.info("Eua Request Succeed."),t.abrupt("return",a.data||!0);case 49:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),q=function(t){return t.forEach(function(t){0===t.statusCode||null===t.statusCode?(t.dept_name=t.deptName||"",t.dept_name_cn=t.deptName||"",t.dept_name_en=t.deptName||"",t.time_stamp=t.updateTime,t.result_code=constant.EADDR_CONTACT_RESULT_CODE.SUCCESS,isNullOrEmpty(t.q_pin_yin)&&(t.q_pin_yin=window.pinyinUtil.getPinyin(t.name)),t.isHardTerminal?(t.short_phone=t.number,t.office_phone2=t.number,t.bind_no="",t.mobile=""):(t.bind_no=t.number,t.mobile=t.phone,t.short_phone="",t.office_phone2=""),delete t.deptName,delete t.number,delete t.phone,delete t.updateTime):3===t.statusCode?(A.info("no permission to access "+handleAccountPrint(t.account)),t.result_code=constant.EADDR_CONTACT_RESULT_CODE.SUCCESS):A.warn("userDetail no change, user = "+(0,g.default)(t))}),t},B=function(t){function e(){var t,r,n,a,o=this;(0,d.default)(this,e);for(var i=arguments.length,f=Array(i),l=0;l<i;l++)f[l]=arguments[l];return r=n=(0,p.default)(this,(t=e.__proto__||(0,s.default)(e)).call.apply(t,[this].concat(f))),n.eaddrUnint=(0,y.default)(x.default.mark(function t(){return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,T();case 2:if(t.sent){t.next=4;break}return t.abrupt("return");case 4:return t.next=6,L.reset();case 6:case"end":return t.stop()}},t,o)})),n.searchAvatar=function(){var t=(0,y.default)(x.default.mark(function t(e){var r,a,u,c=e.account,i=e.iconSize,s=void 0===i?constant.AVATAR_SIZE.BIG:i,f=e.callback,d=e.etag,l=void 0===d?"":d;return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return A.info("searchAvatar"),A.debug("searchAvatar",{account:c,iconSize:s,callback:f,etag:l}),t.next=4,coreAccount.getLoginModel();case 4:if(r=t.sent,!r.isSupportAS){t.next=12;break}return t.next=8,appService.getAvatarPath(r.account);case 8:return a=t.sent,t.next=11,n.downloadHeadPortrait({id:c,filePath:""+a+c+".png",resultCallback:f,etag:l});case 11:return t.abrupt("return",t.sent);case 12:return t.next=14,D();case 14:if(t.sent){t.next=16;break}return t.abrupt("return",!1);case 16:return t.next=18,L.wait();case 18:return A.debug("searchAvatar",s),u={ServerType:constant.EADDR_SERVER_TYPE.RCS,ucaccount:c,IconSize:s},t.abrupt("return",coreTup.getEUAInstance().then(function(t){return t.setNotifies({196611:f}),t.eaddrSearchAvatar(u).then(function(t){return A.debug("eaddrSearchAvatar"),I(t),t})}));case 21:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.searchAvatarList=function(){var t=(0,y.default)(x.default.mark(function t(e){var r,n=e.accountList,a=e.callback;return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return A.debug("searchAvatarList",n),t.next=3,D();case 3:if(t.sent){t.next=5;break}return t.abrupt("return",!1);case 5:return t.next=7,L.wait();case 7:return A.info("searchAvatarList begin"),r={ServerType:constant.EADDR_SERVER_TYPE.RCS,ucaccounts:n,IconSize:0},t.abrupt("return",coreTup.getEUAInstance().then(function(t){return t.setNotifies({196616:a}),t.eaddrSearchAvatarList(r).then(function(t){return A.debug("searchAvatarList"),I(t),t})}));case 10:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.setAvatar=function(){var t=(0,y.default)(x.default.mark(function t(e){var r,a,u,c=e.data,i=e.callback,s=e.contentType;return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return A.info("setAvatar"),A.debug("setAvatar",{data:c,callback:i}),t.next=4,coreAccount.getLoginModel();case 4:if(r=t.sent,!r.isSupportAS){t.next=13;break}return t.next=8,n.uploadHeadPortrait({id:r.account,filePath:c.LargeIconFilePath,resultCallback:i,contentType:s});case 8:return a=t.sent,A.info("setAvatar based on restful"),t.abrupt("return",{result:a.result});case 13:return t.next=15,D();case 15:if(t.sent){t.next=17;break}return t.abrupt("return");case 17:return t.next=19,L.wait();case 19:return u={ServerType:3,IconType:1,SmallIconFilePath:c.SmallIconFilePath,MediumIconFilePath:c.MediumIconFilePath,LargeIconFilePath:c.LargeIconFilePath},t.abrupt("return",coreTup.getEUAInstance().then(function(t){return t.setEaddrBaseEvent({upLoadAvatarAck:function(t){I(t),i(t)}}),t.eaddrSetAvatar(u).then(function(t){return I(t),t})}));case 21:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.searchServerContact=function(){var t=(0,y.default)(x.default.mark(function t(e){var r,a,u,c,i,s=e.query_key,f=void 0===s?"":s,d=e.pageOffset,l=void 0===d?0:d,p=e.SearchType,v=void 0===p?0:p;return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,coreAccount.getLoginModel();case 2:if(r=t.sent,!r.isSupportAS){t.next=16;break}return A.info("query user list in cloudusg"),t.next=7,n.queryUserList({query_key:f,offSet:l});case 7:if(!(a=t.sent)){t.next=12;break}return t.abrupt("return",{recordAmount:a.totalCount,userInformationList:a.data});case 12:return A.info("query user list in cloudusg failed."),t.abrupt("return",{recordAmount:0,userInformationList:[]});case 14:t.next=37;break;case 16:return t.next=18,D();case 18:if(t.sent){t.next=20;break}return t.abrupt("return",{});case 20:return t.prev=20,t.next=23,L.wait();case 23:t.next=29;break;case 25:return t.prev=25,t.t0=t.catch(20),A.error("eabserverLoginAtomic error : "+t.t0),t.abrupt("return",{});case 29:return A.debug("load ent first time"),A.info("searchServerContact"),f=encodeURIComponent(f),f=""===f?" ":f,u=window.CLIENTCONFIG.EAB_SEARCH_NUM||20,c=parseInt(l/u)+1,i={ServerType:3,condition:f,PageIndex:c,SearchType:v,Dept:""},t.abrupt("return",coreTup.getEUAInstance().then(function(t){return t.eaddrSearchInfo(i).then(function(t){if(I(t)){t.hasOwnProperty("param")&&t.param.hasOwnProperty("entry")&&(t.param.entry=S(t.param.entry));var e=t.param.entry,r=t.param.TotalNum;return A.info("interface server all contacts search finish,count",r),{recordAmount:r,userInformationList:e}}return A.error("searchServerContact failed"),{}})}));case 37:case"end":return t.stop()}},t,o,[[20,25]])}));return function(e){return t.apply(this,arguments)}}(),n.queryServerContact=function(){var t=(0,y.default)(x.default.mark(function t(e){var r,a,u,c;return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return A.info("queryServerContact"),t.next=3,coreAccount.getLoginModel();case 3:if(r=t.sent,!(r.isSupportAS&&e.trim().length>0)){t.next=17;break}return t.next=7,n.queryUserList({condition:e});case 7:if(!(a=t.sent)||!a.data){t.next=13;break}return u=a.data.filter(function(t){return t.bind_no.indexOf(e)>0||t.account.indexOf(e)}),t.abrupt("return",{param:u,result:1});case 13:return A.error("queryServerContact failed"),t.abrupt("return",{param:{},result:0});case 15:t.next=25;break;case 17:return t.next=19,D();case 19:if(t.sent){t.next=21;break}return t.abrupt("return",{param:{}});case 21:return t.next=23,L.wait();case 23:return c={ServerType:3,condition:e,PageIndex:1,SearchType:1,Dept:""},t.abrupt("return",coreTup.getEUAInstance().then(function(t){return t.eaddrSearchInfo(c).then(function(t){return I(t)?(t.hasOwnProperty("param")&&t.param.hasOwnProperty("entry")&&(t.param.entry=S(t.param.entry)),{param:t.param.entry[0],result:t.param.result}):(A.error("queryServerContact failed"),{param:{}})})}));case 25:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.queryUserListFromEaddr=function(){var t=(0,y.default)(x.default.mark(function t(e){var r,a,u,i,s;return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(A.info("queryUserListFromEaddr"),!(e instanceof Array)){t.next=28;break}return t.next=4,coreAccount.getLoginModel();case 4:if(r=t.sent,!r.isSupportAS){t.next=18;break}return A.info("query user list in cloudusg"),a=e.map(function(t){return{id:t.username}}),t.next=10,n.syncUserDetails(a);case 10:if(!((u=t.sent)instanceof Array&&u.length>0)){t.next=14;break}return i={entry:u,result:0},t.abrupt("return",i);case 14:return A.info("query user list in cloudusg failed."),t.abrupt("return",{});case 18:return t.next=20,D();case 20:if(t.sent){t.next=22;break}return t.abrupt("return");case 22:return t.next=24,L.wait();case 24:return s={users:[].concat((0,c.default)(e))},t.abrupt("return",coreTup.getEUAInstance().then(function(t){return t.eaddrSearchUserList(s).then(function(t){return I(t)?(t.hasOwnProperty("param")&&t.param.hasOwnProperty("entry")&&(t.param.entry=S(t.param.entry)),t.param):(A.error("queryUserListFromEaddr failed"),{})})}));case 26:t.next=30;break;case 28:return A.error("queryUserListFromEaddr accountList is not array"),t.abrupt("return",{});case 30:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.refreshTocken=(0,y.default)(x.default.mark(function t(){return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return A.info("eua refreshToken, just reset eabserverLoginAtomic"),t.abrupt("return",L.reset());case 2:case"end":return t.stop()}},t,o)})),n.getDeptTree=(0,y.default)(x.default.mark(function t(){return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return A.info("euaRequest: before getDeptTree"),t.next=3,n.getDeptList();case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}},t,o)})),n.getDeptList=function(){var t=(0,y.default)(x.default.mark(function t(){var e,r,n,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return A.info("euaRequest: before getDeptList"),e=""===a?"":"/"+a,r="department"+e,t.next=5,U({path:r});case 5:if(n=t.sent){t.next=8;break}return t.abrupt("return",null);case 8:return t.next=10,F(n);case 10:return t.abrupt("return",t.sent);case 11:case"end":return t.stop()}},t,o)}));return function(){return t.apply(this,arguments)}}(),n.getDeptUserList=function(){var t=(0,y.default)(x.default.mark(function t(e){var r=e.deptID,n=void 0===r?"":r,a=e.offSet,u=void 0===a?0:a,c=e.showAll,i=void 0===c||c,s=e.isLoadMax,f=void 0!==s&&s;return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return A.info("euaRequest: before getDeptUserList"),t.next=3,M(n,u,"",i,f);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.queryUserList=function(){var t=(0,y.default)(x.default.mark(function t(e){var r=e.query_key,n=void 0===r?"":r,a=e.offSet,u=void 0===a?0:a;return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return A.info("euaRequest: before queryDeptUserList"),t.next=3,M("",u,n,!0);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.syncUserDetails=function(){var t=(0,y.default)(x.default.mark(function t(){var e,r,n,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(A.info("euaRequest: before syncUserDetails"),!(a instanceof Array&&a.length>0)){t.next=13;break}return t.next=4,R((0,g.default)(a));case 4:if(e=t.sent){t.next=7;break}return t.abrupt("return",null);case 7:return t.next=9,F(e);case 9:if(!((r=t.sent)instanceof Array&&r.length>0)){t.next=13;break}return n=r.filter(function(t){return-1!==[0,1,3].indexOf(t.statusCode)}),t.abrupt("return",q(S(n)));case 13:return t.abrupt("return",null);case 14:case"end":return t.stop()}},t,o)}));return function(){return t.apply(this,arguments)}}(),n.downloadHeadPortrait=function(){var t=(0,y.default)(x.default.mark(function t(e){var r,n=e.id,a=void 0===n?"":n,u=e.filePath,c=void 0===u?"":u,i=e.size,s=void 0===i?"large":i,f=e.etag,d=void 0===f?"":f,l=e.resultCallback;return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return A.info("euaRequest: before downloadHeadPortrait"),t.next=3,P({id:a,downloadPath:c,size:s,etag:d});case 3:if(r=t.sent,A.debug("downloadHeadPortrait",r),r){t.next=7;break}return t.abrupt("return",null);case 7:return t.next=9,coreHttp.downloadFile({params:r,resultCallback:l});case 9:return t.abrupt("return",t.sent);case 10:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.uploadHeadPortrait=function(){var t=(0,y.default)(x.default.mark(function t(e){var r,n=e.id,a=void 0===n?"":n,u=e.filePath,c=void 0===u?"":u,i=e.resultCallback,s=e.contentType;return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return A.info("euaRequest: before uploadHeadPortrait"),t.next=3,P({id:a,uploadPath:c,contentType:s});case 3:if(r=t.sent){t.next=6;break}return t.abrupt("return",null);case 6:if(!(i&&i instanceof Function)){t.next=13;break}return r.resultCallback=i,t.next=10,coreHttp.sendAsyncRequest(r);case 10:return t.abrupt("return",t.sent);case 13:return t.next=15,coreHttp.sendSyncRequest(r);case 15:return t.abrupt("return",t.sent);case 16:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.uploadUserInfo=function(){var t=(0,y.default)(x.default.mark(function t(){var e,r,n,a,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return A.info("euaRequest: before uploadUserInfo"),e="PUT",r="/rest/usg/datacenter/v1/member",n=(0,g.default)(u),t.next=6,U({method:e,path:r,body:n});case 6:if(a=t.sent){t.next=9;break}return t.abrupt("return",null);case 9:return t.next=11,F(a);case 11:return t.abrupt("return",t.sent);case 12:case"end":return t.stop()}},t,o)}));return function(){return t.apply(this,arguments)}}(),n.queryFriendsBySearchText=function(){var t=(0,y.default)(x.default.mark(function t(e){var r;return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return A.info("queryFriendsBySearchText"),t.next=3,coreDb.queryContactBySearchText(e);case 3:return r=t.sent,isNullOrEmpty(r)||(r=r.filter(function(t){return!isNullOrEmpty(t.contact_id)})),t.abrupt("return",r);case 6:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.addExternalContact=function(){var t=(0,y.default)(x.default.mark(function t(e){var r,a,u,c,i,s,f;return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return A.info("addExternalContact"),r=(0,k.convertJsToUsgExternalContact)(e),a="external-contact",u=(0,g.default)(r),t.next=6,U({path:a,body:u});case 6:if(c=t.sent){t.next=11;break}return A.error("addExternalContact constructEUAParams fail"),coreUt.utCustomEvent({eventId:constant.EVENT_ID.UT_CONTACTGROUP_ADD_EXTERNAL_CONTACT,params:[-1,"client inner error"]}),t.abrupt("return",null);case 11:return i=function(t,e){coreUt.utCustomEvent({eventId:constant.EVENT_ID.UT_CONTACTGROUP_ADD_EXTERNAL_CONTACT,params:[t,e]})},t.next=14,F(c,i);case 14:if(s=t.sent,A.info("addExternalContact ret = "+s),!isNullOrEmpty(s)){t.next=20;break}return t.abrupt("return",null);case 20:return t.next=22,n.queryExternalContact([{id:s}]);case 22:if(f=t.sent,!isNullOrEmpty(f)){t.next=29;break}return A.error("addExternalContact query fail"),coreUt.utCustomEvent({eventId:constant.EVENT_ID.UT_CONTACTGROUP_ADD_EXTERNAL_CONTACT,params:[-1,"query fail after add"]}),t.abrupt("return",null);case 29:return coreUt.utCustomEvent({eventId:constant.EVENT_ID.UT_CONTACTGROUP_ADD_EXTERNAL_CONTACT,params:[0,""]}),t.abrupt("return",f[0]);case 31:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.modifyExternalContact=function(){var t=(0,y.default)(x.default.mark(function t(e){var r,a,u,c,i,s,f,d=e.uuid,l=e.modifyUserInfo;return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return A.info("modifyExternalContact uuid = "+d),r=(0,k.convertJsToUsgExternalContact)(l),a="external-contact/"+d,u="PUT",c=(0,g.default)(r),t.next=7,U({method:u,path:a,body:c});case 7:if(i=t.sent){t.next=10;break}return t.abrupt("return",null);case 10:return t.next=12,F(i);case 12:if(s=t.sent,A.info("modifyExternalContact ret = ",s),!s){t.next=25;break}return t.next=17,n.queryExternalContact([{id:d}]);case 17:if(f=t.sent,!isNullOrEmpty(f)){t.next=22;break}return t.abrupt("return",null);case 22:return t.abrupt("return",f[0]);case 23:t.next=26;break;case 25:return t.abrupt("return",null);case 26:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.queryExternalContact=function(){var t=(0,y.default)(x.default.mark(function t(e){var r,n,a,c,i,s;return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return A.info("queryExternalContact"),r="external-contact/_detail",n=(0,g.default)(e),t.next=5,U({path:r,body:n});case 5:if(a=t.sent){t.next=8;break}return t.abrupt("return",null);case 8:return A.info("queryExternalContact euaParams = ",a),t.next=11,F(a);case 11:if(c=t.sent,A.info("queryExternalContact isNullOrEmpty(ret) = "+isNullOrEmpty(c)),!(c instanceof Array&&c.length>0)){t.next=19;break}return i=c.filter(function(t){return 0===t.statusCode||1===t.statusCode}),s=i.map(function(t){var e=(0,u.default)({},t);return N(t),0===t.statusCode&&(e=(0,k.convertUsgToJsExternalContact)(t)),e}),t.abrupt("return",s);case 19:return t.abrupt("return",null);case 20:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.deleteExternalContact=function(){var t=(0,y.default)(x.default.mark(function t(e){var r,n,a,u;return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return A.info("deleteExternalContact"),r="external-contact/_delete",n=(0,g.default)(e),t.next=5,U({path:r,body:n});case 5:if(a=t.sent){t.next=8;break}return t.abrupt("return",!1);case 8:return A.info("deleteExternalContact euaParams = ",a),t.next=11,F(a);case 11:return u=t.sent,A.info("deleteExternalContact ret = ",u),t.abrupt("return",u);case 14:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.searchExternalContactByKey=function(){var t=(0,y.default)(x.default.mark(function t(e){var r,n,a,u,c,i=e.pageIndex,s=void 0===i?1:i,f=e.pageSize,d=void 0===f?100:f,l=e.searchKey,p=void 0===l?"":l;return x.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return A.info("searchExternalContactByKey"),r="external-contact/_search",n=(0,g.default)({pageIndex:s,pageSize:d,searchKey:p}),t.next=5,U({path:r,body:n});case 5:if(a=t.sent){t.next=8;break}return t.abrupt("return",null);case 8:return t.next=10,F(a);case 10:if(!((u=t.sent)&&u.data instanceof Array)){t.next=17;break}return c=[],u.data.length>0&&(c=u.data.map(function(t){return N(t),(0,k.convertUsgToJsExternalContact)(t)})),t.abrupt("return",c);case 17:return t.abrupt("return",null);case 18:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),a=r,(0,p.default)(n,a)}return(0,h.default)(e,t),e}(_.default);e.euaserver=new B},186:function(t,e,r){var n=r(16),a=r(6)("iterator"),u=r(17);t.exports=r(8).isIterable=function(t){var e=Object(t);return void 0!==e[a]||"@@iterator"in e||u.hasOwnProperty(n(e))}},1860:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=r(1),u=n(a),o=r(2),c=n(o),i=r(131),s=n(i),f=r(4),d=n(f),l=r(132),p=n(l),v=r(133),h=n(v),m=function(t){function e(){var t,r,n,a,o=this;(0,d.default)(this,e);for(var i=arguments.length,f=Array(i),l=0;l<i;l++)f[l]=arguments[l];return r=n=(0,p.default)(this,(t=e.__proto__||(0,s.default)(e)).call.apply(t,[this].concat(f))),n.eaddrUnint=(0,c.default)(u.default.mark(function t(){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)})),n.searchAvatar=function(){var t=(0,c.default)(u.default.mark(function t(e){var r=(e.account,e.iconSize);void 0===r&&constant.AVATAR_SIZE.BIG,e.callback;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.searchAvatarList=function(){var t=(0,c.default)(u.default.mark(function t(e){e.accountList,e.callback;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.setAvatar=function(){var t=(0,c.default)(u.default.mark(function t(e){e.data,e.callback,e.contentType;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.searchServerContact=function(){var t=(0,c.default)(u.default.mark(function t(e){e.query_key,e.pageOffset,e.SearchType;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.queryServerContact=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.queryUserListFromEaddr=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.refreshTocken=(0,c.default)(u.default.mark(function t(){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)})),n.getDeptTree=(0,c.default)(u.default.mark(function t(){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)})),n.getDeptList=function(){var t=(0,c.default)(u.default.mark(function t(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(){return t.apply(this,arguments)}}(),n.getDeptUserList=function(){var t=(0,c.default)(u.default.mark(function t(e){e.deptID,e.offSet,e.showAll,e.isLoadMax;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.queryDeptUserList=function(){var t=(0,c.default)(u.default.mark(function t(e){e.deptID,e.offSet,e.query_key;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.syncUserDetails=function(){var t=(0,c.default)(u.default.mark(function t(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(){return t.apply(this,arguments)}}(),n.downloadHeadPortrait=function(){var t=(0,c.default)(u.default.mark(function t(e){e.id,e.filePath,e.size,e.etag,e.resultCallback;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.uploadHeadPortrait=function(){var t=(0,c.default)(u.default.mark(function t(e){e.id,e.filePath,e.resultCallback,e.contentType;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.uploadUserInfo=function(){var t=(0,c.default)(u.default.mark(function t(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(){return t.apply(this,arguments)}}(),n.queryFriendsBySearchText=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.addExternalContact=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.modifyExternalContact=function(){var t=(0,c.default)(u.default.mark(function t(e){e.uuid,e.modifyUserInfo;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.queryExternalContact=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.deleteExternalContact=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.searchExternalContactByKey=function(){var t=(0,c.default)(u.default.mark(function t(e){e.pageIndex,e.pageSize,e.searchKey;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),a=r,(0,p.default)(n,a)}return(0,h.default)(e,t),e}(coreCommon.Interface);e.default=m},1861:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.convertJsToUsgExternalContact=e.convertUsgToJsExternalContact=void 0;var a=r(147),u=n(a),o=r(135),c=n(o),i={mobile:"mobileCountry",office_phone:"officePhoneCountry"};e.convertUsgToJsExternalContact=function(t){var e={isExternalContact:1,account:t.account,show_account:t.show_account,contact_id:t.account,name:t.name,address:t.address,email:t.email,dept_name:t.deptName,dept_name_cn:t.deptName,dept_name_en:t.deptName,mobile:t.phone,mobileCountry:t.country,office_phone:t.otherNumber,officePhoneCountry:t.otherNumberCountry,fax:t.faxCode,faxCountry:t.faxCodeCountry,website:t.website,postcode:t.zipCode,desc:t.remarks,title:t.position,crop_name:t.corpName,result_code:constant.EADDR_CONTACT_RESULT_CODE.SUCCESS,externalType:t.type},r=(0,c.default)({},e);return(0,u.default)(i).map(function(t){var e=i[t],n=r[e];if(!isNullOrEmpty(n)){var a=constant.PHONE_COUNTRY_CODE.find(function(t){return t.country===n});r[e]=a.key}}),r},e.convertJsToUsgExternalContact=function(t){var e=(0,c.default)({},t);return(0,u.default)(i).map(function(t){var r=e[t];if(!isNullOrEmpty(r)){var n=i[t],a=e[n]?e[n]:0,u=constant.PHONE_COUNTRY_CODE[a];e[n]=u.country,e[t]=u.preNum+e[t]}}),{name:isNullOrEmpty(e.name)?"":e.name,country:isNullOrEmpty(e.mobile)?"":e.mobileCountry,phone:isNullOrEmpty(e.mobile)?"":e.mobile,otherNumberCountry:isNullOrEmpty(e.office_phone)?"":e.officePhoneCountry,otherNumber:isNullOrEmpty(e.office_phone)?"":e.office_phone,faxCodeCountry:isNullOrEmpty(e.fax)?"":e.faxCountry,faxCode:isNullOrEmpty(e.fax)?"":e.fax,email:isNullOrEmpty(e.email)?"":e.email,corpName:isNullOrEmpty(e.crop_name)?"":e.crop_name,deptName:isNullOrEmpty(e.dept_name)?"":e.dept_name,position:isNullOrEmpty(e.title)?"":e.title,address:isNullOrEmpty(e.address)?"":e.address,website:isNullOrEmpty(e.website)?"":e.website,zipCode:isNullOrEmpty(e.postcode)?"":e.postcode,remarks:isNullOrEmpty(e.desc)?"":e.desc}}},1862:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}var a=r(1),u=n(a),o=r(2),c=n(o),i=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e.code){t.next=10;break}t.t0=e.event,t.next="total"===t.t0?4:"uportal"===t.t0?6:9;break;case 4:return window.CLIENTCONFIG.ENABLE_IT_MEETING?coreUi.getDirectoryMenuKeyScroll():(coreUi.loadServerContact(),coreUi.initDepartmentTree(),coreUi.getDirectoryMenuKeyScroll(),coreContact.loadMyContactInfoAndAvatar()),t.abrupt("break",10);case 6:return coreContact.refreshTocken().then(function(){return(0,f.dealExternalContact)()}),(0,f.teLoadContactAndGroupList)(),t.abrupt("break",10);case 9:return t.abrupt("break",10);case 10:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),s=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),f=r(820);coreLogger.getLogger("contact")("moduleMessager");coreCommon.registeModuleListener("login",i),coreCommon.registeModuleListener("logout",s)},1863:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.getContactApiList=void 0;var a=r(1),u=n(a),o=r(2),c=n(o),i=r(131),s=n(i),f=r(4),d=n(f),l=r(132),p=n(l),v=r(133),h=n(v),m=r(1864),g=n(m),C=r(634),x=r(633),b=r(1865),y=r(594),w=r(1866),_=r(1867),k=r(968),A=r(632),E=r(820),L=r(1868),I=r(1869),S=r(1870),N=r(1871),O=r(969),T=r(971),D=r(970),U=function(t){function e(){var t,r,n,a,o=this;(0,d.default)(this,e);for(var i=arguments.length,f=Array(i),l=0;l<i;l++)f[l]=arguments[l];return r=n=(0,p.default)(this,(t=e.__proto__||(0,s.default)(e)).call.apply(t,[this].concat(f))),n.getContactByCallNumber=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.getContactByCallNumber)(e));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.getContactByAccount=function(){var t=(0,c.default)(u.default.mark(function t(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.getContactByAccount)(e,r,n,a));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.getContactListByAccountList=function(){var t=(0,c.default)(u.default.mark(function t(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.getContactListByAccountList)(e,r));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.getContactDetailInfo=function(){var t=(0,c.default)(u.default.mark(function t(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.getContactDetailInfo)(e,r));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.updateSignatureFromServer=function(){var t=(0,c.default)(u.default.mark(function t(e,r){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.updateSignatureFromServer)(e,r));case 1:case"end":return t.stop()}},t,o)}));return function(e,r){return t.apply(this,arguments)}}(),n.updateSignatureByRecent=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.updateSignatureByRecent)(e));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.createContactConversation=function(){var t=(0,c.default)(u.default.mark(function t(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.createContactConversation)(e,r,n));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.openContactConversation=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.openContactConversation)(e));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.openContactConversationByConf=function(){var t=(0,c.default)(u.default.mark(function t(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.openContactConversationByConf)(e,r));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.toggleRemoveFromAll=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.toggleRemoveFromAll)(e));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.deleteContact=function(){var t=(0,c.default)(u.default.mark(function t(e,r){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.deleteContact)(e,r));case 1:case"end":return t.stop()}},t,o)}));return function(e,r){return t.apply(this,arguments)}}(),n.deleteContactFromAll=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.deleteContactFromAll)(e));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.deleteContactSubmenu=function(){var t=(0,c.default)(u.default.mark(function t(e,r){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.deleteContactSubmenu)(e,r));case 1:case"end":return t.stop()}},t,o)}));return function(e,r){return t.apply(this,arguments)}}(),n.moveToOtherGroup=function(){var t=(0,c.default)(u.default.mark(function t(e,r,n,a,c){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.moveToOtherGroup)(e,r,n,a,c));case 1:case"end":return t.stop()}},t,o)}));return function(e,r,n,a,u){return t.apply(this,arguments)}}(),n.createContactGroup=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.createContactGroup)(e));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.createNewContactGroup=(0,c.default)(u.default.mark(function t(){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.createNewContactGroup)());case 1:case"end":return t.stop()}},t,o)})),n.setAddNewContactValueLogic=function(t){return(0,C.setAddNewContactValueLogic)(t)},n.checkContactGroupName=function(t){return(0,C.checkContactGroupName)(t)},n.addContact=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.addContact)(e));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.changeContactGroupName=function(){var t=(0,c.default)(u.default.mark(function t(e,r,n){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.changeContactGroupName)(e,r,n));case 1:case"end":return t.stop()}},t,o)}));return function(e,r,n){return t.apply(this,arguments)}}(),n.selectAddContactList=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.selectAddContactList)(e));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.createConversationLogic=function(){return(0,C.createConversationLogic)()},n.createConversation=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.createConversation)(e));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.dealUserInfoChange=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.dealUserInfoChange)(e));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.dealUserInfoOprNotify=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.dealUserInfoOprNotify)(e));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.loadMyContactInfoAndAvatar=(0,c.default)(u.default.mark(function t(){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,C.loadMyContactInfoAndAvatar)());case 1:case"end":return t.stop()}},t,o)})),n.getUserInfo=function(){var t=(0,c.default)(u.default.mark(function t(e,r){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,x.getUserInfo)(e,r,n));case 1:case"end":return t.stop()}},t,o)}));return function(e,r){return t.apply(this,arguments)}}(),n.queryEserverSignature=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,x.queryEserverSignature)(e));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.saveContactInfoList=function(){var t=(0,c.default)(u.default.mark(function t(e,r){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,b.saveContactInfoList)(e,r));case 1:case"end":return t.stop()}},t,o)}));return function(e,r){return t.apply(this,arguments)}}(),n.saveContactInfo=function(){var t=(0,c.default)(u.default.mark(function t(e,r){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!window.CLIENTCONFIG.USE_IM){t.next=4;break}return t.abrupt("return",(0,b.saveContactInfo)(e,r));case 4:return t.abrupt("return",(0,b.saveContactInfo)(e,!1));case 5:case"end":return t.stop()}},t,o)}));return function(e,r){return t.apply(this,arguments)}}(),n.confirmPreservateLogic=function(){var t=(0,c.default)(u.default.mark(function t(e,r){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,y.confirmPreservateLogic)(e,r));case 1:case"end":return t.stop()}},t,o)}));return function(e,r){return t.apply(this,arguments)}}(),n.getFullContactList=(0,c.default)(u.default.mark(function t(){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,y.getFullContactList)());case 1:case"end":return t.stop()}},t,o)})),n.setLinkageStatusLogic=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,y.setLinkageStatusLogic)(e));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.getLinkageStatusLogic=(0,c.default)(u.default.mark(function t(){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,y.getLinkageStatusLogic)());case 1:case"end":return t.stop()}},t,o)})),n.getEserverUserInfo=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,y.getEserverUserInfo)(e));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.uploadWorkplaceAvatar=function(){var t=(0,c.default)(u.default.mark(function t(e){var r=e.imageStr,n=e.fileName;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,S.uploadWorkplaceAvatar)({imageStr:r,fileName:n}));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.setSign=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,S.setSign)(e));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.addCustomContact=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,w.addCustomContact)(e));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.modifyCustomContact=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,w.modifyCustomContact)(e));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.checkEmailInput=function(t){return(0,w.checkEmailInput)(t)},n.checkIsChange=function(t,e){return(0,w.checkIsChange)(t,e)},n.searchContactByNum=function(){var t=(0,c.default)(u.default.mark(function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,w.searchContactByNum)(e));case 1:case"end":return t.stop()}},t,o)}));return function(){return t.apply(this,arguments)}}(),n.delCustomContact=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,w.delCustomContact)(e));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.getCallNumList=function(t){return(0,_.getCallNumList)(t)},n.getVideoNumList=function(t){return(0,_.getVideoNumList)(t)},n.getTempCallUserInfo=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,_.getTempCallUserInfo)(t,e,r)},n.addContactToContactGroup=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,k.addContactToContactGroup)(e));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.sortMUserListSync=function(t){return(0,A.sortMUserListSync)(t)},n.normalLoadContactAndGroupList=(0,c.default)(u.default.mark(function t(){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,E.normalLoadContactAndGroupList)());case 1:case"end":return t.stop()}},t,o)})),n.getLocalContactAndGroupInfo=(0,c.default)(u.default.mark(function t(){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,E.getLocalContactAndGroupInfo)());case 1:case"end":return t.stop()}},t,o)})),n.deleteContactFromDB=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,E.deleteContactFromDB)(e));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.downloadContactListAvatar=function(){var t=(0,c.default)(u.default.mark(function t(e){var r=e.accountList,n=e.highPriority;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,L.downloadContactListAvatar)(r,n));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.downloadContactAvatar=function(){var t=(0,c.default)(u.default.mark(function t(e){var r=e.account,n=e.iconSize;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,L.downloadContactAvatar)(r,n));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.getLocalAvatar=(0,c.default)(u.default.mark(function t(){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,I.getLocalAvatar)());case 1:case"end":return t.stop()}},t,o)})),n.uploadAvatar=function(){var t=(0,c.default)(u.default.mark(function t(e){var r=e.param,n=e.contentType,a=e.imgBase64;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,N.uploadAvatar)(r,n,a));case 1:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.queryUserInfoByKeyWord=function(){var t=(0,c.default)(u.default.mark(function t(e){var r,n,a,c,i=e.keyWord;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,coreContact.searchServerContact({query_key:i});case 2:if(r=t.sent,n=r.userInformationList,!Array.isArray(n)||0===n.length){t.next=10;break}return a=n[0].account,t.next=8,(0,x.getUserInfo)(a,null,!1);case 8:return c=t.sent,t.abrupt("return",c.param||{});case 10:return t.abrupt("return",{});case 11:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.initTaskQueue=function(){var t=(0,c.default)(u.default.mark(function t(e){e.info;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:(0,O.initDownloadAsAvatarTaskQueue)(),(0,T.initDownloadAvatarTaskQueue)(),(0,D.initDownloadAvatarListTaskQueue)(),(0,O.initDownloadAsAvatarListTaskQueue)(),coreIm.initStatusUpdateTaskQueue();case 5:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),a=r,(0,p.default)(n,a)}return(0,h.default)(e,t),e}(g.default),G=void 0;e.getContactApiList=function(){return isNullOrEmpty(G)&&(G=new U),G.getApiList()}},1864:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=r(1),u=n(a),o=r(2),c=n(o),i=r(131),s=n(i),f=r(4),d=n(f),l=r(132),p=n(l),v=r(133),h=n(v),m=function(t){function e(){var t,r,n,a,o=this;(0,d.default)(this,e);for(var i=arguments.length,f=Array(i),l=0;l<i;l++)f[l]=arguments[l];return r=n=(0,p.default)(this,(t=e.__proto__||(0,s.default)(e)).call.apply(t,[this].concat(f))),n.getContactByCallNumber=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.getContactByAccount=function(){var t=(0,c.default)(u.default.mark(function t(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2],!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.getContactListByAccountList=function(){var t=(0,c.default)(u.default.mark(function t(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.getContactDetailInfo=function(){var t=(0,c.default)(u.default.mark(function t(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.updateSignatureFromServer=function(){var t=(0,c.default)(u.default.mark(function t(e,r){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e,r){return t.apply(this,arguments)}}(),n.updateSignatureByRecent=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.createContactConversation=function(){var t=(0,c.default)(u.default.mark(function t(e){!(arguments.length>1&&void 0!==arguments[1])||arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2];return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.openContactConversation=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.openContactConversationByConf=(0,c.default)(u.default.mark(function t(){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)})),n.toggleRemoveFromAll=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.deleteContact=function(){var t=(0,c.default)(u.default.mark(function t(e,r){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e,r){return t.apply(this,arguments)}}(),n.deleteContactFromAll=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.deleteContactSubmenu=function(){var t=(0,c.default)(u.default.mark(function t(e,r){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e,r){return t.apply(this,arguments)}}(),n.moveToOtherGroup=function(){var t=(0,c.default)(u.default.mark(function t(e,r,n,a,c){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e,r,n,a,u){return t.apply(this,arguments)}}(),n.createContactGroup=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.createNewContactGroup=(0,c.default)(u.default.mark(function t(){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)})),n.setAddNewContactValueLogic=function(t){},n.checkContactGroupName=function(t){},n.addContact=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.changeContactGroupName=function(){var t=(0,c.default)(u.default.mark(function t(e,r,n){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e,r,n){return t.apply(this,arguments)}}(),n.selectAddContactList=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.createConversationLogic=function(){},n.createConversation=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.dealUserInfoChange=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.dealUserInfoOprNotify=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.loadMyContactInfoAndAvatar=(0,c.default)(u.default.mark(function t(){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)})),n.getUserInfo=function(){var t=(0,c.default)(u.default.mark(function t(e,r){!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e,r){return t.apply(this,arguments)}}(),n.queryEserverSignature=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.saveContactInfoList=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.saveContactInfo=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.confirmPreservateLogic=function(){var t=(0,c.default)(u.default.mark(function t(e,r){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e,r){return t.apply(this,arguments)}}(),n.getFullContactList=(0,c.default)(u.default.mark(function t(){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)})),n.setLinkageStatusLogic=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.getLinkageStatusLogic=(0,c.default)(u.default.mark(function t(){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)})),n.getEserverUserInfo=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.uploadWorkplaceAvatar=function(){var t=(0,c.default)(u.default.mark(function t(e){e.imageStr,e.fileName;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.setSign=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.addCustomContact=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.modifyCustomContact=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.checkEmailInput=function(t){},n.checkIsChange=function(t,e){},n.searchContactByNum=function(){var t=(0,c.default)(u.default.mark(function t(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(){return t.apply(this,arguments)}}(),n.getCallNumList=function(t){},n.getVideoNumList=function(t){},n.getTempCallUserInfo=function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]&&arguments[2]},n.addContactToContactGroup=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.sortMUserListSync=function(t){},n.normalLoadContactAndGroupList=(0,c.default)(u.default.mark(function t(){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)})),n.getLocalContactAndGroupInfo=(0,c.default)(u.default.mark(function t(){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)})),n.deleteContactFromDB=function(){var t=(0,c.default)(u.default.mark(function t(e){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.downloadContactListAvatar=function(){var t=(0,c.default)(u.default.mark(function t(e){e.accountList,e.highPriority;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.downloadContactAvatar=function(){var t=(0,c.default)(u.default.mark(function t(e){e.account,e.iconSize;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.getLocalAvatar=(0,c.default)(u.default.mark(function t(){return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)})),n.uploadAvatar=function(){var t=(0,c.default)(u.default.mark(function t(e){e.param,e.contentType,e.imgBase64;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.initTaskQueue=function(){var t=(0,c.default)(u.default.mark(function t(e){e.info;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),n.queryUserInfoByKeyWord=function(){var t=(0,c.default)(u.default.mark(function t(e){e.keyWord;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:case"end":return t.stop()}},t,o)}));return function(e){return t.apply(this,arguments)}}(),a=r,(0,p.default)(n,a)}return(0,h.default)(e,t),e}(coreCommon.Interface);e.default=m},1865:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.createContactInfoChangeEvent=e.saveContactInfo=e.saveContactInfoList=void 0;var a=r(1),u=n(a),o=r(2),c=n(o),i=coreLogger.getLogger("group")("detail"),s=(e.saveContactInfoList=function(){var t=(0,c.default)(u.default.mark(function t(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,i.info("saveContactInfoList "),t.next=4,coreDb.bulkPutContact(e);case 4:r&&s(e.map(function(t){return t.account})),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),i.error("saveContactInfoList ",t.t0.toString());case 10:case"end":return t.stop()}},t,void 0,[[0,7]])}));return function(e){return t.apply(this,arguments)}}(),e.saveContactInfo=function(){var t=(0,c.default)(u.default.mark(function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,i.info("saveContactInfo "),t.next=4,coreDb.saveContact(e);case 4:return r=t.sent,n&&s([e.account]),t.abrupt("return",r);case 9:t.prev=9,t.t0=t.catch(0),i.error("saveContactInfo ",t.t0.toString());case 12:case"end":return t.stop()}},t,void 0,[[0,9]])}));return function(e){return t.apply(this,arguments)}}(),e.createContactInfoChangeEvent=function(t){var e=new Event("contactInfoChange");e.data={accountList:t},window.dispatchEvent(e)})},1866:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(){var t=$getState(),e=t.contactGroups.contactUserList,r=parseInt(window.CLIENTCONFIG["Device.ComCfg.IM.MaxContact"]);if(isNaN(r))return window.alert(window.language.ADD_FRIEND_ERROR),b.error("checkNowFriendNum esight config IM.MaxContact error"),!1;var n=e?e.length:0;return n>=r?(window.alert(window.language.ADD_TO_MAX),!1):n<r}Object.defineProperty(e,"__esModule",{value:!0}),e.searchContactByNum=e.checkIsChange=e.checkEmailInput=e.delCustomContact=e.modifyCustomContact=e.addCustomContact=void 0;var u=r(147),o=n(u),c=r(135),i=n(c),s=r(155),f=n(s),d=r(1),l=n(d),p=r(2),v=n(p),h=function(){var t=(0,v.default)(l.default.mark(function t(){var e,r,n,a,u,o=this;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=$getState(),r=void 0,n=e.contactGroups.contactGroup,a="Group",-1!==(u=n.findIndex(function(t){return t.name===a}))){t.next=8;break}return t.delegateYield(l.default.mark(function t(){var e,u;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(e=1;-1!==n.findIndex(function(t){return t.group_id===e});)e++;return u={group_id:e,index:n.length,name:a,state:0},t.next=5,coreDb.saveContactGroup(u);case 5:r={group_id:e,index:n.length};case 6:case"end":return t.stop()}},t,o)})(),"t0",6);case 6:t.next=9;break;case 8:r={group_id:n[u].group_id,index:u};case 9:return t.abrupt("return",r);case 10:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),m=r(594),g=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(m),C=r(634),x=r(968),b=coreLogger.getLogger("logic")("addCustom"),y=(e.addCustomContact=function(){var t=(0,v.default)(l.default.mark(function t(e){var r;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(b.info("addCustomContact add custom contact to contact group"),a()){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,coreAccount.getLoginModel();case 5:if(r=t.sent,!r.isSupportAS){t.next=10;break}return t.abrupt("return",y(e));case 10:if(!window.CLIENTCONFIG.USE_IM){t.next=14;break}return t.abrupt("return",_(e));case 14:return t.abrupt("return",k(e));case 15:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),function(){var t=(0,v.default)(l.default.mark(function t(e){var r;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return b.info("addExternalContact"),t.next=3,coreContact.addExternalContact(e);case 3:if(r=t.sent,!isNullOrEmpty(r)){t.next=9;break}return b.error("usg addExternalContact fail"),t.abrupt("return",{result:-1});case 9:return t.next=11,coreContact.saveContactInfo(r);case 11:return t.next=13,(0,C.reloadContactListData)();case 13:return t.abrupt("return",{result:0,externalContact:r});case 14:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}()),w=function(){var t=(0,v.default)(l.default.mark(function t(e){var r;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return b.info("modifyExternalContact"),t.next=3,coreContact.modifyExternalContact({uuid:e.account,modifyUserInfo:e});case 3:if(r=t.sent,!isNullOrEmpty(r)){t.next=9;break}return b.error("usg addExternalContact return uuid is null"),t.abrupt("return",{result:-1});case 9:return t.next=11,coreContact.saveContactInfo(r);case 11:return t.next=13,(0,C.reloadContactListData)();case 13:return $dispatch(coreUi.updateSliderContactDetail(e,!0)),t.abrupt("return",{result:0,externalContact:r});case 15:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),_=function(){var t=(0,v.default)(l.default.mark(function t(e){var r,n,a;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,b.info("normalAddCustomContact begin"),!window.CLIENTCONFIG.ISMOBILE){t.next=8;break}if(e.hasOwnProperty("group_id")){t.next=8;break}return t.next=6,(0,x.dealContactGroupInfo)();case 6:r=t.sent,e.group_id=r.group_id;case 8:return t.next=10,g.addCustomContactService(e);case 10:if(n=t.sent,n.result!==constant.RESULT.SUCCESS||1!==n.param.result){t.next=21;break}return e.contact_id=n.param.contact_id,t.next=15,coreContact.saveContactInfo(e);case 15:return e=t.sent,a={contact_id:e.contact_id,group_id:e.group_id,state:constant.CONTACT_GROUP_STATE.ADD},t.next=19,coreDb.saveContactMemberGroup(a);case 19:return t.next=21,(0,C.reloadContactListData)();case 21:return t.abrupt("return",{result:n.result,externalContact:e});case 24:return t.prev=24,t.t0=t.catch(0),b.error("normalAddCustomContact error",t.t0),t.abrupt("return",{result:1});case 28:case"end":return t.stop()}},t,void 0,[[0,24]])}));return function(e){return t.apply(this,arguments)}}(),k=function(){var t=(0,v.default)(l.default.mark(function t(e){var r;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.delegateYield(l.default.mark(function t(){var r,n,a,u,o;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return b.info("TeAddCustomContact begin"),t.next=3,h();case 3:for(r=t.sent,n=$getState(),a=n.contactGroups.contactUserList,u=1;-1!==a.findIndex(function(t){return parseInt(t.contact_id)===u});)u++;return e.contact_id=u.toString(),e.gender=2,t.next=12,coreContact.saveContactInfo(e);case 12:return e=t.sent,o={contact_id:e.contact_id,group_id:r.group_id,state:constant.CONTACT_GROUP_STATE.ADD},t.next=16,coreDb.saveContactMemberGroup(o);case 16:return t.next=18,(0,C.reloadContactListData)();case 18:return t.abrupt("return",{v:{result:0,externalContact:e}});case 19:case"end":return t.stop()}},t,void 0)})(),"t0",2);case 2:if(r=t.t0,"object"!==(void 0===r?"undefined":(0,f.default)(r))){t.next=5;break}return t.abrupt("return",r.v);case 5:t.next=10;break;case 7:t.prev=7,t.t1=t.catch(0),b.error("TeAddCustomContact",t.t1.toJSON);case 10:case"end":return t.stop()}},t,void 0,[[0,7]])}));return function(e){return t.apply(this,arguments)}}(),A=(e.modifyCustomContact=function(){var t=(0,v.default)(l.default.mark(function t(e){var r;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return b.info("modifyCustomContact modify custom info"),t.next=3,coreAccount.getLoginModel();case 3:if(r=t.sent,!r.isSupportAS){t.next=8;break}return t.abrupt("return",w(e));case 8:if(!window.CLIENTCONFIG.USE_IM){t.next=12;break}return t.abrupt("return",A(e));case 12:return t.abrupt("return",E(e));case 13:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),function(){var t=(0,v.default)(l.default.mark(function t(e){var r,n,a,u;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,b.info("modifyCustomContact begin"),r=$getState().contactGroups.lastContactGroupInfo,n=void 0===r?{}:r,a={},t.next=6,g.modifyCustomContactService(e);case 6:if(u=t.sent,u.result!==constant.RESULT.SUCCESS||1!==u.param.result){t.next=15;break}return t.next=10,coreContact.saveContactInfo(e);case 10:return e=t.sent,t.next=13,(0,C.reloadContactListData)();case 13:$dispatch(coreUi.updateSliderContactDetail(e,!0)),!isNullOrEmpty(n)&&n.menuItem&&n.menuItem.contact_id===e.contact_id&&(a=(0,i.default)({},n,{menuItem:e}),$dispatch(coreUi.updateLastInfo(a)));case 15:return t.abrupt("return",{result:u.result,externalContact:e});case 18:t.prev=18,t.t0=t.catch(0),b.error("normalModifyCustomContact error",t.t0);case 21:case"end":return t.stop()}},t,void 0,[[0,18]])}));return function(e){return t.apply(this,arguments)}}()),E=function(){var t=(0,v.default)(l.default.mark(function t(e){var r,n,a;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,b.info("TeModifyCustomContact begin"),r=$getState().contactGroups.lastContactGroupInfo,n=void 0===r?{}:r,a={},t.next=6,coreContact.saveContactInfo(e);case 6:return e=t.sent,t.next=9,(0,C.reloadContactListData)();case 9:return $dispatch(coreUi.updateSliderContactDetail(e,!0)),!isNullOrEmpty(n)&&n.menuItem&&n.menuItem.contact_id===e.contact_id&&(n.menuItem=e,a=(0,i.default)({},n,{menuItem:e}),$dispatch(coreUi.updateLastInfo(a))),t.abrupt("return",{result:0,externalContact:e});case 14:t.prev=14,t.t0=t.catch(0),b.error("TeModifyCustomContact",t.t0.toJSON);case 17:case"end":return t.stop()}},t,void 0,[[0,14]])}));return function(e){return t.apply(this,arguments)}}();e.delCustomContact=function(){var t=(0,v.default)(l.default.mark(function t(e){var r,n,a;return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return b.info("delCustomContact"),t.next=3,coreContact.deleteExternalContact([e.account]);case 3:if(!(r=t.sent)){t.next=15;break}return t.next=7,coreDb.queryContact({contact_id:e.contact_id});case 7:return n=t.sent,t.next=10,coreDb.deleteContact({id:n.id});case 10:return t.next=12,(0,C.reloadContactListData)();case 12:window.CLIENTCONFIG.ISMOBILE?window.goRoute("main/contactGroups"):(a=$getState().contactGroups.contactInfo.contact_id,e.contactId===a&&(coreUi.updateSelectedItemKey(-1),coreUi.updateContactGroupDetailShow("noContent"))),t.next=16;break;case 15:b.error("usg delCustomContact fail");case 16:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),e.checkEmailInput=function(t){var e=/^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;return!!isNullOrEmpty(t)||e.test(t)},e.checkIsChange=function(t,e){if("object"!==Object.type(t)||"object"!==Object.type(e))return!1;var r=!1;return(0,o.default)(t).forEach(function(n){e.hasOwnProperty(n)?t[n]!==e[n]&&(r=!0):r=!0}),r},e.searchContactByNum=function(){var t=(0,v.default)(l.default.mark(function t(){var e,r,n,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return l.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e={},t.next=3,coreDb.queryContactByPhonenumberAccurate(a);case 3:if(r=t.sent,isNullOrEmpty(r)){t.next=10;break}b.info("searchContactByNum find constact in DB success"),e=r[0],r.length>1&&r.forEach(function(t){""===t.account&&(e=t)}),t.next=15;break;case 10:return b.info("searchContactByNum  not find in DB, query contact from server"),t.next=13,coreContact.queryServerContact(a);case 13:n=t.sent,n&&n.param&&(e=n.param);case 15:return t.abrupt("return",e);case 16:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}()},1867:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});coreLogger.getLogger("service")("service/util/contactUtils"),e.getCallNumList=function(t){if(!t)return[];var e=[];return Object.forEach(constant.USER_INFO.CALL_INFO,function(r,n){isNullOrEmpty(t[r])||!isNullOrEmpty(t.bind_no)&&"espacenumber"===r||!isNullOrEmpty(t.short_phone)&&"office_phone2"===r||e.push({key:n,num:t[r]})}),e},e.getVideoNumList=function(t){if(!t)return[];var e=[];return Object.forEach(constant.USER_INFO.VIDEO_INFO,function(r,n){isNullOrEmpty(t[r])||!isNullOrEmpty(t.bind_no)&&"espacenumber"===r||!isNullOrEmpty(t.short_phone)&&"office_phone2"===r||e.push({key:n,num:t[r]})}),e},e.getTempCallUserInfo=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=t.toString();return{account:n,name:""!==e.toString()?e:n,q_pin_yin:n,gender:0,mobile:"",office_phone:"",other_phone:"",fax:"",email:"",postcode:"",address:"",title:"",dept_name:"",signature:"",website:"",bind_no:n,native_name:"",staff_no:"",crop_name:"",dept_id:"",dept_name_cn:"",dept_name_en:"",desc:"",foreign_name:"",im_no:"",ip_phone:"",is_security:0,nick_name:"",old_account:n,short_phone:"",voip:"",modify_time:(new Date).getTime().toString(),home_phone:"",other_phone2:"",number:r?n:"",isVmFlag:r}}},1868:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.downloadContactAvatar=e.downloadContactListAvatar=void 0;var a=r(1),u=n(a),o=r(142),c=n(o),i=r(2),s=n(i),f=r(635),d=r(969),l=r(970),p=r(971),v=coreLogger.getLogger("contact/avatar")("downloadAvatar");e.downloadContactListAvatar=function(){var t=(0,s.default)(u.default.mark(function t(){var e,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,coreAccount.getLoginModel();case 2:if(e=t.sent,!e.sipLoginOnly){t.next=5;break}return t.abrupt("return");case 5:r=n.indexOf(e.account),r>-1&&(v.info("downloadContactListAvatar, not get self avatar"),n=[].concat((0,c.default)(n)),n.splice(r,1)),a&&n.reverse(),v.info("downloadContactListAvatar,accountList.length",n.length),v.debug("downloadContactListAvatar,accountList",n),e.isSupportAS?(v.info("downloadContactListAvatar curr env is as env,not support get all avatar together"),(0,d.getDownloadAsAvatarListTaskQueue)().addTaskData(n,a)):(v.info("downloadContactListAvatar curr env is mdx env,deal downloadAvatarList"),(0,l.getDownloadAvatarListTaskQueue)().addTaskData(n,a));case 11:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}(),e.downloadContactAvatar=function(){var t=(0,s.default)(u.default.mark(function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:constant.AVATAR_SIZE.BIG;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(v.debug("downloadContactAvatar,account",e),(0,f.checkCanDownloadAvatar)(e,"downloadContactAvatar")){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,coreAccount.getLoginModel();case 5:if(r=t.sent,!r.sipLoginOnly){t.next=8;break}return t.abrupt("return");case 8:r.isSupportAS?(v.info("downloadContactAvatar, curr env is as env"),(0,d.getDownloadAsAvatarTaskQueue)().addTaskData(e)):(0,p.getDownloadAvatarTaskQueue)().addTaskData(e,n);case 9:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}()},1869:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){return-1!==t.indexOf("_s.")?t.slice(0,1+(t.lastIndexOf("_s.")-1>>>0)):t.slice(0,1+(t.lastIndexOf(".")-1>>>0))}function u(t){return a(t.split("headimg/")[1])}Object.defineProperty(e,"__esModule",{value:!0}),e.getLocalAvatar=void 0;var o=r(1),c=n(o),i=r(139),s=n(i),f=r(2),d=n(f),l=(e.getLocalAvatar=function(){var t=(0,d.default)(c.default.mark(function t(){var e,r,n,o,i,f;return c.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(window.CLIENTCONFIG.ENABLE_IT_MEETING||window.CLIENTCONFIG.IS_LINK_IT_SMC_MEETING||window.CLIENTCONFIG.ISBIGWIN)){t.next=3;break}return l.info("IT Meeting plugin or big win, return"),t.abrupt("return");case 3:return t.next=5,coreAccount.getLoginModel();case 5:if(e=t.sent,!e.sipLoginOnly){t.next=8;break}return t.abrupt("return");case 8:return l.info("getLocalAvatar 初始化本地头像"),r=(0,s.default)({},$getState().common.avatarMap)||{},n="?temp="+Math.random(),t.next=13,appService.getAvatarPath(e.account);case 13:if(o=t.sent,!coreCommon.isPc()){t.next=19;break}i=fs.readdirSync(o)||[],isNullOrEmpty(i)?l.info("getLocalAvatar local avatar is empty!"):(i.forEach(function(t){if(-1!==t.indexOf(".")){var e=o+t,u=a(t);isNullOrEmpty(r[u])&&(r[u]=e+n)}}),coreUi.updateAvatarMap(r)),t.next=23;break;case 19:return t.next=21,appService.readLocalFileList("file://"+o);case 21:f=t.sent,isNullOrEmpty(f)?l.info("getLocalAvatar local avatar is empty!"):(l.info("getLocalAvatar local avatar has",f.length),f.forEach(function(t){var e=u(t);isNullOrEmpty(r[e])&&(r[e]=t+n)}),coreUi.updateAvatarMap(r));case 23:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),coreLogger.getLogger("contact/avatar")("localAvatar"))},1870:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.setSign=e.uploadWorkplaceAvatar=e.getHeaders=e.post=e.request=e.loginToItMcloud=void 0;var a=r(135),u=n(a),o=r(69),c=n(o),i=r(155),s=n(i),f=r(1),d=n(f),l=r(2),p=n(l),v=(e.loginToItMcloud=function(){var t=(0,p.default)(d.default.mark(function t(){var e,r,n,a,u,o,c;return d.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return v.info("loginToItMcloud"),t.next=3,coreAccount.getLoginModel();case 3:return h=t.sent,e=h,r=e.itOAuthUrl,n=e.account,t.next=7,coreSecurity.getPasswordManager();case 7:return a=t.sent,t.next=10,a.getPassword("password");case 10:return u=t.sent,o="loginName="+n+"&password="+u+"&publicKeyFlag=4",t.next=14,g(r,o,{"Content-Type":"application/x-www-form-urlencoded"});case 14:if(c=t.sent,0!==c.result||!c.data){t.next=18;break}return v.info("loginToItMcloud successfully"),t.abrupt("return",{result:0,data:c.data.crypt_token});case 18:return v.info("loginToItMcloud error"),t.abrupt("return",{result:1});case 20:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),e.uploadWorkplaceAvatar=function(){var t=(0,p.default)(d.default.mark(function t(e){var r,n,a,u,o=e.imageStr,c=e.fileName;return d.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return v.info("itEab uploadWorkplaceAvatar"),t.next=3,coreAccount.getLoginModel();case 3:return r=t.sent,n="https://"+r.middleEndAddress+"/mcloud/mag/ProxyForText/wecontact/personService/v2/uploadHeadImgInfo",a=C(r.crypt_token),t.next=8,g(n,{imageStr:o,fileName:c},a);case 8:return u=t.sent,v.info("itEab uploadWorkplaceAvatar result: ",u.result,u.data&&u.data.msg),t.abrupt("return",{result:0===u.result&&u.data.flag?0:1});case 11:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),e.setSign=function(){var t=(0,p.default)(d.default.mark(function t(e){var r,n,a,u;return d.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return v.info("itEab setSign"),t.next=3,coreAccount.getLoginModel();case 3:return r=t.sent,n="https://"+r.middleEndAddress+"/mcloud/mag/ProxyForText/wecontact/contactService/remarkOrSignedMain",a=C(r.crypt_token),t.next=8,g(n,{signed:e,action:"sign"},a);case 8:return u=t.sent,v.info("itEab setSign result: ",u.result,u.data&&u.data.msg),t.abrupt("return",{result:0===u.result&&u.data.flag?0:1});case 11:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),coreLogger.getLogger("logic")("itEab")),h=null,m=e.request=function(){var t=(0,p.default)(d.default.mark(function t(e){var r,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(h){t.next=4;break}return t.next=3,coreAccount.getLoginModel();case 3:h=t.sent;case 4:return r={url:e,type:a.type,header:a.headers||"",body:a.body||"",cipherlist:[50331695,50331701,50331708,50331709]},t.next=7,coreHttp.sendSyncRequest(r);case 7:if(n=t.sent,200!==n.param.resp_code){t.next=10;break}return t.abrupt("return",{result:0,data:JSON.parse(n.param.recv_body)});case 10:return t.abrupt("return",n);case 11:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),g=e.post=function(){var t=(0,p.default)(d.default.mark(function t(e,r,n){var a;return d.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m(e,{type:constant.REQUEST_TYPE.POST,headers:n,body:"object"===(void 0===r?"undefined":(0,s.default)(r))?(0,c.default)(r):r});case 2:return a=t.sent,t.abrupt("return",a);case 4:case"end":return t.stop()}},t,void 0)}));return function(e,r,n){return t.apply(this,arguments)}}(),C=e.getHeaders=function(t){return(0,u.default)({"Content-Type":"application/json"},{Cookie:"token="+t})}},1871:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){f.info("uploadAvatarFailed,errorCode = "+t),window.CLIENTCONFIG.ISMOBILE?coreUi.changeIsShowAvatarLoading(!1):$dispatch(coreUi.changeEnterConfState(!1)),window.alert(language.SET_AVATAR_FAILED)}function u(){f.info("uploadAvatarSuccess"),window.CLIENTCONFIG.ISMOBILE?coreUi.changeIsShowAvatarLoading(!1):$dispatch(coreUi.changeEnterConfState(!1)),window.Toast(language.SET_AVATAR_SUCCESS,2,!1)}Object.defineProperty(e,"__esModule",{value:!0}),e.uploadAvatar=void 0;var o=r(1),c=n(o),i=r(2),s=n(i),f=coreLogger.getLogger("contact/avatar")("uploadAvatar"),d=(e.uploadAvatar=function(){var t=(0,s.default)(c.default.mark(function t(e,r,n){var o,i,s,l,p,v;return c.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,coreAccount.getLoginModel();case 3:if(o=t.sent,!o.isSupportAS){t.next=31;break}if("WeLink"!==window.CLIENTCONFIG.NEW_APP_NAME){t.next=21;break}return f.info("uploadAvatar AS+WeLink"),t.next=9,coreContact.uploadWorkplaceAvatar({imageStr:n.substring(n.indexOf(",")+1),fileName:o.account+".jpg"});case 9:if(i=t.sent,0===i.result){t.next=15;break}return a(i.result),t.abrupt("return",{});case 15:s=coreCommon.getSelfAccount(),coreContact.downloadContactAvatar({account:s}),u();case 18:return t.abrupt("return",i);case 21:return f.info("uploadAvatar AS+HuaweiMeeting"),t.next=24,coreContact.setAvatar({data:e,contentType:r,callback:d});case 24:if(l=t.sent,0===l.result){t.next=28;break}return a(l.result),t.abrupt("return",{});case 28:return t.abrupt("return",l);case 29:t.next=51;break;case 31:if("WeLink"!==window.CLIENTCONFIG.NEW_APP_NAME){t.next=43;break}return f.info("uploadAvatar MeidaX+WeLink"),coreContact.uploadWorkplaceAvatar({imageStr:n.substring(n.indexOf(",")+1),fileName:o.account+".jpg"}),t.next=36,coreContact.setAvatar({data:e,contentType:r,callback:d});case 36:if(p=t.sent,0===p.result){t.next=40;break}return a(p.result),t.abrupt("return",{});case 40:return t.abrupt("return",p);case 43:return f.info("uploadAvatar MeidaX+HuaweiMeeting"),t.next=46,coreContact.setAvatar({data:e,contentType:r,callback:d});case 46:if(v=t.sent,0===v.result){t.next=50;break}return a(v.result),t.abrupt("return",{});case 50:return t.abrupt("return",v);case 51:t.next=58;break;case 53:return t.prev=53,t.t0=t.catch(0),f.error("uploadAvatar error:",t.t0),a("code error"),t.abrupt("return",{});case 58:case"end":return t.stop()}},t,void 0,[[0,53]])}));return function(e,r,n){return t.apply(this,arguments)}}(),function(){var t=(0,s.default)(c.default.mark(function t(e){var r,n,o,i;return c.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,f.debug("uploadAvatarCallback",e),t.next=4,coreAccount.getLoginModel();case 4:if(r=t.sent,n=-1,!r.isSupportAS){t.next=27;break}if(e.hasOwnProperty("param")){t.next=11;break}return f.info("uploadAvatarCallback failed,missing param."),a(n),t.abrupt("return");case 11:if(e.param.hasOwnProperty("ret")&&0===e.param.ret){t.next=15;break}return f.info("uploadAvatarCallback failed,ret:"+e.param.ret),a(e.param.ret),t.abrupt("return");case 15:if(e.param.hasOwnProperty("rsp_body")&&200===e.param.rsp_body.rsp_code){t.next=19;break}return f.info("uploadAvatarCallback failed,rsp_code:"+e.param.rsp_body.rsp_code),a(e.param.rsp_body.rsp_code),t.abrupt("return");case 19:if(e.param.rsp_body.hasOwnProperty("rsp_msg")){t.next=23;break}return f.info("uploadAvatarCallback failed,missing rsp_msg."),a(n),t.abrupt("return");case 23:o=JSON.parse(e.param.rsp_body.rsp_msg),n=Number(o.returnCode),t.next=28;break;case 27:n=e.param.result;case 28:n===constant.ERROR_SEARCHINFO_CODE.EADDR_SUCCESS?(f.info("uploadAvatarCallback success!"),u(),i=coreCommon.getSelfAccount(),coreContact.downloadContactAvatar({account:i})):n===constant.ERROR_SEARCHINFO_CODE.EADDR_FAIL_TOKEN?f.info("uploadAvatarCallback failed,result:",n):(f.info("uploadAvatarCallback failed,result:",n),a(n)),t.next=34;break;case 31:t.prev=31,t.t0=t.catch(0),f.error("uploadAvatarCallback error",t.t0);case 34:case"end":return t.stop()}},t,void 0,[[0,31]])}));return function(e){return t.apply(this,arguments)}}())},301:function(t,e,r){(function(t,n){function a(t,r){var n={seen:[],stylize:o};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),h(r)?n.showHidden=r:r&&e._extend(n,r),y(n.showHidden)&&(n.showHidden=!1),y(n.depth)&&(n.depth=2),y(n.colors)&&(n.colors=!1),y(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=u),i(n,t,n.depth)}function u(t,e){var r=a.styles[e];return r?"["+a.colors[r][0]+"m"+t+"["+a.colors[r][1]+"m":t}function o(t,e){return t}function c(t){var e={};return t.forEach(function(t,r){e[t]=!0}),e}function i(t,r,n){if(t.customInspect&&r&&E(r.inspect)&&r.inspect!==e.inspect&&(!r.constructor||r.constructor.prototype!==r)){var a=r.inspect(n,t);return x(a)||(a=i(t,a,n)),a}var u=s(t,r);if(u)return u;var o=Object.keys(r),h=c(o);if(t.showHidden&&(o=Object.getOwnPropertyNames(r)),A(r)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return f(r);if(0===o.length){if(E(r)){var m=r.name?": "+r.name:"";return t.stylize("[Function"+m+"]","special")}if(w(r))return t.stylize(RegExp.prototype.toString.call(r),"regexp");if(k(r))return t.stylize(Date.prototype.toString.call(r),"date");if(A(r))return f(r)}var g="",C=!1,b=["{","}"];if(v(r)&&(C=!0,b=["[","]"]),E(r)){g=" [Function"+(r.name?": "+r.name:"")+"]"}if(w(r)&&(g=" "+RegExp.prototype.toString.call(r)),k(r)&&(g=" "+Date.prototype.toUTCString.call(r)),A(r)&&(g=" "+f(r)),0===o.length&&(!C||0==r.length))return b[0]+g+b[1];if(n<0)return w(r)?t.stylize(RegExp.prototype.toString.call(r),"regexp"):t.stylize("[Object]","special");t.seen.push(r);var y;return y=C?d(t,r,n,h,o):o.map(function(e){return l(t,r,n,h,e,C)}),t.seen.pop(),p(y,g,b)}function s(t,e){if(y(e))return t.stylize("undefined","undefined");if(x(e)){var r="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(r,"string")}return C(e)?t.stylize(""+e,"number"):h(e)?t.stylize(""+e,"boolean"):m(e)?t.stylize("null","null"):void 0}function f(t){return"["+Error.prototype.toString.call(t)+"]"}function d(t,e,r,n,a){for(var u=[],o=0,c=e.length;o<c;++o)O(e,String(o))?u.push(l(t,e,r,n,String(o),!0)):u.push("");return a.forEach(function(a){a.match(/^\d+$/)||u.push(l(t,e,r,n,a,!0))}),u}function l(t,e,r,n,a,u){var o,c,s;if(s=Object.getOwnPropertyDescriptor(e,a)||{value:e[a]},s.get?c=s.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):s.set&&(c=t.stylize("[Setter]","special")),O(n,a)||(o="["+a+"]"),c||(t.seen.indexOf(s.value)<0?(c=m(r)?i(t,s.value,null):i(t,s.value,r-1),c.indexOf("\n")>-1&&(c=u?c.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+c.split("\n").map(function(t){return"   "+t}).join("\n"))):c=t.stylize("[Circular]","special")),y(o)){if(u&&a.match(/^\d+$/))return c;o=JSON.stringify(""+a),o.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=t.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=t.stylize(o,"string"))}return o+": "+c}function p(t,e,r){var n=0;return t.reduce(function(t,e){return n++,e.indexOf("\n")>=0&&n++,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?r[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+r[1]:r[0]+e+" "+t.join(", ")+" "+r[1]}function v(t){return Array.isArray(t)}function h(t){return"boolean"==typeof t}function m(t){return null===t}function g(t){return null==t}function C(t){return"number"==typeof t}function x(t){return"string"==typeof t}function b(t){return"symbol"==typeof t}function y(t){return void 0===t}function w(t){return _(t)&&"[object RegExp]"===I(t)}function _(t){return"object"==typeof t&&null!==t}function k(t){return _(t)&&"[object Date]"===I(t)}function A(t){return _(t)&&("[object Error]"===I(t)||t instanceof Error)}function E(t){return"function"==typeof t}function L(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t}function I(t){return Object.prototype.toString.call(t)}function S(t){return t<10?"0"+t.toString(10):t.toString(10)}function N(){var t=new Date,e=[S(t.getHours()),S(t.getMinutes()),S(t.getSeconds())].join(":");return[t.getDate(),G[t.getMonth()],e].join(" ")}function O(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var T=/%[sdj%]/g;e.format=function(t){if(!x(t)){for(var e=[],r=0;r<arguments.length;r++)e.push(a(arguments[r]));return e.join(" ")}for(var r=1,n=arguments,u=n.length,o=String(t).replace(T,function(t){if("%%"===t)return"%";if(r>=u)return t;switch(t){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(t){return"[Circular]"}default:return t}}),c=n[r];r<u;c=n[++r])m(c)||!_(c)?o+=" "+c:o+=" "+a(c);return o},e.deprecate=function(r,a){function u(){if(!o){if(n.throwDeprecation)throw new Error(a);n.traceDeprecation?console.trace(a):console.error(a),o=!0}return r.apply(this,arguments)}if(y(t.process))return function(){return e.deprecate(r,a).apply(this,arguments)};if(!0===n.noDeprecation)return r;var o=!1;return u};var D,U={};e.debuglog=function(t){if(y(D)&&(D=n.env.NODE_DEBUG||""),t=t.toUpperCase(),!U[t])if(new RegExp("\\b"+t+"\\b","i").test(D)){var r=n.pid;U[t]=function(){var n=e.format.apply(e,arguments);console.error("%s %d: %s",t,r,n)}}else U[t]=function(){};return U[t]},e.inspect=a,a.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},a.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},e.isArray=v,e.isBoolean=h,e.isNull=m,e.isNullOrUndefined=g,e.isNumber=C,e.isString=x,e.isSymbol=b,e.isUndefined=y,e.isRegExp=w,e.isObject=_,e.isDate=k,e.isError=A,e.isFunction=E,e.isPrimitive=L,e.isBuffer=r(336);var G=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];e.log=function(){console.log("%s - %s",N(),e.format.apply(e,arguments))},e.inherits=r(140),e._extend=function(t,e){if(!e||!_(e))return t;for(var r=Object.keys(e),n=r.length;n--;)t[r[n]]=e[r[n]];return t}}).call(e,r(154),r(157))},336:function(t,e){t.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},594:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.getEserverUserInfo=e.getLinkageStatusLogic=e.setLinkageStatusLogic=e.getFullContactList=e.getContactList=e.confirmPreservateLogic=e.modifyCustomContactService=e.addCustomContactService=e.addContactService=e.modifyContactGroupName=e.addContactGroupService=e.removeContactToGroupService=e.deleteContactGroupService=e.deleteContactService=void 0;var a=r(1),u=n(a),o=r(2),c=n(o),i=coreLogger.getLogger("logic")("tupLogic"),s=(e.deleteContactService=function(){var t=(0,c.default)(u.default.mark(function t(e,r){var n,a,o,c,s,f,d;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!window.CLIENTCONFIG.USE_IM){t.next=24;break}return n=$getState().contactGroups.contactUserList,a="",t.next=5,coreAccount.getLoginModel();case 5:if(o=t.sent,!o.isSupportAS){t.next=15;break}c=0;case 8:if(!(c<n.length)){t.next=15;break}if(e!==n[c].contact_id){t.next=12;break}return a=n[c].account,t.abrupt("break",15);case 12:c++,t.next=8;break;case 15:return t.next=17,coreTup.getIMInstance();case 17:return s=t.sent,t.next=20,o.isSupportAS?s.deleteFriend({self_uuid:$getState().myInfo.account,uuid:a,group_id:r}):s.delfriendorcontact({contact_id:e,group_id:r});case 20:return f=t.sent,d=f.result,i.info("delete friend result : ",d),t.abrupt("return",d);case 24:return t.abrupt("return",0);case 25:case"end":return t.stop()}},t,void 0)}));return function(e,r){return t.apply(this,arguments)}}(),e.deleteContactGroupService=function(){var t=(0,c.default)(u.default.mark(function t(e){var r,n,a;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=!0,!window.CLIENTCONFIG.USE_IM){t.next=9;break}return t.next=4,coreTup.getIMInstance();case 4:return n=t.sent,t.next=7,n.delusergroup(e);case 7:a=t.sent,r=0===a.result;case 9:return t.next=11,coreDb.deleteContactGroup({group_id:e});case 11:return t.abrupt("return",r);case 12:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),e.removeContactToGroupService=function(){var t=(0,c.default)(u.default.mark(function t(e){var r,n,a,o,c;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.contact_id,n=e.old_group_id,a=e.new_group_id,o=e.type,!window.CLIENTCONFIG.USE_IM){t.next=10;break}return t.next=4,coreTup.getIMInstance();case 4:return c=t.sent,t.next=7,c.movecontactgroup(e);case 7:return t.abrupt("return",t.sent);case 10:return t.abrupt("return",{result:0});case 11:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),e.addContactGroupService=function(){var t=(0,c.default)(u.default.mark(function t(e,r){var n,a,o;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={name:e,index:r},t.next=3,coreTup.getIMInstance();case 3:return a=t.sent,t.next=6,a.addusergroup(n);case 6:return o=t.sent,t.abrupt("return",o);case 8:case"end":return t.stop()}},t,void 0)}));return function(e,r){return t.apply(this,arguments)}}(),e.modifyContactGroupName=function(){var t=(0,c.default)(u.default.mark(function t(e,r,n){var a,o;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!window.CLIENTCONFIG.USE_IM){t.next=10;break}return t.next=3,coreTup.getIMInstance();case 3:return a=t.sent,o={id:e,name:r,index:n},t.next=7,a.modusergroup(o);case 7:return t.abrupt("return",t.sent);case 10:return t.abrupt("return",{result:0});case 11:case"end":return t.stop()}},t,void 0)}));return function(e,r,n){return t.apply(this,arguments)}}(),e.addContactService=function(){var t=(0,c.default)(u.default.mark(function t(e){var r,n;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,coreTup.getIMInstance();case 2:return r=t.sent,t.next=5,r.addfriend(e);case 5:return n=t.sent,i.info("add friend result : ",n&&n.result),t.abrupt("return",n);case 8:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),e.addCustomContactService=function(){var t=(0,c.default)(u.default.mark(function t(e){var r,n;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(window.isEserverOnline){t.next=3;break}return i.error("addCustomContactService eserver is offline!"),t.abrupt("return",{result:1,param:{}});case 3:return t.next=5,coreTup.getIMInstance();case 5:return r=t.sent,n={id:0,staff_id:0,name:f(e.name),nick_name:"",foreign_name:"",birthday:"",gender:2,corp_name:f(e.crop_name),
//! corp_name 和 crop_name 好坑啊!!!
dept_name:f(e.dept_name),title:f(e.title),mobile:f(e.mobile),office_phone:f(e.office_phone),home_phone:f(e.home_phone),other_phone:f(e.other_phone),fax:f(e.fax),email:f(e.email),website:f(e.website),im_no:f(e.im_no),address:f(e.address),desc:f(e.desc),postcode:f(e.postcode),state:0,other_phone2:f(e.other_phone2),other_mobiles:f(e.other_mobiles),group_id:s(e.group_id)},t.abrupt("return",r.addcontact(n));case 8:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),e.modifyCustomContactService=function(){var t=(0,c.default)(u.default.mark(function t(e){var r,n;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(window.isEserverOnline){t.next=3;break}return i.error("modifyCustomContactService eserver is offline!"),t.abrupt("return",{result:1,param:{}});case 3:return t.next=5,coreTup.getIMInstance();case 5:return r=t.sent,n={id:s(e.contact_id),staff_id:s(e.staff_id),name:f(e.name),nick_name:f(e.nick_name),foreign_name:f(e.foreign_name),birthday:f(e.birthday),gender:s(e.gender),corp_name:f(e.crop_name),
//! 设置是corp_name,下发的却是crop_name 好坑啊!!!
dept_name:f(e.dept_name),title:f(e.title),mobile:f(e.mobile),office_phone:f(e.office_phone),home_phone:f(e.home_phone),other_phone:f(e.other_phone),fax:f(e.fax),email:f(e.email),website:f(e.website),im_no:f(e.im_no),address:f(e.address),desc:f(e.desc),postcode:f(e.postcode),state:0,other_phone2:f(e.other_phone2),other_mobiles:f(e.other_mobiles)},t.abrupt("return",r.modcontact(n));case 8:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),function(t){var e="number"===Object.type(t)?t:parseInt(t);return isNaN(e)?0:e}),f=function(t){return isNullOrEmpty(t)||"object"===Object.type(t)?"":t.toString()};e.confirmPreservateLogic=function(){var t=(0,c.default)(u.default.mark(function t(e,r){var n,a,o;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,coreTup.getIMInstance();case 3:return n=t.sent,a={id:e.contact_id,staff_id:e.staff_id,name:e.name,nick_name:r,foreign_name:"11"},t.next=7,n.modcontact(a);case 7:if(o=t.sent,0!==o.result){t.next=13;break}return t.next=11,coreContact.saveContactInfo(e);case 11:t.next=14;break;case 13:window.alert(language.SETTING_NICKNAME_FAILED);case 14:return t.abrupt("return",o);case 17:t.prev=17,t.t0=t.catch(0),i.error("error",t.t0);case 20:case"end":return t.stop()}},t,void 0,[[0,17]])}));return function(e,r){return t.apply(this,arguments)}}(),e.getContactList=function(){var t=(0,c.default)(u.default.mark(function t(){var e,r,n,a;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i.info("getContactList"),coreIm.checkEServerOnlineNoToast("getContactList")){t.next=3;break}return t.abrupt("return",{});case 3:return t.next=5,coreTup.getIMInstance();case 5:return e=t.sent,t.next=8,coreDb.queryUserConfig({key:"increTimeStamp"});case 8:if(r=t.sent,n=r.value,a=void 0,!isNullOrEmpty(n)){t.next=17;break}return t.next=14,e.getcontactlist({is_sync_all:1,time_stamp:""});case 14:a=t.sent,t.next=20;break;case 17:return t.next=19,e.getcontactlist({is_sync_all:0,time_stamp:n});case 19:a=t.sent;case 20:return a&&a.result===constant.ERROR_CODE.Success&&(i.info("getContactList save time_stamp to localstorage"),coreDb.saveUserConfig({key:"increTimeStamp",value:a.param.time_stamp})),t.abrupt("return",a);case 22:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}(),e.getFullContactList=function(){var t=(0,c.default)(u.default.mark(function t(){var e,r;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,i.info("getFullContactList"),t.next=4,coreTup.getIMInstance();case 4:return e=t.sent,t.next=7,e.getcontactlist({is_sync_all:1,time_stamp:""});case 7:return r=t.sent,t.abrupt("return",r);case 11:t.prev=11,t.t0=t.catch(0),i.error("getFullContactList",t.t0.toString());case 14:case"end":return t.stop()}},t,void 0,[[0,11]])}));return function(){return t.apply(this,arguments)}}(),e.setLinkageStatusLogic=function(){var t=(0,c.default)(u.default.mark(function t(e){var r;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,i.info("setLinkageStatusLogic"),t.next=4,coreTup.getIMInstance();case 4:return r=t.sent,t.abrupt("return",r.setLinkageStatus(e));case 8:t.prev=8,t.t0=t.catch(0),i.error("setLinkageStatusLogic",t.t0.toString());case 11:case"end":return t.stop()}},t,void 0,[[0,8]])}));return function(e){return t.apply(this,arguments)}}(),e.getLinkageStatusLogic=function(){var t=(0,c.default)(u.default.mark(function t(){var e;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,i.info("getLinkageStatusLogic"),t.next=4,coreTup.getIMInstance();case 4:return e=t.sent,t.abrupt("return",e.getLinkageStatus({}));case 8:t.prev=8,t.t0=t.catch(0),i.error("getLinkageStatusLogic",t.t0.toString());case 11:case"end":return t.stop()}},t,void 0,[[0,8]])}));return function(){return t.apply(this,arguments)}}(),e.getEserverUserInfo=function(){var t=(0,c.default)(u.default.mark(function t(e){var r,n;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,i.info("getEserverUserInfo"),t.next=4,coreTup.getIMInstance();case 4:return r=t.sent,t.next=7,r.getuserinfo(e);case 7:return n=t.sent,t.abrupt("return",n);case 11:t.prev=11,t.t0=t.catch(0),i.error("getEserverUserInfo",t.t0.toString());case 14:case"end":return t.stop()}},t,void 0,[[0,11]])}));return function(e){return t.apply(this,arguments)}}()},632:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.sortMUserListSync=e.sortMUserList=void 0;var a=r(142),u=n(a),o=r(1),c=n(o),i=r(2),s=n(i),f=(e.sortMUserList=function(){var t=(0,s.default)(c.default.mark(function t(e){return c.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",f(e));case 1:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),e.sortMUserListSync=function(t){var e=t.sort(function(){return function(t,e){var r=window.pinyinUtil.getPinyin(t.name),n=window.pinyinUtil.getPinyin(e.name);return r.localeCompare(n)}}()),r=[],n=[],a=[],o=1,c=!1;e.forEach(function(t){var e=window.pinyinUtil.getPinyin(t.name.trim()),u=e.charAt(0).toUpperCase();if(/[a-zA-Z]/.test(u))r.includes(u)||(r.push(u),n.push({type:"charTitle",char:u,char_index:o++})),n.push({type:"charItem",item:t,itemKey:t.contact_id});else{if(c=!0,""===u){var i=getContactName(t);t.q_pin_yin=i}a.push({type:"charItem",item:t,itemKey:t.contact_id})}});var i=[];return c&&(r.push("#"),i=a.sort(function(){return function(t,e){var r=t.item.name,n=e.item.name;return r.localeCompare(n)}}()),i.unshift({type:"charTitle",char:"#",char_index:27})),n.push.apply(n,(0,u.default)(i)),{mList:n,enList:r}})},633:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.preQueryUserListEaddr=e.deleteContactPreSave=e.queryEserverSignature=e.getUserInfo=void 0;var a=r(3),u=n(a),o=r(1),c=n(o),i=r(135),s=n(i),f=r(2),d=n(f),l=coreLogger.getLogger("contactInterface")("corporateDirectory"),p=(e.getUserInfo=function(){var t=(0,d.default)(c.default.mark(function t(e,r){var n,a,u,o,i,f,d,v=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return c.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return l.info("getUserInfo,acc:",handleAccountPrint(e)),v&&coreContact.downloadContactAvatar({account:e}),t.next=4,coreAccount.getLoginModel();case 4:if(n=t.sent,a=n.isSupportAS,u={},o={},i={},isNullOrEmpty(r)){t.next=15;break}return t.next=12,coreContact.queryServerContact(r);case 12:i=t.sent,t.next=19;break;case 15:return t.next=17,coreContact.queryUserListFromEaddr([{username:e,etag:"fffff"}]);case 17:f=t.sent,!isNullOrEmpty(f)&&f.entry&&(i={param:f.entry[0],result:f.result});case 19:if(!window.CLIENTCONFIG.USE_IM||a){t.next=23;break}return t.next=22,p(e);case 22:u=t.sent;case 23:return d=a?{}:{image_sync_time:"",modify_time:"",q_pin_yin:"",signature:"",staff_id:"",state:"",age:"",birthday:"",dept_id:"",desc:"",ip_phone:"",is_security:0,old_account:"",other_mobiles:"",voip:""},isNullOrEmpty(u)||isNullOrEmpty(u.param)||(d={image_sync_time:u.param.image_sync_time,modify_time:u.param.modify_time,q_pin_yin:u.param.q_pin_yin,signature:u.param.signature,staff_id:u.param.staff_id,state:u.param.state,age:u.param.age,birthday:u.param.birthday,dept_id:u.param.dept_id,desc:u.param.desc,ip_phone:u.param.ip_phone,is_security:u.param.is_security,old_account:u.param.old_account,other_mobiles:u.param.other_mobiles,voip:u.param.voip}),o=isNullOrEmpty(i)||isNullOrEmpty(i.param)||i.param.result_code!==constant.EADDR_CONTACT_RESULT_CODE.SUCCESS?isNullOrEmpty(u)||isNullOrEmpty(u.param)?(0,s.default)({},{param:{},result:1}):(0,s.default)({},u):(0,s.default)({},i,{param:(0,s.default)({},i.param,d)}),t.abrupt("return",o);case 27:case"end":return t.stop()}},t,void 0)}));return function(e,r){return t.apply(this,arguments)}}(),e.queryEserverSignature=function(){var t=(0,d.default)(c.default.mark(function t(e){var r,n,a,u;return c.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,coreAccount.getLoginModel();case 2:if(r=t.sent,n=r.isSupportAS,a={},u={},!window.CLIENTCONFIG.USE_IM||n){t.next=10;break}return t.next=9,p(e);case 9:a=t.sent;case 10:return isNullOrEmpty(a)||isNullOrEmpty(a.param)?u=(0,s.default)({},{result:1}):u.signature=a.param.signature,t.abrupt("return",u);case 12:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),function(){var t=(0,d.default)(c.default.mark(function t(e){var r;return c.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(coreIm.checkEServerOnlineNoToast("queryEServerFuc")){t.next=2;break}return t.abrupt("return",{param:{}});case 2:return t.next=4,coreContact.getEserverUserInfo({account:e});case 4:if(!(r=t.sent)||!r.param||0!==r.result){t.next=9;break}return t.abrupt("return",{param:r.param,result:r.result});case 9:return l.error("queryEServerFuc search user info failed"),t.abrupt("return",{param:{}});case 11:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}());e.deleteContactPreSave=function(){var t=(0,d.default)(c.default.mark(function t(e){var r,n,a,o;return c.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!isNullOrEmpty(e)){t.next=4;break}return l.info("deleteContactPreSave account is empty"),t.abrupt("return");case 4:return t.next=6,coreDb.queryContactList({all:"",accountlist:e});case 6:if(r=t.sent,n=[],!isNullOrEmpty(r)){t.next=11;break}return l.info("deleteContactPreSave dbResult is empty"),t.abrupt("return");case 11:for(a=0;a<r.length;a++)o=r[a],n.push(coreDb.deleteContact({id:o.id}));return t.next=14,u.default.all(n);case 14:l.info("deleteContactPreSave success,has delete",r.length),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(0),l.error("deleteContactPreSave"+{error:t.t0.toJSON()});case 20:case"end":return t.stop()}},t,void 0,[[0,17]])}));return function(e){return t.apply(this,arguments)}}(),e.preQueryUserListEaddr=function(){var t=(0,d.default)(c.default.mark(function t(e){var r,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return c.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!isNullOrEmpty(e)){t.next=3;break}return t.abrupt("return",[]);case 3:if(r=[],!isNullOrEmpty(a)){t.next=9;break}return n=e.getKeyArr("account").join(","),t.next=8,coreDb.queryContactList({all:"",accountlist:n});case 8:a=t.sent;case 9:return e.forEach(function(t){var e=a.query({account:t.account})||{},n={username:t.account,etag:isNullOrEmpty(e.etag)?"fffff":e.etag},u=r.query({username:n.username});isNullOrEmpty(u)&&r.push(n)}),t.abrupt("return",r);case 13:return t.prev=13,t.t0=t.catch(0),l.error("preQueryUserListEaddr error"+{error:t.t0.toJSON()}),t.abrupt("return",[]);case 17:case"end":return t.stop()}},t,void 0,[[0,13]])}));return function(e){return t.apply(this,arguments)}}()},634:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t,e){var r=[];return t.forEach(function(t){isNullOrEmpty(e.query({account:t}))&&r.push({username:t,etag:"fffff"})}),r}function u(t,e){return t.map(function(t){return isNullOrEmpty(t)?{}:e[t]||{}})}function o(t){return t.replace(/(^\s*)|(\s*$)/g,"")}Object.defineProperty(e,"__esModule",{value:!0}),e.loadMyContactInfoAndAvatar=e.getUserDetail=e.dealUserInfoOprNotify=e.dealUserInfoChange=e.createContactOrGroupConversation=e.createConversation=e.createConversationLogic=e.selectAddContactList=e.changeContactGroupName=e.queryContactGroupByOpts=e.addContact=e.checkContactGroupName=e.setAddNewContactValueLogic=e.createNewContactGroup=e.createContactGroup=e.moveToOtherGroup=e.queryContactMemerGroupByOpts=e.deleteContactSubmenu=e.deleteContactFromAll=e.deleteContact=e.deleteContactLogic=e.checkIsFriendByQuery=e.reloadContactListData=e.toggleRemoveFromAll=e.openContactConversationByConf=e.openContactConversation=e.createContactConversation=e.updateSignatureByRecent=e.updateSignatureFromServer=e.getContactDetailInfo=e.hideGroupAddContacts=e.getContactListByAccountList=e.getContactByAccount=e.getContactByCallNumber=e.toggleContactDetailTab=void 0;var c=r(69),i=n(c),s=r(155),f=n(s),d=r(142),l=n(d),p=r(158),v=n(p),h=r(147),m=n(h),g=r(3),C=n(g),x=r(135),b=n(x),y=r(1),w=n(y),_=r(2),k=n(_),A=r(594),E=r(633),L=r(632),I=coreLogger.getLogger("logic")("contact"),S=(e.toggleContactDetailTab=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:try{r=$getState(),n=r.contactGroups.sliderDetailShow,n?$dispatch(coreUi.updateSliderContactDetailTab(e)):$dispatch(coreUi.updateContactDetailTab(e)),I.info("切换联系人详情tab页","sliderDetailShow:tab:"+e),I.info("切换联系人详情tab页")}catch(t){I.error("toggleContactDetailTab",t)}case 1:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),e.getContactByCallNumber=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n,a;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,I.info("getContactByCallNumber begin"),!isNullOrEmpty(e)){t.next=5;break}return I.error("getContactByCallNumber error: callNumber is empty!"),t.abrupt("return","");case 5:return t.next=7,coreDb.queryContactByPhonenumberAccurate(e);case 7:if(r=t.sent,isNullOrEmpty(r)){t.next=11;break}return I.info("getContactByCallNumber has fonded from db!"),t.abrupt("return",r.account);case 11:return t.next=13,coreContact.queryServerContact(e);case 13:if(n=t.sent,n.result!==constant.ERROR_SEARCHINFO_CODE.EADDR_SUCCESS){t.next=21;break}return a=n.param||{},coreContact.downloadContactAvatar({account:a.account}),coreContact.saveContactInfo(a),t.abrupt("return",a.account);case 21:return t.abrupt("return","");case 22:t.next=27;break;case 24:t.prev=24,t.t0=t.catch(0),I.error("getContactByCallNumber",t.t0);case 27:case"end":return t.stop()}},t,void 0,[[0,24]])}));return function(e){return t.apply(this,arguments)}}(),e.getContactByAccount=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n,a,u,o,c,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],f=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r=$getState(),n=r.contactGroups.contactUserList,a=r.myInfo,e!==a.account){t.next=7;break}return s&&coreContact.downloadContactAvatar({account:e}),t.abrupt("return",a);case 7:if(u=n.query({account:e}),isNullOrEmpty(u)||!u.contact_id){t.next=11;break}return s&&!u.isExternalContact&&coreContact.downloadContactAvatar({account:e}),t.abrupt("return",u);case 11:if(isNullOrEmpty(e)){t.next=15;break}return t.next=14,coreDb.queryContact({all:"",accountlist:e});case 14:u=t.sent;case 15:if(u.id&&!s){t.next=28;break}return t.next=18,(0,E.getUserInfo)(e,null,f);case 18:if(o=t.sent,c=o&&o.param,!o||o.result){t.next=26;break}return u=(0,b.default)(u,c),(i||s)&&coreContact.saveContactInfo(u,s),t.abrupt("return",u);case 26:return I.error("getContactByAccount 用户已经不存在"),t.abrupt("return",{});case 28:return I.info("通过account获取联系人信息","success"),t.abrupt("return",u);case 32:return t.prev=32,t.t0=t.catch(0),I.error("getContactByAccount",t.t0&&t.t0.toString()),t.abrupt("return",{});case 36:case"end":return t.stop()}},t,void 0,[[0,32]])}));return function(e){return t.apply(this,arguments)}}()),N=(e.getContactListByAccountList=function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{var r=PromiseObject();if(I.info("getContactListByAccountList 通过AccountList获取联系人List"),isNullOrEmpty(t))return I.info("getContactListByAccountList list is empty"),C.default.resolve([]);var n=$getState(),o={};t.forEach(function(t){o[t]||(o[t]=!1)});var c=n.contactGroups.contactUserList,i=n.myInfo,s=[],f=[];if((0,m.default)(o).forEach(function(t){if(isNullOrEmpty(t))o[t]={};else if(!o[t]){var e=void 0;t===i.account?o[t]=i:(e=c.query({account:t}),isNullOrEmpty(e)?s.push(t):o[t]=e)}}),isNullOrEmpty(s))r.resolve(u(t,o));else{I.info("getContactListByAccountList 查询数据库");var d=s.join(",");I.info("getContactListByAccountList should query from DB:"+s.length),coreDb.queryContactList({all:"",accountlist:d}).then(function(n){if(I.info("getContactListByAccountList DB 查到的联系人:"+n.length),n.forEach(function(t){o[t.account]=t}),n.length===s.length)r.resolve(u(t,o));else{I.info("getContactListByAccountList 查询服务器");var c=a(s,n),i=$getState().login.isSupportAS?200:20;c.splitByNum(i).forEach(function(t){f.push(coreContact.queryUserListFromEaddr(t))}),C.default.all(f).then(function(n){var a=[];n.forEach(function(t){0===t.result&&t.entry.forEach(function(t){t.result_code===constant.EADDR_CONTACT_RESULT_CODE.SUCCESS&&(a.push(t),o[t.account]=t)})}),e&&(I.info("getContactListByAccountList 保存服务器查到的联系人:"+a.length),coreContact.saveContactInfoList(a)),r.resolve(u(t,o))})}})}return r}catch(t){return I.error("getContactListByAccountList",{error:t.toJSON()}),C.default.resolve([])}},e.hideGroupAddContacts=function(){coreUi.hideModal()},e.getContactDetailInfo=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n,a,u,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r=!0,n={},a={},!isNullOrEmpty(e.account)){t.next=8;break}n=e,t.next=19;break;case 8:if(!e.account){t.next=16;break}return r=!1,u=e.account,t.next=13,S(u,o,o);case 13:a=t.sent,t.next=19;break;case 16:return t.next=18,coreDb.queryContact({contact_id:e.contact_id});case 18:a=t.sent;case 19:return n=isNullOrEmpty(a)?(0,b.default)({},e,{isNotServerInfo:!0}):(0,b.default)({},a,{isNotServerInfo:!1}),I.info("获取联系人详情页信息"),t.abrupt("return",{userInfo:n,customContact:r});case 24:t.prev=24,t.t0=t.catch(0),I.error("getContactDetailInfo",t.t0);case 27:case"end":return t.stop()}},t,void 0,[[0,24]])}));return function(e){return t.apply(this,arguments)}}(),e.updateSignatureFromServer=function(){var t=(0,k.default)(w.default.mark(function t(e,r){var n,a,u;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(I.info("updateSignatureFromServer"),n=r===$getState().myInfo.account,coreIm.checkEServerOnlineNoToast("updateSignatureFromServer")){t.next=4;break}return t.abrupt("return",e);case 4:return t.next=6,(0,E.getUserInfo)(r);case 6:if(!(a=t.sent)||0!==a.result){t.next=15;break}if(N(a,r),e.signature=a.param.signature,!n){t.next=15;break}return t.next=13,coreAccount.getMyInfo();case 13:u=t.sent,u.signature=a.param.signature;case 15:return t.abrupt("return",e);case 16:case"end":return t.stop()}},t,void 0)}));return function(e,r){return t.apply(this,arguments)}}(),function(){var t=(0,k.default)(w.default.mark(function t(e,r){var n,a;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(I.info("saveSignatureToDB"),n=$getState().contactGroups.contactUserList,a=n.query({account:r}),isNullOrEmpty(r)){t.next=7;break}return t.next=6,coreDb.queryContact({all:"",accountlist:r});case 6:a=t.sent;case 7:if(isNullOrEmpty(a)||!a.contact_id){t.next=12;break}return t.next=10,coreDb.deleteContact({id:""+a.id});case 10:a.signature=e.param.signature,coreContact.saveContactInfo(a);case 12:case"end":return t.stop()}},t,void 0)}));return function(e,r){return t.apply(this,arguments)}}()),O=(e.updateSignatureByRecent=function(){var t=(0,k.default)(w.default.mark(function t(e){var r;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!coreIm.isGroup(e.chat_type)){t.next=3;break}return I.info("is not contact chat, do not query signature"),t.abrupt("return");case 3:if(I.info("updateSignatureByRecent"),coreIm.checkEServerOnlineNoToast("updateSignatureByRecent")){t.next=6;break}return t.abrupt("return");case 6:if(!window.CLIENTCONFIG.ISMOBILE){t.next=8;break}return t.abrupt("return");case 8:return t.next=10,(0,E.getUserInfo)(e.owner);case 10:r=t.sent,r&&0===r.result&&(I.info("update sig-nature in recent",handlePhoneNumber(e.owner)),isNullOrEmpty(e.contact)?(I.info("current recent contact is empty"),e.contact=r.param):e.contact.signature=r.param.signature,coreIm.refreshRecentList(e));case 12:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),e.createContactConversation=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,coreIm.createOrUpdateRecent({contact:e},null,n,a);case 3:return r=t.sent,I.info("创建联系人会话"),t.abrupt("return",r);case 8:t.prev=8,t.t0=t.catch(0),I.error("createContactConversation",t.t0);case 11:case"end":return t.stop()}},t,void 0,[[0,8]])}));return function(e){return t.apply(this,arguments)}}()),T=e.openContactConversation=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n,a,u;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r=$getState(),n=r.myInfo.account,a=e.account,window.CLIENTCONFIG.USE_IM){t.next=6;break}return t.abrupt("return");case 6:if(!a){t.next=15;break}if(window.CLIENTCONFIG.ISMOBILE){t.next=10;break}return t.next=10,coreCommon.switchNav("recent");case 10:return t.next=12,O(e);case 12:return u=t.sent,isNullOrEmpty(u)?I.error("openContactConversation recent is invalid:",u):(coreIm.openRecentConversation(u),I.info("openContactConversation")),t.abrupt("return",u);case 15:t.next=20;break;case 17:t.prev=17,t.t0=t.catch(0),I.error("openContactConversation error:",t.t0);case 20:case"end":return t.stop()}},t,void 0,[[0,17]])}));return function(e){return t.apply(this,arguments)}}(),D=(e.openContactConversationByConf=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n,a,u=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!(r=e.account)){t.next=16;break}if(n=$getState().myInfo.account,r===n){t.next=14;break}return t.next=7,O(e);case 7:if(!(a=t.sent)){t.next=14;break}if(window.CLIENTCONFIG.ISMOBILE){t.next=12;break}return t.next=12,coreCommon.switchNav("recent");case 12:coreIm.toggleRecent(a,u),I.info("openContactConversationByConf 会议中打开联系人会话");case 14:t.next=17;break;case 16:I.info("account is null");case 17:t.next=22;break;case 19:t.prev=19,t.t0=t.catch(0),I.error("openContactConversationByConf",t.t0);case 22:case"end":return t.stop()}},t,void 0,[[0,19]])}));return function(e){return t.apply(this,arguments)}}(),e.toggleRemoveFromAll=function(){var t=(0,k.default)(w.default.mark(function t(e){return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:$dispatch(coreUi.updateRemoveFromAll(e));case 1:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),e.reloadContactListData=function(){var t=(0,k.default)(w.default.mark(function t(){var e,r,n,a,u,o,c,i,s,f,d,l,p;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,C.default.all([coreDb.queryAllContact(),coreDb.queryAllContactGroupList(),coreDb.queryAllContactMemberGroupList()]);case 3:return e=t.sent,r=(0,v.default)(e,3),n=r[0],a=r[1],u=r[2],o=(0,b.default)([],a),c=n.filter(function(t){return 1!==t.externalType}),t.next=12,coreAccount.getLoginModel();case 12:if(i=t.sent,i.isSupportAS&&"WeLink"!==window.CLIENTCONFIG.NEW_APP_NAME&&a.push({group_id:"externalContact",isDefault:0,name:language.EXTERNAL_CONTACT_GROUP}),s=n.length>0,f={hasContact:s,contactUserList:n,contactGroup:a,contactGroupListWithoutExternal:o,contactMemberGroup:u},I.info("reloadContactListData success, contacGroupIdList = "+a.getKeyArr("group_id")),$dispatch(coreUi.updateContactListData(f)),!window.CLIENTCONFIG.ISMOBILE){t.next=25;break}return t.next=21,(0,L.sortMUserList)(c);case 21:d=t.sent,l=d.mList,p=d.enList,$dispatch(coreUi.updateMobileContactList(l,p));case 25:t.next=30;break;case 27:t.prev=27,t.t0=t.catch(0),I.error("reloadContactListData",t.t0);case 30:case"end":return t.stop()}},t,void 0,[[0,27]])}));return function(){return t.apply(this,arguments)}}()),U=e.checkIsFriendByQuery=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n,a,u;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,I.info("checkIsFriendByQuery 查找联系人分组对应表"),t.next=4,coreDb.queryAllContactMemberGroupList();case 4:r=t.sent,n=!1,a=0;case 7:if(!(a<r.length)){t.next=15;break}if(u=r[a],u.contact_id!==e){t.next=12;break}return n=!0,t.abrupt("break",15);case 12:a++,t.next=7;break;case 15:return t.abrupt("return",n);case 18:return t.prev=18,t.t0=t.catch(0),I.error("checkIsFriendByQuery",t.t0),t.abrupt("return",!1);case 22:case"end":return t.stop()}},t,void 0,[[0,18]])}));return function(e){return t.apply(this,arguments)}}(),G=e.deleteContactLogic=function(){var t=(0,k.default)(w.default.mark(function t(e,r){var n,a,u,o,c;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,A.deleteContactService)(e,r);case 3:if(n=t.sent){t.next=28;break}return t.next=7,coreDb.deleteContactMemberGroup({contact_id:e,group_id:r});case 7:return t.next=9,U(e);case 9:if(a=t.sent){t.next=28;break}return t.next=13,coreDb.queryContact({contact_id:e});case 13:return u=t.sent,o=u.account,u.contact_id="",t.next=18,coreContact.deleteContactFromDB(u);case 18:return t.next=20,coreIm.getLocalRecent({owner:o});case 20:if(c=t.sent,!c.id){t.next=28;break}return c.contact.contact_id="",t.next=25,coreDb.saveRecent(c);case 25:return c=t.sent,t.next=28,$dispatch(coreUi.updateRecent(c));case 28:I.info("删除单个分组里联系人逻辑"),t.next=34;break;case 31:t.prev=31,t.t0=t.catch(0),I.error("deleteContactLogic",t.t0);case 34:case"end":return t.stop()}},t,void 0,[[0,31]])}));return function(e,r){return t.apply(this,arguments)}}(),M=(e.deleteContact=function(){var t=(0,k.default)(w.default.mark(function t(e,r){var n,a;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,G(e,r);case 3:return t.next=5,D();case 5:n=$getState(),a=n.contactGroups.contactInfo.contact_id,e===a&&(coreUi.updateSelectedItemKey(-1),coreUi.updateContactGroupDetailShow("noContent")),I.info("删除单个分组里联系人"),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),I.error("deleteContact",t.t0);case 14:case"end":return t.stop()}},t,void 0,[[0,11]])}));return function(e,r){return t.apply(this,arguments)}}(),e.deleteContactFromAll=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n,a,u,o,c,i,s,f,d;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,r=$getState(),n=r.contactGroups.contactMemberGroup,a=[].concat((0,l.default)(n)),u=1,o=null,c=0;case 7:if(!(c<a.length)){t.next=23;break}if(e!==a[c].contact_id){t.next=20;break}return o=a[c].group_id,I.info("start to delete friend from contactMemberGroup, contactId : ",e),t.next=13,(0,A.deleteContactService)(e,o);case 13:if(!(u=t.sent)){t.next=18;break}return t.abrupt("break",23);case 18:return t.next=20,coreDb.deleteContactMemberGroup({contact_id:e,group_id:o});case 20:c++,t.next=7;break;case 23:if(u){t.next=44;break}return t.next=26,coreDb.queryContact({contact_id:e});case 26:return i=t.sent,s=i.account,i.contact_id="",t.next=31,coreContact.deleteContactFromDB(i);case 31:return t.next=33,coreIm.getLocalRecent({owner:s});case 33:if(f=t.sent,isNullOrEmpty(f)){t.next=41;break}return f.contact.contact_id="",t.next=38,coreDb.saveRecent(f);case 38:return f=t.sent,t.next=41,$dispatch(coreUi.updateRecent(f));case 41:return t.next=43,D();case 43:window.CLIENTCONFIG.ISMOBILE?i.hasOwnProperty("account")&&!isNullOrEmpty(i.account)?$dispatch(coreUi.updateMobileContactDetail(i,!1)):window.goRoute("main/contactGroups"):(d=r.contactGroups.contactInfo.contact_id,e===d&&(coreUi.updateSelectedItemKey(-1),coreUi.updateContactGroupDetailShow("noContent")));case 44:I.info("delete friend from all group result:",u),t.next=50;break;case 47:t.prev=47,t.t0=t.catch(0),I.error("deleteContactFromAll",t.t0);case 50:case"end":return t.stop()}},t,void 0,[[0,47]])}));return function(e){return t.apply(this,arguments)}}(),e.deleteContactSubmenu=function(){var t=(0,k.default)(w.default.mark(function t(e,r){var n,a;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,coreIm.checkEserverOnline("deleteContactSubmenu")){t.next=4;break}return I.info("deleteContactSubmenu failed due to offline!"),t.abrupt("return");case 4:if(!(r.length>0)){t.next=13;break}n=0;case 6:if(!(n<r.length)){t.next=13;break}return a=r[n].contact_id,t.next=10,G(a,e);case 10:n++,t.next=6;break;case 13:return t.next=15,(0,A.deleteContactGroupService)(e);case 15:return t.next=17,coreDb.deleteContactGroup({group_id:e});case 17:return t.next=19,D();case 19:I.info("deleteContactSubmenu"),t.next=25;break;case 22:t.prev=22,t.t0=t.catch(0),I.error("deleteContactSubmenu",t.t0);case 25:case"end":return t.stop()}},t,void 0,[[0,22]])}));return function(e,r){return t.apply(this,arguments)}}(),e.queryContactMemerGroupByOpts=function(){var t=(0,k.default)(w.default.mark(function t(e,r){var n,a;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,n=0;case 2:if(!(n<e.length)){t.next=9;break}if(a=e[n],a.contact_id!==r.contact_id||a.group_id!==r.group_id){t.next=6;break}return t.abrupt("return",a);case 6:n++,t.next=2;break;case 9:I.info("queryContactMemerGroupByOpts","success"),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),I.error("queryContactMemerGroupByOpts",t.t0);case 15:case"end":return t.stop()}},t,void 0,[[0,12]])}));return function(e,r){return t.apply(this,arguments)}}()),R=(e.moveToOtherGroup=function(){var t=(0,k.default)(w.default.mark(function t(e,r,n,a,u){var o,c,i,s,f,d,l,p;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,o={contact_id:e,old_group_id:r,new_group_id:n,type:a,uuid:u},t.next=4,(0,A.removeContactToGroupService)(o);case 4:if(c=t.sent,I.info("move friend to other group, result : ",c&&c.result),!(i=0===c.result)){t.next=29;break}if(0!==a){t.next=22;break}return s=$getState(),f=s.contactGroups.contactMemberGroup,t.next=13,M(f,{contact_id:e,group_id:r});case 13:return d=t.sent,d.group_id=n,l=(0,b.default)({},d),t.next=18,coreDb.deleteContactMemberGroup({contact_id:e,group_id:r});case 18:return t.next=20,coreDb.bulkPutContactMemberGroup([l]);case 20:t.next=26;break;case 22:if(1!==a){t.next=26;break}return p={contact_id:e,group_id:n,state:48},t.next=26,coreDb.bulkPutContactMemberGroup([p]);case 26:return t.next=28,D();case 28:return t.abrupt("return",i);case 29:I.info("移动/复制到分组"),t.next=35;break;case 32:t.prev=32,t.t0=t.catch(0),I.error("moveToOtherGroup",t.t0);case 35:case"end":return t.stop()}},t,void 0,[[0,32]])}));return function(e,r,n,a,u){return t.apply(this,arguments)}}(),e.createContactGroup=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n,a,u,o,c,i,s,f;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=$getState(),n=r.common.inputValue,a=n.replace(/\s+/g,""),u=0===a.length?"New Group":n,o=R(u),t.next=8,(0,A.addContactGroupService)(o,e);case 8:if(c=t.sent,c.result){t.next=19;break}return i={group_id:c.param.id,index:-1,name:o,state:0},t.next=13,coreDb.bulkPutContactGroup([i]);case 13:return s=r.contactGroups.contactTypeOpen,f=[].concat((0,l.default)(s)),f.push({group:c.param.id,open:!0}),$dispatch(coreUi.updateContactTypeOpen(f)),t.next=19,D();case 19:return I.info("createContactGroup"),t.abrupt("return",c);case 23:t.prev=23,t.t0=t.catch(0),I.error("createContactGroup",t.t0);case 26:case"end":return t.stop()}},t,void 0,[[0,23]])}));return function(e){return t.apply(this,arguments)}}(),e.createNewContactGroup=function(){var t=(0,k.default)(w.default.mark(function t(){var e,r,n,a,u,o,c,i,s,f,d;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e=$getState(),r=e.contactGroups.addNewName,n=r.replace(/\s+/g,""),!window.CLIENTCONFIG.USE_IM||0!==n.length){t.next=6;break}return t.abrupt("return");case 6:return a=0===n.length?"New Group":r,u=R(a),o=e.contactGroups.contactGroupListWithoutExternal,c=1,isNullOrEmpty(o)||(c=o[o.length-1].index+1),t.next=13,(0,A.addContactGroupService)(u,c);case 13:if(i=t.sent,i.result){t.next=24;break}return s={group_id:i.param.id,index:c,name:u,isDefault:0,state:0},t.next=18,coreDb.bulkPutContactGroup([s]);case 18:return f=e.contactGroups.contactTypeOpen,d=[].concat((0,l.default)(f)),d.push({group:i.param.id,open:!0}),$dispatch(coreUi.updateContactTypeOpen(d)),t.next=24,D();case 24:return I.info("createNewContactGroup"),t.abrupt("return",i);case 28:t.prev=28,t.t0=t.catch(0),I.error("createNewContactGroup",t.t0);case 31:case"end":return t.stop()}},t,void 0,[[0,28]])}));return function(){return t.apply(this,arguments)}}(),e.setAddNewContactValueLogic=function(t){try{$dispatch(coreUi.setAddNewContactValue(t))}catch(t){I.error("setAddNewContactValue",t)}},e.checkContactGroupName=function(t){try{I.info("checkContactGroupName");var e=o(t),r=[];$getState().contactGroups.contactGroup.map(function(t){r.push(t.name)});if(-1===r.findIndex(function(t){return t===e}))return e;var n=e.length,a=[];r.map(function(t){var r=t.length;if(r>n){var u=t.substr(0,n),o=t.substr(n+1,1),c=t.substr(r-1,1),i=parseInt(t.substr(n+2,r-n-3));u===e&&i&&"number"==typeof i&&"["===o&&"]"===c&&a.push(i)}});for(var u=0===a.length?0:Math.max.apply(Math,a),c=1;c<u+2;c++){var i=function(t){if(-1===a.findIndex(function(e){return e===t}))return{v:e+" ["+t+"]"}}(c);if("object"===(void 0===i?"undefined":(0,f.default)(i)))return i.v}}catch(t){I.error("checkContactGroupName",t)}}),P=(e.addContact=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n,a,u,o,c,i,s,f,d,l,p,v,h,m,g,C,x,b;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r=$getState(),n=parseInt(window.CLIENTCONFIG["Device.ComCfg.IM.MaxContact"]),!((a=r.contactGroups.contactUserList?r.contactGroups.contactUserList.length:0)>=n)){t.next=7;break}return alert(language.ADD_TO_MAX),t.abrupt("return");case 7:if(u=e.account,o=e.groupId,c=e.displayName,i={account:u,group_id:o,display_name:void 0===c?"":c},s=void 0,window.CLIENTCONFIG.USE_IM||-3===o){t.next=14;break}s={result:0,param:{contact_id:parseInt((new Date).getTime().toString().substring(5))}},t.next=17;break;case 14:return t.next=16,(0,A.addContactService)(i);case 16:s=t.sent;case 17:if(f=s.param.contact_id,s.result){t.next=50;break}return t.next=21,S(u);case 21:return d=t.sent,d.contact_id=f,t.next=25,(0,E.deleteContactPreSave)(u);case 25:return t.next=27,coreContact.saveContactInfo(d);case 27:return d=t.sent,l={contact_id:f,group_id:o,state:48},t.next=31,coreDb.bulkPutContactMemberGroup([l]);case 31:return t.next=33,D();case 33:return t.next=35,coreIm.getLocalRecent({owner:u});case 35:if(p=t.sent,v=r.contactGroups,h=v.detailContent,m=v.contactInfo,g=v.sliderDetailShow,C=v.sliderContent,x=v.sliderContactInfo,!g||"Contact"!==C||x.account!==u){t.next=41;break}return b=r.contactGroups.sliderAllowBack,t.next=41,$dispatch(coreUi.updateSliderContactDetail(d,!1,b));case 41:if("contact"!==h||m.account!==d.account&&m.contact_id!==d.contact_id||$dispatch(coreUi.updateContactDetail(d,!1)),window.CLIENTCONFIG.ISMOBILE&&$dispatch(coreUi.updateMobileContactDetail(d,!1)),!p.id){t.next=50;break}return p.contact.contact_id=f,t.next=47,coreDb.saveRecent(p);case 47:return p=t.sent,t.next=50,$dispatch(coreUi.updateRecent(p));case 50:return I.info("addContact"),t.abrupt("return",s.result);case 54:t.prev=54,t.t0=t.catch(0),I.error("addContact",t.t0);case 57:case"end":return t.stop()}},t,void 0,[[0,54]])}));return function(e){return t.apply(this,arguments)}}(),e.queryContactGroupByOpts=function(){var t=(0,k.default)(w.default.mark(function t(e,r){var n,a;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=0;case 1:if(!(n<e.length)){t.next=8;break}if(a=e[n],a.group_id!==r.group_id){t.next=5;break}return t.abrupt("return",a);case 5:n++,t.next=1;break;case 8:case"end":return t.stop()}},t,void 0)}));return function(e,r){return t.apply(this,arguments)}}()),F=(e.changeContactGroupName=function(){var t=(0,k.default)(w.default.mark(function t(e,r,n){var a,u,o,c,i,s;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,a=R(r),t.next=4,(0,A.modifyContactGroupName)(e,a,n);case 4:if(u=t.sent,0!==(o=u.result)){t.next=19;break}return c=$getState(),i=c.contactGroups.contactGroup,t.next=11,P(i,{group_id:e});case 11:return s=t.sent,s.name=a,t.next=15,coreDb.deleteContactGroup({group_id:e});case 15:return t.next=17,coreDb.bulkPutContactGroup([s]);case 17:return t.next=19,D();case 19:I.info("changeContactGroupName"),t.next=25;break;case 22:t.prev=22,t.t0=t.catch(0),I.error("changeContactGroupName",t.t0);case 25:case"end":return t.stop()}},t,void 0,[[0,22]])}));return function(e,r,n){return t.apply(this,arguments)}}(),e.selectAddContactList=function(){var t=(0,k.default)(w.default.mark(function t(e){return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:try{I.info("selectAddContactList"),$dispatch(coreUi.updateSelectedContactGroupId(e))}catch(t){I.error("selectAddContactList",t)}case 1:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),e.createConversationLogic=function(){if(!coreIm.checkEserverOnline("createConversationLogic"))return void I.info("createConversationLogic  Offline not allow");var t=$getState(),e=t.recent.currentRecentInfo;return F(e.contact)},e.createConversation=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n,a,u,o;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r=$getState(),n=r.selectBox.selectBox_tempSelectedList,a=r.myInfo,isNullOrEmpty(e)){t.next=14;break}if(1!==n.length){t.next=14;break}if(n[0].account!==e.account){t.next=11;break}return window.alert(language.CONTACT_ALREADY_EXISTS),t.abrupt("return");case 11:if(n[0].account!==a.account){t.next=14;break}return window.alert(language.CAN_NOT_ADD_OWN_ACCOUNT),t.abrupt("return");case 14:return u=n.findIndex(function(t){return t.account===a.account}),-1!==u&&n.splice(u,1),e&&e.account!==a.account&&n.unshift(e),t.next=19,B(q(n));case 19:if(!1!==(o=t.sent)){t.next=22;break}return t.abrupt("return");case 22:coreUi.hideModal(),I.info("createConversationLogic","success"),t.next=29;break;case 26:t.prev=26,t.t0=t.catch(0),I.error("createConversationLogic",t.t0);case 29:case"end":return t.stop()}},t,void 0,[[0,26]])}));return function(e){return t.apply(this,arguments)}}()),q=function(t){for(var e=[],r=0,n=t.length;r<n;r++){for(var a=r+1;a<n;a++)t[r].account===t[a].account&&(a=++r);e.push(t[r])}return e},B=e.createContactOrGroupConversation=function(){var t=(0,k.default)(w.default.mark(function t(e){var r;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(coreIm.checkEserverOnline("createContactOrGroupConversation")){t.next=3;break}return I.info("createContactOrGroupConversation Offline not allow"),t.abrupt("return");case 3:if(0!==e.length){t.next=5;break}return t.abrupt("return");case 5:if(1!==e.length){t.next=9;break}return t.next=8,T(e[0]);case 8:return t.abrupt("return",t.sent);case 9:return t.next=11,coreGroup.createDiscussionGroup({list:e});case 11:if(!((r=t.sent)instanceof Object)){t.next=17;break}return t.next=15,coreIm.openGroupConversation({group_id:r.group_id});case 15:t.next=29;break;case 17:t.t0=r,t.next=1===t.t0?20:32===t.t0?22:35===t.t0?24:27;break;case 20:return window.alert(language.CREAT_FAIL),t.abrupt("break",29);case 22:return window.alert(language.CREATE_GROUP_MAXNUM),t.abrupt("break",29);case 24:return coreUi.hideModal(),window.alert(language.CREATE_DISCUSS_MAXNUM),t.abrupt("break",29);case 27:return I.info("createContactOrGroupConversation fail"),t.abrupt("break",29);case 29:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),j=(e.dealUserInfoChange=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n,a,u,o,c,i;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!e.param){t.next=11;break}if(r=$getState(),n=r.myInfo.account,a=e.param.user_list,u=[],!a||!a.length){t.next=11;break}for(o=0;o<a.length;o++)c=a[o],u.push({id:c.account}),i=c.account,n===i&&coreContact.downloadContactAvatar({account:i});return t.next=10,$(u);case 10:I.info("dealUserInfoChange","success");case 11:t.next=16;break;case 13:t.prev=13,t.t0=t.catch(0),I.error("dealUserInfoChange",t.t0);case 16:case"end":return t.stop()}},t,void 0,[[0,13]])}));return function(e){return t.apply(this,arguments)}}(),e.dealUserInfoOprNotify=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n,a,u,o,c,s,f;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(t.prev=0,I.info("userInfoOprNotify logic in data = ",(0,i.default)(e.param)),r=e.param.msg_list,n=[],a=[],u=[],o=[],c=[],s=[],f=0;f<r.length;f++)0===r[f].info_type?1===r[f].user_type?2===r[f].opr_type?(I.info("userInfoOprNotify external contact delete logic in"),s.push(r[f].user_id)):c.push({id:r[f].user_id}):2===r[f].opr_type?(I.info("userInfoOprNotify user base info delete logic in"),a.push({id:r[f].user_id,updateTime:r[f].time_stamp})):n.push({id:r[f].user_id,updateTime:r[f].time_stamp}):2===r[f].opr_type?(I.info("userInfoOprNotify user avatar delete logic in"),o.push({id:r[f].user_id,updateTime:r[f].time_stamp})):u.push(r[f].user_id);if(!(n.length>0)){t.next=13;break}return t.next=13,$(n);case 13:if(!(u.length>0)){t.next=16;break}return t.next=16,coreContact.downloadContactListAvatar({accountList:u});case 16:j(c,s),t.next=22;break;case 19:t.prev=19,t.t0=t.catch(0),I.error("userInfoOprNotify",t.t0);case 22:case"end":return t.stop()}},t,void 0,[[0,19]])}));return function(e){return t.apply(this,arguments)}}(),function(){var t=(0,k.default)(w.default.mark(function t(e,r){var n,a,u,o;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,coreAccount.getLoginModel();case 2:if(n=t.sent,n.isSupportAS){t.next=6;break}return I.warn("dealExternalContacteIncrement no need for no-as"),t.abrupt("return");case 6:if(I.info("dealExternalContacteIncrement changeList length = "+e.length+",deleteList = "+r.length),!(e.length>0)){t.next=13;break}return t.next=10,coreContact.queryExternalContact(e);case 10:return a=t.sent,t.next=13,coreDb.bulkPutContact(a);case 13:if(u=[],!(r.length>0)){t.next=21;break}return t.next=17,coreDb.queryContactList({all:"",accountlist:r.join(",")});case 17:return o=t.sent,o.map(function(t){u.push(coreDb.deleteContact({id:""+t.id}))}),t.next=21,C.default.all(u);case 21:if(!(e.length>0||r.length>0)){t.next=24;break}return t.next=24,D();case 24:case"end":return t.stop()}},t,void 0)}));return function(e,r){return t.apply(this,arguments)}}()),$=e.getUserDetail=function(){var t=(0,k.default)(w.default.mark(function t(e){var r,n,a,u,o,c;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=$getState(),I.debug("result dealuserInfoOpr userDetailAccountList",e),t.next=4,coreContact.syncUserDetails(e);case 4:if(n=t.sent,I.debug("result dealuserInfoOpr",n),!isNullOrEmpty(n)){t.next=8;break}return t.abrupt("return",!1);case 8:a=0;case 9:if(!(a<n.length)){t.next=24;break}if(u=n[a],I.info("getUserDetail statusCode = "+u.statusCode+",account = "+handleAccountPrint(u.account)),0!==u.statusCode){t.next=20;break}return t.next=15,coreDb.queryContact({account:u.account});case 15:return o=t.sent,c=(0,b.default)({},o,u),u.account===r.myInfo.account&&$dispatch(coreUi.updateMyInfo(c)),t.next=20,coreContact.saveContactInfo(c,!0);case 20:I.info("userInfoOprNotify","success");case 21:a++,t.next=9;break;case 24:return t.next=26,D();case 26:return t.abrupt("return",!0);case 27:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}();e.loadMyContactInfoAndAvatar=function(){var t=(0,k.default)(w.default.mark(function t(){var e,r,n,a;return w.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(window.CLIENTCONFIG.ENABLE_IT_MEETING||window.CLIENTCONFIG.IS_LINK_IT_SMC_MEETING||window.CLIENTCONFIG.ISBIGWIN)){t.next=3;break}return I.info("IT Meeting plugin or big win, return"),t.abrupt("return");case 3:return t.next=5,coreAccount.getLoginModel();case 5:if(e=t.sent,!e.isSupportAS){t.next=17;break}return t.next=9,coreDb.queryRecentList({all:""});case 9:for(r=t.sent,n=[],a=0;a<r.length;a++)0!==r[a].chat_type||isNullOrEmpty(r[a].account)||n.push({id:r[a].account});return n=n.slice(0,50),t.next=15,$(n);case 15:return t.next=17,coreContact.downloadContactListAvatar({accountList:n.map(function(t){return t.id})});case 17:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}()},635:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){f.addQueueFunc(t),f.runQueueFunc()}Object.defineProperty(e,"__esModule",{value:!0}),e.getUiData=e.getAvatarRealPath=e.checkSameAvatar=e.checkCanDownloadAvatarList=e.checkCanDownloadAvatar=void 0;var u=r(1),o=n(u),c=r(2),i=n(c);e.checkSameAvatar=function(){var t=(0,i.default)(o.default.mark(function t(e,r){var n,a,u,c,i,f;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,s.debug("checkSameAvatar begin"),n=$getState().common.avatarMap,a=/headimg[\\|\/](.*)/,isNullOrEmpty(n[e])){t.next=19;break}return u=n[e].split("?temp")[0],c=u.match(a)[1],t.next=9,coreAccount.getLoginModel();case 9:return i=t.sent,t.next=12,appService.getAvatarPath(i.account);case 12:if(f=t.sent,s.debug("checkSameAvatar begin"),c!==r){t.next=16;break}return t.abrupt("return","same");case 16:return appService.deleteFile(f+"/"+c),s.info("checkSameAvatar delete old avatar file"),t.abrupt("return","delete");case 19:t.next=24;break;case 21:t.prev=21,t.t0=t.catch(0),s.error("checkSameAvatar error",t.t0);case 24:case"end":return t.stop()}},t,this,[[0,21]])}));return function(e,r){return t.apply(this,arguments)}}();e.avatarDownloadAckQueue=a;var s=coreLogger.getLogger("contact/avatar")("libs"),f=new coreCommon.QueueDealFunction;e.checkCanDownloadAvatar=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return isNullOrEmpty(t)?(s.info("checkCanDownloadAvatar account is null or empty",e),!1):!window.CLIENTCONFIG.ENABLE_IT_MEETING||(s.info("checkCanDownloadAvatar it workplace conf plgin can not search avatar.",e),!1)},e.checkCanDownloadAvatarList=function(t){return isNullOrEmpty(t)?(s.info("checkCanDownloadAvatarList account is null or empty"),!1):!window.CLIENTCONFIG.ENABLE_IT_MEETING||(s.info("checkCanDownloadAvatarList it workplace conf plgin can not search avatar."),!1)},e.getAvatarRealPath=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n="";return coreCommon.isPc()?(t=t.replaceAll("/","\\"),n=t+e+r):n=coreCommon.isIos()?"/local-filesystem"+t+e+r:"file://"+t+e+r,n},e.getUiData=function(){return $getState()}},69:function(t,e,r){t.exports={default:r(70),__esModule:!0}},70:function(t,e,r){var n=r(8),a=n.JSON||(n.JSON={stringify:JSON.stringify});t.exports=function(t){return a.stringify.apply(a,arguments)}},820:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.coverUserList=e.queryUsersIncrementFromEaddr=e.queryAllfromList=e.deleteContactFromDB=e.getLocalContactAndGroupInfo=e.dealExternalContact=e.teLoadContactAndGroupList=e.normalLoadContactAndGroupList=void 0;var a=r(155),u=n(a),o=r(142),c=n(o),i=r(158),s=n(i),f=r(135),d=n(f),l=r(1),p=n(l),v=r(69),h=n(v),m=r(3),g=n(m),C=r(2),x=n(C),b=(e.normalLoadContactAndGroupList=function(){var t=(0,x.default)(p.default.mark(function t(){var e,r;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,coreAccount.getLoginModel();case 2:if(e=t.sent,e.useIM){t.next=6;break}return O.info("normalLoadContactAndGroupList","now is te eva"),t.abrupt("return");case 6:return t.next=8,E.getContactList();case 8:if(!(r=t.sent)){t.next=15;break}return O.info("uc get contactList and groupList from eserver result : ",r.result),t.next=13,g.default.all([U(r.param),coreGroup.calGroupAndMemberListData(r.param)]);case 13:t.next=16;break;case 15:O.error("uc get contactList and groupList from eserver, res = "+(0,h.default)(r));case 16:T();case 17:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),e.teLoadContactAndGroupList=function(){var t=(0,x.default)(p.default.mark(function t(){var e,r;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,coreAccount.getLoginModel();case 2:if(e=t.sent,!e.useIM){t.next=6;break}return O.info("teLoadContactAndGroupList","now is uc eva"),t.abrupt("return");case 6:return O.debug("teLoadContactAndGroupList TE模式 获取联系人和群组"),t.next=9,D();case 9:r=t.sent,b(r&&r.contactUserList);case 11:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),function(){var t=(0,x.default)(p.default.mark(function t(e){var r,n,a,u,o,c,i,s,f;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,O.info("updataTeContactInfo begin!"),!isNullOrEmpty(e)){t.next=5;break}return O.error("updataTeContactInfo contactList is empty!"),t.abrupt("return");case 5:return r=[],n=e.getKeyArr("account"),coreContact.downloadContactListAvatar({accountList:n}),a=e.filter(function(t){if(""!==t.account&&!t.isExternalContact)return{username:t.account,etag:""===t.etag?"fffff":t.etag}}),u=[],t.next=12,coreAccount.getLoginModel().isSupportAS;case 12:if(!t.sent){t.next=16;break}t.t0=200,t.next=17;break;case 16:t.t0=20;case 17:return o=t.t0,a.splitByNum(o).forEach(function(t){r.push(coreContact.queryUserListFromEaddr(t))}),t.next=21,g.default.all(r).then(function(t){t.forEach(function(t){0===t.result&&t.entry.forEach(function(t){t.result_code===constant.EADDR_CONTACT_RESULT_CODE.SUCCESS&&u.push(t)})})});case 21:if(!isNullOrEmpty(u)){t.next=24;break}return O.info("updataTeContactInfo contact info already newest!"),t.abrupt("return");case 24:if(c=e.map(function(t){var e=u.query({account:t.account});return isNullOrEmpty(e)?t:(0,d.default)({},t,e)}),coreContact.saveContactInfoList(c),$dispatch(coreUi.updateContactListData({contactUserList:c})),!window.CLIENTCONFIG.ISMOBILE){t.next=34;break}return t.next=30,(0,L.sortMUserList)(c);case 30:i=t.sent,s=i.mList,f=i.enList,$dispatch(coreUi.updateMobileContactList(s,f));case 34:t.next=39;break;case 36:t.prev=36,t.t1=t.catch(0),O.error("updataTeContactInfo error",t.t1);case 39:case"end":return t.stop()}},t,this,[[0,36]])}));return function(e){return t.apply(this,arguments)}}()),y=function(){var t=(0,x.default)(p.default.mark(function t(e,r){var n,a,u,o,c,i,s,f,d,l;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(O.info("好友列表 begin"),!isNullOrEmpty(e)){t.next=4;break}return O.info("dealContactInfo recordList is empty"),t.abrupt("return",[]);case 4:
//! 操作记录去重
return n=[],a=[],u=q(e),t.next=9,w(u);case 9:if(o=t.sent,c=B(o,r),i=c.getKeyArr("account"),s=i.join(","),coreContact.downloadContactListAvatar({accountList:i}),isNullOrEmpty(s)){t.next=21;break}return t.next=17,coreDb.queryContactList({all:"",accountlist:s});case 17:return f=t.sent,f.forEach(function(t){n.push(coreDb.deleteContact({id:""+t.id}))}),t.next=21,g.default.all(n);case 21:return t.next=23,j(c);case 23:return d=t.sent,l=$(c,d),l.forEach(function(t){t.state===constant.CONTACT_GROUP_STATE.ADD&&(t.contact_id=t.id),delete t.id,a.push(t)}),O.info("dealContactInfo success! data length:"+a.length),t.abrupt("return",a);case 28:case"end":return t.stop()}},t,this)}));return function(e,r){return t.apply(this,arguments)}}(),w=function(){var t=(0,x.default)(p.default.mark(function t(){var e,r,n,a,u,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!isNullOrEmpty(o)){t.next=3;break}return O.info("dealCustomContact contactList is empty"),t.abrupt("return",[]);case 3:e=[],r=[],n=0;case 6:if(!(n<o.length)){t.next=23;break}if(a=o[n],!isNullOrEmpty(a.account)||a.state!==constant.CONTACT_GROUP_STATE.ADD){t.next=12;break}e.push(a),t.next=20;break;case 12:if(!isNullOrEmpty(a.account)||a.state!==constant.CONTACT_GROUP_STATE.DELETE){t.next=19;break}return t.next=15,coreDb.queryContactByContactId({contact_id:a.id});case 15:u=t.sent,!isNullOrEmpty(u)&&r.push(coreDb.deleteContact({id:u.id})),t.next=20;break;case 19:e.push(a);case 20:n++,t.next=6;break;case 23:return t.next=25,g.default.all(r);case 25:return t.abrupt("return",e);case 26:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),_=function(){var t=(0,x.default)(p.default.mark(function t(e){var r,n,a,u,o;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(O.info("dealContactGroupInfo, userListGroup length = "+(e&&e.length)),e=e||[],e.length){t.next=4;break}return t.abrupt("return",[]);case 4:r=[],n=[],a=0;case 7:if(!(a<e.length)){t.next=25;break}if(u=e[a],u.state!==constant.CONTACT_GROUP_STATE.ADD){t.next=20;break}if("Group"!==u.name){t.next=15;break}return t.next=13,coreDb.queryAllContactGroupList();case 13:o=t.sent,o.forEach(function(t){"Group"===t.name&&(n.push(coreDb.deleteContactGroup({group_id:t.group_id})),n.push(coreDb.deleteContactMemberGroup({group_id:t.group_id})))});case 15:u.group_id=u.id,delete u.id,r.push(u),t.next=22;break;case 20:n.push(coreDb.deleteContactGroup({group_id:u.id})),n.push(coreDb.deleteContactMemberGroup({group_id:u.id}));case 22:a++,t.next=7;break;case 25:return t.next=27,g.default.all(n);case 27:return r=G(r),t.abrupt("return",r);case 29:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),k=function(){var t=(0,x.default)(p.default.mark(function t(e){var r,n;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(O.debug("dealContactGroupMemberList"),e=e||[],e.length){t.next=4;break}return t.abrupt("return",[]);case 4:return r=[],n=[],e.forEach(function(t){t.state===constant.CONTACT_GROUP_STATE.ADD?r.push(t):n.push(coreDb.deleteContactMemberGroup({group_id:t.group_id,contact_id:t.contact_id}))}),t.next=9,g.default.all(n);case 9:return t.abrupt("return",r);case 10:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),A=r(594),E=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}(A),L=r(632),I=r(633),S=r(301),N=r(634),O=coreLogger.getLogger("logic")("contactGroup/联系人群组增量处理"),T=function(){var t=(0,x.default)(p.default.mark(function t(){var e,r,n,a,u,o;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,coreAccount.getLoginModel();case 2:if(e=t.sent,e.isSupportAS){t.next=6;break}return O.info("refreshFriendInfoForUpdate no need for mediax, so return"),t.abrupt("return");case 6:if("WeLink"===window.CLIENTCONFIG.NEW_APP_NAME){t.next=9;break}return O.info("refreshFriendInfoForUpdate no need for huaweimeeting, so return"),t.abrupt("return");case 9:return t.next=11,coreDb.queryUserConfig({key:"alreadyUpdateFriendInfo"});case 11:if(r=t.sent,"true"!==(n=r.value)){t.next=16;break}return O.info("refreshFriendInfoForUpdate already update, so return"),t.abrupt("return");case 16:return t.next=18,coreDb.queryAllContact();case 18:if(a=t.sent,!isNullOrEmpty(a)){t.next=24;break}return t.next=22,coreDb.saveUserConfig({key:"alreadyUpdateFriendInfo",value:"true"});case 22:return O.info("refreshFriendInfoForUpdate db no friends, so return"),t.abrupt("return");case 24:return u=[],a.map(function(t){u.push({id:t.account})}),t.next=28,(0,N.getUserDetail)(u);case 28:o=t.sent,o?(O.info("refreshFriendInfoForUpdate suc"),coreDb.saveUserConfig({key:"alreadyUpdateFriendInfo",value:"true"})):O.error("refreshFriendInfoForUpdate fail");case 30:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}(),D=(e.dealExternalContact=function(){var t=(0,x.default)(p.default.mark(function t(){var e,r,n;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,coreAccount.getLoginModel();case 2:if(e=t.sent,e.isSupportAS&&"WeLink"!==window.CLIENTCONFIG.NEW_APP_NAME){t.next=6;break}return O.warn("dealExternalContact no need for no-as or for workplace"),t.abrupt("return");case 6:return t.next=8,coreContact.searchExternalContactByKey({});case 8:if(r=t.sent,(0,S.isNullOrUndefined)(r)){t.next=21;break}return O.info("dealExternalContact sycn from usg suc, contact length = "+r.length),t.next=13,coreDb.deleteContact({isExternalContact:1});case 13:return n=r.map(function(t){if(t.result_code===constant.EADDR_CONTACT_RESULT_CODE.SUCCESS)return t.contact_id=t.account,t}),t.next=16,coreDb.bulkPutContact(n);case 16:return t.next=18,(0,N.reloadContactListData)();case 18:R(),t.next=22;break;case 21:O.error("dealExternalContact sync from usg fail");case 22:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}(),e.getLocalContactAndGroupInfo=function(){var t=(0,x.default)(p.default.mark(function t(){var e,r,n,a,u,o,c,i,f,l,v,h;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!window.CLIENTCONFIG.ENABLE_IT_MEETING){t.next=2;break}return t.abrupt("return");case 2:return O.debug("getLocalContactAndGroupInfo"),t.next=5,g.default.all([coreDb.queryAllContact(),coreDb.queryAllContactGroupList(),coreDb.queryAllContactMemberGroupList()]);case 5:return e=t.sent,r=(0,s.default)(e,3),n=r[0],a=r[1],u=r[2],o=(0,d.default)([],a),c=n.filter(function(t){return 1!==t.externalType}),t.next=14,coreAccount.getLoginModel();case 14:if(i=t.sent,i.isSupportAS&&"WeLink"!==window.CLIENTCONFIG.NEW_APP_NAME&&a.push({group_id:"externalContact",isDefault:0,name:language.EXTERNAL_CONTACT_GROUP}),f={hasContact:n.length>0,contactUserList:n,contactGroup:a,contactMemberGroup:u,contactGroupListWithoutExternal:o},$dispatch(coreUi.updateContactListData(f)),M(n),!window.CLIENTCONFIG.ISMOBILE){t.next=26;break}return t.next=22,(0,L.sortMUserList)(c);case 22:l=t.sent,v=l.mList,h=l.enList,$dispatch(coreUi.updateMobileContactList(v,h));case 26:return R(),t.abrupt("return",f);case 28:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}()),U=function(){var t=(0,x.default)(p.default.mark(function t(e){var r,n,a,u,o,c,i,f,d,l;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,O.info("calcContactListData deal contactList"),r=e.contact_list,n=e.user_list,a=e.user_group_list,u=e.user_group_member_list,t.next=5,coreAccount.getLoginModel();case 5:return o=t.sent,t.next=8,g.default.all([o.isSupportAS?z(r):y(r,n),_(a),k(u)]);case 8:return c=t.sent,i=(0,s.default)(c,3),f=i[0],d=i[1],l=i[2],O.info("整理联系人列表数据","success"),t.next=16,P(f);case 16:return t.next=18,g.default.all([coreContact.saveContactInfoList(f),coreDb.bulkPutContactGroup(d),coreDb.bulkPutContactMemberGroup(l)]);case 18:return t.next=20,D();case 20:return t.abrupt("return",t.sent);case 23:t.prev=23,t.t0=t.catch(0),O.error("calcContactListData",t.t0);case 26:case"end":return t.stop()}},t,void 0,[[0,23]])}));return function(e){return t.apply(this,arguments)}}(),G=function(t){return t=t||[],t.sort(function(t,e){return t.group_id>e.group_id})},M=function(t){O.debug("dealSpecialContacts 筛选特别关注联系人");var e=[];t&&t.length>0&&t.forEach(function(t){t.isSpecial&&e.push(t)}),$dispatch(coreUi.updateSpecialContactListData(e))},R=function(){try{O.debug("loadContactTypeOpen 加载与刷新联系人分组折叠对应表");var t=$getState(),e=t.contactGroups.contactGroup,r=t.contactGroups.contactTypeOpen,n=[].concat((0,c.default)(e)),a=[].concat((0,c.default)(r));if(0===r.length)n.forEach(function(t){a.push({group:t.group_id,open:!1})});else{var u=[],o=[];a.forEach(function(t){o.push(t.group)}),n.forEach(function(t){a.forEach(function(e){t.group_id===e.group?u.push({group:t.group_id,open:e.open}):-1===o.indexOf(t.group_id)&&u.push({group:t.group_id,open:!1})})}),a=[].concat(u)}O.info("loadContactTypeOpen 加载刷新联系人分组折叠表","success"),$dispatch(coreUi.updateContactTypeOpen(a))}catch(t){O.error("loadContactTypeOpen",t)}},P=(e.deleteContactFromDB=function(){var t=(0,x.default)(p.default.mark(function t(e){return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!isNullOrEmpty(e)){t.next=3;break}return O.debug("deleteContact data null"),t.abrupt("return",{});case 3:if(!e.id){t.next=11;break}return t.next=6,coreDb.deleteContact({id:e.id});case 6:if(""===e.account){t.next=9;break}return t.next=9,coreContact.saveContactInfo(e);case 9:t.next=11;break;case 11:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),function(){var t=(0,x.default)(p.default.mark(function t(e){var r,n,a;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,r="",n=[],isNullOrEmpty(e)){t.next=15;break}return r=e.getKeyArr("account").join(","),t.next=7,coreDb.queryContactList({all:"",accountlist:r});case 7:if(t.t0=t.sent,t.t0){t.next=10;break}t.t0=[];case 10:return a=t.t0,e.forEach(function(t){for(var e=F(a,{account:t.account}),r=0;r<e.length;r++){var u=e[r];n.push(coreDb.deleteContact({id:""+u.id}))}}),t.next=14,g.default.all(n);case 14:O.info("delDbContactList success");case 15:t.next=20;break;case 17:t.prev=17,t.t1=t.catch(0),O.error("delDbContactList fail",{error:t.t1.toJSON()});case 20:case"end":return t.stop()}},t,void 0,[[0,17]])}));return function(e){return t.apply(this,arguments)}}()),F=e.queryAllfromList=function(t,e){try{var r=function(){var r=[];for(var n in e)!function(n){t.forEach(function(t){e[n]===t[n]&&r.push(t)})}(n);return{v:r}}();if("object"===(void 0===r?"undefined":(0,u.default)(r)))return r.v}catch(t){return O.error("queryAllfromList fail",t.toString()),[]}},q=function(t){var e=[];return isNullOrEmpty(t)?(O.info("delContactOperationRecord contactList empty!"),[]):(t.forEach(function(r){if(0===r.staff_id)return r.gender=2,e.push(r),!1;var n=t.queryList({staff_id:r.staff_id});if(!isNullOrEmpty(n))if(1===n.length)e.push(r);else{for(var a=n[0],u=1;u<n.length;u++){var o=n[u];o.id>a.id&&(a=o)}isNullOrEmpty(e.query(a))&&e.push(a)}}),e)},B=function(t,e){try{var r=[];return t.forEach(function(t){""===t.name&&(0,d.default)(t,e.query({staff_id:t.staff_id}),{state:t.state}),r.push(t)}),r}catch(t){return O.error("delCoverEserverList",{error:t.toJSON()}),[]}},j=e.queryUsersIncrementFromEaddr=function(){var t=(0,x.default)(p.default.mark(function t(e,r){var n,a,u,o,i,s,f,d,l,v;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,n=[],a=[],t.next=5,(0,I.preQueryUserListEaddr)(e,r);case 5:return u=t.sent,t.next=8,coreAccount.getLoginModel();case 8:o=t.sent,i=o.isSupportAS?200:20,s=u.splitByNum(i),f=0;case 12:if(!(f<s.length)){t.next=21;break}return d=s[f],t.next=16,coreContact.queryUserListFromEaddr(d);case 16:l=t.sent,!isNullOrEmpty(l)&&l.entry&&n.push.apply(n,(0,c.default)(l.entry));case 18:f++,t.next=12;break;case 21:if(v=[],!isNullOrEmpty(n)){t.next=25;break}return O.error("queryUsersIncrementFromEaddr willCoverList is empty"),t.abrupt("return",[]);case 25:return n.forEach(function(t){if(t.result_code===constant.EADDR_CONTACT_RESULT_CODE.NO_CHANGE){var e=r.query({etag:t.etag});isNullOrEmpty(e)||(delete e.id,delete e.contact_id,v.push(e))}else t.result_code===constant.EADDR_CONTACT_RESULT_CODE.SUCCESS&&v.push(t)}),t.abrupt("return",v);case 29:return t.prev=29,t.t0=t.catch(0),O.error("queryUsersIncrementFromEaddr",{error:t.t0.toJSON()}),t.abrupt("return",[]);case 33:case"end":return t.stop()}},t,void 0,[[0,29]])}));return function(e,r){return t.apply(this,arguments)}}(),$=e.coverUserList=function(t,e){if(isNullOrEmpty(t)&&isNullOrEmpty(e))return O.info("coverUserList all empty"),[];if(isNullOrEmpty(t))return O.info("coverUserList eSerList empty"),e;if(isNullOrEmpty(e))return O.info("coverUserList eaddrList empty"),t;var r=[];return t.length<e.length?e.forEach(function(e){var n=t.query({account:e.account}),a=Q(n,e);r.push(a)}):t.forEach(function(t){if(isNullOrEmpty(t.account))r.push(t);else{var n=e.query({account:t.account}),a=Q(t,n);r.push(a)}}),r},Q=function(t,e){if(isNullOrEmpty(t)&&isNullOrEmpty(e))return O.info("coverUserInfo all empty"),{};if(isNullOrEmpty(t))return O.debug("coverUserInfo eserverInfo empty"),e;if(isNullOrEmpty(e))return O.debug("coverUserInfo eaddrInfo empty"),t;if(t.account!==e.account)return O.debug("coverUserInfo two info is not one person!"),{};var r={staff_id:t.staff_id,account:t.account,etag:e.etag,state:t.state,name:e.name,q_pin_yin:t.q_pin_yin,gender:e.gender,mobile:e.mobile,office_phone:e.office_phone,office_phone2:e.office_phone2,other_phone:e.other_phone,fax:e.fax,email:e.email,address:e.address,title:e.title,image_id:e.image_id,signature:t.signature,website:e.website,bind_no:e.bind_no,native_name:e.native_name,home_phone:e.home_phone,other_phone2:e.other_phone2,staff_no:e.staff_no,dept_id:t.dept_id,dept_name_cn:e.dept_name_cn,dept_name_en:e.dept_name_en,desc:t.desc,image_sync_time:t.image_sync_time,ip_phone:t.ip_phone,is_security:t.is_security,old_account:t.old_account,short_phone:e.short_phone,voip:t.voip,modify_time:t.modify_time,espacenumber:e.espacenumber};return void 0!==t.id&&(r.id=t.id),r},z=function(){var t=(0,x.default)(p.default.mark(function t(e){var r,n,a,u,o,c;return p.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e||[],O.info("deal increment contactList at AS, length : ",r.length),r.length){t.next=4;break}return t.abrupt("return",[]);case 4:if(n=[],a=[],u=[],r.map(function(t){t.state===constant.CONTACT_GROUP_STATE.ADD?u.push({id:t.staffAccount||t.name}):a.push(t.staffAccount||t.name)}),!a.length){t.next=14;break}return t.next=11,coreDb.queryContactList({all:"",accountlist:a.join(",")});case 11:t.t0=t.sent,t.next=15;break;case 14:t.t0=[];case 15:return o=t.t0,O.info("deal increment contactList at AS, need to delete count : ",o&&o.length),o&&o.map(function(t){n.push(coreDb.deleteContact({id:t.id}))}),t.next=20,g.default.all(n);case 20:if(O.info("deal increment contactList at AS, need to add count : ",u.length),!u.length){t.next=27;break}return t.next=24,coreContact.syncUserDetails(u);case 24:t.t1=t.sent,t.next=28;break;case 27:t.t1=[];case 28:return c=t.t1,c.map(function(t){for(var e=0;e<r.length;e++)if(t.account===r[e].staffAccount){t.contact_id=r[e].id;break}}),t.abrupt("return",c);case 31:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}()},968:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(){var t=$getState(),e=t.contactGroups.contactUserList,r=parseInt(window.CLIENTCONFIG["Device.ComCfg.IM.MaxContact"]);if(isNaN(r))return window.alert(window.language.ADD_FRIEND_ERROR),g.error("checkNowFriendNum esight config IM.MaxContact error"),!1;var n=e?e.length:0;return n>=r?(window.alert(window.language.ADD_TO_MAX),!1):n<r}Object.defineProperty(e,"__esModule",{value:!0}),e.dealContactGroupInfo=e.normalAddContactToContactGroup=e.addContactToContactGroup=void 0;var u=r(155),o=n(u),c=r(1),i=n(c),s=r(2),f=n(s),d=(e.addContactToContactGroup=function(){var t=(0,f.default)(i.default.mark(function t(e){return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(g.info("addContactToContactGroup add a contact as a friend"),e&&e.account){t.next=5;break}if(!window.CLIENTCONFIG.USE_IM){t.next=5;break}return g.info("addContactToContactGroup contact information has a problem or no account"),t.abrupt("return");case 5:if(a()){t.next=7;break}return t.abrupt("return");case 7:return t.abrupt("return",window.CLIENTCONFIG.USE_IM?C(e):d(e));case 8:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),function(){var t=(0,f.default)(i.default.mark(function t(e){var r,n=this;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.delegateYield(i.default.mark(function t(){var r,a,u,o,c,s,f,d,l,v,h,C,x;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return g.info("teAddContactToContactGroup add a contact as a friend"),t.next=3,p();case 3:if(r=t.sent,e.id){t.next=9;break}return t.next=7,coreDb.queryContact({account:e.account});case 7:a=t.sent,isNullOrEmpty(a)||(e=a);case 9:for(u=$getState(),o=u.contactGroups.contactUserList,c=1;-1!==o.findIndex(function(t){return parseInt(t.contact_id)===c});)c++;return e.contact_id=c.toString(),t.next=16,coreContact.saveContactInfo(e);case 16:return e=t.sent,s={contact_id:e.contact_id,group_id:r.group_id,state:constant.CONTACT_GROUP_STATE.ADD},t.next=20,coreDb.saveContactMemberGroup(s);case 20:return t.next=22,(0,m.reloadContactListData)();case 22:if(f=u.contactGroups,d=f.detailContent,l=f.contactInfo,v=f.sliderDetailShow,h=f.sliderContent,C=f.sliderContactInfo,!v||"Contact"!==h||C.account!==e.account){t.next=26;break}return t.next=26,$dispatch(coreUi.updateSliderContactDetail(e,!1));case 26:if("contact"!==d||l.account!==e.account&&l.contact_id!==e.contact_id||$dispatch(coreUi.updateContactDetail(e,!1)),!window.CLIENTCONFIG.ISMOBILE){t.next=35;break}if($dispatch(coreUi.updateMobileContactDetail(e,!1)),window.Toast(language.ADDED_FRIEND,2,!1),window.CLIENTCONFIG.USE_IM){t.next=32;break}return t.abrupt("return",{v:void 0});case 32:return x={account:e.account,contact_id:e.contact_id},t.next=35,coreUi.tapContact(x);case 35:case"end":return t.stop()}},t,n)})(),"t0",2);case 2:if(r=t.t0,"object"!==(void 0===r?"undefined":(0,o.default)(r))){t.next=5;break}return t.abrupt("return",r.v);case 5:t.next=10;break;case 7:t.prev=7,t.t1=t.catch(0),g.error("teAddContactToContactGroup",t.t1.toJSON);case 10:case"end":return t.stop()}},t,this,[[0,7]])}));return function(e){return t.apply(this,arguments)}}()),l=e.dealContactGroupInfo=function(){var t=(0,f.default)(i.default.mark(function t(){var e,r,n,a,u,o,c;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=$getState(),r=void 0,n=e.contactGroups.contactGroupListWithoutExternal,a="Group",-1!==(u=n.findIndex(function(t){return t.name===a}))){t.next=14;break}return t.next=7,(0,v.addContactGroupService)(a,n.length);case 7:return o=t.sent,c={group_id:o.param.id,index:n.length,name:a,state:0},t.next=11,coreDb.saveContactGroup(c);case 11:r={group_id:o.param.id,index:n.length},t.next=15;break;case 14:r={group_id:n[u].group_id,index:u};case 15:return t.abrupt("return",r);case 16:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),p=function(){var t=(0,f.default)(i.default.mark(function t(){var e,r,n,a,u,o=this;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=$getState(),r=void 0,n=e.contactGroups.contactGroup,a="Group",-1!==(u=n.findIndex(function(t){return t.name===a}))){t.next=8;break}return t.delegateYield(i.default.mark(function t(){var e,u;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:for(e=1;-1!==n.findIndex(function(t){return t.group_id===e});)e++;return u={group_id:e,index:n.length,name:a,state:0},t.next=5,coreDb.saveContactGroup(u);case 5:r={group_id:e,index:n.length};case 6:case"end":return t.stop()}},t,o)})(),"t0",6);case 6:t.next=9;break;case 8:r={group_id:n[u].group_id,index:u};case 9:return t.abrupt("return",r);case 10:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),v=r(594),h=r(633),m=r(634),g=coreLogger.getLogger("logic")("contact"),C=e.normalAddContactToContactGroup=function(){var t=(0,f.default)(i.default.mark(function t(e){var r,n,a,u,o,c,s,f,d,p,C,x,b,y;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,g.info("normalAddContactToContactGroup add a contact as a friend"),t.next=4,l();case 4:return r=t.sent,n={account:e.account,group_id:r.group_id,display_name:""},t.next=8,(0,v.addContactService)(n);case 8:if(a=t.sent,a.result!==constant.ERROR_CODE.Success){t.next=47;break}if(e.id){t.next=15;break}return t.next=13,coreDb.queryContact({all:"",accountlist:e.account});case 13:u=t.sent,isNullOrEmpty(u)||(e=u);case 15:return e.contact_id=a.param.contact_id,t.next=18,(0,h.deleteContactPreSave)(e.account);case 18:return t.next=20,coreContact.saveContactInfo(e);case 20:return e=t.sent,o={contact_id:e.contact_id,group_id:r.group_id,state:constant.CONTACT_GROUP_STATE.ADD},t.next=24,coreDb.saveContactMemberGroup(o);case 24:return t.next=26,(0,m.reloadContactListData)();case 26:if(c=$getState(),s=c.contactGroups,f=s.detailContent,d=s.contactInfo,p=s.sliderDetailShow,C=s.sliderContent,x=s.sliderContactInfo,!p||"Contact"!==C||x.account!==e.account){t.next=31;break}return t.next=31,$dispatch(coreUi.updateSliderContactDetail(e,!1));case 31:if("contact"!==f||d.account!==e.account&&d.contact_id!==e.contact_id||$dispatch(coreUi.updateContactDetail(e,!1)),!window.CLIENTCONFIG.ISMOBILE){t.next=37;break}return $dispatch(coreUi.updateMobileContactDetail(e,!1)),b={account:e.account,contact_id:e.contact_id},t.next=37,coreUi.tapContact(b);case 37:return t.next=39,coreIm.getLocalRecent({owner:e.account});case 39:if(y=t.sent,isNullOrEmpty(y)){t.next=46;break}return y.contact=e,t.next=44,coreDb.saveRecent(y);case 44:y=t.sent,$dispatch(coreUi.updateRecent(y));case 46:return t.abrupt("return",a.result);case 47:t.next=52;break;case 49:t.prev=49,t.t0=t.catch(0),g.error("normalAddContactToContactGroup",t.t0.toJSON);case 52:case"end":return t.stop()}},t,void 0,[[0,49]])}));return function(e){return t.apply(this,arguments)}}()},969:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(!(0,g.checkCanDownloadAvatar)(t,"downloadAsAvatar"))return h.default.resolve(!0);var e={account:t};return new h.default(function(r){_(t).then(function(t){t&&(e.etag=t.etag_large),C.debug("downloadAsAvatar",e);var n=setTimeout(function(){return r(!0)},5e3),a=function(){C.debug("downloadAsAvatar ackCallback"),n&&clearTimeout(n),r(!0)};coreContact.searchAvatar((0,p.default)({},e,{iconSize:constant.AVATAR_SIZE.BIG,callback:u(a)}))})})}function u(t){return function(e){C.debug("downloadAsAvatarAck",e),t(),(0,g.avatarDownloadAckQueue)(function(){return m(e)})}}Object.defineProperty(e,"__esModule",{value:!0}),e.getDownloadAsAvatarListTaskQueue=e.initDownloadAsAvatarListTaskQueue=e.getDownloadAsAvatarTaskQueue=e.initDownloadAsAvatarTaskQueue=e.downloadAsAvatarList=void 0;var o=r(1),c=n(o),i=r(143),s=n(i),f=r(2),d=n(f),l=r(139),p=n(l),v=r(3),h=n(v),m=function(){var t=(0,d.default)(c.default.mark(function t(e){var r,n,a,u,o,i,f,d;return c.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,C.debug("dealDownloadAsAvatarResult",e),!(e&&e.param&&0===e.param.ret&&e.param.rsp_body)){t.next=32;break}return r="?temp="+Math.random(),n=void 0,a=void 0,t.next=6,coreAccount.getLoginModel();case 6:return u=t.sent,t.next=9,appService.getAvatarPath(u.account);case 9:o=t.sent,i=e.param.rsp_body.header,f=(i.query({name:"x-request-id"})||{}).value,d=(i.query({name:"id"})||{}).value,t.t0=e.param.rsp_body.rsp_code,t.next=t.t0===constant.AS_AVATAR_RESP_CODE.SUCCESS?16:t.t0===constant.AS_AVATAR_RESP_CODE.NO_AVATAR?23:t.t0===constant.AS_AVATAR_RESP_CODE.NO_CHANGE?25:t.t0===constant.AS_AVATAR_RESP_CODE.AUTHENTICATION_ERROR?27:t.t0===constant.AS_AVATAR_RESP_CODE.SERVER_ERROR?27:29;break;case 16:return C.info("dealDownloadAsAvatarResult,this user's avatar download success,result="+e.param.rsp_body.rsp_code+",id="+handleAccountPrint(d)),r="?temp="+Math.random(),n=d+".png",a=i.query({name:"ETag"}).value,(0,g.checkSameAvatar)(d,n),coreUi.updateAvatarMap((0,s.default)({},d,(0,g.getAvatarRealPath)(o,n,r)),!0).then(function(){coreIm.UnReadMessageFlashSetting().updateTrayImg(d)}),t.abrupt("return",w(d,a));case 23:return C.info("dealDownloadAsAvatarResult,this user has no avatar,result="+e.param.rsp_body.rsp_code+",request="+f+",id="+handleAccountPrint(d)),t.abrupt("break",30);case 25:return C.info("dealDownloadAsAvatarResult,this user's avatar is no change,result="+e.param.rsp_body.rsp_code+",request="+f+",id="+handleAccountPrint(d)),t.abrupt("break",30);case 27:return C.info("dealDownloadAsAvatarResult,this request is error,result="+e.param.rsp_body.rsp_code+",request="+f+",id="+handleAccountPrint(d)),t.abrupt("break",30);case 29:return t.abrupt("break",30);case 30:t.next=33;break;case 32:C.error("dealDownloadAsAvatarResult,request data is error");case 33:t.next=38;break;case 35:t.prev=35,t.t1=t.catch(0),C.error("dealDownloadAsAvatarResult",t.t1);case 38:case"end":return t.stop()}},t,this,[[0,35]])}));return function(e){return t.apply(this,arguments)}}();e.downloadAsAvatar=a;var g=r(635),C=coreLogger.getLogger("contact/avatar")("downloadAsAvatar"),x=e.downloadAsAvatarList=function(t){return a(t[0])},b=new coreCommon.BatchDealSelfExecutionTasksQueue({describe:"downloadAsAvatarListTaskQueue",taskFunc:x,maxBatchNumber:1}),y=new coreCommon.SelfExecutionTasksQueue({describe:"downloadAsAvatarTaskQueue",taskFunc:a});e.initDownloadAsAvatarTaskQueue=function(){y=new coreCommon.SelfExecutionTasksQueue({describe:"downloadAsAvatarTaskQueue",taskFunc:a})},e.getDownloadAsAvatarTaskQueue=function(){return y},e.initDownloadAsAvatarListTaskQueue=function(){b=new coreCommon.BatchDealSelfExecutionTasksQueue({describe:"downloadAsAvatarListTaskQueue",taskFunc:x,maxBatchNumber:1})},e.getDownloadAsAvatarListTaskQueue=function(){return b};window.useNeiCunData=!0,window.userAvatarList=[];var w=function(){var t=(0,d.default)(c.default.mark(function t(e,r){var n;return c.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,_(e);case 2:return n=t.sent,n.etag_large=r,C.debug("saveUserAvatarInfo",n),t.next=7,coreDb.saveAvatarTag(n);case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}},t,void 0)}));return function(e,r){return t.apply(this,arguments)}}(),_=function(){var t=(0,d.default)(c.default.mark(function t(e){var r,n,a,u;return c.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return C.debug("getAvatarInfo",e),t.next=3,coreAccount.getLoginModel();case 3:return r=t.sent,t.next=6,appService.getAvatarPath(r.account);case 6:return n=t.sent,n=(0,g.getAvatarRealPath)(n,e+".png"),t.next=10,appService.isFileExist(n);case 10:if(!(a=t.sent)){t.next=20;break}return t.next=14,coreDb.queryAvatarTagList({account:e});case 14:if(u=t.sent[0]){t.next=18;break}return C.debug("getAvatarInfo,avatarInfo is null"),t.abrupt("return",{account:e,etag_large:"",etag_medium:"",etag_small:""});case 18:return C.debug("getAvatarInfo",u),t.abrupt("return",u);case 20:return C.debug("getAvatarInfo has no local avatar,download again"),t.abrupt("return",{account:e,etag_large:"",etag_medium:"",etag_small:""});case 22:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}()},970:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){return function(e){v.debug("dealGetAvatarListAck",e),t(),(0,p.avatarDownloadAckQueue)(function(){return l(e)})}}Object.defineProperty(e,"__esModule",{value:!0}),e.downloadAvatarList=e.getDownloadAvatarListTaskQueue=e.initDownloadAvatarListTaskQueue=void 0;var u=r(1),o=n(u),c=r(3),i=n(c),s=r(2),f=n(s),d=e.downloadAvatarList=function(){var t=(0,f.default)(o.default.mark(function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if((0,p.checkCanDownloadAvatarList)(e)){t.next=2;break}return t.abrupt("return",i.default.resolve(!0));case 2:return t.abrupt("return",new i.default(function(t){v.debug("downloadAvatarList",e);var r=setTimeout(function(){return t(!0)},5e3),n=function(){v.debug("downloadAvatarList ackCallback"),r&&clearTimeout(r),t(!0)};e&&e.length>0&&coreContact.searchAvatarList({accountList:e,callback:a(n)})}));case 3:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),l=function(){var t=(0,f.default)(o.default.mark(function t(e){var r,n,a,u,c,i;return o.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(v.info("dealGetAvatarListResult",!isNullOrEmpty(e.info)&&e.info.length),r=e.info,n=e.result,0!==n||isNullOrEmpty(r)){t.next=13;break}return t.next=5,coreAccount.getLoginModel();case 5:return a=t.sent,t.next=8,appService.getAvatarPath(a.account);case 8:u=t.sent,c={},i="?temp="+Math.random(),r.forEach(function(t){var e=t.AvatarFile,r=t.ucaccount;""!==e&&(c[r]=(0,p.getAvatarRealPath)(u,e,i))}),coreUi.updateAvatarMap(c,!0);case 13:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}(),p=r(635),v=coreLogger.getLogger("contact/avatar")("downloadAvatar"),h=new coreCommon.BatchDealSelfExecutionTasksQueue({describe:"downloadAvatarListTaskQueue",taskFunc:d,maxBatchNumber:20});e.initDownloadAvatarListTaskQueue=function(){h=new coreCommon.BatchDealSelfExecutionTasksQueue({describe:"downloadAvatarListTaskQueue",taskFunc:d,maxBatchNumber:20})},e.getDownloadAvatarListTaskQueue=function(){return h}},971:function(t,e,r){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:constant.AVATAR_SIZE.BIG;if(!(0,h.checkCanDownloadAvatar)(t,"downloadAvatar"))return p.default.resolve(!0);var r=getClientId();return new p.default(function(n){var a=setTimeout(function(){n(!0),a=null},5e3),o=function(){m.debug("downloadAvatar ackCallback",a),a&&(a&&clearTimeout(a),a=null,n(!0))};m.debug("downloadAvatar",t,r),coreContact.searchAvatar({account:t,iconSize:e,callback:u(t,o,r)})})}function u(t,e,r){return m.debug("createDownloadAvatarAck",t,r),function(n){e(),m.debug("downloadAvatarAck 处理头像下载完成通知",n,t,r),(0,h.avatarDownloadAckQueue)(function(){return v(t,n)})}}Object.defineProperty(e,"__esModule",{value:!0}),e.getDownloadAvatarTaskQueue=e.initDownloadAvatarTaskQueue=void 0;var o=r(1),c=n(o),i=r(143),s=n(i),f=r(2),d=n(f),l=r(3),p=n(l),v=function(){var t=(0,d.default)(c.default.mark(function t(e,r){var n,a,u,o,i;return c.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(m.info("dealDownloadAvatarResult"),m.debug("dealDownloadAvatarResult",r),n=r.AvatarFile,a=r.result,u="?temp="+Math.random(),0!==a){t.next=18;break}if(!n){t.next=16;break}return(0,h.checkSameAvatar)(e,n),t.next=9,coreAccount.getLoginModel();case 9:return o=t.sent,t.next=12,appService.getAvatarPath(o.account);case 12:i=t.sent,coreUi.updateAvatarMap((0,s.default)({},e,(0,h.getAvatarRealPath)(i,n,u)),!0).then(function(){coreIm.UnReadMessageFlashSetting().updateTrayImg(n.slice(0,n.lastIndexOf(".")))}),t.next=18;break;case 16:coreUi.deleteAvatarMap(e),m.error("dealDownloadAvatarResult no avatar","result:"+a);case 18:return t.abrupt("return",p.default.resolve());case 19:case"end":return t.stop()}},t,this)}));return function(e,r){return t.apply(this,arguments)}}();e.downloadAvatar=a;var h=r(635),m=coreLogger.getLogger("contact/avatar")("downloadAvatar"),g=new coreCommon.SelfExecutionTasksQueue({describe:"downloadAvatarTaskQueue",taskFunc:a});e.initDownloadAvatarTaskQueue=function(){g=new coreCommon.SelfExecutionTasksQueue({describe:"downloadAvatarTaskQueue",taskFunc:a})},e.getDownloadAvatarTaskQueue=function(){return g}}});
webpackJsonp([9],{1e3:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.reSendScreenShots=t.sendScreenShots=void 0;var o=r(1),s=a(o),i=r(2),u=a(i),c=r(302),l=n(c),d=r(171),f=n(d),p=r(337),g=r(182),_=n(g),h=r(190),v=n(h),m=r(217),M=r(304),y=coreLogger.getLogger("logic")("IM/messageSend"),E=(t.sendScreenShots=function(){var e=(0,u.default)(s.default.mark(function e(t,r){var n,a,o,i,u,c,d,p,g,h=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,I=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,y.info("sendScreenShots"),isNullOrEmpty(h)&&(h=$getState()),coreUi.clearDoc().then(function(){coreCommon.isIos()&&delegate.$getUmEditor&&delegate.$getUmEditor().focus()}),S(t)){e.next=7;break}return window.alert(language.CHECK_PHOTO_MAX_SIZE),e.abrupt("return");case 7:return n=l.createPhotoTextMessage(h,r,I),a=[],o=!0,e.next=12,coreAccount.getLoginModel();case 12:i=e.sent,u=0;case 14:if(!(u<t.length)){e.next=31;break}return c=t[u],d={file_name:c.name,file_real_save_path:c.path,file_size:c.size,width:c.width,height:c.height,message_id:n.id,message_server_chat_id_str:n.server_chat_id_str,recent_id:n.recent_id,recent_owner:n.recent_owner,file_handle:"",is_uploaded:constant.IS_UPLOADED.NO,file_deal_type:constant.FILE_DEAL_TYPE.UPLOAD,time_stamp:n.time_stamp},p=i.account,d.file_path=appService.getOriginFilesPath(p)+c.name,d.file_real_save_name=d.file_name,e.next=22,E(d,n);case 22:return g=e.sent,g||(o=!1),e.next=26,coreDb.saveScreenShot(d);case 26:d=e.sent,a.push(d);case 28:u++,e.next=14;break;case 31:return n.file_list=a,o||(0,M.dealScreenShotSendFailed)(n),n.status=constant.MEDIA_STATUS.SEND_ERROR,n.send_status=constant.SEND_STATUS.error,e.next=37,coreDb.saveMessage(n);case 37:n=e.sent,n.send_status=constant.SEND_STATUS.sending,n.status=constant.MEDIA_STATUS.SENDING,_.setSendingMessage(n.client_chat_id,n),(0,m.updateMessageToRecent)(n),y.info("sendScreenShots has been completed"),f.isBelongToCurrentRecent(n)&&(v.initLoadMore(),v.addNewMessage(n)),e.next=49;break;case 46:e.prev=46,e.t0=e.catch(0),y.error("sendScreenShots",e.t0.toJSON());case 49:case"end":return e.stop()}},e,void 0,[[0,46]])}));return function(t,r){return e.apply(this,arguments)}}(),t.reSendScreenShots=function(){var e=(0,u.default)(s.default.mark(function e(t){var r,n,a,o,i,u;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,r=t.file_list,n=[],a=!0,o=0;case 5:if(!(o<r.length)){e.next=18;break}return i=r[o],e.next=9,E(i,t);case 9:return u=e.sent,u||(a=!1),e.next=13,coreDb.saveScreenShot(i);case 13:i=e.sent,n.push(i);case 15:o++,e.next=5;break;case 18:if(t.file_list=n,a){e.next=21;break}return e.abrupt("return",(0,M.dealScreenShotSendFailed)(t));case 21:return t.status=constant.MEDIA_STATUS.SEND_ERROR,t.send_status=constant.SEND_STATUS.error,e.next=25,coreDb.saveMessage(t);case 25:t=e.sent,t.status=constant.MEDIA_STATUS.SENDING,t.send_status=constant.SEND_STATUS.resend,_.setSendingMessage(t.client_chat_id,t),(0,m.updateMessageToRecent)(t),y.info("sendScreenShots has been completed"),f.isBelongToCurrentRecent(t)&&v.updateMessageList(t),e.next=37;break;case 34:e.prev=34,e.t0=e.catch(0),y.error("reSendFile",e.t0.toString());case 37:case"end":return e.stop()}},e,void 0,[[0,34]])}));return function(t){return e.apply(this,arguments)}}(),function(){var e=(0,u.default)(s.default.mark(function e(t,r){var n,a,o,i,u,c;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(y.info("sendScreenShot"),n=$getState(),a=n.recent,o=a.currentRecentInfo,i={file_name:t.file_name,file_path:t.file_real_save_path},!f.isGroup(o.chat_type)||!_.getUmServerFlag()){e.next=13;break}return i.group_id=o.group.group_id,i.file_type=constant.UPLOAD_FILE_TYPE.GROUP,e.next=9,(0,p.groupFilePreUpload)(t,r);case 9:if(""!==(u=e.sent)){e.next=12;break}return e.abrupt("return",!1);case 12:i.operation_token=u;case 13:return e.next=15,coreIm.uploadFile(i);case 15:if(!1!==(c=e.sent)){e.next=18;break}return e.abrupt("return",!1);case 18:return t.file_handle=c.param.pfile_handle.toString(),_.setFileByHandle(t.file_handle,t),e.abrupt("return",!0);case 21:case"end":return e.stop()}},e,void 0)}));return function(t,r){return e.apply(this,arguments)}}()),S=function(e){for(var t=0;t<e.length;t++)if(e[t].size>1024*parseInt(window.CLIENTCONFIG["Device.ComCfg.IM.limitpic"]))return!1;return!0}},1001:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.dealRelativeEmotionPath=t.saveMessageListInfo=t.getMessageShowHtml=t.getMessageShowText=t.dealRecentLastMessageList=t.dealHistoryMessageList=t.dealReceiveMessage=void 0;var a=r(1002),o=n(a),s=r(1003),i=n(s),u=r(1004),c=n(u),l=r(598),d=n(l);t.dealReceiveMessage=o.dealReceiveMessage,t.dealHistoryMessageList=i.dealHistoryMessageList,t.dealRecentLastMessageList=c.dealRecentLastMessageList,t.getMessageShowText=d.getMessageShowText,t.getMessageShowHtml=d.getMessageShowHtml,t.saveMessageListInfo=d.saveMessageListInfo,t.dealRelativeEmotionPath=d.dealRelativeEmotionPath},1002:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.dealReceiveMessage=void 0;var a=r(1),o=n(a),s=r(2),i=n(s),u=r(217),c=r(598),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(c),d=coreLogger.getLogger("logic")("IM/message/receive"),f=(t.dealReceiveMessage=function(){var e=(0,i.default)(o.default.mark(function e(t){var r,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,d.info("dealReceiveMessage"),t.chat_type!==constant.CHAT_TYPE.SYSTEM_NOTIFICATION){e.next=4;break}return e.abrupt("return",p(t,a=-1));case 4:return e.next=6,coreContact.getContactByAccount(t.origin);case 6:if(r=e.sent,!isNullOrEmpty(r)){e.next=10;break}return d.error("[dealReceiveMessage] Message contact was not exist, and stop continuing analysis. Message chat id was ",t.server_chat_id_str),e.abrupt("return",null);case 10:return e.next=12,coreIm.createOrGetRecentByMessage(t,r,a);case 12:return n=e.sent,d.info("[dealReceiveMessage] Deal the message contact."),t.sub_msg_type===constant.MSGSUBFLAG.ANNOUNCEMENT&&coreGroup.dealFixedGroupAnnouncementChange(t),e.next=17,f(t,n,r);case 17:if(t=e.sent,!isNullOrEmpty(t.media_type)){e.next=21;break}return d.error("[dealReceiveMessage] Message type was not exist, and stop continuing analysis. Message chat id was ",t.server_chat_id_str),e.abrupt("return",null);case 21:if(!isNullOrEmpty(t.show_text)){e.next=24;break}return d.error("[dealReceiveMessage] Failed to analysis the message contact. The message was invalid. Message chat id was ",t.server_chat_id_str),e.abrupt("return",null);case 24:return n=(0,u.dealRecentLastMessageInfo)(n,t),e.next=27,coreDb.saveRecent(n);case 27:return n=e.sent,e.abrupt("return",{message:t,recent:n});case 31:return e.prev=31,e.t0=e.catch(0),d.error("dealReceiveMessage",e.t0.toString()),e.abrupt("return",null);case 35:case"end":return e.stop()}},e,void 0,[[0,31]])}));return function(t){return e.apply(this,arguments)}}(),function(){var e=(0,i.default)(o.default.mark(function e(t,r,n){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,d.debug("[dealMessage] Deal message contact"),e.next=4,l.dealPcMessageInfo(t,r,n);case 4:if(t=e.sent,!isNullOrEmpty(t)){e.next=8;break}return d.error("[dealMessage] Deal message failed, The message is null or empty"),e.abrupt("return",t);case 8:return l.saveMessageListInfo([t]),e.abrupt("return",t);case 12:return e.prev=12,e.t0=e.catch(0),d.error("[dealMessage] Deal message failed.",e.t0.toString()),e.abrupt("return",t);case 16:case"end":return e.stop()}},e,void 0,[[0,12]])}));return function(t,r,n){return e.apply(this,arguments)}}()),p=function(){var e=(0,i.default)(o.default.mark(function e(t,r){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return d.info("dealSystemBulletinMessage"),l.saveMessageListInfo([t]),n={chat_type:t.chat_type,time_stamp:t.utc_stamp,last_message:t,server_chat_id_str:t.server_chat_id_str,owner:t.origin},e.next=5,coreDb.saveRecent(n);case 5:return n=e.sent,e.abrupt("return",{message:t,recent:n});case 7:case"end":return e.stop()}},e,void 0)}));return function(t,r){return e.apply(this,arguments)}}()},1003:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.dealHistoryMessageList=void 0;var a=r(1),o=n(a),s=r(2),i=n(s),u=r(598),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(u),l=coreLogger.getLogger("logic")("IM/message/receive");t.dealHistoryMessageList=function(){var e=(0,i.default)(o.default.mark(function e(t,r){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l.info("dealHistoryMessageList start dealing messageList"),e.next=4,c.dealPcMessageList(t,r);case 4:return n=e.sent,e.next=7,c.saveMessageListInfo(n);case 7:e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),l.error("dealHistoryMessageList 处理失败",e.t0.toString());case 12:case"end":return e.stop()}},e,void 0,[[0,9]])}));return function(t,r){return e.apply(this,arguments)}}()},1004:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.dealRecentLastMessageList=void 0;var a=r(1),o=n(a),s=r(3),i=n(s),u=r(139),c=n(u),l=r(2),d=n(l),f=r(598),p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(f),g=coreLogger.getLogger("logic")("IM/message/receive");t.dealRecentLastMessageList=function(){var e=(0,d.default)(o.default.mark(function e(t){var r,n,a,s,u,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,g.info("dealRecentLastMessageList 处理最后一条消息特有逻辑"),e.next=4,p.dealPcRecentListLastMessageInfo(t,l);case 4:for(r=e.sent,n=r.messageList,a=r.recentList,s=0;s<n.length;s++)u=(0,c.default)({},n[s]),a[s].last_message=(0,c.default)({},u),a[s].time_stamp=u.utc_stamp||a[s].time_stamp;return a=l.update(["owner"],a),e.next=11,i.default.all([coreDb.bulkPutRecent(a),coreDb.bulkPutMessage(n)]);case 11:return g.debug("dealRecentLastMessageList"),e.abrupt("return",a);case 15:return e.prev=15,e.t0=e.catch(0),g.error("dealRecentLastMessageList 处理失败",e.t0.toString()),e.abrupt("return",l);case 19:case"end":return e.stop()}},e,void 0,[[0,15]])}));return function(t){return e.apply(this,arguments)}}()},1005:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.reSendMessage=void 0;var a=r(1),o=n(a),s=r(139),i=n(s),u=r(2),c=n(u),l=r(228),d=coreLogger.getLogger("logic")("IM/messageReSend");t.reSendMessage=function(){var e=(0,c.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{d.info("reSendMessage"),t.send_status=constant.SEND_STATUS.resend,(0,l.sendImMessage)((0,i.default)({},t))}catch(e){d.error("sendNormalMessage",e.toString())}case 1:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}()},1006:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.relayMessage=void 0;var a=r(135),o=n(a),s=r(3),i=n(s),u=r(139),c=n(u),l=r(142),d=n(l),f=r(228),p=r(171),g=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(p),_=r(338),h=coreLogger.getLogger("logic")("IM/messageRelay"),v=(t.relayMessage=function(e){try{h.info("relayMessage 转发消息");var t=v(e);if(isNullOrEmpty(t.file_list))return(0,f.sendImMessage)((0,c.default)({},t));g.hasScreenShot(t.media_type)||g.isShareImage(t.card_type)?coreDb.bulkPutScreenShot([].concat((0,d.default)(t.file_list))).then(function(){return(0,f.sendImMessage)((0,c.default)({},t))}):t.media_type===constant.MEDIA_TYPE.VIDEO&&2===t.file_list.length?i.default.all([coreDb.saveFile(t.file_list[0]),coreDb.saveScreenShot(t.file_list[1])]).then(function(){return(0,f.sendImMessage)((0,c.default)({},t))}):(t.file_list.map(function(e){var r=!isNullOrEmpty(e.exparams)&&String(e.exparams).isJSON()?JSON.parse(e.exparams):{};return e.send_from_local=t.status===constant.MEDIA_STATUS.RECEIVE_SUCCESS?1:r.local,e}),coreDb.bulkPutFile([].concat((0,d.default)(t.file_list))).then(function(){return(0,f.sendImMessage)((0,c.default)({},t))}))}catch(e){h.error("relayMessage",e.toString())}},function(e){try{h.info("dealRelayParams");var t=$getState(),r=t.myInfo,n=e.message,a=e.recent,s=(0,o.default)({},(0,c.default)({},n));return isNullOrEmpty(n.file_list)||(s.file_list=[]),g.isGroup(a.chat_type)?s.group_id=a.owner:s.target=a.owner,s.name=r.name,s.native_name=r.native_name,s.display_name=getContactName(r),s.origin=r.account,s.chat_type=a.chat_type,s.recent_id=a.id,s.recent_owner=a.owner,s.client_chat_id=getClientId(),s.time_stamp=_.localTimeService.getLocalTime(),s.server_chat_id_str=s.client_chat_id.toString(),s.at_user_list=[],isNullOrEmpty(n.file_list)||n.file_list.map(function(e){var t=(0,o.default)({},e);return t.recent_id=s.recent_id,t.recent_owner=s.recent_owner,t.message_server_chat_id_str=s.server_chat_id_str,delete t.id,s.file_list.push(t),t}),delete s.id,s}catch(e){return h.error("dealRelayParams",e.toString()),{}}})},1007:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.teamNotifyReadMessage=t.deleteMessage=void 0;var a=r(1),o=n(a),s=r(2),i=n(s),u=r(171),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(u),l=r(217),d=coreLogger.getLogger("logic")("IM/messageDelete");t.deleteMessage=function(){var e=(0,i.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{d.info("deleteMessage"),window.confirm(language.CONFIRM_TO_DELETE_MESSAGE).then(function(){var e=(0,i.default)(o.default.mark(function e(r){var n,a,s,i,u,d,f,p,g,_,h,v;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.ret){e.next=2;break}return e.abrupt("return");case 2:if(coreIm.checkEserverOnline("deleteMessage")){e.next=4;break}return e.abrupt("return");case 4:return n=t.chat_type,a=t.server_chat_id_str,s=t.group_id,i=t.target,u=$getState().recent,d=u.currentRecentInfo,f=u.messageList,p={msg_type:constant.IM_MSG_TYPE.SINGLE,opt_type:0,msgid_list:[a],sender:i},g=c.isGroup(n),g&&(p.msg_type=constant.IM_MSG_TYPE.GROUP,p.sender=s),coreIm.isPublicNo(n)&&(p.sender=t.recent_owner),e.next=12,coreIm.deleteHistoryMessage(p);case 12:if(!(_=e.sent)||_.result!==constant.ERROR_CODE.Success){e.next=20;break}return t.is_delete=constant.IS_DELETE.YES,coreIm.updateImgList(t,"delete"),d.last_message_server_chat_id_str===t.server_chat_id_str&&(h=f[f.length-2],v=(0,l.dealRecentLastMessageInfo)(d,h),coreDb.saveRecent(v),(0,l.refreshRecentList)(v)),coreDb.saveMessage(t),isNullOrEmpty(t.file_list)||isNullOrEmpty(t.file_list[0])||(coreDb.deleteFile({message_server_chat_id_str:t.file_list[0].message_server_chat_id_str}),coreDb.deleteScreenShot({message_server_chat_id_str:t.file_list[0].message_server_chat_id_str})),e.abrupt("return",$dispatch(coreUi.deleteSelectMessage(t)));case 20:window.Toast(language.DELETE_MESSAGE_ERROR);case 21:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}())}catch(e){d.error("deleteMessage",e.toString())}case 1:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.teamNotifyReadMessage=function(){var e=$getState().recent.currentRecentInfo;e.group.team_notify_is_read=constant.IS_READ.YES,coreGroup.setTeamNotifyRead(e.group.group_id),coreIm.updateRecent(e)}},1008:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(M.info("dealWithdrawMessageInfo"),h.isGroup(t.chat_type)){var r=$getState().recent.atMessageList,n=[],a=0;r.map(function(t){t.server_chat_id_str!==e.server_chat_id_str&&n.push(t)}),n.map(function(e){e.recent_owner===t.owner&&a++}),$dispatch(coreUi.setAtMessageList(n)),a||(t.is_at=!1),e.at_user_list=null}var o=e.media_type,s=e.origin;coreCommon.isSelfAccount(s)&&(o===constant.MEDIA_TYPE.TEXT||constant.MEDIA_TYPE.PHOTO||constant.MEDIA_TYPE.PHOTO_TEXT)?e.time_stamp=(new Date).getTime():e.show_html="",e.media_type=constant.MEDIA_TYPE.WITHDRAW_NOTIFY,e.content="",e.is_read=constant.IS_READ.YES,coreIm.updateImgList(e,"delete"),(0,d.updateMessageList)(e),coreDb.saveMessage(e),isNullOrEmpty(e.file_list)||isNullOrEmpty(e.file_list[0])||(coreDb.deleteFile({message_server_chat_id_str:e.file_list[0].message_server_chat_id_str}),coreDb.deleteScreenShot({message_server_chat_id_str:e.file_list[0].message_server_chat_id_str})),t=(0,f.dealRecentLastMessageInfo)(t,e),coreDb.saveRecent(t),(0,f.refreshRecentList)(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.dealWithdrawMessageNotify=t.dealWithdrawMessageAck=t.withdrawMessage=void 0;var s=r(1),i=a(s),u=r(2),c=a(u),l=r(228),d=r(190),f=r(217),p=r(182),g=n(p),_=r(171),h=n(_),v=r(303),m=r(644),M=coreLogger.getLogger("logic")("IM/withdraw");t.withdrawMessage=function(e){var t=e.origin,r=e.target,n=e.server_chat_id_str,a=e.group_name,o=e.chat_type,s=e.group_id,i=$getState().recent.currentRecentInfo,u=i.last_message_server_chat_id_str,c=h.isGroup(o);c&&isNullOrEmpty(a)&&i.group&&(M.info("withdrawMessage message's group_name is empty now,, use recent's group_name"),a=i.group.name);var d={origin:t,origin_name:getContactNameByMessage(e),group_name:a,target:c?s:r,msg_type:c?constant.IM_MSG_TYPE.GROUP:constant.IM_MSG_TYPE.SINGLE,is_lastmsg:n===u?constant.IS_LASTMSG.YES:constant.IS_LASTMSG.NO,message_list:[{str_msgid:n}]};(0,l.withdrawIm)(d)},t.dealWithdrawMessageAck=function(e){var t=e.param,r=t.result,n=t.msg_list,a="";if(M.info("dealWithdrawMessageAck",r),r===constant.ERROR_WITHDRAW_CODE.SUCCESS){var s=n[0].str_msgid,i=$getState().recent,u=i.messageList,c=i.currentRecentInfo,l=u.query({server_chat_id_str:s});return g.setMessageWithdrawServerId(s,{server_chat_id_str:s}),l.show_text=language.WITHDRAW_MY_NOTIFY,void o(l,c)}a=r===constant.ERROR_WITHDRAW_CODE.OPRMSG_TIMEOUT?language.WITHDRAW_OPRMSG_TIMEOUT:language.WITHDRAW_ERROR,window.CLIENTCONFIG.ISMOBILE?window.Toast(a,2,!1):window.Toast(a,2,!1,"WhiteWarning")},t.dealWithdrawMessageNotify=function(){var e=(0,c.default)(i.default.mark(function e(t){var r,n,a,s,u,c,l,d,f,p,_,h,y,E,S,I,w;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.param,n=r.msg_list,a=r.origin,s=r.target,u=r.msgtype,c=$getState().myInfo.account,l=n[0].str_msgid,d=$getState(),f=d.recent,p=f.messageList,_=f.currentRecentInfo,h=d.IM.unReadNewMessageNum,y=c!==a,E=u===constant.IM_MSG_TYPE.SINGLE&&y?a:s,e.next=9,coreIm.getLocalRecent({owner:E});case 9:if(S=e.sent,I=void 0,M.info("dealWithdrawMessageNotify 消息撤回通知",l),g.setMessageWithdrawServerId("server_chat_id_str",{server_chat_id_str:l}),isNullOrEmpty(S)){e.next=42;break}if(_.owner!==S.owner){e.next=24;break}if(M.info("dealWithdrawMessageNotify 在当前会话"),I=p.query({server_chat_id_str:l})){e.next=22;break}return e.next=20,coreDb.queryMessage({server_chat_id_str:l});case 20:I=e.sent,(0,v.setUnreadNewMessageNum)(h<=0?h:h-1);case 22:e.next=31;break;case 24:return M.info("dealWithdrawMessageNotify 不在当前会话"),e.next=27,coreDb.queryMessage({server_chat_id_str:l});case 27:if(e.t0=e.sent,e.t0){e.next=30;break}e.t0=g.getRecentUnReadMessage(S.owner,l);case 30:I=e.t0;case 31:if(!isNullOrEmpty(I)){e.next=34;break}return M.error("dealWithdrawMessageNotify 没有查到消息"),e.abrupt("return");case 34:return e.next=36,coreCommon.setWithdrawNotifyRead(l,S);case 36:S=e.sent,w=getContactNameByMessage(I),I.show_text=language.WITHDRAW_MY_NOTIFY,y&&(I.show_text=language.WITHDRAW_NOTIFY.format(w)),o(I,S),(0,m.removeUnReadMessageFlash)(S);case 42:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}()},1009:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.sendAutoReply=void 0;var a=r(190),o=(n(a),r(302)),s=(n(o),r(228)),i=(n(s),r(171)),u=n(i),c=r(1010),l=coreLogger.getLogger("logic")("IM/sendAutoReply");t.sendAutoReply=function(e){var t=u.getImType(e),r=$getState().myInfo.account,n=$getState().contactGroups.contact_status_map[r],a=n&&n.status;if(t===constant.IM_TYPE.SINGLE&&a===constant.ONLINE_STATUS.LEAVE)try{var o=$getState().setting.setResponsePre;o="default"===o.responseType?language[o.defaultResponseId]:o.name,o=coreCommon.filterSensitiveWord(o);var s={html:language.AUTO_REPLY+o,mediaType:constant.MEDIA_TYPE.TEXT,chatType:constant.CHAT_TYPE.AUTO_REPLY,text:language.AUTO_REPLY+o};if(l.info("user sendAutoReply",o),isNullOrEmpty(o))return;(0,c.sendQuickReply)(s,null,e.origin)}catch(e){l.error("sendAutoReply",e.toString())}}},1010:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.sendMobileQuickReply=t.sendQuickReply=void 0;var a=r(139),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=r(190),i=n(s),u=r(302),c=n(u),l=r(228),d=n(l),f=(r(303),coreLogger.getLogger("logic")("IM/sendQuickReply"));t.sendQuickReply=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{if(f.info("userClick sendQuickReply"),!coreIm.checkEserverOnline("sendQuickReply"))return;var n=document.createElement("div");return n.innerHTML=e.html,e.html=n.innerHTML,e.text=n.innerHTML,c.createNormalMessage(e,t,r).then(function(e){return d.sendImMessage((0,o.default)({},e))})}catch(e){f.error("sendQuickReply",e.toString())}},t.sendMobileQuickReply=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{if(f.info("userClick sendQuickReply"),!coreIm.checkEserverOnline("sendMobileQuickReply"))return;return c.createMobileTextMessage(e,t).then(function(e){return i.initLoadMore(),i.addNewMessage(e),d.sendImMessage((0,o.default)({},e))})}catch(e){f.error("sendMobileQuickReply",e.toString())}}},1011:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(1),o=n(a),s=r(2),i=n(s),u=r(4),c=n(u),l=r(5),d=n(l),f=r(171),p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(f),g=r(644),_=function(){function e(){(0,c.default)(this,e),this.init()}return(0,d.default)(e,[{key:"init",value:function(){this.unReadMessageFlashList=[],this.inGroupMap={}}},{key:"push",value:function(e){var t=e.recent;p.isGroup(t.chat_type)&&this.getGroupMap(t),this.unReadMessageFlashList.push(e)}},{key:"getGroupMap",value:function(e){var t=this,r=e.group,n=r.group_id;($getState().contactGroups.groupAvatarMembersMap[n]||[]).map(function(e){return e.account}).forEach(function(e){Object.type(t.inGroupMap[e])===Object.type.ARRAY?t.inGroupMap[e].push(n):t.inGroupMap[e]=[n]})}},{key:"get",value:function(){return this.unReadMessageFlashList}},{key:"delete",value:function(e){return this.unReadMessageFlashList.splice(e,1)[0]}},{key:"updateCurrentTrayImg",value:function(e,t){this.unReadMessageFlashList.findIndex(function(e){return e.owner===t})===this.unReadMessageFlashList.length-1&&window.flashTray(e.image,g.clickTrayUnReadFlash)}},{key:"updateGroupTrayImg",value:function(e){var t=this,r=this.inGroupMap[e];!isNullOrEmpty(r)&&r.map(function(){var e=(0,i.default)(o.default.mark(function e(n,a){var s,i;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.unReadMessageFlashList.query({owner:n}),isNullOrEmpty(s)){e.next=8;break}return i=s.recent,e.next=5,coreUi.getDiscussGroupAvatarImage({group:i.group});case 5:s.image=e.sent,t.updateCurrentTrayImg(s,n),r.splice(a,1);case 8:case"end":return e.stop()}},e,t)}));return function(t,r){return e.apply(this,arguments)}}())}},{key:"updateTrayImg",value:function(){function e(e){return t.apply(this,arguments)}var t=(0,i.default)(o.default.mark(function e(t){var r,n,a,s,i;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.unReadMessageFlashList.query({owner:t}),isNullOrEmpty(r)){e.next=18;break}if(n=$getState().common.avatarMap,a=r.recent,!p.isGroup(a.chat_type)){e.next=11;break}return e.next=7,coreUi.getDiscussGroupAvatarImage({group:a.group});case 7:r.image=e.sent,this.getGroupMap(a),e.next=16;break;case 11:return s=getContactName(a.contact)||t,i=n[t]&&n[t].split("?temp")[0],e.next=15,coreUi.getAvatarImage({owner:t,contactName:s,avatarPath:i});case 15:r.image=e.sent;case 16:this.unReadMessageFlashList.update(["owner"],r),this.updateCurrentTrayImg(r,t);case 18:this.updateGroupTrayImg(t);case 19:case"end":return e.stop()}},e,this)}));return e}()}],[{key:"getInstance",value:function(){return this.instance||(this.instance=new e),this.instance}}]),e}();t.default=_},1012:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.cancelUploadTask=t.finishUploadTask=t.sendUmFileBySequence=void 0;var o=r(1),s=a(o),i=r(139),u=a(i),c=r(149),l=a(c),d=r(135),f=a(d),p=r(2),g=a(p),_=r(190),h=n(_),v=r(599),m=n(v),M=r(171),y=n(M),E=r(182),S=n(E),I=r(217),w=r(304),T=coreLogger.getLogger("logic")("IM/fileSend/taskQueue"),b=[],L=null,O=(t.sendUmFileBySequence=function(){var e=(0,g.default)(s.default.mark(function e(t,r,n){var a,o,i,c,d,p,g,_,v,m,M;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,T.info("sendImgFileBySequence"),a=n.recent,o=a.isLoadMore,t.status=constant.MEDIA_STATUS.SENDING,t.send_status=constant.SEND_STATUS.sending,i=[],c=!0,d=!1,p=void 0,e.prev=10,g=(0,l.default)(r);case 12:if(c=(_=g.next()).done){e.next=32;break}if(v=_.value,v.is_uploaded=constant.IS_UPLOADED.NO,v.file_deal_type=constant.FILE_DEAL_TYPE.UPLOAD,v.file_real_save_name=v.file_name,N(t,v),!v.isVideoImage&&t.media_type!==constant.MEDIA_TYPE.PHOTO){e.next=24;break}return e.next=21,coreDb.saveScreenShot((0,u.default)({},v));case 21:e.t0=e.sent,e.next=27;break;case 24:return e.next=26,coreDb.saveFile((0,u.default)({},v));case 26:e.t0=e.sent;case 27:m=e.t0,i.push(m);case 29:c=!0,e.next=12;break;case 32:e.next=38;break;case 34:e.prev=34,e.t1=e.catch(10),d=!0,p=e.t1;case 38:e.prev=38,e.prev=39,!c&&g.return&&g.return();case 41:if(e.prev=41,!d){e.next=44;break}throw p;case 44:return e.finish(41);case 45:return e.finish(38);case 46:return t.file_list=i,M=(0,f.default)({},t,{send_status:constant.SEND_STATUS.error,status:constant.MEDIA_STATUS.SEND_ERROR}),e.next=50,coreDb.saveMessage(M);case 50:t=e.sent,t.status=constant.MEDIA_STATUS.SENDING,t.send_status=constant.SEND_STATUS.sending,S.setSendingMessage(t.client_chat_id,t),(0,I.updateMessageToRecent)(t),y.isBelongToCurrentRecent(t)&&(o&&h.initLoadMore(),h.addNewMessage(t)),e.next=61;break;case 58:e.prev=58,e.t2=e.catch(0),T.error("sendImgFileBySequence",e.t2&&e.t2.toString());case 61:case"end":return e.stop()}},e,void 0,[[0,58],[10,34,38,46],[39,,41,45]])}));return function(t,r,n){return e.apply(this,arguments)}}(),function(e,t,r){if(!1===e)return(0,w.dealFileSendFailed)(t,r);S.setFileByHandle(t.file_handle,t),h.updateProgressMap(t.file_handle,0),!isNullOrEmpty(r.file_list)&&r.file_list.length>0&&(r.file_list[0].file_handle=t.file_handle),coreIm.updateMessageList(r)}),N=function(e,t){T.info("add upload task");var r={message:e,fileInfo:t};b.push(r),b[0]===r&&x()},R=function(){T.info("delete upload task"),b.shift()},x=function(){var e=(0,g.default)(s.default.mark(function e(){var t,r,n,a,o,i;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==b.length&&!isNullOrEmpty(b[0])){e.next=3;break}return R(),e.abrupt("return");case 3:if(T.info("upload image task queue start executeTask"),C(),t=b[0].message,r=b[0].fileInfo,n={file_name:r.file_name,file_path:r.file_real_save_path},a=$getState().recent.currentRecentInfo,!y.isGroup(a.chat_type)||!S.getUmServerFlag()){e.next=21;break}return n.group_id=a.group.group_id,n.file_type=constant.UPLOAD_FILE_TYPE.GROUP,e.next=14,m.groupFilePreUpload(r,t);case 14:if(""!==(o=e.sent)){e.next=20;break}return O(!1,r,t),R(),x(),e.abrupt("return");case 20:n.operation_token=o;case 21:return e.next=23,coreIm.uploadFile(n);case 23:if(!1!==(i=e.sent)){e.next=29;break}return O(!1,r,t),R(),x(),e.abrupt("return");case 29:b.length>0&&(b[0].fileHandle=i.param.pfile_handle.toString()),r.file_handle=i.param.pfile_handle.toString(),O(i,r,t);case 32:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),A=(t.finishUploadTask=function(){var e=(0,g.default)(s.default.mark(function e(t){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:b.length>0&&!isNullOrEmpty(b[0])&&t.toString()===b[0].fileHandle&&(A(),R(),x());case 1:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.cancelUploadTask=function(){var e=(0,g.default)(s.default.mark(function e(t){var r,n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.file_handle,!isNullOrEmpty(t.file)){e.next=3;break}return e.abrupt("return");case 3:n=t.file.message_server_chat_id_str,a=0;case 5:if(!(a<b.length)){e.next=15;break}if(b[a].fileHandle!==r&&b[a].fileInfo.message_server_chat_id_str!==n){e.next=12;break}if(b[a]={},0!==a){e.next=12;break}return e.next=11,R();case 11:x();case 12:a++,e.next=5;break;case 15:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),function(){L&&(clearTimeout(),L=null)}),C=function(){L&&clearTimeout(L),L=setTimeout(function(){R(),x()},35e3)}},1013:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.reSendFile=void 0;var o=r(1),s=a(o),i=r(139),u=a(i),c=r(149),l=a(c),d=r(2),f=a(d),p=r(182),g=n(p),_=r(171),h=n(_),v=r(228),m=(n(v),r(599)),M=n(m),y=r(304),E=r(217),S=r(190),I=n(S),w=coreLogger.getLogger("logic")("IM/fileReSend");t.reSendFile=function(){var e=(0,f.default)(s.default.mark(function e(t){var r,n,a,o,i,c,d,f,p,_,v,m,S;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,w.info("reSendFile 重新发送文件"),r=$getState(),n=r.recent,a=n.currentRecentInfo,o=[],i=!0,c=!1,d=void 0,e.prev=8,f=(0,l.default)(t.file_list);case 10:if(i=(p=f.next()).done){e.next=47;break}if(_=p.value,v={file_name:_.file_name,file_path:_.file_real_save_path},!h.isGroup(a.chat_type)||!g.getUmServerFlag()){e.next=22;break}return v.group_id=a.group.group_id,v.file_type=constant.UPLOAD_FILE_TYPE.GROUP,e.next=18,M.groupFilePreUpload(_,t);case 18:if(""!==(m=e.sent)){e.next=21;break}return e.abrupt("return",(0,y.dealFileSendFailed)(_,t));case 21:v.operation_token=m;case 22:return _.is_uploaded=constant.IS_UPLOADED.NO,_.file_deal_type=constant.FILE_DEAL_TYPE.UPLOAD,e.next=26,coreIm.uploadFile(v);case 26:if(!1!==(S=e.sent)){e.next=30;break}return(0,y.dealFileSendFailed)(_,t),e.abrupt("return");case 30:if(_.file_real_save_name=_.file_name,_.file_handle=S.param.pfile_handle.toString(),g.setFileByHandle(_.file_handle,_),!_.isVideoImage&&t.media_type!==constant.MEDIA_TYPE.PHOTO){e.next=39;break}return e.next=36,coreDb.saveScreenShot((0,u.default)({},_));case 36:e.t0=e.sent,e.next=42;break;case 39:return e.next=41,coreDb.saveFile((0,u.default)({},_));case 41:e.t0=e.sent;case 42:_=e.t0,o.push(_);case 44:i=!0,e.next=10;break;case 47:e.next=53;break;case 49:e.prev=49,e.t1=e.catch(8),c=!0,d=e.t1;case 53:e.prev=53,e.prev=54,!i&&f.return&&f.return();case 56:if(e.prev=56,!c){e.next=59;break}throw d;case 59:return e.finish(56);case 60:return e.finish(53);case 61:return t.file_list=o,t.status=constant.MEDIA_STATUS.SEND_ERROR,t.send_status=constant.SEND_STATUS.error,e.next=66,coreDb.saveMessage(t);case 66:t=e.sent,t.send_status=constant.SEND_STATUS.resend,t.status=constant.MEDIA_STATUS.SENDING,g.setSendingMessage(t.client_chat_id,t),(0,E.updateMessageToRecent)(t),h.isBelongToCurrentRecent(t)&&(I.updateMessageList(t),I.updateProgressMap(file.file_handle,0)),e.next=77;break;case 74:e.prev=74,e.t2=e.catch(0),w.error("reSendFile",e.t2.toString());case 77:case"end":return e.stop()}},e,void 0,[[0,74],[8,49,53,61],[54,,56,60]])}));return function(t){return e.apply(this,arguments)}}()},1014:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.cancelSendFile=void 0;var a=r(1),o=n(a),s=r(2),i=n(s),u=r(182),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(u),l=r(217),d=coreLogger.getLogger("logic")("IM/fileSend");t.cancelSendFile=function(){var e=(0,i.default)(o.default.mark(function e(t){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,d.info("cancelSendFile 取消发送文件"),r=t.file_list[0],t.status=constant.MEDIA_STATUS.CANCEL_SEND,t.send_status=constant.SEND_STATUS.error,r.file_deal_type!==constant.FILE_DEAL_TYPE.UPLOAD){e.next=8;break}return e.next=8,coreIm.releaseFile({file_handle:parseInt(r.file_handle),file:r});case 8:return $dispatch(coreUi.deleteProgressMap(r.file_handle)),c.deleteSendingMessage(r.message_server_chat_id_str),c.deleteFileByHandleList([r.file_handle,t.client_chat_id]),delete r.file_handle,e.next=14,coreDb.saveFile(r);case 14:r=e.sent,t.file_list[0]=r,(0,l.updateMessageToRecent)(t),$dispatch(coreUi.updateMessageList(t)),coreDb.saveMessage(t),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(0),d.error("cancelSendFile",e.t0.toString());case 24:case"end":return e.stop()}},e,void 0,[[0,21]])}));return function(t){return e.apply(this,arguments)}}()},1015:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.openFolder=t.openFile=void 0;var a=r(1),o=n(a),s=r(2),i=n(s),u=r(645),c=coreLogger.getLogger("logic")("IM/fileOpen");t.openFile=function(){var e=(0,i.default)(o.default.mark(function e(t,r){var n,a,s,i,l,d,f,p,g;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,c.info("userClick openFile  open file"),n=r?t.quote:t,a=n.file_list,s=n.server_chat_id_str,i=a[0],l=i.file_real_save_path,d=i.is_downloaded,e.next=6,appService.isFileExist(l);case 6:if(f=e.sent){e.next=12;break}p={rightButton:language.DOWNLOAD},window.confirm(language.FILE_NOT_FOUND_RE_DOWNLOAD,p).then(function(e){e.ret&&($dispatch(coreUi.updateOpenFileMessageMap(s,l)),(0,u.receiveFile)(t,r))}),e.next=16;break;case 12:return e.next=14,appService.openFileOrFolder(l);case 14:g=e.sent,coreCommon.isAndroid()&&!g&&window.Toast(language.PLEASE_INSTALL_SOFTWARE);case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),c.error("openFile",e.t0.toString());case 21:case"end":return e.stop()}},e,void 0,[[0,18]])}));return function(t,r){return e.apply(this,arguments)}}(),t.openFolder=function(){var e=(0,i.default)(o.default.mark(function e(t,r){var n,a,s,i,l,d;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,c.info("userCLick openFolder  open file dir"),n=r?t.quote:t,a=n.file_list,s=n.server_chat_id_str,i=a[0].file_real_save_path,e.next=6,appService.isFileExist(i);case 6:l=e.sent,l?appService.openFolder(i):(d={rightButton:language.DOWNLOAD},window.confirm(language.FILE_NOT_FOUND_RE_DOWNLOAD,d).then(function(e){e.ret&&($dispatch(coreUi.updateOpenFolderMessageMap(s,i)),(0,u.receiveFile)(t,r))})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),c.error("openFolder",e.t0.toString());case 13:case"end":return e.stop()}},e,void 0,[[0,10]])}));return function(t,r){return e.apply(this,arguments)}}()},1016:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.chooseUploadFile=void 0;var n=r(3),a=function(e){return e&&e.__esModule?e:{default:e}}(n),o=r(987),s=r(171),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(s),u=coreLogger.getLogger("logic")("IM/file/upload");t.chooseUploadFile=function(){u.info("uploadFile 选择附件上传");var e={},t=$getState();e.properties=["openFile","multiSelections"];try{$dispatch(coreUi.setShowOpenDialog(!0)),window.electron.remote.dialog.showOpenDialog(win,e,function(e){if($dispatch(coreUi.setShowOpenDialog(!1)),coreUi.clickToolbar("",!1),!isNullOrEmpty(e)){for(var r=[],n=0;n<e.length;n++)!function(t){var n=e[t],o=PromiseObject(),s=void 0,u=void 0;appService.getFileInfo(n).then(function(e){return u=e.size,coreCommon.getMediaType(n)===constant.MEDIA_TYPE.PHOTO?i.getImageInfo(n):a.default.resolve(!1)}).then(function(e){s={path:n,name:getFileName(n),size:u,type:"file"},!1!==e&&(s.type="image",s.width=e.width,s.height=e.height),o.resolve(s)}),r.push(o)}(n);a.default.all(r).then(function(e){return(0,o.sendFiles)(e,t)})}})}catch(e){u.error("uploadFile",e.toString())}}},1017:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.saveTeamSpace=void 0;var a=r(1),o=n(a),s=r(139),i=n(s),u=r(2),c=n(u),l=r(190),d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(l),f=coreLogger.getLogger("logic")("file/saveFileToSpace");t.saveTeamSpace=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n,a,s,u,c,l,p,g,_,h,v,m,M,y,E,S;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(f.info("saveTeamSpace"),n=t.recent_owner,a=t.file_id,s=t.um_plain_access_code,u=t.um_url,c=t.owner_id,l=$getState().recent.recentList.query({owner:n}),p=l.group,g=p.group_space_id,_=void 0,h=u.split("f/")[1],v=s,a&&c){e.next=27;break}return v=s,e.next=12,coreIm.queryShareLinkInfo({linkCode:h,accessCode:v});case 12:if(m=e.sent){e.next=17;break}return _=language.SAVE_TO_TEAM_SPACE_FAIL,window.Toast(_),e.abrupt("return",!1);case 17:M=m.param.file,y=r.media_type,a=M.id,c=String(M.ownedBy),t.file_id=a,t.owner_id=c,r.file_list[0]=(0,i.default)({},t),coreDb.saveMessage(r),d.updateMessageList(r),y===constant.MEDIA_TYPE.PHOTO_TEXT||y===constant.MEDIA_TYPE.PHOTO||coreIm.isShareImage(r.card_type)?coreDb.saveScreenShot((0,i.default)({},t)):coreDb.saveFile((0,i.default)({},t));case 27:if(g){e.next=39;break}return e.next=30,coreGroup.createTeamSpace(p);case 30:if(E=e.sent,isNullOrEmpty(E)){e.next=36;break}l.group=E,g=E.group_space_id,e.next=39;break;case 36:return _=language.SAVE_TO_TEAM_SPACE_FAIL,window.Toast(_),e.abrupt("return",!1);case 39:return e.next=41,coreIm.umCopyFile({group_space_id:g,file_id:a,from_group:0,owner_id:c,link_code:h,plain_access_code:v});case 41:S=e.sent,_=S?language.SAVE_TO_TEAM_SPACE_SUCCESS:language.SAVE_TO_TEAM_SPACE_FAIL,window.Toast(_);case 44:case"end":return e.stop()}},e,void 0)}));return function(t,r){return e.apply(this,arguments)}}()},1018:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.tipLiten=void 0;var n=r(1920),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(n);t.tipLiten=a.tipLiten},1019:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.dealCopy=t.getCurrentStatus=t.setTipPosition=void 0;var a=r(1921),o=n(a),s=r(1020),i=n(s);t.setTipPosition=i.setTipPosition,t.getCurrentStatus=i.getCurrentStatus,t.dealCopy=o.dealCopy},1020:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getCurrentStatus=t.setTipPosition=void 0;var n=r(636),a=r(171);(function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);t.default=e})(a),coreLogger.getLogger("LOGIC")("mobile/uiController"),t.setTipPosition=function(e){var t=e.showTips,r=e.obj,n=e.message,a=e.havCopy,o=void 0===a||a,s=e.havWithdraw,i=void 0===s||s;$dispatch(coreUi.setTipPosition({showTips:t,obj:r,message:n,havCopy:o,havWithdraw:i}))},t.getCurrentStatus=function(e){var t=e&&e.status,r=e&&e.desc,a=e&&e.client_type,o=void 0;return r?(r=(0,n.correctStatusDesc)(t,r),t===constant.ONLINE_STATUS.BUSY?o=language.BUSY+" - "+r:t===constant.ONLINE_STATUS.LEAVE&&(o=language.AWAY+" - "+r)):o=t===constant.ONLINE_STATUS.OFFLINE?language.OFFLINE:t===constant.ONLINE_STATUS.ONLINE?a===constant.CLIENT_TYPE.MOBILE||a===constant.CLIENT_TYPE.PAD?language.MOBILE_ONLINE:language.ONLINE:t===constant.ONLINE_STATUS.BUSY?language.BUSY:t===constant.ONLINE_STATUS.LEAVE?language.AWAY:"",o?"("+o+")":o}},1021:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.randomLikeImg=t.sendLike=t.sendMobileLike=void 0;var n=r(1022),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(n);t.sendMobileLike=a.sendMobileLike,t.sendLike=a.sendLike,t.randomLikeImg=a.randomLikeImg},1022:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.randomLikeImg=t.sendLike=t.sendMobileLike=void 0;var a=r(139),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=r(190),i=(n(s),r(302)),u=n(i),c=r(228),l=n(c),d=coreLogger.getLogger("logic")("IM/sendLike"),f=(t.sendMobileLike=function(e,t){try{d.info("userClick  sendMobileLike");var r={text:t+"_"+e,mediaType:constant.MEDIA_TYPE.LIKE};return u.createMobileLikeMessage(r).then(function(e){return l.sendImMessage((0,o.default)({},e))})}catch(e){d.error("sendLike",e.toString())}},t.sendLike=function(){try{if(d.info("sendLike"),!coreIm.checkEserverOnline("sendLike"))return;var e=f(),t={text:e+"_large",mediaType:constant.MEDIA_TYPE.LIKE,html:""};return u.createLikeMessage(t).then(function(e){return l.sendImMessage((0,o.default)({},e))})}catch(e){d.error("sendLike",e.toString())}},t.randomLikeImg=function(){return"like-"+Math.ceil(3*Math.random())+".svg"})},1023:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.correctStatusDesc=function(e,t){return e===constant.ONLINE_STATUS.BUSY&&"Calling"===t?t=language.STATUS_IN_CALLING:e===constant.ONLINE_STATUS.BUSY&&"In meeting"===t&&(t=language.STATUS_IN_CONFERENCE),t}},1024:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e){if(coreIm.checkEServerOnlineNoToast("onImgSuccessLoad")){var t=e.data,r=t.message,n=t.img;y.debug("onImgSuccessLoad 图片加载成功");var a=n.getAttribute("data-img-id");if(n.src.hasOneOf([constant.AppConfig.IM.myLoadingImgSrc.replaceAll("../",""),constant.AppConfig.IM.otherLoadingImgSrc.replaceAll("../",""),constant.MobileAppConfig.IM.iosLoadingImgSrc.replaceAll("./",""),constant.MobileAppConfig.IM.androidLoadingImgSrc.replaceAll("../",""),constant.AppConfig.IM.cardLinkSrc.replaceAll("../","")])){y.debug("onImgSuccessLoad 默认图加载完成");var o=r.file_list,i=o.query({file_real_save_name:a});isNullOrEmpty(i)?y.error("onImgSuccessLoad 图片信息不存在"):(y.debug("onImgSuccessLoad 加载默认图成功，没有下载原图，执行加载失败逻辑"),s(e,!1))}else y.debug("onImgSuccessLoad 移除事件listener")}}function s(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];y.info("on img error load");var r=e.data,n=r.message,a=(r.isMine,r.img);if(n=$getState().recent.messageList.query({server_chat_id_str:n.server_chat_id_str})){var o=n,s=o.file_list,u=void 0===s?[]:s,c=a.getAttribute("data-img-id"),l=u.query({file_real_save_name:c});if(g(n,l),t)if(a.src.hasOneOf([constant.AppConfig.IM.myLoadingImgSrc.replaceAll("../",""),constant.AppConfig.IM.otherLoadingImgSrc.replaceAll("../",""),constant.MobileAppConfig.IM.iosLoadingImgSrc.replaceAll("./",""),constant.MobileAppConfig.IM.androidLoadingImgSrc.replaceAll("../",""),constant.AppConfig.IM.cardLinkSrc.replaceAll("../","")]))y.debug("onImgErrorLoad 默认图加载失败,不处理");else{if(-1!==a.className.indexOf("card-flag"))return void(a.src=constant.AppConfig.IM.cardLinkSrc);if(window.CLIENTCONFIG.ISMOBILE){if(l&&!isNullOrEmpty(l.width)&&0!==l.width||l&&!isNullOrEmpty(l.height)&&0!==l.height){var d=Math.max(l.width,l.height),f=d<=constant.MOBILE_IMG_MAX_WIDTH_HEIGHT?l.width:l.width/d*constant.MOBILE_IMG_MAX_WIDTH_HEIGHT,p=d<=constant.MOBILE_IMG_MAX_WIDTH_HEIGHT?l.height:l.height/d*constant.MOBILE_IMG_MAX_WIDTH_HEIGHT;f>p&&f/p>=constant.MOBILE_IMG_MAX_WIDTH_HEIGHT_SCALE?(p=f/constant.MOBILE_IMG_MAX_WIDTH_HEIGHT_SCALE,f="auto"):p>f&&p/f>=constant.MOBILE_IMG_MAX_WIDTH_HEIGHT_SCALE&&(f=p/constant.MOBILE_IMG_MAX_WIDTH_HEIGHT_SCALE,p="auto"),a.style.width=f+"px",a.style.height=p+"px"}else a.className="default";a.style.backgroundColor="#ECEEF2","ios"===window.CLIENTCONFIG.PLATFORM?(a.src=constant.MobileAppConfig.IM.iosTransparentImgSrc,a.style.backgroundImage="url('"+constant.MobileAppConfig.IM.iosLoadingImgSrc+"')"):(a.src=constant.MobileAppConfig.IM.androidTransparentImgSrc,a.style.backgroundImage="url('"+constant.MobileAppConfig.IM.androidLoadingImgSrc+"')"),a.style.backgroundRepeat="no-repeat",a.style.borderRadius="0.04rem",a.style.backgroundPosition="center center",a.style.backgroundSize="0.56rem 0.56rem"}else{if(l&&!isNullOrEmpty(l.width)&&0!==l.width||l&&!isNullOrEmpty(l.height)&&0!==l.height){var _=i(l.width,l.height),h=_.width,v=_.height;a.style.width=h+"px",a.style.height=v+"px"}else a.className="default";a.src=constant.AppConfig.IM.transparentImgSrc,a.style.backgroundColor="#ECEEF2",a.style.backgroundImage="url('"+constant.AppConfig.IM.myLoadingImgSrc+"')",a.style.backgroundRepeat="no-repeat",a.style.backgroundPosition="center center",a.style.backgroundSize="24px,18px"}}else y.debug("onImgErrorLoad 加载默认图成功触发，不进行后续判断")}}function i(e,t){try{var r=document.querySelector(".recent-page").getBoundingClientRect().width,n=r-40-($getState().recent.showRecentInfo?348:182)-34-48,a=document.querySelector(".message-list-area").getBoundingClientRect().height-20,o={width:120,height:80};if(!!(isNullOrEmpty(e)||isNullOrEmpty(t)||0===e||0===t||isNullOrEmpty(n)||isNullOrEmpty(a)))return o;var s=Math.max(e,t),i=s<=constant.PC_IMG_THUMBNAIL_SIZE?e:e/s*constant.PC_IMG_THUMBNAIL_SIZE,u=s<=constant.PC_IMG_THUMBNAIL_SIZE?t:t/s*constant.PC_IMG_THUMBNAIL_SIZE;return i<=n&&u<=a?(o.width=i,o.height=u):u/a>i/n?(o.height=a,o.width=i*(a/u)):(o.width=n,o.height=u*(n/i)),o}catch(e){y.error("calcImgSize",e)}}function u(e){var t=e.data.screenShot;y.debug("onPhotoDownloadSuccess 图片下载成功"),document.querySelectorAll('[data-img-id ="'+t.file_real_save_name+'"]').forEach(function(e){var r=(0,M.isShowOriginImg)(t)?t.file_path:t.file_real_save_path;"ios"===window.CLIENTCONFIG.PLATFORM?e.src="/local-filesystem"+r:e.src=r,-1===e.className.indexOf("card-flag")&&(e.style.backgroundColor="",e.style.backgroundImage="",e.style.backgroundRepeat="",e.style.backgroundPosition="",e.style.backgroundSize="")}),(0,m.downloadPhotoSuccess)(t)}function c(e){var t=e.data.screenShot;y.debug("onPhotoDownloadError 图片下载失败"),(0,m.downloadPhotoError)(t)}Object.defineProperty(t,"__esModule",{value:!0});var l=r(1),d=a(l),f=r(2),p=a(f),g=function(){var e=(0,p.default)(d.default.mark(function e(t,r){var n,a,o;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,coreAccount.getLoginModel();case 2:if(n=e.sent,a=n.umHttpServerUri,!1!==(o=coreIm.getOfflineFileConfig())||!isNullOrEmpty(a)){e.next=9;break}return y.error("dealDownloadPhoto offlineFile address is empty"),sleep(500).then(function(){return g(t,r)}),e.abrupt("return");case 9:r&&!isNullOrEmpty(r.file_real_save_path)&&appService.isFileExist(r.file_real_save_path).then(function(e){e||!(0,M.isShowOriginImg)(r)&&(0,m.downloadPhoto)(r,t,!0)}),appService.isFileExist(r.file_path).then(function(e){e||window.CLIENTCONFIG.ISMOBILE&&!(0,M.isShowOriginImg)(r)||(0,m.downloadPhoto)(r,t,!1)});case 11:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}();t.calcImgSize=i;var _=r(182),h=(n(_),r(832)),v=(n(h),r(337)),m=(n(v),r(643)),M=r(171),y=coreLogger.getLogger("logic")("IM/listenEvent");y.debug("listenEvent"),window.removeEventListener("imgSuccessLoad",o),window.removeEventListener("imgErrorLoad",s),window.removeEventListener("photoDownloadSuccess",u),window.removeEventListener("photoDownloadError",c),window.addEventListener("imgSuccessLoad",o),window.addEventListener("imgErrorLoad",s),window.addEventListener("photoDownloadSuccess",u),window.addEventListener("photoDownloadError",c),delegate(function(e){if(coreIm.checkEServerOnlineNoToast("onImageError")){y.debug("onImageError 图文混排中图片加载失败");var t=e.getAttribute("data-query-id");e.setAttribute("data-img-id",getFileName(e.src)),coreDb.queryMessage({server_chat_id_str:t}).then(function(t){var r=t.origin===$getState().myInfo.account,n=new Event("imgErrorLoad");n.data={message:t,isMine:r,img:e},window.dispatchEvent(n)})}},"onImageError")},1025:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=coreLogger.getLogger("logic")("Um/serviceCheck"),a=(t.checkOfflineFileRequest=function(e){try{return n.info("checkOfflineFileRequest"),!1===e?e:a(e.result)===constant.OffLineErrorCode.OK?(n.debug("checkOfflineFileRequest normal results"),e):(a(e.result)===constant.OffLineErrorCode.NOT_LOGIN&&window.dispatchEvent(new Event("umServerNotLogin")),a(e.param.code)===constant.OffLineErrorCode.DISK_FULL&&window.ToastNew(language.RICH_MEDIA_SPACE_FULL,2),n.error("checkOfflineFileRequest result is not normal",e.result,constant.OfflineFileErrorLogInfo[a(e.param.code)]),!1)}catch(e){return n.error("checkOfflineFileRequest result is not normal",e.toString()),!1}},t.checkOffLineRspNotify=function(e){try{return n.info("checkOffLineRspNotify"),a(e.param.code)===constant.OffLineErrorCode.OK?200===e.param.filersp.status_code||(n.error("checkOffLineRspNotify result is not normal",e.param.filersp.status_code,e.param.filersp.code_msg),!1):(a(e.result)===constant.OffLineErrorCode.NOT_LOGIN&&window.dispatchEvent(new Event("umServerNotLogin")),a(e.param.code)===constant.OffLineErrorCode.DISK_FULL&&window.ToastNew(language.RICH_MEDIA_SPACE_FULL,2),n.error("checkOffLineRspNotify result is not normal",e.param.code,constant.OfflineFileErrorLogInfo[a(e.param.code)]),!1)}catch(e){return n.error("checkOffLineRspNotify result is not normal",e.toString()),!1}},function(e){return e>constant.OFFLINE_FILE_ERR_START?e-constant.OFFLINE_FILE_ERR_START:e})},1026:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(182),a=new n.queueDealFuncClass;t.default={addAvatarDownloadFunc:function(e){a.addQueueFunc(e),a.runQueueFunc()}}},1027:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(182),a=new n.queueDealFuncClass;t.default={addAvatarDownloadAckFunc:function(e){a.addQueueFunc(e),a.runQueueFunc()}}},1028:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){var e=Noop,t=function(){};return t.prototype.setModalFocusFunc=function(t){e=t},t.prototype.getModalFocusFunc=function(){return e},t.prototype.clearModalFocusFunc=function(){e=Noop},new t}()},1029:function(e,t,r){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.eserverLogin=t.loginToeServer=void 0;var a=r(158),o=n(a),s=r(1),i=n(s),u=r(2),c=n(u),l=(t.loginToeServer=function(){var e=(0,c.default)(i.default.mark(function e(){var t;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=getClientId(),(0,p.setEServerOffline)(t+" pre loginToeServer "),(0,g.printEServerLog)(t,"login","0 loginToeServer start"),e.abrupt("return",coreAccount.makeLoginCancelable({promise:v({descrition:"login",id:t}),name:"loginToeServer",loginPromiseKey:constant.LOGIN_PROMISE_KEY.eserver_login}).then(function(e){coreAccount.makeLoginCancelable({promise:l(e,t),name:"afterLogin",loginPromiseKey:constant.LOGIN_PROMISE_KEY.eserver_login})}).catch(function(e){(0,g.printEServerLog)(t,"login","loginToeServer error"),_.error("loginToeServer error",e)}));case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),function(){var e=(0,c.default)(i.default.mark(function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(_.debug("loginToeServer eserverLogin Ret",t),!t){e.next=11;break}if((0,g.printEServerLog)(r,"afterLogin","loginToeServer result="+t.result),!t.result){e.next=10;break}return h.info("ecs login success"),e.next=7,(0,f.afterEServerLoginSuccess)(t.param);case 7:coreCommon.dispatchModuleEvent("login",{event:"eserver",code:0}),e.next=11;break;case 10:coreCommon.dispatchModuleEvent("login",{event:"eserver",code:t});case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),d=r(1925),f=r(1030),p=r(360),g=r(833),_=coreLogger.getLogger("im")("login"),h=coreLogger.getDataLogger("im")("login"),v=t.eserverLogin=function(){var t=(0,c.default)(i.default.mark(function t(r){var n,a,o,s,u,c,l,_,h,v,M,y,E,S,I,w,T=r.descrition,b=void 0===T?"":T,L=r.id,O=void 0===L?0:L,N=r.resume,R=void 0!==N&&N;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=R?g.printEServerResumeLog:g.printEServerLog,t.next=3,coreAccount.getLoginModel();case 3:if(a=t.sent,!a.isInEserverLogin){t.next=7;break}return n(O,b,"1 now is in login process,not do again"),t.abrupt("return",!1);case 7:if(a.isBuildStgSuc||a.socketMode!==constant.IM_STG_MODE.USE_STG){t.next=10;break}return n(O,b,"1 socketMode is USE_STG,but isBuildStgSuc is false"),t.abrupt("return",!1);case 10:return n(O,b,"1 start"),(0,p.setEServerOffline)(O+" "+b+" 2 eserverLogin pre login"),a.isInEserverLogin=!0,t.next=15,(0,d.preLogin)(O,b,R);case 15:if(o=t.sent){t.next=19;break}return n(O,b,"4 preLogin deal failed,stop login"),t.abrupt("return",(0,f.afterEServerLoginFailed)(constant.ESERVER_LOGIN_ERROR.IM_E_PRE_LOGIN_ERROR));case 19:return n(O,b,"4 prepare login param"),t.next=22,coreAccount.getLoginModel();case 22:return s=t.sent,u=s.account,c=s.isResume,l=s.authToken,_=s.real_user_account,h=s.isSupportAS,v=s.sipUri,M="",isNullOrEmpty(v)||(y=v.split(";"),!isNullOrEmpty(y)&&y.length>0&&(M=y[0].split(":")[0])),E={account:h?_:u,password:"",version:"3.1.0.200",auth_type:4,language:"zh-cn",client_desc:window.CLIENTCONFIG.ISMOBILE?constant.CLIENT_DESC.MOBILE:constant.CLIENT_DESC.PC,client_type:window.CLIENTCONFIG.ISMOBILE?constant.CLIENT_TYPE.MOBILE:constant.CLIENT_TYPE.PC,ticket:"",token:new e(l,"base64").toString(),access_address:M,support_batch_notifygroup:!0},a.isSupportAS&&(E.app_id="WeLink"===window.CLIENTCONFIG.NEW_APP_NAME?"1":"2"),window.CLIENTCONFIG.ISMOBILE&&window.device&&window.device.uuid&&(E.device_id=window.device.uuid),t.next=36,coreTup.getIMInstance();case 36:return S=t.sent,n(O,b,"5 ready to login"),t.next=40,S.login(E);case 40:if(I=t.sent){t.next=52;break}return n(O,b,"6 login timeout,do switchToNexteServer"),t.next=45,coreAccount.getLoginModel();case 45:return w=t.sent,w.isInEserverLogin=!1,t.next=49,m({errorCode:constant.ESERVER_LOGIN_ERROR.IM_E_LOGING_RESULT_TIMEOUT,isResume:c,descrition:b,id:O,resume:R});case 49:return t.abrupt("return",t.sent);case 52:if(I.result!==constant.ESERVER_LOGIN_ERROR.IM_E_LOGING_RESULT_SUCCESS&&I.result!==constant.ESERVER_LOGIN_ERROR.IM_E_LOGING_RESULT_ALREADY_LOGIN){t.next=61;break}return n(O,b,"6 login success"),window.isEserverOnline=!0,coreUt.utEventFinish({eventId:constant.EVENT_ID.UT_LOGIN,extraTrackKey:constant.UT_LOGIN_SERVER_NAME.UT_ESERVER_SERVER,resultParams:[1,a.isResume?1:0],isTrackTimeCosts:!0}),coreCommon.isHuaweiCloudWeLink()&&coreUt.utEventStart({eventId:constant.WELINK_EVENT_ID.UT_ONLINE,extraTrackKey:null,params:[]}),a.isInEserverLogin=!1,t.abrupt("return",{result:!0,param:I});case 61:if(!I.param){t.next=72;break}if(n(O,b,"6 login errorCode is "+I.param.reason),107!==I.param.reason&&28!==I.param.reason){t.next=69;break}return n(O,b,"6 do switchToNexteServer"),a.isInEserverLogin=!1,t.next=68,m({errorCode:I.param.reason,isResume:c,descrition:b,id:O,resume:R});case 68:return t.abrupt("return",t.sent);case 69:return t.abrupt("return",(0,f.afterEServerLoginFailed)(I.param.reason));case 72:return n(O,b,"6 login error result is "+I.result),t.abrupt("return",(0,f.afterEServerLoginFailed)(constant.ESERVER_LOGIN_ERROR.IM_E_LOGING_RESULT_TIMEOUT));case 74:case"end":return t.stop()}},t,void 0)}));return function(e){return t.apply(this,arguments)}}(),m=function(){var e=(0,c.default)(i.default.mark(function e(t){var r,n,a,s,u,c,l,d,p,_,h,M,y,E,S,I=t.errorCode,w=t.isResume,T=t.descrition,b=t.id,L=t.resume;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=L?g.printEServerResumeLog:g.printEServerLog,r(b,T,"7 start switchToNexteServer"),e.next=4,coreAccount.getLoginModel();case 4:if(n=e.sent,a=n.eserverStgUri,s=n.maaProxyUrlAll,u=n.socketMode,c=n.eServerAddressAll,l=n.currentNum,d=n.mainSiteSum,p=void 0,p=u===constant.IM_STG_MODE.USE_STG?a.split(";"):u===constant.IM_STG_MODE.USE_TLS?s.split(";"):c.split(";"),r(b,T,"8 eserverUriList.length is "+p.lengt+" currentNum is "+l+",mainSiteSum is "+d),(107===I||28===I)&&l<d?l=d:l+=1,!(l<p.length&&l>0)){e.next=28;break}if(n.currentNum=l,_=p[l],!isNullOrEmpty(_)){e.next=20;break}return r(b,T,"9 eserverUri is Null Or Empty, continue to next"),e.next=17,m({errorCode:I,isResume:w,descrition:T,id:b,resume:L});case 17:return e.abrupt("return",e.sent);case 20:return h=_.split(":"),M=(0,o.default)(h,2),y=M[0],E=M[1],S=parseInt(E),n.eServerAddress=y,n.eServerPort=S,r(b,T,"9 has eserverUri,do login again"),e.abrupt("return",v({descrition:T,id:b,resume:L}));case 26:e.next=30;break;case 28:return r(b,T,"9 switchToNexteServer fail, errorCode is "+I),e.abrupt("return",(0,f.afterEServerLoginFailed)(I));case 30:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}()}).call(t,r(144).Buffer)},1030:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.afterEServerLoginFailed=t.afterEServerLoginSuccess=void 0;var a=r(1),o=n(a),s=r(2),i=n(s),u=r(1926),c=r(182),l=r(360),d=r(642),f=r(1032),p=coreLogger.getLogger("im")("login"),g=coreLogger.getDataLogger("im")("login"),_=(t.afterEServerLoginSuccess=function(){var e=(0,i.default)(o.default.mark(function e(t){var r,n,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return p.info("afterEServerLoginSuccess"),(0,f.startHeartBeatDeal)("afterEServerLoginSuccess"),e.next=4,_(t);case 4:return e.next=6,coreAccount.getLoginModel();case 6:return r=e.sent,coreUt.utHandleMobileSystemBroken(),n=r.desc,a=(0,c.getUserLoginStatus)(),a?window.dispatchEvent(new Event("eServerLoginSuccess")):coreAccount.pushStatusToEServer({status:constant.ONLINE_STATUS.ONLINE,desc:n||""}),(0,u.registerEvent)(),e.next=14,v();case 14:return coreAccount.makeLoginCancelable({promise:coreIm.umserverLogin(),name:"umserverLogin",loginPromiseKey:constant.LOGIN_PROMISE_KEY.umserver_login}),coreContact.normalLoadContactAndGroupList().then(d.dealServerRecentList).catch(function(e){p.error("afterEServerLoginSuccess normalLoadContactAndGroupList error",e),(0,d.dealServerRecentList)()}),window.CLIENTCONFIG.ISMOBILE&&(coreIm.getMuteForMobile(),p.info("eserver login success getMuteForMobile")),e.abrupt("return",{result:!0});case 18:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.afterEServerLoginFailed=function(){var e=(0,i.default)(o.default.mark(function e(t){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return p.info("afterEServerLoginFailed"),g.info("ecs login failed"),(0,l.setEServerOffline)("afterEServerLoginFailed"),e.next=5,coreAccount.getLoginModel();case 5:return r=e.sent,coreUt.utEventFinish({eventId:constant.EVENT_ID.UT_LOGIN,extraTrackKey:constant.UT_LOGIN_SERVER_NAME.UT_ESERVER_SERVER,resultParams:[0,t,r.isResume?1:0]}),r.isInEserverLogin=!1,e.abrupt("return",h({errorCode:t,isResume:r.isResume}));case 9:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),function(){var e=(0,i.default)(o.default.mark(function e(t){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.param){e.next=10;break}if(!window.CLIENTCONFIG.ISMOBILE){e.next=10;break}if(!(t.param.terminal_login_info&&t.param.terminal_login_info.length>0)){e.next=8;break}if(!((r=t.param.terminal_login_info.findIndex(function(e){return 0===e.client_type}))>=0)){e.next=8;break}return e.next=7,coreAccount.refreshIsMultiDeviceLogined({bMultiDeviceLogined:!0});case 7:return e.abrupt("return");case 8:return e.next=10,coreAccount.refreshIsMultiDeviceLogined({bMultiDeviceLogined:!1});case 10:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}()),h=function(e){var t=e.isResume,r=e.errorCode;return function(e){p.error((t?"dealEServerLoginErrorInfo Resume":"dealEServerLoginErrorInfo")+": ["+e+"]")}(constant.ESERVER_LOGIN_ERRORCODE_LOG_INFO[r]||" Unhandle errorCode:"+r+" "),{errorCode:r,errorMessage:language[constant.ESERVER_LOGIN_ERRORCODE_INFO[r]]||language.CALL_CALLING_FAILED,isResume:t}},v=function(){var e=(0,i.default)(o.default.mark(function e(){var t,r,n,a,s,i;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return p.info("getServiceProfile"),e.next=3,coreAccount.getLoginModel();case 3:if(t=e.sent,window.localIp){e.next=6;break}return e.abrupt("return",!1);case 6:return e.next=8,coreTup.getIMInstance();case 8:return r=e.sent,e.next=11,r.getserviceprofile({is_sync_all:1,need_icon:0,is_vpn_access:0,time_stamp:"19000000000000",local_ip:window.localIp});case 11:return n=e.sent,a=n.param,s={sipOutgoingAccCode:a.sip_outgoing_acc_code,umHttpServerUri:a.um_server_http_list||[],umHttpsServerUri:a.um_server_https_list||[]},t.set(s),e.next=17,coreSecurity.getPasswordManager();case 17:if(i=e.sent,e.t0=a.sip_password,!e.t0){e.next=22;break}return e.next=22,i.setPassword("sipPassword",a.sip_password);case 22:return e.abrupt("return",!0);case 23:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}}()},1031:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.getStatusUpdateTaskQueue=t.initStatusUpdateTaskQueue=void 0;var a=r(1),o=n(a),s=r(2),i=n(s),u=coreLogger.getLogger("contact/status")("updateStatus"),c=function(){var e=(0,i.default)(o.default.mark(function e(t){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:u.debug("updateStatus now will update statusObjList.length",t),r={},t.forEach(function(e){r[e.origin]={status:e.status,desc:e.desc,client_type:e.client_type}}),$dispatch(coreUi.updateContactStatusMap(r));case 4:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),l=new coreCommon.BatchDealSelfExecutionTasksQueue({describe:"statusUpdateTaskQueue",taskFunc:c,getCurrentDataIndex:function(e,t){return t.findIndex(function(t){return t.origin===e.origin})},isCoverSameData:!0,maxBatchNumber:1e3,delay:200});t.initStatusUpdateTaskQueue=function(){l=new coreCommon.BatchDealSelfExecutionTasksQueue({describe:"statusUpdateTaskQueue",taskFunc:c,getCurrentDataIndex:function(e,t){return t.findIndex(function(t){return t.origin===e.origin})},isCoverSameData:!0,maxBatchNumber:1e3,delay:200})},t.getStatusUpdateTaskQueue=function(){return l}},1032:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=coreLogger.getLogger("IM")("dealHeartBeat"),a=new coreCommon.Timer({name:"willResumeEServerTimer",describe:"dealHeartBeat"}),o=null,s=(t.startHeartBeatDeal=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";n.info("dealHeartBeat "+e),o&&o.cancel(),o=new coreCommon.TimerTask({task:s,name:"eServerIsNotConnect"}),a.purge().schedule(o,95e3)},function(){n.info("checkEServerIsConnect"),a.cancel(),window.dispatchEvent(new Event("heartBeatMiss"))})},1033:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.createOrUpdateRecent=void 0;var a=r(1),o=n(a),s=r(139),i=n(s),u=r(2),c=n(u),l=r(338),d=r(640),f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(d),p=r(830),g=r(358),_=coreLogger.getLogger("im")("recent/recentOpen");t.createOrUpdateRecent=function(){var e=(0,c.default)(o.default.mark(function e(){var t,r,n,a,s,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{contact:null,group:null},c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,d=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],h=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,_.info("createOrUpdateRecent",d,h),t=$getState().recent.recentList,r=void 0,n=u.contact,a=u.group,!isNullOrEmpty(a)){e.next=18;break}if(!isNullOrEmpty(n)){e.next=10;break}return e.abrupt("return",{});case 10:return coreDb.saveContact((0,i.default)({},n)),e.next=13,coreIm.getLocalRecent({owner:n.account});case 13:r=e.sent,isNullOrEmpty(r)&&(r={chat_type:constant.CHAT_TYPE.SINGLE_CHAT,owner:n.account,account:n.account,time_stamp:l.localTimeService.getLocalTime(),contact:n,stick_on_top:0,is_delete:constant.IS_DELETE.NO}),(0,p.subscribeRecentList)([r]);case 16:e.next=22;break;case 18:return e.next=20,coreIm.getLocalRecent({owner:a.group_id});case 20:r=e.sent,isNullOrEmpty(r)&&(r={chat_type:f.getChatTypeByGroup(a),owner:a.group_id,group_id:a.group_id,time_stamp:l.localTimeService.getLocalTime(),stick_on_top:0,is_delete:constant.IS_DELETE.NO,group:a,unread_group_notify_num:0});case 22:if(r.is_delete=constant.IS_DELETE.NO,d&&((0,g.deleteUnReadNumMap)(r.owner),r.unread_num=0),isNullOrEmpty(r.last_message)?(r.last_message={},r.time_stamp=l.localTimeService.getLocalTime()):h&&(_.info("force to update timestamp by out"),r.time_stamp=l.localTimeService.getLocalTime()),isNullOrEmpty(c)||(r.id=c),""!==r.owner){e.next=28;break}return e.abrupt("return");case 28:return e.next=30,coreDb.saveRecent(r);case 30:return r=e.sent,s=t.find(function(e){return e.owner===r.owner}),s&&(r.last_message=s.last_message),e.abrupt("return",r);case 36:return e.prev=36,e.t0=e.catch(0),_.error("createOrUpdateRecent",d,h,e.t0.toString()),e.abrupt("return",{});case 40:case"end":return e.stop()}},e,void 0,[[0,36]])}));return function(){return e.apply(this,arguments)}}()},131:function(e,t,r){e.exports={default:r(151),__esModule:!0}},132:function(e,t,r){e.exports=r(0)(45)},133:function(e,t,r){e.exports=r(0)(47)},135:function(e,t,r){e.exports=r(0)(562)},139:function(e,t,r){e.exports=r(0)(57)},141:function(e,t,r){e.exports=r(0)(238)},142:function(e,t,r){"use strict";t.__esModule=!0;var n=r(159),a=function(e){return e&&e.__esModule?e:{default:e}}(n);t.default=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return(0,a.default)(e)}},144:function(e,t,r){"use strict";(function(e){function n(){return o.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(n()<t)throw new RangeError("Invalid typed array length");return o.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t),e.__proto__=o.prototype):(null===e&&(e=new o(t)),e.length=t),e}function o(e,t,r){if(!(o.TYPED_ARRAY_SUPPORT||this instanceof o))return new o(e,t,r);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return c(this,e)}return s(this,e,t,r)}function s(e,t,r,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?f(e,t,r,n):"string"==typeof t?l(e,t,r):p(e,t)}function i(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function u(e,t,r,n){return i(t),t<=0?a(e,t):void 0!==r?"string"==typeof n?a(e,t).fill(r,n):a(e,t).fill(r):a(e,t)}function c(e,t){if(i(t),e=a(e,t<0?0:0|g(t)),!o.TYPED_ARRAY_SUPPORT)for(var r=0;r<t;++r)e[r]=0;return e}function l(e,t,r){if("string"==typeof r&&""!==r||(r="utf8"),!o.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|h(t,r);e=a(e,n);var s=e.write(t,r);return s!==n&&(e=e.slice(0,s)),e}function d(e,t){var r=t.length<0?0:0|g(t.length);e=a(e,r);for(var n=0;n<r;n+=1)e[n]=255&t[n];return e}function f(e,t,r,n){if(t.byteLength,r<0||t.byteLength<r)throw new RangeError("'offset' is out of bounds");if(t.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");return t=void 0===r&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,r):new Uint8Array(t,r,n),o.TYPED_ARRAY_SUPPORT?(e=t,e.__proto__=o.prototype):e=d(e,t),e}function p(e,t){if(o.isBuffer(t)){var r=0|g(t.length);return e=a(e,r),0===e.length?e:(t.copy(e,0,0,r),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||z(t.length)?a(e,0):d(e,t);if("Buffer"===t.type&&J(t.data))return d(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function g(e){if(e>=n())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n().toString(16)+" bytes");return 0|e}function _(e){return+e!=e&&(e=0),o.alloc(+e)}function h(e,t){if(o.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var r=e.length;if(0===r)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return j(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return W(e).length;default:if(n)return j(e).length;t=(""+t).toLowerCase(),n=!0}}function v(e,t,r){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if(r>>>=0,t>>>=0,r<=t)return"";for(e||(e="utf8");;)switch(e){case"hex":return A(this,t,r);case"utf8":case"utf-8":return O(this,t,r);case"ascii":return R(this,t,r);case"latin1":case"binary":return x(this,t,r);case"base64":return L(this,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return C(this,t,r);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}function m(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function M(e,t,r,n,a){if(0===e.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=a?0:e.length-1),r<0&&(r=e.length+r),r>=e.length){if(a)return-1;r=e.length-1}else if(r<0){if(!a)return-1;r=0}if("string"==typeof t&&(t=o.from(t,n)),o.isBuffer(t))return 0===t.length?-1:y(e,t,r,n,a);if("number"==typeof t)return t&=255,o.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?a?Uint8Array.prototype.indexOf.call(e,t,r):Uint8Array.prototype.lastIndexOf.call(e,t,r):y(e,[t],r,n,a);throw new TypeError("val must be string, number or Buffer")}function y(e,t,r,n,a){function o(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}var s=1,i=e.length,u=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;s=2,i/=2,u/=2,r/=2}var c;if(a){var l=-1;for(c=r;c<i;c++)if(o(e,c)===o(t,-1===l?0:c-l)){if(-1===l&&(l=c),c-l+1===u)return l*s}else-1!==l&&(c-=c-l),l=-1}else for(r+u>i&&(r=i-u),c=r;c>=0;c--){for(var d=!0,f=0;f<u;f++)if(o(e,c+f)!==o(t,f)){d=!1;break}if(d)return c}return-1}function E(e,t,r,n){r=Number(r)||0;var a=e.length-r;n?(n=Number(n))>a&&(n=a):n=a;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var s=0;s<n;++s){var i=parseInt(t.substr(2*s,2),16);if(isNaN(i))return s;e[r+s]=i}return s}function S(e,t,r,n){return V(j(t,e.length-r),e,r,n)}function I(e,t,r,n){return V(q(t),e,r,n)}function w(e,t,r,n){return I(e,t,r,n)}function T(e,t,r,n){return V(W(t),e,r,n)}function b(e,t,r,n){return V(Q(t,e.length-r),e,r,n)}function L(e,t,r){return 0===t&&r===e.length?X.fromByteArray(e):X.fromByteArray(e.slice(t,r))}function O(e,t,r){r=Math.min(e.length,r);for(var n=[],a=t;a<r;){var o=e[a],s=null,i=o>239?4:o>223?3:o>191?2:1;if(a+i<=r){var u,c,l,d;switch(i){case 1:o<128&&(s=o);break;case 2:u=e[a+1],128==(192&u)&&(d=(31&o)<<6|63&u)>127&&(s=d);break;case 3:u=e[a+1],c=e[a+2],128==(192&u)&&128==(192&c)&&(d=(15&o)<<12|(63&u)<<6|63&c)>2047&&(d<55296||d>57343)&&(s=d);break;case 4:u=e[a+1],c=e[a+2],l=e[a+3],128==(192&u)&&128==(192&c)&&128==(192&l)&&(d=(15&o)<<18|(63&u)<<12|(63&c)<<6|63&l)>65535&&d<1114112&&(s=d)}}null===s?(s=65533,i=1):s>65535&&(s-=65536,n.push(s>>>10&1023|55296),s=56320|1023&s),n.push(s),a+=i}return N(n)}function N(e){var t=e.length;if(t<=Z)return String.fromCharCode.apply(String,e);for(var r="",n=0;n<t;)r+=String.fromCharCode.apply(String,e.slice(n,n+=Z));return r}function R(e,t,r){var n="";r=Math.min(e.length,r);for(var a=t;a<r;++a)n+=String.fromCharCode(127&e[a]);return n}function x(e,t,r){var n="";r=Math.min(e.length,r);for(var a=t;a<r;++a)n+=String.fromCharCode(e[a]);return n}function A(e,t,r){var n=e.length;(!t||t<0)&&(t=0),(!r||r<0||r>n)&&(r=n);for(var a="",o=t;o<r;++o)a+=$(e[o]);return a}function C(e,t,r){for(var n=e.slice(t,r),a="",o=0;o<n.length;o+=2)a+=String.fromCharCode(n[o]+256*n[o+1]);return a}function k(e,t,r){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>r)throw new RangeError("Trying to access beyond buffer length")}function P(e,t,r,n,a,s){if(!o.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>a||t<s)throw new RangeError('"value" argument is out of bounds');if(r+n>e.length)throw new RangeError("Index out of range")}function F(e,t,r,n){t<0&&(t=65535+t+1);for(var a=0,o=Math.min(e.length-r,2);a<o;++a)e[r+a]=(t&255<<8*(n?a:1-a))>>>8*(n?a:1-a)}function D(e,t,r,n){t<0&&(t=4294967295+t+1);for(var a=0,o=Math.min(e.length-r,4);a<o;++a)e[r+a]=t>>>8*(n?a:3-a)&255}function U(e,t,r,n,a,o){if(r+n>e.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function G(e,t,r,n,a){return a||U(e,t,r,4,3.4028234663852886e38,-3.4028234663852886e38),K.write(e,t,r,n,23,4),r+4}function B(e,t,r,n,a){return a||U(e,t,r,8,1.7976931348623157e308,-1.7976931348623157e308),K.write(e,t,r,n,52,8),r+8}function H(e){if(e=Y(e).replace(ee,""),e.length<2)return"";for(;e.length%4!=0;)e+="=";return e}function Y(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function $(e){return e<16?"0"+e.toString(16):e.toString(16)}function j(e,t){t=t||1/0;for(var r,n=e.length,a=null,o=[],s=0;s<n;++s){if((r=e.charCodeAt(s))>55295&&r<57344){if(!a){if(r>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===n){(t-=3)>-1&&o.push(239,191,189);continue}a=r;continue}if(r<56320){(t-=3)>-1&&o.push(239,191,189),a=r;continue}r=65536+(a-55296<<10|r-56320)}else a&&(t-=3)>-1&&o.push(239,191,189);if(a=null,r<128){if((t-=1)<0)break;o.push(r)}else if(r<2048){if((t-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((t-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function q(e){for(var t=[],r=0;r<e.length;++r)t.push(255&e.charCodeAt(r));return t}function Q(e,t){for(var r,n,a,o=[],s=0;s<e.length&&!((t-=2)<0);++s)r=e.charCodeAt(s),n=r>>8,a=r%256,o.push(a),o.push(n);return o}function W(e){return X.toByteArray(H(e))}function V(e,t,r,n){for(var a=0;a<n&&!(a+r>=t.length||a>=e.length);++a)t[a+r]=e[a];return a}function z(e){return e!==e}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var X=r(234),K=r(235),J=r(218);t.Buffer=o,t.SlowBuffer=_,t.INSPECT_MAX_BYTES=50,o.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=n(),o.poolSize=8192,o._augment=function(e){return e.__proto__=o.prototype,e},o.from=function(e,t,r){return s(null,e,t,r)},o.TYPED_ARRAY_SUPPORT&&(o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&o[Symbol.species]===o&&Object.defineProperty(o,Symbol.species,{value:null,configurable:!0})),o.alloc=function(e,t,r){return u(null,e,t,r)},o.allocUnsafe=function(e){return c(null,e)},o.allocUnsafeSlow=function(e){return c(null,e)},o.isBuffer=function(e){return!(null==e||!e._isBuffer)},o.compare=function(e,t){if(!o.isBuffer(e)||!o.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var r=e.length,n=t.length,a=0,s=Math.min(r,n);a<s;++a)if(e[a]!==t[a]){r=e[a],n=t[a];break}return r<n?-1:n<r?1:0},o.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(e,t){if(!J(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return o.alloc(0);var r;if(void 0===t)for(t=0,r=0;r<e.length;++r)t+=e[r].length;var n=o.allocUnsafe(t),a=0;for(r=0;r<e.length;++r){var s=e[r];if(!o.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(n,a),a+=s.length}return n},o.byteLength=h,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)m(this,t,t+1);return this},o.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)m(this,t,t+3),m(this,t+1,t+2);return this},o.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)m(this,t,t+7),m(this,t+1,t+6),m(this,t+2,t+5),m(this,t+3,t+4);return this},o.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?O(this,0,e):v.apply(this,arguments)},o.prototype.equals=function(e){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===o.compare(this,e)},o.prototype.inspect=function(){var e="",r=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(e+=" ... ")),"<Buffer "+e+">"},o.prototype.compare=function(e,t,r,n,a){if(!o.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===r&&(r=e?e.length:0),void 0===n&&(n=0),void 0===a&&(a=this.length),t<0||r>e.length||n<0||a>this.length)throw new RangeError("out of range index");if(n>=a&&t>=r)return 0;if(n>=a)return-1;if(t>=r)return 1;if(t>>>=0,r>>>=0,n>>>=0,a>>>=0,this===e)return 0;for(var s=a-n,i=r-t,u=Math.min(s,i),c=this.slice(n,a),l=e.slice(t,r),d=0;d<u;++d)if(c[d]!==l[d]){s=c[d],i=l[d];break}return s<i?-1:i<s?1:0},o.prototype.includes=function(e,t,r){return-1!==this.indexOf(e,t,r)},o.prototype.indexOf=function(e,t,r){return M(this,e,t,r,!0)},o.prototype.lastIndexOf=function(e,t,r){return M(this,e,t,r,!1)},o.prototype.write=function(e,t,r,n){if(void 0===t)n="utf8",r=this.length,t=0;else if(void 0===r&&"string"==typeof t)n=t,r=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var a=this.length-t;if((void 0===r||r>a)&&(r=a),e.length>0&&(r<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return E(this,e,t,r);case"utf8":case"utf-8":return S(this,e,t,r);case"ascii":return I(this,e,t,r);case"latin1":case"binary":return w(this,e,t,r);case"base64":return T(this,e,t,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b(this,e,t,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Z=4096;o.prototype.slice=function(e,t){var r=this.length;e=~~e,t=void 0===t?r:~~t,e<0?(e+=r)<0&&(e=0):e>r&&(e=r),t<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e);var n;if(o.TYPED_ARRAY_SUPPORT)n=this.subarray(e,t),n.__proto__=o.prototype;else{var a=t-e;n=new o(a,void 0);for(var s=0;s<a;++s)n[s]=this[s+e]}return n},o.prototype.readUIntLE=function(e,t,r){e|=0,t|=0,r||k(e,t,this.length);for(var n=this[e],a=1,o=0;++o<t&&(a*=256);)n+=this[e+o]*a;return n},o.prototype.readUIntBE=function(e,t,r){e|=0,t|=0,r||k(e,t,this.length);for(var n=this[e+--t],a=1;t>0&&(a*=256);)n+=this[e+--t]*a;return n},o.prototype.readUInt8=function(e,t){return t||k(e,1,this.length),this[e]},o.prototype.readUInt16LE=function(e,t){return t||k(e,2,this.length),this[e]|this[e+1]<<8},o.prototype.readUInt16BE=function(e,t){return t||k(e,2,this.length),this[e]<<8|this[e+1]},o.prototype.readUInt32LE=function(e,t){return t||k(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},o.prototype.readUInt32BE=function(e,t){return t||k(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},o.prototype.readIntLE=function(e,t,r){e|=0,t|=0,r||k(e,t,this.length);for(var n=this[e],a=1,o=0;++o<t&&(a*=256);)n+=this[e+o]*a;return a*=128,n>=a&&(n-=Math.pow(2,8*t)),n},o.prototype.readIntBE=function(e,t,r){e|=0,t|=0,r||k(e,t,this.length);for(var n=t,a=1,o=this[e+--n];n>0&&(a*=256);)o+=this[e+--n]*a;return a*=128,o>=a&&(o-=Math.pow(2,8*t)),o},o.prototype.readInt8=function(e,t){return t||k(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},o.prototype.readInt16LE=function(e,t){t||k(e,2,this.length);var r=this[e]|this[e+1]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt16BE=function(e,t){t||k(e,2,this.length);var r=this[e+1]|this[e]<<8;return 32768&r?4294901760|r:r},o.prototype.readInt32LE=function(e,t){return t||k(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},o.prototype.readInt32BE=function(e,t){return t||k(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},o.prototype.readFloatLE=function(e,t){return t||k(e,4,this.length),K.read(this,e,!0,23,4)},o.prototype.readFloatBE=function(e,t){return t||k(e,4,this.length),K.read(this,e,!1,23,4)},o.prototype.readDoubleLE=function(e,t){return t||k(e,8,this.length),K.read(this,e,!0,52,8)},o.prototype.readDoubleBE=function(e,t){return t||k(e,8,this.length),K.read(this,e,!1,52,8)},o.prototype.writeUIntLE=function(e,t,r,n){if(e=+e,t|=0,r|=0,!n){P(this,e,t,r,Math.pow(2,8*r)-1,0)}var a=1,o=0;for(this[t]=255&e;++o<r&&(a*=256);)this[t+o]=e/a&255;return t+r},o.prototype.writeUIntBE=function(e,t,r,n){if(e=+e,t|=0,r|=0,!n){P(this,e,t,r,Math.pow(2,8*r)-1,0)}var a=r-1,o=1;for(this[t+a]=255&e;--a>=0&&(o*=256);)this[t+a]=e/o&255;return t+r},o.prototype.writeUInt8=function(e,t,r){return e=+e,t|=0,r||P(this,e,t,1,255,0),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},o.prototype.writeUInt16LE=function(e,t,r){return e=+e,t|=0,r||P(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):F(this,e,t,!0),t+2},o.prototype.writeUInt16BE=function(e,t,r){return e=+e,t|=0,r||P(this,e,t,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):F(this,e,t,!1),t+2},o.prototype.writeUInt32LE=function(e,t,r){return e=+e,t|=0,r||P(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):D(this,e,t,!0),t+4},o.prototype.writeUInt32BE=function(e,t,r){return e=+e,t|=0,r||P(this,e,t,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},o.prototype.writeIntLE=function(e,t,r,n){if(e=+e,t|=0,!n){var a=Math.pow(2,8*r-1);P(this,e,t,r,a-1,-a)}var o=0,s=1,i=0;for(this[t]=255&e;++o<r&&(s*=256);)e<0&&0===i&&0!==this[t+o-1]&&(i=1),this[t+o]=(e/s>>0)-i&255;return t+r},o.prototype.writeIntBE=function(e,t,r,n){if(e=+e,t|=0,!n){var a=Math.pow(2,8*r-1);P(this,e,t,r,a-1,-a)}var o=r-1,s=1,i=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===i&&0!==this[t+o+1]&&(i=1),this[t+o]=(e/s>>0)-i&255;return t+r},o.prototype.writeInt8=function(e,t,r){return e=+e,t|=0,r||P(this,e,t,1,127,-128),o.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},o.prototype.writeInt16LE=function(e,t,r){return e=+e,t|=0,r||P(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):F(this,e,t,!0),t+2},o.prototype.writeInt16BE=function(e,t,r){return e=+e,t|=0,r||P(this,e,t,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):F(this,e,t,!1),t+2},o.prototype.writeInt32LE=function(e,t,r){return e=+e,t|=0,r||P(this,e,t,4,2147483647,-2147483648),o.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):D(this,e,t,!0),t+4},o.prototype.writeInt32BE=function(e,t,r){return e=+e,t|=0,r||P(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),o.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},o.prototype.writeFloatLE=function(e,t,r){return G(this,e,t,!0,r)},o.prototype.writeFloatBE=function(e,t,r){return G(this,e,t,!1,r)},o.prototype.writeDoubleLE=function(e,t,r){return B(this,e,t,!0,r)},o.prototype.writeDoubleBE=function(e,t,r){return B(this,e,t,!1,r)},o.prototype.copy=function(e,t,r,n){if(r||(r=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-r&&(n=e.length-t+r);var a,s=n-r;if(this===e&&r<t&&t<n)for(a=s-1;a>=0;--a)e[a+t]=this[a+r];else if(s<1e3||!o.TYPED_ARRAY_SUPPORT)for(a=0;a<s;++a)e[a+t]=this[a+r];else Uint8Array.prototype.set.call(e,this.subarray(r,r+s),t);return s},o.prototype.fill=function(e,t,r,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===e.length){var a=e.charCodeAt(0);a<256&&(e=a)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!o.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<r)throw new RangeError("Out of range index");if(r<=t)return this;t>>>=0,r=void 0===r?this.length:r>>>0,e||(e=0);var s;if("number"==typeof e)for(s=t;s<r;++s)this[s]=e;else{var i=o.isBuffer(e)?e:j(new o(e,n).toString()),u=i.length;for(s=0;s<r-t;++s)this[s+t]=i[s%u]}return this};var ee=/[^+\/0-9A-Za-z-_]/g}).call(t,r(154))},146:function(e,t,r){var n=r(10),a=r(8),o=r(148);e.exports=function(e,t){var r=(a.Object||{})[e]||Object[e],s={};s[e]=t(r),n(n.S+n.F*o(function(){r(1)}),"Object",s)}},147:function(e,t,r){e.exports={default:r(178),__esModule:!0}},148:function(e,t,r){e.exports=r(0)(59)},149:function(e,t,r){e.exports={default:r(168),__esModule:!0}},151:function(e,t,r){r(152),e.exports=r(8).Object.getPrototypeOf},152:function(e,t,r){var n=r(141),a=r(153);r(146)("getPrototypeOf",function(){return function(e){return a(n(e))}})},153:function(e,t,r){e.exports=r(0)(585)},154:function(e,t,r){e.exports=r(0)(86)},155:function(e,t,r){e.exports=r(0)(84)},158:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0;var a=r(184),o=n(a),s=r(149),i=n(s);t.default=function(){function e(e,t){var r=[],n=!0,a=!1,o=void 0;try{for(var s,u=(0,i.default)(e);!(n=(s=u.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(e){a=!0,o=e}finally{try{!n&&u.return&&u.return()}finally{if(a)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if((0,o.default)(Object(t)))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},159:function(e,t,r){e.exports={default:r(173),__esModule:!0}},164:function(e,t,r){e.exports=r(0)(80)},168:function(e,t,r){r(23),r(22),e.exports=r(169)},169:function(e,t,r){var n=r(9),a=r(26);e.exports=r(8).getIterator=function(e){var t=a(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return n(t.call(e))}},171:function(e,t,r){"use strict";function n(e){return!isNullOrEmpty(e.quote)}function a(e){return s(e)===constant.BUBBLE_TYPE.SHARE_FILE}function o(e){return s(e)===constant.BUBBLE_TYPE.SHARE_IMAGE}function s(e,t){var r=constant.BUBBLE_TYPE.UNDEFINED;return e!==constant.CARD_TYPE.ESpaceSharingTypeCloudText&&e!==constant.CARD_TYPE.ESpaceSharingTypeCloudAudio&&e!==constant.CARD_TYPE.ESpaceSharingTypeCloudVideo&&e!==constant.CARD_TYPE.ESpaceSharingTypeCloudWord&&e!==constant.CARD_TYPE.ESpaceSharingTypeCloudExcel&&e!==constant.CARD_TYPE.ESpaceSharingTypeCloudPPT&&e!==constant.CARD_TYPE.ESpaceSharingTypeCloudPDF&&e!==constant.CARD_TYPE.ESpaceSharingTypeCloudOther&&e!==constant.CARD_TYPE.ESpaceSharingTypeCloudFolder||(r=constant.BUBBLE_TYPE.SHARE_FILE),e===constant.CARD_TYPE.ESpaceSharingTypeCloudImage?constant.BUBBLE_TYPE.SHARE_IMAGE:(e!==constant.CARD_TYPE.ESpaceSharingTypeText&&e!==constant.CARD_TYPE.ESpaceSharingTypeImgAndText&&e!==constant.CARD_TYPE.ESpaceSharingTypeAudioAndVideo&&e!==constant.CARD_TYPE.ESpaceSharingTypeNew&&e!==constant.CARD_TYPE.ESpaceSharingTypeNewCard||(r=constant.BUBBLE_TYPE.SHARE_KNOWLEDGE),e!==constant.CARD_TYPE.ESpaceSharingTypeCard&&e!==constant.CARD_TYPE.ESpaceSharingTypeTeamCard&&e!==constant.CARD_TYPE.ESpaceSharingTypeExpertCard||(r=constant.BUBBLE_TYPE.BUSINESS_CARD),e===constant.CARD_TYPE.ESpaceSharingType2ndRedPacketNew?constant.BUBBLE_TYPE.RED_PACKET:(Number(e)===constant.CARD_TYPE.WECodeCardType&&Number(t)===constant.CARD_TYPE.WECodeCustomSubCardType&&(r=constant.BUBBLE_TYPE.WE_CODE),Number(e)===constant.CARD_TYPE.MakeComplaintsCardType&&Number(t)===constant.CARD_TYPE.MakeComplaintsSubCardType&&(r=constant.BUBBLE_TYPE.MAKE_COMPLAINTS),r))}function i(e){try{var t=e.media_type;e.chat_type;return t===constant.MEDIA_TYPE.FILE||t===constant.MEDIA_TYPE.AUDIO||t===constant.MEDIA_TYPE.VIDEO||t===constant.MEDIA_TYPE.PHOTO||t===constant.MEDIA_TYPE.SCREEN_SHOT}catch(e){return T.error("isNewFileMessage",e.toString()),!1}}function u(e){var t=coreCommon.xssFilter(e);return t=function(e){return y(e)&&(e=e.replace(g(),function(t){var r=arguments[arguments.length-2];if(m(e,r))return t;var n=/(https|http):\/\//gi,a=t;return n.test(t)||(a="http://"+t),'<a href="'+a+'" >'+t+"</a>"})),e}(t),t=function(e){return M(e)&&(e=e.replace(v(),function(t){var r=arguments[arguments.length-2];if(m(e,r))return t;var n=/mailto:/gi,a=t;return n.test(t)||(a="mailto:"+t.toLocaleLowerCase()),'<a href="'+a+'" >'+t+"</a>"})),e}(t),-1!==t.indexOf("\n")&&(t=t.replaceAll("\n","<br/>")),t}function c(e){return T.info("getImageInfo"),new S.default(function(t,r){var n=new Image;"ios"===window.CLIENTCONFIG.PLATFORM?n.setAttribute("src","/local-filesystem"+e):n.setAttribute("src",e),n.complete?(T.info("getImageInfo","width",n.width,"height",n.height),t({width:n.width,height:n.height})):(n.onload=function(){T.info("getImageInfo","width",n.width,"height",n.height),t({width:n.width,height:n.height})},n.onerror=function(){T.error("getImageInfo","img path error"),t({width:0,height:0})})})}function l(e){return T.info("getVideoInfo"),"ios"===window.CLIENTCONFIG.PLATFORM?appService.getVideoDurationAndSize(e):new S.default(function(t,r){var n=document.createElement("video");n.setAttribute("src",e),n.complete?(T.info("getVideoInfo","width",n.videoWidth,"height",n.videoHeight),t({width:n.videoWidth,height:n.videoHeight})):(n.onloadedmetadata=function(){T.info("getVideoInfo","width",n.videoWidth,"height",n.videoHeight),t({width:n.videoWidth,height:n.videoHeight})},n.onerror=function(){T.error("getVideoInfo","video path error"),t({width:0,height:0})})})}function d(e){return T.info("getAudioInfo"),"ios"===window.CLIENTCONFIG.PLATFORM?appService.getAudioDuration(e):new S.default(function(t,r){var n=document.createElement("audio");n.setAttribute("src",e),n.complete?(T.info("getAudioInfo","duration",n.duration),t({duration:parseInt(n.duration)})):(n.onloadedmetadata=function(){T.info("getAudioInfo","duration",n.duration),t({duration:parseInt(n.duration)})},n.onerror=function(){T.error("getAudioInfo","audio path error"),t({duration:0})})})}function f(e){try{var t=e?new Date(e):new Date,r="screenshot_"+t.format("yyyyMMddhhmmssS");return T.info("createImageName 截图名: "+r),r}catch(e){T.error("createImageName",e.toString())}}function p(e){return e.is_quote===constant.IS_QUOTE.YES}function g(){return/((https?):\/\/|www\.)[-a-zA-Z0-9@:%_+.~#?&\/=\\'`!$*(&amp;)]+/gi}function _(){return/(file:\/\/|\\\\)(((?:(?:25[0-5]|2[0-4]\d|((1\d{2})|([1-9]?\d)))\.){3}(?:25[0-5]|2[0-4]\d|((1\d{2})|([1-9]?\d))))|([a-zA-Z]))[^<\s]*/gi}function h(){return/((notes|telnet|ftp):\/\/)[-a-zA-Z0-9@:;%_+.~#?&\/=\\']+/gi}function v(){return/(mailto:)?(\w)+(\.\w+)*([@:%_+.~#?&\/=\\'<>])*@(\w)+((\.\w{2,3}){1,3})/gi}function m(e,t){var r=e.substring(0,t);return r.lastIndexOf("<")>r.lastIndexOf(">")}function M(e){var t=e,r=v();return new RegExp(r.source).test(t)}function y(e){var t=e,r=g(),n=_(),a=h(),o=[new RegExp(r.source,"i"),new RegExp(n.source,"i"),new RegExp(a.source,"i")];return o[0].test(t)||o[1].test(t)||o[2].test(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.isShowOriginImg=t.findFileIndex=t.isGroupNotifyMessage=t.formatPcNormalMessage=t.isCustomChat=t.isBelongToCurrentRecent=t.formatImgUrl=t.isAtMessage=t.getRecentOwnerByMessage=t.hasScreenShot=t.dealShareFileMessageFileList=t.getBubbleRenderType=t.checkClientChatId=t.resolveFileInfoByContent=t.getFileMediaType=t.getImType=t.isPublicNo=t.isGroup=t.isErrorQuote=t.isErrorMessage=t.isUseUmFile=t.isShowMessageRelay=t.isMessageToolTipsShow=void 0;var E=r(3),S=function(e){return e&&e.__esModule?e:{default:e}}(E);t.isQuoteMessage=n,t.isShareFile=a,t.isShareImage=o,t.getCardBubbleType=s,t.isNewFileMessage=i,t.formatMobileNormalMessage=u,t.getImageInfo=c,t.getVideoInfo=l,t.getAudioInfo=d,t.createImageName=f,t.isQuoteFile=p;var I=r(182),w=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(I),T=coreLogger.getLogger("service")("IM/messageUtil"),b=(t.isMessageToolTipsShow=function(e){var t=e.media_type,r=e.quote;return t===constant.MEDIA_TYPE.FILE||t===constant.MEDIA_TYPE.AUDIO||t===constant.MEDIA_TYPE.VIDEO?b():!!(isNullOrEmpty(r)||(t=e.quote.media_type)!==constant.MEDIA_TYPE.FILE&&t!==constant.MEDIA_TYPE.AUDIO&&t!==constant.MEDIA_TYPE.VIDEO)||b()},t.isShowMessageRelay=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.media_type;return t!==constant.MEDIA_TYPE.FILE&&t!==constant.MEDIA_TYPE.AUDIO&&t!==constant.MEDIA_TYPE.VIDEO||b()},t.isUseUmFile=function(){var e=$getState();return!(e.login.isSupportProxy&&e.IM.stgDisableSendFile)}),L=(t.isErrorMessage=function(e){return e.chat_type!==constant.CHAT_TYPE.SYSTEM_NOTIFICATION&&(e.show_html===constant.DEAL_ERROR?(T.error("消息格式异常！show_html"),T.debug("消息格式异常！show_html",e),!0):!(e.media_type!==constant.MEDIA_TYPE.FILE&&e.media_type!==constant.MEDIA_TYPE.AUDIO&&e.media_type!==constant.MEDIA_TYPE.VIDEO&&e.media_type!==constant.MEDIA_TYPE.PHOTO&&e.media_type!==constant.MEDIA_TYPE.SCREEN_SHOT||!isNullOrEmpty(e.file_list))&&(T.error("消息格式异常！file_list为空"),T.debug("消息格式异常！file_list为空",e),!0))},t.isErrorQuote=function(e){if(e.chat_type===constant.CHAT_TYPE.SYSTEM_NOTIFICATION)return!1;if(!isNullOrEmpty(e.quote)){if(e.quote.show_html===constant.DEAL_ERROR)return T.error("消息格式异常！quote.show_html"),T.debug("消息格式异常！quote.show_html",e),!0;if((e.quote.media_type===constant.MEDIA_TYPE.FILE||e.quote.media_type===constant.MEDIA_TYPE.AUDIO||e.quote.media_type===constant.MEDIA_TYPE.VIDEO||e.quote.media_type===constant.MEDIA_TYPE.PHOTO||e.quote.media_type===constant.MEDIA_TYPE.SCREEN_SHOT)&&isNullOrEmpty(e.quote.file_list))return T.error("消息格式异常！quote.file_list为空"),T.debug("消息格式异常！quote.file_list为空",e),!0}return!1},t.isGroup=function(e){return e===constant.CHAT_TYPE.GROUP_CHAT||e===constant.CHAT_TYPE.GROUP_CHAT_TEMPORARY||e===constant.CHAT_TYPE.DISCUSSION_GROUP});t.isPublicNo=function(e){return e===constant.CHAT_TYPE.PUBLIC_NO},t.getImType=function(e){switch(e.chat_type){case constant.CHAT_TYPE.SINGLE_CHAT:case constant.CHAT_TYPE.SINGLE_CHAT_TEMPORARY:return constant.IM_TYPE.SINGLE;case constant.CHAT_TYPE.GROUP_CHAT:case constant.CHAT_TYPE.GROUP_CHAT_TEMPORARY:case constant.CHAT_TYPE.DISCUSSION_GROUP:return constant.IM_TYPE.GROUP;case constant.CHAT_TYPE.SYSTEM_NOTIFICATION:case constant.CHAT_TYPE.SYSTEM_ADVERTISING:return constant.IM_TYPE.SYSTEM_ANNOUNCEMENT;case constant.CHAT_TYPE.SERVICE_ONLINE:case constant.CHAT_TYPE.REMINDER:case constant.CHAT_TYPE.FUSION_MEETING_NOTIFICATION:case constant.CHAT_TYPE.IM_NOTIFICATION_MESSAGE:case constant.CHAT_TYPE.AUTO_REPLY:default:return constant.IM_TYPE.OTHER}},t.getFileMediaType=function(e){var t=getSuffix(e);return-1!==["mp4","mpeg4","ogg"].indexOf(t)?constant.FILE_MEDIA_TYPE.VIDEO:-1!==["wav","mp3"].indexOf(t)&&window.CLIENTCONFIG.ISMOBILE?constant.FILE_MEDIA_TYPE.AUDIO:-1!==["png","jpg","jpeg","bmp","gif"].indexOf(t)?constant.FILE_MEDIA_TYPE.Img:constant.FILE_MEDIA_TYPE.FILE},t.resolveFileInfoByContent=function(e){try{T.debug("resolveFileInfoByContent");var t=new RegExp("\\||;|{|}"),r=e.split(t);return{um_url:r[1],file_type:r[2],file_size:r[3],file_name:r[4],duration:r[5],width:r[6],height:r[7],um_plain_access_code:r[8]}}catch(e){T.error("resolveFileInfoByContent 文件信息解析失败",e.toString())}},t.checkClientChatId=function(e){return e>2},t.getBubbleRenderType=function(e){try{var t=e.media_type,r=e.status,n=e.file_list,a=e.card_type,o=e.show_html,i=e.sub_msg_type;T.debug("getBubbleRenderType",{media_type:t,status:r,file_list:n,card_type:a,sub_msg_type:i});var u=null,c={},l=null;switch(t){case constant.MEDIA_TYPE.AUTO_REPLY:case constant.MEDIA_TYPE.TEXT:case constant.MEDIA_TYPE.PHOTO_TEXT:case constant.MEDIA_TYPE.CALL_RECORD_NOTIFY:return i===constant.MSGSUBFLAG.ANNOUNCEMENT?constant.BUBBLE_TYPE.TEAM_ANNOUNCEMENT:constant.BUBBLE_TYPE.NORMAL;case constant.MEDIA_TYPE.SCREEN_SHOT:case constant.MEDIA_TYPE.PHOTO:return constant.BUBBLE_TYPE.PHOTO;case constant.MEDIA_TYPE.LIKE:return constant.BUBBLE_TYPE.LIKE;case constant.MEDIA_TYPE.AUDIO:return constant.BUBBLE_TYPE.AUDIO;case constant.MEDIA_TYPE.VIDEO:return constant.BUBBLE_TYPE.VIDEO;case constant.MEDIA_TYPE.FILE:return constant.BUBBLE_TYPE.FILE;case constant.MEDIA_TYPE.SHARE:if(isNullOrEmpty(o)){var d=coreCommon.String2MessageXML(e.content),f=d.querySelector("c").textContent.split("<![CDATA[")[1].split("]]>")[0];c=JSON.parse(f)}else c=JSON.parse(o);return a=c.cardType,u=c.cardContext,isNullOrEmpty(u)||(l=u.customSubCardType),s(a,l);case constant.MEDIA_TYPE.CARD:return constant.BUBBLE_TYPE.OUT_SHARE;case constant.MEDIA_TYPE.DANGEROUS:return constant.BUBBLE_TYPE.DANGEROUS;case constant.MEDIA_TYPE.PUBLIC_NUMBER:return constant.BUBBLE_TYPE.PUBLIC_NO;case constant.MEDIA_TYPE.SECRET:return constant.BUBBLE_TYPE.SECRET;default:return constant.BUBBLE_TYPE.UNDEFINED}}catch(e){T.error("getBubbleRenderType",e.toString())}},t.dealShareFileMessageFileList=function(e,t,r){var n=$getState().login.account,a=void 0,o=void 0,s=void 0,i=void 0;if(r){var u=getSuffix(t.title);a=f()+"."+u,o=appService.getScreenShotPath(n)+a,i=appService.getOriginFilesPath(n)+a,s="Img"}else a=t.title,o=appService.getReceiveFilesPath(n)+t.title,s="File";var c=t.cardContext.sourceUrl.replace(/[?#&].*/,"").replace(/\/\/?p\//,"/f/"),l={um_plain_access_code:"",um_url:c,file_size:t.cardContext.fileSize,file_name:a,file_real_save_path:o,file_real_save_name:a,file_path:i,file_id:t.cardContext.fileID,owner_id:t.cardContext.ownerID,is_downloaded:constant.IS_DOWNLOADED.NO,file_deal_type:constant.FILE_DEAL_TYPE.DOWNLOAD,recent_id:e.recent_id,recent_owner:e.recent_owner,message_id:e.id,message_server_chat_id_str:e.server_chat_id_str,time_stamp:e.utc_stamp,is_quote:constant.IS_QUOTE.NO,file_type:s,width:0,height:0,duration:"0"};e.status=constant.MEDIA_STATUS.RECEIVE,e.file_list=[l]},t.hasScreenShot=function(e){return e===constant.MEDIA_TYPE.SCREEN_SHOT||e===constant.MEDIA_TYPE.PHOTO_TEXT},t.getRecentOwnerByMessage=function(e){try{return L(e.chat_type)?e.group_id:e.origin===$getState().login.account?e.target:e.origin}catch(t){return T.error("getRecentOwnerByMessage",t.toString()),e.origin}},t.isAtMessage=function(e){try{var t=$getState().login.account,r=e.show_html,n=e.media_type,a=e.at_user_list;if(T.info("show at_user_list ,length : ",a&&a.length),!isNullOrEmpty(a)){var o=!1;return-1!==a.findIndex(function(e){return e.account===t})&&(o=!0),T.info("isAtMessage",{isAt:o}),o}if(n!==constant.MEDIA_TYPE.TEXT||n!==constant.MEDIA_TYPE.PHOTO_TEXT||isNullOrEmpty(r))return T.info("isAtMessage, does not meet type requirements",{show_html:r,media_type:n}),!1;var s=r&&coreCommon.String2HTML(r);if(!isNullOrEmpty(s)&&s.querySelectorAll){var i=s.querySelectorAll("[role-at]"),u=!1;return isNullOrEmpty(i)||i.forEach(function(e){e.getAttribute("data-account")===$getState().login.account&&(u=!0)}),T.info("isAtMessage",u),u}return!1}catch(e){return T.error("isAtMessage",e.toString()),!1}},t.formatImgUrl=function(e){try{var t=decodeURI(e);return t.startsWith("http://")||t.startsWith("https://")||t.startsWith("ftp://")?(T.info("formatImgUrl NG"),!1):(t=t.replace("file:///",""),T.info("formatImgUrl OK"),t)}catch(e){return T.error("formatImgUrl",e.toString()),!1}},t.isBelongToCurrentRecent=function(e){var t=$getState(),r=t.recent,n=r.currentRecentInfo,a=n.owner;return e.recent_owner===a},t.isCustomChat=function(e){return e===constant.CHAT_TYPE.CUSTOM_CHAT},t.formatPcNormalMessage=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";e=coreIm.dealRelativeEmotionPath(e);var n=coreCommon.xssFilter(e);return n=function(e){return y(e)&&(e=e.replace(g(),function(t){var r=arguments[arguments.length-2];if(m(e,r))return t;var n=/(https|http):\/\//gi,a=t;return n.test(t)||(a="http://"+t),'<a href="javascript:;" onClick="appService.openUrl(\''+a+"')\">"+t+"</a>"}),e=e.replace(_(),function(t){var r=arguments[arguments.length-2];return m(e,r)?t:'<a href="javascript:;" onClick="appService.openUrl(\'file:'+t.replace("file:","").replace(/\\/g,"/").replace(/([^\/]+)\/+/g,"$1/")+"')\">"+t+"</a>"}),e=e.replace(h(),function(t){var r=arguments[arguments.length-2];return m(e,r)?t:"<a>"+t+"</a>"})),e}(n),n=function(e){return M(e)&&(e=e.replace(v(),function(t){var r=arguments[arguments.length-2];if(m(e,r))return t;var n=/mailto:/gi,a=t;return n.test(t)||(a="mailto:"+t.toLocaleLowerCase()),'<a href="javascript:;" onClick="appService.openUrl(\''+a+"')\">"+t+"</a>"})),e}(n),n=function(e,t,r){if(t){var n=null;""!==r&&(n=new RegExp(r,"gi"),e=e.replace(n,function(e){return'<span style="color:#04cfef !important">'+e+"</span>"}))}return e}(n,t,r),-1!==n.indexOf("\n")&&(n=n.replaceAll("\n","<br/>")),n=n.replace(/<img[^>]+>/g,function(e){if(-1!==e.indexOf(window.EMOTION_PATH)){var t=e.lastIndexOf(".");return e.slice(0,t)+".png"+e.slice(t+4,e.length)}return e})},t.isGroupNotifyMessage=function(e){return e===constant.MEDIA_TYPE.GROUP_MEMBERCHG_NOTIFY||e===constant.MEDIA_TYPE.APPLY_JOIN_FIXED_GROUP_NOTIFY||e===constant.MEDIA_TYPE.UPGRADE_TO_FIXED_GROUP_NOTIFY||e===constant.MEDIA_TYPE.CHANGE_JOIN_GROUP_VERIFY||e===constant.MEDIA_TYPE.GROUP_NAME_CHANGE},t.findFileIndex=function(e,t){for(var r=0;r<e.file_list.length;r++)if(e.file_list[r].um_plain_access_code===t.um_plain_access_code)return r;return T.info("findFileIndex   index not found"),0},t.isShowOriginImg=function(e){var t=e.width,r=e.height;return Math.max(t,r)<=constant.PC_IMG_THUMBNAIL_SIZE||w.getUmServerFlag()}},173:function(e,t,r){r(22),r(174),e.exports=r(8).Array.from},174:function(e,t,r){"use strict";var n=r(11),a=r(10),o=r(141),s=r(31),i=r(32),u=r(27),c=r(175),l=r(26);a(a.S+a.F*!r(33)(function(e){Array.from(e)}),"Array",{from:function(e){var t,r,a,d,f=o(e),p="function"==typeof this?this:Array,g=arguments.length,_=g>1?arguments[1]:void 0,h=void 0!==_,v=0,m=l(f);if(h&&(_=n(_,g>2?arguments[2]:void 0,2)),void 0==m||p==Array&&i(m))for(t=u(f.length),r=new p(t);t>v;v++)c(r,v,h?_(f[v],v):f[v]);else for(d=m.call(f),r=new p;!(a=d.next()).done;v++)c(r,v,h?s(d,_,[a.value,v],!0):a.value);return r.length=v,r}})},175:function(e,t,r){"use strict";var n=r(25),a=r(176);e.exports=function(e,t,r){t in e?n.f(e,t,a(0,r)):e[t]=r}},176:function(e,t,r){e.exports=r(0)(79)},178:function(e,t,r){r(179),e.exports=r(8).Object.keys},179:function(e,t,r){var n=r(141),a=r(164);r(146)("keys",function(){return function(e){return a(n(e))}})},182:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";coreLogger.getLogger("model")("IMService").info(e+" initImModelService"),N(),R(),x(),H(),O(),F(),D(),k(),U(),G(),B(),(0,L.initUserLoginStatus)(),C(),A(!1)}Object.defineProperty(t,"__esModule",{value:!0}),t.getSendPhotoType=t.setSendPhotoType=t.initSendPhotoType=t.getOfflineFileConfig=t.setOfflineFileConfig=t.initOfflineFileConfig=t.deleteMessageWithdrawServerId=t.getMessageWithdrawServerIdList=t.getMessageWithdrawServerId=t.setMessageWithdrawServerId=t.initMessageWithdrawServerIdList=t.addDownloadScreenShotFunc=t.addUploadScreenShotFunc=t.queueDealFuncClass=t.deleteUnDownloadedPhoto=t.getUnDownloadedPhotoMap=t.getUnDownloadedPhoto=t.setUnDownloadedPhoto=t.initUnDownloadedPhotoMap=t.deleteGroupFileByHandle=t.getGroupFileByHandle=t.setGroupFileByHandle=t.initGroupFileHandleMap=t.deleteFileByHandleList=t.deleteFileByHandle=t.getFileHandleMap=t.getFileByHandle=t.setFileByHandle=t.initFileHandleMap=t.getUmServerFlag=t.setUmServerFlag=t.getIsReceiveMessageQueueDealing=t.setIsReceiveMessageQueueDealing=t.getFirstReceiveMessageQueue=t.setReceiveMessageQueueList=t.setReceiveMessageQueue=t.initReceiveMessageQueue=t.deleteReceivingMessage=t.queryReceivingMessageMap=t.getReceivingMessage=t.setReceivingMessage=t.initReceivingMessageMap=t.deleteSendingMessage=t.querySendingMessageMap=t.getSendingMessage=t.setSendingMessage=t.initSendingMessageMap=t.setPosition=t.getPosition=t.setRecentListReady=t.getRecentListReady=t.getUnDealMessageList=t.setUnDealMessage=t.initUnDealMessageList=t.deleteUnReadMessage=t.deleteRecentUnReadMessage=t.setRecentUnReadMessageList=t.setRecentUnReadMessage=t.getRecentUnReadMessage=t.initUnReadMessageList=t.setCurrentRecentUnReadMessage=t.getCurrentRecentAllUnReadMessageList=t.initCurrentRecentUnReadMessageList=t.deleteUnReadFileMessageList=t.initUnReadFileMessageList=t.getUnReadFileMessageList=t.setUnReadFileMessage=t.getUserLoginStatus=t.setUserLoginStatus=void 0;var o=r(1),s=n(o),i=r(2),u=n(i);t.initImModelService=a;var c=r(979),l=n(c),d=r(980),f=n(d),p=r(981),g=n(p),_=r(982),h=n(_),v=r(983),m=n(v),M=r(984),y=n(M),E=r(985),S=n(E),I=r(986),w=n(I),T=r(639),b=n(T),L=r(1911);t.setUserLoginStatus=L.setUserLoginStatus,t.getUserLoginStatus=L.getUserLoginStatus;var O=(t.setUnReadFileMessage=l.default.setUnReadFileMessage,t.getUnReadFileMessageList=l.default.getUnReadFileMessageList,t.initUnReadFileMessageList=l.default.initUnReadFileMessageList),N=(t.deleteUnReadFileMessageList=l.default.deleteUnReadFileMessageList,t.initCurrentRecentUnReadMessageList=l.default.initCurrentRecentUnReadMessageList),R=(t.getCurrentRecentAllUnReadMessageList=l.default.getCurrentRecentAllUnReadMessageList,t.setCurrentRecentUnReadMessage=l.default.setCurrentRecentUnReadMessage,t.initUnReadMessageList=l.default.initUnReadMessageList),x=(t.getRecentUnReadMessage=l.default.getRecentUnReadMessage,t.setRecentUnReadMessage=l.default.setRecentUnReadMessage,t.setRecentUnReadMessageList=l.default.setRecentUnReadMessageList,t.deleteRecentUnReadMessage=l.default.deleteRecentUnReadMessage,t.deleteUnReadMessage=l.default.deleteUnReadMessage,t.initUnDealMessageList=l.default.initUnDealMessageList),A=(t.setUnDealMessage=l.default.setUnDealMessage,t.getUnDealMessageList=l.default.getUnDealMessageList,t.getRecentListReady=l.default.getRecentListReady,t.setRecentListReady=l.default.setRecentListReady),C=(t.getPosition=l.default.getPosition,t.setPosition=l.default.setPosition,t.initSendingMessageMap=l.default.initSendingMessageMap),k=(t.setSendingMessage=l.default.setSendingMessage,t.getSendingMessage=l.default.getSendingMessage,t.querySendingMessageMap=l.default.querySendingMessageMap,t.deleteSendingMessage=l.default.deleteSendingMessage,t.initReceivingMessageMap=l.default.initReceivingMessageMap,t.setReceivingMessage=l.default.setReceivingMessage,t.getReceivingMessage=l.default.getReceivingMessage,t.queryReceivingMessageMap=l.default.queryReceivingMessageMap,t.deleteReceivingMessage=l.default.deleteReceivingMessage,t.initReceiveMessageQueue=l.default.initReceiveMessageQueue),P=(t.setReceiveMessageQueue=l.default.setReceiveMessageQueue,t.setReceiveMessageQueueList=l.default.setReceiveMessageQueueList,t.getFirstReceiveMessageQueue=l.default.getFirstReceiveMessageQueue,t.setIsReceiveMessageQueueDealing=l.default.setIsReceiveMessageQueueDealing,t.getIsReceiveMessageQueueDealing=l.default.getIsReceiveMessageQueueDealing,t.setUmServerFlag=l.default.setUmServerFlag,t.getUmServerFlag=l.default.getUmServerFlag,t.initFileHandleMap=f.default.initFileHandleMap),F=(t.setFileByHandle=f.default.setFileByHandle,t.getFileByHandle=f.default.getFileByHandle,t.getFileHandleMap=f.default.getFileHandleMap,t.deleteFileByHandle=f.default.deleteFileByHandle,t.deleteFileByHandleList=f.default.deleteFileByHandleList,t.initGroupFileHandleMap=f.default.initGroupFileHandleMap),D=(t.setGroupFileByHandle=f.default.setGroupFileByHandle,t.getGroupFileByHandle=f.default.getGroupFileByHandle,t.deleteGroupFileByHandle=f.default.deleteGroupFileByHandle,t.initUnDownloadedPhotoMap=g.default.initUnDownloadedPhotoMap),U=(t.setUnDownloadedPhoto=g.default.setUnDownloadedPhoto,t.getUnDownloadedPhoto=g.default.getUnDownloadedPhoto,t.getUnDownloadedPhotoMap=g.default.getUnDownloadedPhotoMap,t.deleteUnDownloadedPhoto=g.default.deleteUnDownloadedPhoto,t.queueDealFuncClass=b.default,t.addUploadScreenShotFunc=h.default.addUploadScreenShotFunc,t.addDownloadScreenShotFunc=m.default.addDownloadScreenShotFunc,t.initMessageWithdrawServerIdList=y.default.initMessageWithdrawServerIdList),G=(t.setMessageWithdrawServerId=y.default.setMessageWithdrawServerId,t.getMessageWithdrawServerId=y.default.getMessageWithdrawServerId,t.getMessageWithdrawServerIdList=y.default.getMessageWithdrawServerIdList,t.deleteMessageWithdrawServerId=y.default.deleteMessageWithdrawServerId,t.initOfflineFileConfig=S.default.initOfflineFileConfig),B=(t.setOfflineFileConfig=S.default.setOfflineFileConfig,t.getOfflineFileConfig=S.default.getOfflineFileConfig,t.initSendPhotoType=w.default.initSendPhotoType),H=(t.setSendPhotoType=w.default.setSendPhotoType,t.getSendPhotoType=w.default.getSendPhotoType,function(){var e=(0,u.default)(s.default.mark(function e(){var t;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=coreIm.getFileHandleMap(),coreIm.stopAllFileReceive(t),P();case 3:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}}())},184:function(e,t,r){e.exports={default:r(185),__esModule:!0}},185:function(e,t,r){r(23),r(22),e.exports=r(186)},186:function(e,t,r){var n=r(16),a=r(6)("iterator"),o=r(17);e.exports=r(8).isIterable=function(e){var t=Object(e);return void 0!==t[a]||"@@iterator"in t||o.hasOwnProperty(n(t))}},190:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(){$dispatch(coreUi.initLoadMore())}function o(e){coreIm.updateImgList(e,"update");var t=$getState(),r=t.recent,n=t.IM;(r.isBackwardLoadMessage||0!==n.unReadNewMessageNum)&&O.clearNewMessageFromMessageList(),$dispatch(coreUi.addNewMessage(e))}function s(e){$getState().recent.currentRecentInfo.owner===e.recent_owner&&$dispatch(coreUi.updateMessageList(e))}function i(e){$dispatch(coreUi.updateMessageListByClientId(e))}function u(e,t){$dispatch(coreUi.updateProgressMap(e,t))}function c(e){$dispatch(coreUi.deleteProgressMap(e))}function l(e,t,r){$dispatch(coreUi.updateCurrentRecentImgList(e,t,r))}function d(e){$dispatch(coreUi.setCurrentImg(e))}function f(e){$dispatch(coreUi.deleteOpenFileMessageMap(e))}function p(e){$dispatch(coreUi.deleteOpenFolderMessageMap(e))}function g(e){$dispatch(coreUi.deleteSaveAsFileMessageMap(e))}function _(){$dispatch(coreUi.setBackwardLoadMessage())}function h(){$dispatch(coreUi.setLoadMore())}function v(){$dispatch(coreUi.setHistoryMessageLoading())}function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$getState().recent.currentRecentInfo;if($dispatch(coreUi.loadHistoryMessage(e)),!isNullOrEmpty(e)){var r=R.dealRecentLastMessageInfo(t,e[e.length-1]);coreDb.saveRecent(r),R.refreshRecentList(r)}}function M(){$dispatch(coreUi.setHistoryMessageNotLoading())}function y(){$dispatch(coreUi.haveMoreLocalMessage())}function E(){$dispatch(coreUi.haveMoreServerMessage())}function S(){x.info("userClick  clearScreen"),$dispatch(coreUi.initHistoryMessageQueryInfo()),$dispatch(coreUi.clearScreen())}function I(e){$dispatch(coreUi.updateNowPlayingAudio(e))}function w(e){$dispatch(coreUi.setFirstLoadMessage(e))}function T(e){$dispatch(coreUi.setToBottom(e))}function b(e){$dispatch(coreUi.setCurrentPlayVideo(e))}Object.defineProperty(t,"__esModule",{value:!0}),t.optionBtn=void 0,t.initLoadMore=a,t.addNewMessage=o,t.updateMessageList=s,t.updateMessageListByClientId=i,t.updateProgressMap=u,t.deleteProgressMap=c,t.updateCurrentRecentImgList=l,t.setCurrentImg=d,t.deleteOpenFileMessageMap=f,t.deleteOpenFolderMessageMap=p,t.deleteSaveAsFileMessageMap=g,t.setBackwardLoadMessage=_,t.setLoadMore=h,t.setHistoryMessageLoading=v,t.loadHistoryMessage=m,t.setHistoryMessageNotLoading=M,t.haveMoreLocalMessage=y,t.haveMoreServerMessage=E,t.clearScreen=S,t.updateNowPlayingAudio=I,t.setFirstLoadMessage=w,t.setToBottom=T,t.setCurrentPlayVideo=b;var L=r(303),O=n(L),N=r(217),R=n(N),x=(r(597),coreLogger.getLogger("logic")("IM/dataUpdate"));t.optionBtn=function(e){$dispatch(coreUi.updateOptionBtn(e))}},1911:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=null,a=coreLogger.getLogger("logic")("model/IM/personal");t.initUserLoginStatus=function(){n=null},t.setUserLoginStatus=function(e){a.info("setUserLoginStatus",e),n=e},t.getUserLoginStatus=function(){return n}},1912:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(3),a=function(e){return e&&e.__esModule?e:{default:e}}(n);t.default=function(){var e=0,t=0,r=0,n=null,o=function(){};return o.prototype.getLocalTime=function(){return Date.now()+e},o.prototype.getMergeTime=function(){return e},o.prototype.initLocalTimeService=function(){clearTimeout(n),e=0,t=0,r=0},o.prototype.startLocalTimeService=function(){var o=this;return coreIm.checkEServerOnlineNoToast("startLocalTimeService")?coreTup.getIMInstance().then(function(e){return t=Date.now(),e.getServiceUtcTime()}).then(function(s){if(clearTimeout(n),!isNullOrEmpty(s)&&s.result===constant.ERROR_CODE.Success&&s.param&&1===s.param.result){var i=Math.floor((Date.now()+t)/2);e=s.param.utc_time-i,r=0}else e=0,r++;return r>=3?o.initLocalTimeService():n=setTimeout(function(){o.startLocalTimeService()},36e5),a.default.resolve()}):(n=setTimeout(function(){o.startLocalTimeService()},59e3),a.default.resolve())},new o}()},1913:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.loadOneClickJumpMessageList=t.forwardQueryMessage=void 0;var o=r(1),s=a(o),i=r(2),u=a(i),c=r(228),l=n(c),d=r(641),f=n(d),p=r(171),g=n(p),_=r(992),h=n(_),v=coreLogger.getLogger("logic")("IM/historyMessageDeal"),m=(t.forwardQueryMessage=function(){var e=(0,u.default)(s.default.mark(function e(){var t,r;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{v.info("forwardQueryMessage"),t=$getState(),r=t.recent.currentRecentInfo,f.checkOnlyLoadLocalMessage(r,!0)?(v.info("forwardQueryMessage 只加载本地消息"),m(r)):(v.info("forwardQueryMessage 同步服务器消息"),M(r))}catch(e){v.error("forwardQueryMessage",e.toString()),$dispatch(coreUi.setHistoryMessageNotLoading())}case 1:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),t.loadOneClickJumpMessageList=function(){var e=(0,u.default)(s.default.mark(function e(t,r,n){var a,o;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,v.info("loadOneClickJumpMessageList"),a=$getState(),o=a.recent.currentRecentInfo,!f.checkOnlyLoadLocalMessage(o,!0)){e.next=10;break}return v.info("loadOneClickJumpMessageList 只加载本地消息"),e.next=8,m(o,t,r);case 8:e.next=13;break;case 10:return v.info("loadOneClickJumpMessageList 同步服务器消息"),e.next=13,M(o,t,r,n);case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),v.error("loadOneClickJumpMessageList",e.t0.toString()),$dispatch(coreUi.setHistoryMessageNotLoading());case 19:case"end":return e.stop()}},e,void 0,[[0,15]])}));return function(t,r,n){return e.apply(this,arguments)}}(),function(){var e=(0,u.default)(s.default.mark(function e(t,r,n){var a,o,i,u,c,l,d,p;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=$getState(),o=a.recent,i=o.isHistoryMessageLoading,u=o.smallQueryMessageUtcStamp,c=o.moreLocalMessage,!i){e.next=5;break}return e.abrupt("return");case 5:if(c){e.next=8;break}return v.info("onlyForwardLocalMessage","没有更多消息"),e.abrupt("return");case 8:if(f.initAddMoreHistoryMessage(),l=$getState().recent.currentRecentInfo,l.owner===t.owner){e.next=14;break}return v.info("onlyForwardLocalMessage 不在当前会话"),$dispatch(coreUi.setHistoryMessageNotLoading()),e.abrupt("return");case 14:return d={recent_owner:t.owner,utc_stamp:n||u,pageCount:r,isPre:!0},v.debug("onlyForwardLocalMessage 加载本地消息"),e.next=18,coreDb.limitMessageList(d);case 18:if(p=e.sent,!isNullOrEmpty(p)){e.next=24;break}v.info("onlyForwardLocalMessage 没有本地消息"),$dispatch(coreUi.haveNoMoreMessage()),e.next=26;break;case 24:return e.next=26,f.loadDbMessage(t,p,!0);case 26:$dispatch(coreUi.setHistoryMessageNotLoading()),e.next=33;break;case 29:e.prev=29,e.t0=e.catch(0),v.error("onlyForwardLocalMessage",e.t0.toString()),$dispatch(coreUi.setHistoryMessageNotLoading());case 33:case"end":return e.stop()}},e,void 0,[[0,29]])}));return function(t,r,n){return e.apply(this,arguments)}}()),M=function(){var e=(0,u.default)(s.default.mark(function e(t,r,n,a){var o,i,u,c,d,p,_,m,M,y,E,S,I;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,o=$getState(),i=o.recent,u=i.isHistoryMessageLoading,c=i.smallQueryMessageServerId,d=i.smallQueryMessageUtcStamp,p=i.moreSeverMessage,!u){e.next=6;break}return v.info("forwardLocalAndServerMessage","正在加载漫游消息"),e.abrupt("return");case 6:if(p){e.next=9;break}return v.info("forwardLocalAndServerMessage","没有更多漫游消息"),e.abrupt("return");case 9:return f.initAddMoreHistoryMessage(),v.debug("forwardLocalAndServerMessage 查询服务器漫游消息"),d=n||d,_={recent_owner:t.owner,utc_stamp:d,pageCount:r,isPre:!0},m=t.chat_type===constant.CHAT_TYPE.SYSTEM_NOTIFICATION,e.next=16,l.queryHistoryMessage({sender:m?"":t.owner,operation_type:constant.QUERY_OPERATION_TYPE.NORMAL,count:r,server_chat_id_str:a||c,message_type:m?3:g.isGroup(t.chat_type)?1:0});case 16:if(M=e.sent,!isNullOrEmpty(M)){e.next=32;break}return v.info("forwardLocalAndServerMessage（处理服务器消息）","没有更多漫游消息"),e.next=21,coreDb.limitMessageList(_);case 21:if(y=e.sent,!isNullOrEmpty(y)){e.next=27;break}return v.info("forwardLocalAndServerMessage(处理服务器消息) 没有本地消息"),$dispatch(coreUi.haveNoMoreMessage()),$dispatch(coreUi.setHistoryMessageNotLoading()),e.abrupt("return");case 27:return $dispatch(coreUi.haveNoMoreServerMessage()),e.next=30,f.loadDbMessage(t,y,!0);case 30:return $dispatch(coreUi.setHistoryMessageNotLoading()),e.abrupt("return");case 32:if(E=$getState().recent.currentRecentInfo,E.owner===t.owner){e.next=37;break}return v.info("forwardLocalAndServerMessage 不在当前会话"),$dispatch(coreUi.setHistoryMessageNotLoading()),e.abrupt("return");case 37:if(d=0===d?M[M.length-1].utc_stamp:d,S={queryTime:d,bigTime:M[0].utc_stamp,smallTime:M[M.length-1].utc_stamp},!h.isLocalHas(S,t)){e.next=53;break}return v.info("forwardLocalAndServerMessage 直接加载本地消息"),e.next=43,coreDb.limitMessageList(_);case 43:if(I=e.sent,!isNullOrEmpty(I)){e.next=49;break}return v.info("forwardLocalAndServerMessage(处理服务器消息) 没有本地消息"),$dispatch(coreUi.haveNoMoreLocalMessage()),$dispatch(coreUi.setHistoryMessageNotLoading()),e.abrupt("return");case 49:return e.next=51,f.loadDbMessage(t,I,!0);case 51:e.next=58;break;case 53:return v.debug("forwardLocalAndServerMessage 更新记录信息"),t=h.dealMessageSign(S,t),v.debug("forwardLocalAndServerMessage 处理服务器消息"),e.next=58,f.loadServerMessage(M,_,t);case 58:$dispatch(coreUi.setHistoryMessageNotLoading()),e.next=65;break;case 61:e.prev=61,e.t0=e.catch(0),v.error("forwardLocalAndServerMessage",e.t0.toString()),$dispatch(coreUi.setHistoryMessageNotLoading());case 65:case"end":return e.stop()}},e,void 0,[[0,61]])}));return function(t,r,n,a){return e.apply(this,arguments)}}()},1914:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(139),a=function(e){return e&&e.__esModule?e:{default:e}}(n);coreLogger.getLogger("model")("recentService/recentList");t.default=function(){var e={},t={},r={},n=function(){};return n.prototype={initAtMap:function(){e={}},updateAtMap:function(t,r){if(Object.type(t)===Object.type.ARRAY)for(var n=0;n<t.length;n++)e[t[n]]=r[n];else e[t]=r;return(0,a.default)({},e)},deleteAtMap:function(t){return delete e[t],(0,a.default)({},e)},getAtMap:function(){return(0,a.default)({},e)},initUnReadNumMap:function(){t={}},updateUnReadNumMap:function(e,r){if(Object.type(e)===Object.type.ARRAY)for(var n=0;n<e.length;n++)t[e[n]]=r[n];else t[e]=r;return(0,a.default)({},t)},deleteUnReadNumMap:function(e){return delete t[e],(0,a.default)({},t)},getUnReadNumMap:function(){return(0,a.default)({},t)},initUnReadApplyGroupNotifyNumMap:function(){r={}},updateUnReadApplyGroupNotifyNumMap:function(e,t){if(Object.type(e)===Object.type.ARRAY)for(var n=0;n<e.length;n++)r[e[n]]=t[n];else r[e]=t;return(0,a.default)({},r)},deleteUnReadApplyGroupNotifyNumMap:function(e){return delete r[e],(0,a.default)({},r)},getUnReadApplyGroupNotifyNumMap:function(){return(0,a.default)({},r)}},new n}()},1915:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(322),a=function(e){return e&&e.__esModule?e:{default:e}}(n),o=coreLogger.getLogger("recent")("recentUpdateSubscribe");t.default=function(){var e={},t=function(){};return t.prototype={initRecentUpdateSubscribeMap:function(){o.info("initRecentUpdateSubscribeMap"),e={}},subscribeRecentUpdate:function(t){var r=t.describe,n=t.callback;if(o.info("subscribeRecentUpdate",r),isNullOrEmpty(r)||isNullOrEmpty(n))return void o.info("subscribeRecentUpdate args is wrong",r,isNullOrEmpty(n));e[r]?o.info("subscribeRecentUpdate describe is already exist",r):e[r]=n},unSubscribeRecentUpdate:function(t){var r=t.describe;if(o.info("unSubscribeRecentUpdate",r),isNullOrEmpty(r))return void o.info("unSubscribeRecentUpdate args is wrong",r);delete e[r]},getAllSubscribeRecentUpdate:function(){return isNullOrEmpty(e)?(o.info("getAllSubscribeRecentUpdate there is not this group's subscribe "),[]):(0,a.default)(e)}},new t}()},1916:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.onlyLoadLocalHistoryMessageList=t.getServerHistoryMessage=t.loadLocalHistoryMessageList=t.loadHistoryMessageList=void 0;var o=r(1),s=a(o),i=r(2),u=a(i),c=r(228),l=n(c),d=r(641),f=n(d),p=r(171),g=n(p),_=coreLogger.getLogger("logic")("IM/historyMessageDeal"),h=(t.loadHistoryMessageList=function(){var e=(0,u.default)(s.default.mark(function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:$getState().recent.currentRecentInfo;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!f.checkOnlyLoadLocalMessage(t)){e.next=7;break}return _.info("loadHistoryMessageList","Load only local messages",t.id),e.next=5,m(t);case 5:e.next=10;break;case 7:return _.info("loadHistoryMessageList","Load server messages",t.id),e.next=10,M(t);case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),_.error("loadHistoryMessageList",e.t0.toString());case 15:case"end":return e.stop()}},e,void 0,[[0,12]])}));return function(){return e.apply(this,arguments)}}(),t.loadLocalHistoryMessageList=function(){var e=(0,u.default)(s.default.mark(function e(t){var r,n,a,o,i,u;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r=t.owner,n=t.id,a=$getState(),o=a.recent.isHistoryMessageLoading,_.info("loadLocalHistoryMessageList",n),!o){e.next=8;break}return _.info("loadLocalHistoryMessageList","Loading local message",n),e.abrupt("return");case 8:return i={recent_owner:r,utc_stamp:9999999999999,isPre:!0},f.initLoadHistoryMessage(),e.next=12,coreDb.limitMessageList(i);case 12:u=e.sent,isNullOrEmpty(u)?$dispatch(coreUi.haveNoMoreMessage()):(_.info("loadLocalHistoryMessageList have local message",n),f.loadDbMessage(t,u,!1)),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),_.error("loadLocalHistoryMessageList",e.t0.toString());case 19:case"end":return e.stop()}},e,void 0,[[0,16]])}));return function(t){return e.apply(this,arguments)}}()),v=t.getServerHistoryMessage=function(){var e=(0,u.default)(s.default.mark(function e(t){var r,n,a,o,i,u;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=$getState().recent.currentRecentInfo,n=t.owner,a=t.id,!(0,d.checkOnlyLoadLocalMessage)(t)&&r.owner===t.owner){e.next=4;break}return e.abrupt("return");case 4:return _.info("getServerHistoryMessage",a),o=t.chat_type===constant.CHAT_TYPE.SYSTEM_NOTIFICATION,e.next=8,l.queryHistoryMessage({sender:o?"":n,operation_type:constant.QUERY_OPERATION_TYPE.FIRST,message_type:o?3:g.isGroup(t.chat_type)?1:0});case 8:if(i=e.sent,u={},isNullOrEmpty(i)||(u={queryTime:i[0].utc_stamp,bigTime:i[0].utc_stamp,smallTime:i[i.length-1].utc_stamp}),r=$getState().recent.currentRecentInfo,r.owner===t.owner){e.next=14;break}return e.abrupt("return");case 14:coreCommon.dispatchModuleEvent("getServerHistoryMessage",{historyMessageList:i,serverSign:u,recent:t});case 15:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),m=t.onlyLoadLocalHistoryMessageList=function(){var e=(0,u.default)(s.default.mark(function e(t){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h(t);case 3:$dispatch(coreUi.setHistoryMessageNotLoading()),e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),_.error("onlyLoadLocalHistoryMessageList",e.t0.toString()),$dispatch(coreUi.setHistoryMessageNotLoading());case 10:case"end":return e.stop()}},e,void 0,[[0,6]])}));return function(t){return e.apply(this,arguments)}}(),M=function(){var e=(0,u.default)(s.default.mark(function e(t){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,h(t);case 3:v(t),e.next=10;break;case 6:e.prev=6,e.t0=e.catch(0),_.error("loadLocalAndServerHistoryMessageList",e.t0.toString()),$dispatch(coreUi.setHistoryMessageNotLoading());case 10:case"end":return e.stop()}},e,void 0,[[0,6]])}));return function(t){return e.apply(this,arguments)}}()},1917:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.backwardQueryMessage=void 0;var o=r(1),s=a(o),i=r(2),u=a(i),c=r(641),l=n(c),d=r(303),f=n(d),p=r(190),g=n(p),_=coreLogger.getLogger("logic")("IM/historyMessageDeal/addMoreBackwardMessage");t.backwardQueryMessage=function(){var e=(0,u.default)(s.default.mark(function e(){var t,r,n,a,o,i,u,c,d,p,h,v;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,_.debug("backwardQueryMessage"),t=$getState(),r=t.recent,n=r.isHistoryMessageLoading,a=r.bigQueryMessageUtcStamp,o=r.isBackwardLoadMessage,i=r.isLoadMore,u=t.IM.unReadNewMessageNum,o){e.next=7;break}return e.abrupt("return");case 7:if(!n){e.next=10;break}return _.info("backwardQueryMessage","正在加载漫游消息"),e.abrupt("return");case 10:return c=t.recent.currentRecentInfo,l.initAddMoreHistoryMessage(),e.next=14,coreDb.limitMessageList({recent_owner:c.owner,utc_stamp:a,isPre:!1});case 14:if(d=e.sent,p=$getState().recent.currentRecentInfo,p.owner===c.owner){e.next=19;break}return _.info("backwardQueryMessage 不在当前会话"),e.abrupt("return");case 19:if(!isNullOrEmpty(d)){e.next=27;break}return _.info("backwardQueryMessage(处理服务器消息) 没有本地消息"),$dispatch(coreUi.haveNoMoreLocalMessage()),$dispatch(coreUi.setHistoryMessageNotLoading()),$dispatch(coreUi.initBackwardLoadMessage()),f.setUnreadNewMessageNum(0),i&&g.initLoadMore(),e.abrupt("return");case 27:return h=p.last_message,v=d[d.length-1],h&&h.client_chat_id===v.client_chat_id&&($dispatch(coreUi.initBackwardLoadMessage()),f.setUnreadNewMessageNum(0),i&&g.initLoadMore()),e.next=32,l.loadDbMessage(c,d,!0,!0);case 32:$dispatch(coreUi.setHistoryMessageNotLoading()),e.next=39;break;case 35:e.prev=35,e.t0=e.catch(0),_.error("backwardQueryMessage",e.t0.toString()),$dispatch(coreUi.setHistoryMessageNotLoading());case 39:case"end":return e.stop()}},e,void 0,[[0,35]])}));return function(){return e.apply(this,arguments)}}()},1918:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.updatePictureList=t.updateCurrentRecentImgList=t.updateImgList=t.lazyGetImgList=t.firstGetImgList=void 0;var a=r(1),o=n(a),s=r(135),i=n(s),u=r(2),c=n(u),l=r(171),d=r(637),f=r(643),p=coreLogger.getLogger("logic")("IM/historyMessageDeal/imgList"),g=coreCommon.TaskQueue.getInstance("updatePictureList"),_=!1,h=(t.firstGetImgList=function(){var e=(0,c.default)(o.default.mark(function e(t){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=coreCommon.TaskOptions.defaultOptions(),r.priority=coreCommon.TASK_PRIORITY.HIGH,g.addTask((0,c.default)(o.default.mark(function e(){var r,n,a,s,u;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,p.info("first get img list upon message list is loaded"),r=[],n=0;case 4:if(!(n<t.length)){e.next=20;break}if(b(t[n])&&t[n].media_type!==constant.MEDIA_TYPE.WITHDRAW_NOTIFY&&t[n].is_delete!==constant.IS_DELETE.YES){e.next=7;break}return e.abrupt("continue",17);case 7:a=0;case 8:if(!(a<t[n].file_list.length)){e.next=17;break}return s=(0,i.default)({},t[n].file_list[a]),e.next=12,N(s);case 12:s=e.sent,r.push(s);case 14:a++,e.next=8;break;case 17:n++,e.next=4;break;case 20:if(u=$getState().recent.currentRecentInfo,0!==r.length&&r[0].recent_owner!==u.owner){e.next=24;break}return e.next=24,$dispatch(coreUi.setCurrentRecentImgList(r));case 24:h(),e.next=30;break;case 27:e.prev=27,e.t0=e.catch(0),p.error("firstGetImgLIst error",e.t0);case 30:case"end":return e.stop()}},e,void 0,[[0,27]])})),r,null);case 3:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.lazyGetImgList=function(){if(_)return void p.info("lazyGetImgList is already in progress, return");_=!0;var e=coreCommon.TaskOptions.defaultOptions();e.priority=coreCommon.TASK_PRIORITY.HIGH,g.addTask(v,e,null)}),v=function(){var e=(0,c.default)(o.default.mark(function e(){var t,r,n,a,s,u,c,l,d;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,_=!0,p.info("lazyGetImgList 请求本会话中图片地址"),t=(0,i.default)([],$getState().recent.currentRecentImgList),r=$getState().recent.currentRecentInfo,window.CLIENTCONFIG.ISMOBILE?!isNullOrEmpty(t)&&t.length>0&&r.owner!==t[0].recent_owner&&(p.info("not same conversation, clear old img list"),$dispatch(coreUi.setCurrentRecentImgList([]))):!isNullOrEmpty(t)&&t.length>0&&(r={owner:t[0].recent_owner}),n={recent_owner:r.owner},t&&t.length>0&&(n.utc_stamp=t[0].time_stamp),e.next=10,x(n,"screenshot");case 10:return a=e.sent,e.next=13,x(n,"file");case 13:s=e.sent,u=a.listOrigin,c=s.listOrigin,l=u.concat(c),l=isNullOrEmpty(l)?[]:I(S(L(l),"time_stamp")),d=[],isNullOrEmpty(l)||0===l.length||(t=(0,i.default)([],$getState().recent.currentRecentImgList),d=S(L(l.concat(t)),"time_stamp"),window.CLIENTCONFIG.ISMOBILE&&(r=$getState().recent.currentRecentInfo),r.owner===d[0].recent_owner&&$dispatch(coreUi.setCurrentRecentImgList(d))),_=!1,e.next=27;break;case 23:e.prev=23,e.t0=e.catch(0),p.error("lazyGetImgList error",e.t0),_=!1;case 27:case"end":return e.stop()}},e,void 0,[[0,23]])}));return function(){return e.apply(this,arguments)}}(),m=(t.updateImgList=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:window.CLIENTCONFIG.ISMOBILE?M(t,r,n):m(t,r,n);case 1:case"end":return e.stop()}},e,void 0)}));return function(t,r){return e.apply(this,arguments)}}(),t.updateCurrentRecentImgList=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n,a,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=$getState().recent.currentRecentImgList,a=$getState().recent.currentRecentInfo,n.length>0&&!isNullOrEmpty(a.owner)&&(isNullOrEmpty(n[0])||n[0].recent_owner!==a.owner||M(t,r,s));case 3:case"end":return e.stop()}},e,void 0)}));return function(t,r){return e.apply(this,arguments)}}()),M=t.updatePictureList=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(b(t,r)){e.next=2;break}return e.abrupt("return");case 2:p.info("enter update img list",r),g.addTask(y,{},null,t,r,n);case 4:case"end":return e.stop()}},e,void 0)}));return function(t,r){return e.apply(this,arguments)}}(),y=function(){var e=(0,c.default)(o.default.mark(function e(t,r,n){var a,s,u,c,l,d,f,g,_,h;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=$getState().recent.currentRecentInfo,s=$getState().recent.currentRecentImgList,window.CLIENTCONFIG.ISMOBILE||!isNullOrEmpty(s)&&s.length>0&&(a={owner:s[0].recent_owner}),t.recent_owner===a.owner){e.next=6;break}return e.abrupt("return");case 6:u=0;case 7:if(!(u<t.file_list.length)){e.next=56;break}c=t.file_list[u],l=!0,d=(0,i.default)([],$getState().recent.currentRecentImgList),f=0;case 12:if(!(f<d.length)){e.next=43;break}if(c.message_server_chat_id_str!==d[f].message_server_chat_id_str||!isNullOrEmpty(c.um_plain_access_code)&&!isNullOrEmpty(d[f].um_plain_access_code)&&c.um_plain_access_code!==d[f].um_plain_access_code){e.next=31;break}if("delete"!==r){e.next=20;break}return d.splice(f,1),e.next=18,$dispatch(coreUi.setCurrentRecentImgList(d));case 18:e.next=29;break;case 20:if("update"!==r||!T(d[f],c)){e.next=29;break}return p.info("update image list  same file"),e.next=24,O([c]);case 24:if(g=e.sent,isNullOrEmpty(g[0])){e.next=29;break}return d[f]=g[0],e.next=29,$dispatch(coreUi.setCurrentRecentImgList(d));case 29:return l=!1,e.abrupt("break",43);case 31:if("serverId"!==r||n!==d[f].message_server_chat_id_str){e.next=40;break}return p.info("update image list  update serverId"),d[f].message_server_chat_id_str=t.server_chat_id_str,d[f].time_stamp=t.utc_stamp,d=S(d,"time_stamp"),e.next=38,$dispatch(coreUi.setCurrentRecentImgList(d));case 38:return l=!1,e.abrupt("break",43);case 40:f++,e.next=12;break;case 43:if("update"!==r||!l){e.next=53;break}return p.info("update image list  insert new record "),e.next=47,O([c]);case 47:if(_=e.sent,isNullOrEmpty(_[0])){e.next=53;break}return d.push((0,i.default)({},_[0])),d=S(d,"time_stamp"),e.next=53,$dispatch(coreUi.setCurrentRecentImgList(d));case 53:u++,e.next=7;break;case 56:return h=(0,i.default)([],$getState().recent.currentRecentImgList),t.file_list.length>1&&(h=w(h,t)),e.next=60,$dispatch(coreUi.setCurrentRecentImgList(h));case 60:e.next=65;break;case 62:e.prev=62,e.t0=e.catch(0),p.error("updateImgList error",e.t0);case 65:case"end":return e.stop()}},e,void 0,[[0,62]])}));return function(t,r,n){return e.apply(this,arguments)}}(),E=function(e){return function(t,r){var n=t[e],a=r[e],o=t.index,s=r.index;return n<a?-1:n>a?1:o<s?-1:o>s?1:0}},S=function(e,t){if(!isNullOrEmpty(e)){for(var r=0;r<e.length;r++)e[r].index=r;e.sort(E(t));for(var n=0;n<e.length;n++)delete e[n].index;return e}},I=function(e){for(var t=e.slice(-constant.LAZY_LOAD_IMG_PAGE_SIZE),r=e.length-constant.LAZY_LOAD_IMG_PAGE_SIZE-1;r>=0&&e[r].time_stamp===t[0].time_stamp;)t.unshift(e[r]),r--;return t},w=function(e,t){for(var r=[],n=[],a=0;a<t.file_list.length;a++)for(var o=0;o<e.length;o++)e[o].message_server_chat_id_str===t.file_list[a].message_server_chat_id_str&&e[o].um_plain_access_code===t.file_list[a].um_plain_access_code&&(r.push((0,i.default)({},e[o])),n.push(o));n.sort();for(var s=0;s<r.length;s++)e[n[s]]=r[s];return e},T=function(e,t){return e.time_stamp!==t.time_stamp||e.type!==t.type||e.is_downloaded!==t.is_downloaded||e.file_deal_type!==t.file_deal_type||e.isThumbnail!==t.isThumbnail||e.file_real_save_path!==t.file_real_save_path||e.file_handle!==t.file_handle||(p.info("update image list no need to update"),!1)},b=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(isNullOrEmpty(e)||isNullOrEmpty(e.file_list))return!1;var t=e.media_type,r=e.card_type,n=coreIm.isShareImage(r);return!(t!==constant.MEDIA_TYPE.PHOTO&&t!==constant.MEDIA_TYPE.SCREEN_SHOT&&!n&&t!==constant.MEDIA_TYPE.PHOTO_TEXT&&t!==constant.MEDIA_TYPE.WITHDRAW_NOTIFY)},L=function(e){for(var t={},r=[],n=0;n<e.length;n++)t[e[n].message_server_chat_id_str]&&t[e[n].um_plain_access_code]||(r.push(e[n]),t[e[n].um_plain_access_code]=1,t[e[n].message_server_chat_id_str]=1);return r},O=function(){var e=(0,c.default)(o.default.mark(function e(t){var r,n,a,s,i,u,c;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,R(t);case 2:if(r=e.sent,n=[],0!==r.length){e.next=6;break}return e.abrupt("return",n);case 6:a=0;case 7:if(!(a<r.length)){e.next=30;break}return s=r[a],s.file_path&&(s.file_path=coreIm.getRealFilePath({filePath:s.file_path})),s.file_real_save_path&&(s.file_real_save_path=coreIm.getRealFilePath({filePath:s.file_real_save_path})),i=(0,l.isShowOriginImg)(s)?s.file_path:s.file_real_save_path,e.next=14,appService.isFileExist(i);case 14:if(u=e.sent){e.next=23;break}return p.info("deal img info, file not exist"),e.next=19,coreDb.queryMessage({server_chat_id_str:s.message_server_chat_id_str});case 19:c=e.sent,window.CLIENTCONFIG.ISMOBILE?(0,l.isShowOriginImg)(s)?(0,f.downloadPhoto)(s,c,!1):(0,f.downloadPhoto)(s,c,!0):(!(0,l.isShowOriginImg)(s)&&(0,f.downloadPhoto)(s,c,!0),(0,f.downloadPhoto)(s,c,!1)),e.next=26;break;case 23:return e.next=25,(0,d.isExistOfOriginImage)(s);case 25:s.type="origin";case 26:n.push(s);case 27:a++,e.next=7;break;case 30:return e.abrupt("return",n);case 31:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),N=function(){var e=(0,c.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.file_path&&(t.file_path=coreIm.getRealFilePath({filePath:t.file_path})),t.file_real_save_path&&(t.file_real_save_path=coreIm.getRealFilePath({filePath:t.file_real_save_path})),e.next=4,(0,d.isExistOfOriginImage)(t);case 4:return e.abrupt("return",t);case 5:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),R=function(){var e=(0,c.default)(o.default.mark(function e(t){var r,n,a,s,u,c,l,d,f,g,_,h,v;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(0,i.default)([],t),n="",a={},s={},u=[],c=[],!(isNullOrEmpty(r)||r.length<=0)){e.next=8;break}return e.abrupt("return",r);case 8:l=0;case 9:if(!(l<r.length)){e.next=19;break}if(d=r[l].um_plain_access_code+r[l].message_server_chat_id_str,s[d]=r[l],!isNullOrEmpty(r[l].message_server_chat_id_str)&&!a[r[l].message_server_chat_id_str]){e.next=14;break}return e.abrupt("continue",16);case 14:a[r[l].message_server_chat_id_str]=!0,n+=r[l].message_server_chat_id_str+",";case 16:l++,e.next=9;break;case 19:return n=n.slice(0,-1),p.info("filterDeletOrWithdrawImg query message"),e.next=23,coreDb.queryMessage({server_chat_id_str:n,bulk:!0});case 23:u=e.sent,f=0;case 25:if(!(f<u.length)){e.next=33;break}if(g=u[f],!isNullOrEmpty(g)){e.next=29;break}return e.abrupt("continue",30);case 29:if(g.media_type!==constant.MEDIA_TYPE.WITHDRAW_NOTIFY&&g.is_delete!==constant.IS_DELETE.YES&&b(g))for(_=0;_<g.file_list.length;_++)h=g.file_list[_].um_plain_access_code+g.file_list[_].message_server_chat_id_str,v=s[h],!isNullOrEmpty(g.file_list[_])&&v&&(v.file_size=g.file_list[_].file_size,v.time_stamp!==g.utc_stamp&&(v.time_stamp=g.utc_stamp,g.media_type===constant.MEDIA_TYPE.PHOTO?coreDb.saveScreenShot(v):coreDb.saveFile(v)),c.push(v));case 30:f++,e.next=25;break;case 33:return e.abrupt("return",c);case 34:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),x=function(){var e=(0,c.default)(o.default.mark(function e(t,r){var n,a,s,u,c,l;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=[],a=[],s=(0,i.default)({},t);case 3:if(!(a.length<constant.LAZY_LOAD_IMG_PAGE_SIZE)){e.next=33;break}if(p.info("start query db image , type is : "+r+"  "+a.length),u=[],c=[],a.length>0&&(s.utc_stamp=a[0].time_stamp),"screenshot"!==r){e.next=14;break}return e.next=11,coreDb.limitScreenShotListByRecent({opts:s,pageSize:constant.LAZY_LOAD_IMG_PAGE_SIZE+4});case 11:n=e.sent,e.next=18;break;case 14:if("file"!==r){e.next=18;break}return e.next=17,coreDb.limitImageFileListByRecent({opts:s,pageSize:constant.LAZY_LOAD_IMG_PAGE_SIZE+4});case 17:n=e.sent;case 18:if(0!==n.length){e.next=20;break}return e.abrupt("break",33);case 20:for("screenshot"===r&&p.info("query db",n.length),l=0;l<n.length;l++)0===n[l].is_quote&&u.push(n[l]);return e.next=24,O(u);case 24:if(c=e.sent,a=c.concat(a),!(n.length<constant.LAZY_LOAD_IMG_PAGE_SIZE+4)){e.next=30;break}return e.abrupt("break",33);case 30:s.utc_stamp=n[0].time_stamp;case 31:e.next=3;break;case 33:return"screenshot"===r&&p.info("query db res",a.length),e.abrupt("return",{listOrigin:a});case 35:case"end":return e.stop()}},e,void 0)}));return function(t,r){return e.apply(this,arguments)}}()},1919:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.stopAllFileReceive=void 0;var a=r(1),o=n(a),s=r(149),i=n(s),u=r(147),c=n(u),l=r(2),d=n(l),f=r(645),p=coreLogger.getLogger("logic")("IM/cancelSend");t.stopAllFileReceive=function(){var e=(0,d.default)(o.default.mark(function e(t){var r,n,a,s,u,l,d,g,_;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(p.info("stopAllFileReceive"),!isNullOrEmpty(t)){e.next=4;break}return p.info("stopAllFileReceive file map is empty"),e.abrupt("return");case 4:r=(0,c.default)(t),n=!0,a=!1,s=void 0,e.prev=8,u=(0,i.default)(r);case 10:if(n=(l=u.next()).done){e.next=22;break}if(d=l.value,g=t[d],g.file_deal_type!==constant.FILE_DEAL_TYPE.DOWNLOAD&&g.file_deal_type!==constant.FILE_DEAL_TYPE.RE_DOWNLOAD){e.next=19;break}return e.next=16,coreDb.queryMessage({server_chat_id_str:g.message_server_chat_id_str});case 16:return _=e.sent,e.next=19,(0,f.rejectFile)(_);case 19:n=!0,e.next=10;break;case 22:e.next=28;break;case 24:e.prev=24,e.t0=e.catch(8),a=!0,s=e.t0;case 28:e.prev=28,e.prev=29,!n&&u.return&&u.return();case 31:if(e.prev=31,!a){e.next=34;break}throw s;case 34:return e.finish(31);case 35:return e.finish(28);case 36:case"end":return e.stop()}},e,void 0,[[8,24,28,36],[29,,31,35]])}));return function(t){return e.apply(this,arguments)}}()},1920:function(e,t,r){"use strict";function n(e){o.info("tipTouchStartListen"),(0,a.setTipPosition)({showTips:!1,obj:0,message:0,havCopy:!1,havWithdraw:!1})}Object.defineProperty(t,"__esModule",{value:!0}),t.tipLiten=void 0;var a=r(636),o=coreLogger.getLogger("logic")("IM/recentChatKeyboard");t.tipLiten=function(){!coreCommon.isIos()&&delegate.$getUmEditor().isFocus()&&delegate.$getUmEditor().blur(),window.addEventListener("touchstart",n)}},1921:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dealCopy=void 0;var n=r(1020),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(n),o=coreLogger.getLogger("logic")("IM/dealCopy");t.dealCopy=function(e){o.info("dealCopy 执行复制操作");var t=e.show_text.replace(new RegExp("&lt;","gm"),"<").replace(new RegExp("&gt;","gm"),">");appService.doCopy(null,t),document.execCommand("Copy"),a.setTipPosition({showTips:!1,obj:0,message:0,havCopy:!1,havWithdraw:!1})}},1922:function(e,t,r){"use strict"},1923:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.addAvatarDownloadAckFunc=t.addAvatarDownloadFunc=t.clearModalFocusFunc=t.getModalFocusFunc=t.setModalFocusFunc=void 0;var a=r(1028),o=n(a),s=r(1026),i=n(s),u=r(1027),c=n(u);t.setModalFocusFunc=o.default.setModalFocusFunc,t.getModalFocusFunc=o.default.getModalFocusFunc,t.clearModalFocusFunc=o.default.clearModalFocusFunc,t.addAvatarDownloadFunc=i.default.addAvatarDownloadFunc,t.addAvatarDownloadAckFunc=c.default.addAvatarDownloadAckFunc},1924:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}var a=r(1),o=n(a),s=r(2),i=n(s),u=function(){var e=(0,i.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.code){e.next=11;break}e.t0=t.event,e.next="uportal"===e.t0?4:"eserver"===e.t0?7:"total"===e.t0?8:10;break;case 4:return window.dispatchEvent(new Event("umServerNotLogin")),coreAccount.getLoginModel().then(function(){var e=(0,i.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.useIM){e.next=3;break}return e.next=3,(0,l.loadLocalRecentList)();case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),e.abrupt("break",11);case 7:return e.abrupt("break",11);case 8:return coreAccount.getLoginModel().then(function(){var e=(0,i.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.useIM){e.next=11;break}if(g.info("<account_login><6_eserver>begin"),!t.resume){e.next=7;break}return e.next=5,(0,f.resumeToeServer)("loginNotify total");case 5:e.next=10;break;case 7:return e.next=9,(0,d.loginToeServer)();case 9:coreIm.setEServerResumeAble({flag:!0});case 10:g.info("<account_login><6_eserver>end");case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),e.abrupt("break",11);case 10:return e.abrupt("break",11);case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),c=function(){var e=(0,i.default)(o.default.mark(function e(t){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.event,e.next="groupInfoDelete"===e.t0?3:7;break;case 3:return r=t.data,e.next=6,(0,p.dealRecentByDeleteGroup)(r);case 6:case 7:return e.abrupt("break",8);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),l=r(642),d=r(1029),f=r(360),p=r(217),g=coreLogger.getLogger("logic")("im/moduleMessenger");coreCommon.registeModuleListener("login",u),coreCommon.registeModuleListener("group",c)},1925:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.setServerAddressAndNetMode=t.preLogin=void 0;var a=r(1),o=n(a),s=r(2),i=n(s),u=r(833),c=(t.preLogin=function(){var e=(0,i.default)(o.default.mark(function e(t){var r,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=arguments[2];return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=s?u.printEServerResumeLog:u.printEServerLog,a+=" preLogin",r(t,a,"3 preLogin start"),coreUt.utEventStart({eventId:constant.EVENT_ID.UT_LOGIN,extraTrackKey:constant.UT_LOGIN_SERVER_NAME.UT_ESERVER_SERVER,params:[constant.UT_LOGIN_SERVER_NAME.UT_ESERVER_SERVER]}),e.next=6,coreTup.getIMInstance();case 6:return n=e.sent,e.next=9,n.setImErrorEvent({onImErrorDeals:function(e){var t=e.param;coreUt.utHandleServerError({isLocalError:t.isLocalError,requestId:t.requestId,serverName:t.serverName,serverApiName:t.serverApiName,errorCode:t.errorCode,errorDescription:t.errorDescription})}});case 9:return e.next=11,n.setdispatchmessage(0);case 11:return e.next=13,c(t,a,r);case 13:return e.abrupt("return",e.sent);case 14:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.setServerAddressAndNetMode=function(){var e=(0,i.default)(o.default.mark(function e(t,r,n){var a,s,i,u,c,l,d,f,p;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,coreTup.getIMInstance();case 2:return a=e.sent,e.next=5,coreAccount.getLoginModel();case 5:return s=e.sent,i=s.eServerAddress,u=s.eServerPort,c=s.maaProxyAddress,l=s.maaProxyPort,d=s.socketMode,n(t,r,"3 preLogin socketMode is "+d+", 0.no stg; 1.stg; 2.tls"),e.next=14,a.setNetAccessMode(0);case 14:if((f=e.sent)&&0===f.result){e.next=18;break}return n(t,r,"3 preLogin setNetAccessMode 1 is error"),e.abrupt("return",!1);case 18:return d===constant.IM_STG_MODE.USE_TLS&&(i=c,u=l),e.next=21,a.setserveraddress(i,1*u);case 21:if((f=e.sent)&&0===f.result){e.next=25;break}return n(t,r,"3 preLogin setserveraddress 1 is error"),e.abrupt("return",!1);case 25:return e.next=27,a.setNetAccessMode(d);case 27:if((f=e.sent)&&0===f.result){e.next=31;break}return n(t,r,"3 preLogin setNetAccessMode 2 is error"),e.abrupt("return",!1);case 31:if(d!==constant.IM_STG_MODE.USE_TLS){e.next=40;break}return p={tls_verision:4,tls_verify_mode:$getState().login.isSupportCACertCheck?0:1,root_cert_path:window.EXEC_PATH,client_cert_path:"",client_key_path:"",client_privkey_pwd:""},n(t,r,"3 preLogin,tls_verify_mode is "+p.tls_verify_mode),e.next=36,a.setTlsParam(p);case 36:if((f=e.sent)&&0===f.result){e.next=40;break}return n(t,r,"3 preLogin setTlsParam is error"),e.abrupt("return",!1);case 40:return e.next=42,a.setserveraddress(i,1*u);case 42:if((f=e.sent)&&0===f.result){e.next=46;break}return n(t,r,"3 preLogin setserveraddress 2 is error"),e.abrupt("return",!1);case 46:return n(t,r,"3 preLogin success"),e.abrupt("return",!0);case 48:case"end":return e.stop()}},e,void 0)}));return function(t,r,n){return e.apply(this,arguments)}}())},1926:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.registerEvent=void 0;var a=r(139),o=n(a),s=r(1),i=n(s),u=r(2),c=n(u),l=r(1927),d=r(1031),f=r(1032),p=coreLogger.getLogger("im")("register"),g=coreLogger.getDataLogger("im")("register");t.registerEvent=function(){var e=(0,c.default)(i.default.mark(function e(){var t;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,p.info("registerEvent"),e.next=4,coreTup.getIMInstance();case 4:return t=e.sent,window.imService=t,e.next=8,coreIm.localTimeService.startLocalTimeService();case 8:return e.next=10,t.setBasicImEvent({onHeartBeat:function(e){p.debug("onHeartBeat",e),(0,f.startHeartBeatDeal)("onHeartBeat")},onKickOut:l.dealKickOut,onLogout:function(e){p.debug("onLogout",e),p.info("onLogout")},onMultiDevice:function(e){p.debug("onMultiDevice",e),coreAccount.handleMultiDeviceMsg(e)},onGeneral:function(e){p.debug("onGeneral",e),e.param&&2===e.param.flag&&window.dispatchEvent(new Event(constant.RESUME_EVENT.SESSION_TIMEOUT))},onTlsStateChange:function(){p.debug("onTlsStateChange"),window.dispatchEvent(new Event("tlsStateChange"))},onAddFriend:function(e){p.debug("onAddFriend",e)},onUserStatusList:function(e){if(coreCommon.isPc()){p.debug("onUserStatusList",e);var t=e.param.userstatus_list;t&&(t.forEach(function(e){g.info("status change, origin: "+e.origin+"; status: "+e.status+"; desc :"+e.desc+"; client_desc :"+e.client_desc+"; client_type :"+e.client_type)}),(0,d.getStatusUpdateTaskQueue)().addTaskData(t))}},onUserInfoChange:function(e){p.debug("onUserInfoChange",e),coreContact.dealUserInfoChange(e)},userInfoOprNotify:function(e){p.debug("userInfoOprNotify",e),coreContact.dealUserInfoOprNotify(e)},onCodeChat:function(){var e=(0,c.default)(i.default.mark(function e(t){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:p.debug("onCodeChat",t),coreIm.dealCodeChat(t);case 2:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),onChatList:function(e){p.debug("onChatList",(0,o.default)({},e)),coreIm.dealChatList(e)},onMsgSendAck:function(e){p.debug("onMsgSendAck",e),coreIm.dealSendMessageAck(e)},onUnDeliver:function(e){p.debug("onUnDeliver 消息未送达",e)},onMsgRead:function(e){p.debug("onMsgRead",e),coreIm.dealMsgRead(e)},onWithdrawNotify:function(e){p.debug("onWithdrawNotify",e),coreIm.dealWithdrawMessageNotify(e)},onWithdrawAck:function(e){p.debug("onWithdrawAck",e),coreIm.dealWithdrawMessageAck(e)},onSystemBulletin:function(e){p.debug("onSystemBulletin",e),coreIm.dealSystemBulletinMessage(e)},onOprCommand:function(e){if(coreCommon.isHuaweiCloudWeLink()){var t=JSON.parse(e.param.body);3===t.oprType&&coreIm.dealPublicMarkMessage(t.oprContext)}},onTopRecentConversation:function(e){p.debug("onTopRecentConversation",e),coreCommon.isHuaweiCloudWeLink()&&coreIm.dealTopRecentConversation(e)}});case 10:return e.next=12,coreGroup.setGroupNotify();case 12:return e.next=14,t.setdispatchmessage(1);case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),p.error("registerEvent",e.t0.toString());case 19:case"end":return e.stop()}},e,void 0,[[0,16]])}));return function(){return e.apply(this,arguments)}}()},1927:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.dealKickOut=void 0;var a=r(1),o=n(a),s=r(2),i=n(s),u=coreLogger.getLogger("im")("dealKickOut"),c=(t.dealKickOut=function(e){if(u.info("dealKickOut"),"function"==typeof window.isJudgeDialogExist&&window.isJudgeDialogExist(language.LOGIN_LOGGEDON_ANOTHER))return void u.info("imKickOut, has exit alert");coreIm.setEServerResumeAble({flag:!1}),coreAccount.clearResumeService(),coreAccount.stopResume("dealKickOut"),coreAccount.checkAndEndCall().then(function(){coreAccount.setOffline({cancelAutoLogin:!1,isShowAlert:!1}),window.endCallPromise&&(window.endCallPromise=null)}).then(function(){var t=this;if(!window.CLIENTCONFIG.ISBIGWIN){if(window.isPluginEnv)return void coreAccount.clearState().then(function(){coreCommon.dispatchModuleEvent("eServerKickOut",e)});window.CLIENTCONFIG.ISMOBILE||(appService.showMainWindow(!0),window.setMainSize());var r=window.CLIENTCONFIG.ISMOBILE?"loginCtn":"login";switch(e.param.exit_flag){case 0:alert(language.LOGIN_LOGGEDON_ANOTHER).then(function(){var e=(0,i.default)(o.default.mark(function e(n){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n.ret&&coreAccount.clearState().then(function(){c(r)});case 1:case"end":return e.stop()}},e,t)}));return function(t){return e.apply(this,arguments)}}());break;case 2:alert(language.LOGIN_LOGGEDON_PAUSEOFFLINE).then(function(){var e=(0,i.default)(o.default.mark(function e(n){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n.ret&&coreAccount.clearState().then(function(){c(r)});case 1:case"end":return e.stop()}},e,t)}));return function(t){return e.apply(this,arguments)}}());break;default:alert(language.LOGIN_LOGGEDON_OVERDUEOFFLINE).then(function(){var e=(0,i.default)(o.default.mark(function e(n){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n.ret&&coreAccount.clearState().then(function(){c(r)});case 1:case"end":return e.stop()}},e,t)}));return function(t){return e.apply(this,arguments)}}())}}})},function(){var e=(0,i.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,coreAccount.changeAutoLogin();case 2:window.goRoute(t);case 3:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}())},1928:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.ImImpl=t.getImApi=void 0;var a=r(1),o=n(a),s=r(2),i=n(s),u=r(131),c=n(u),l=r(4),d=n(l),f=r(132),p=n(f),g=r(133),_=n(g),h=r(1929),v=n(h),m=r(1930),M=r(1931),y=r(360),E=r(1932),S=r(1933),I=r(824),w=r(831),T=r(1936),b=r(1031),L=r(830),O=r(1937),N=r(1017),R=r(1938),x=r(1011),A=n(x),C=r(978),k=coreLogger.getLogger("Im")("impl"),P=void 0,F=(t.getImApi=function(){return P=new F},t.ImImpl=function(e){function t(){var e,r,n,a,s=this;(0,d.default)(this,t);for(var u=arguments.length,l=Array(u),f=0;f<u;f++)l[f]=arguments[f];return r=n=(0,p.default)(this,(e=t.__proto__||(0,c.default)(t)).call.apply(e,[this].concat(l))),n.checkEserverOnline=function(e){var t=n.onlyCheckEServerOnline("checkEserverOnline "+e);return t||(k.info("checkEserverOnline  eserver is offline",e),window.ToastNew(language.OFFLINE_STATUS),window.dispatchEvent(new Event("eServerNotLogin"))),t},n.checkEServerOnlineNoToast=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=n.onlyCheckEServerOnline("checkEServerOnlineNoToast "+e);return t||(k.info("checkEServerOnlineNoToast  eserver is offline",e),window.dispatchEvent(new Event("eServerNotLogin"))),t},n.eserverLogout=function(){return(0,m.eserverLogout)()},n.kickPCOut=function(){return(0,M.kickPCOut)()},n.publishStatusToServer=function(e){var t=e.status,r=e.desc;if(n.checkEServerOnlineNoToast("publishStatusToServer"))return r&&(r=r.toString()),(0,E.publishStatusToServer)({status:t,desc:r})},n.setUserInfo=function(e){return(0,E.setUserInfo)(e)},n.checkEServerIsOnline=function(){return(0,y.checkEServerIsOnline)()},n.detectEServerOnline=function(e){var t=n.onlyCheckEServerOnline("detectEServerOnline "+e);return t||(k.info("detectEServerOnline eserver is offline",e),(0,y.setEServerOffline)("detectEServerOnline")),t},n.onlyCheckEServerOnline=function(e){if(!window.CLIENTCONFIG.USE_IM)return k.info("onlyCheckEServerOnline, Currently under TE mode, mistakenly trigered eserver interface",e),!1;var t=coreAccount.getSyncLoginModel();if(t.isBuildStgSuc||t.socketMode!==constant.IM_STG_MODE.USE_STG){if(window.isEserverOnline)return!0}else k.info("onlyCheckEServerOnline, socketMode is USE_STG,but isBuildStgSuc is false",e);return k.info("onlyCheckEServerOnline eserver is offline",e),!1},n.setEServerResumeAble=function(e){var t=e.flag;return(0,y.setEServerResumeAble)(t)},n.setEServerOffline=function(){var e=(0,i.default)(o.default.mark(function e(t){var r=t.info;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,y.setEServerOffline)(r));case 1:case"end":return e.stop()}},e,s)}));return function(t){return e.apply(this,arguments)}}(),n.openOrCreateRecent=function(){var e=(0,i.default)(o.default.mark(function e(t){var r=t.owner,n=t.chat_type;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,S.openOrCreateRecent)(r,n));case 1:case"end":return e.stop()}},e,s)}));return function(t){return e.apply(this,arguments)}}(),n.getRealFilePath=function(e){var t=e.filePath;return k.debug("getRealFilePath",t),t?appService.getRealFilePath(t,$getState().login.account):t},n.imgForward=function(e){var t=e.messageId;return k.debug("imgForward",t),(0,I.imgForward)(t)},n.imgGoToMessage=function(e){var t=e.messageId;return k.debug("imgGoToMessage",t),(0,w.imgGoToMessage)(t)},n.checkEditorBeforeLogout=function(){var e=(0,i.default)(o.default.mark(function e(t){var r=t.showInfo,n=t.languageKey,a=t.isShowCloseBtn;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,T.checkEditorBeforeLogout)(r,n,a));case 1:case"end":return e.stop()}},e,s)}));return function(t){return e.apply(this,arguments)}}(),n.checkEditor=function(){var e=(0,i.default)(o.default.mark(function e(t){var r=t.showInfo,n=t.languageKey,a=t.isShowCloseBtn;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,T.checkEditor)(r,n,a));case 1:case"end":return e.stop()}},e,s)}));return function(t){return e.apply(this,arguments)}}(),n.checkFileTransFer=function(){var e=(0,i.default)(o.default.mark(function e(t){var r=t.showInfo,n=t.languageKey,a=t.isShowCloseBtn,i=t.isShowAlert;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,T.checkFileTransFer)(r,n,a,i));case 1:case"end":return e.stop()}},e,s)}));return function(t){return e.apply(this,arguments)}}(),n.saveTeamSpace=function(){var e=(0,i.default)(o.default.mark(function e(t){var r=t.file,n=t.message;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,N.saveTeamSpace)(r,n));case 1:case"end":return e.stop()}},e,s)}));return function(t){return e.apply(this,arguments)}}(),n.checkFileTransFerInRecent=function(){var e=(0,i.default)(o.default.mark(function e(t){var r=t.owner,n=t.showInfo;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,T.checkFileTransFerInRecent)(r,n));case 1:case"end":return e.stop()}},e,s)}));return function(t){return e.apply(this,arguments)}}(),n.initStatusUpdateTaskQueue=(0,i.default)(o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.initStatusUpdateTaskQueue)());case 1:case"end":return e.stop()}},e,s)})),n.UnReadMessageFlashSetting=function(){return A.default.getInstance()},n.subscribeRecentList=function(){var e=(0,i.default)(o.default.mark(function e(t){var r=t.recentList,n=void 0===r?[]:r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,L.subscribeRecentList)(n));case 1:case"end":return e.stop()}},e,s)}));return function(t){return e.apply(this,arguments)}}(),n.detectContactStatus=function(){var e=(0,i.default)(o.default.mark(function e(t){var r=t.accountList;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,O.detectContactStatus)(r));case 1:case"end":return e.stop()}},e,s)}));return function(t){return e.apply(this,arguments)}}(),n.autoTranslateByElement=function(){var e=(0,i.default)(o.default.mark(function e(t){var r=t.el,n=t.to,a=t.isEscapeScreenshot,i=t.isEscapeAtText,u=t.isEscapeLink;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,R.autoTranslateByElement)({el:r,to:n,isEscapeScreenshot:a,isEscapeAtText:i,isEscapeLink:u}));case 1:case"end":return e.stop()}},e,s)}));return function(t){return e.apply(this,arguments)}}(),n.getKnowledUrlCode=(0,i.default)(o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.getKnowledUrlCode)());case 1:case"end":return e.stop()}},e,s)})),a=r,(0,p.default)(n,a)}return(0,_.default)(t,e),t}(v.default))},1929:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(1),o=n(a),s=r(2),i=n(s),u=r(131),c=n(u),l=r(4),d=n(l),f=r(132),p=n(f),g=r(133),_=n(g),h=function(e){function t(){var e,r,n,a,s=this;(0,d.default)(this,t);for(var u=arguments.length,l=Array(u),f=0;f<u;f++)l[f]=arguments[f];return r=n=(0,p.default)(this,(e=t.__proto__||(0,c.default)(t)).call.apply(e,[this].concat(l))),n.checkEserverOnline=function(e){},n.eserverLogout=function(){},n.kickPCOut=function(){},n.publishStatusToServer=function(e){e.status,e.desc},n.setUserInfo=function(e){},n.checkEServerIsOnline=function(){},n.checkEServerOnlineNoToast=function(e){},n.detectEServerOnline=function(e){},n.onlyCheckEServerOnline=function(e){},n.setEServerResumeAble=function(e){e.flag},n.setEServerNetworkIsOk=function(e){e.flag,e.info},n.setEServerOffline=function(e){e.info},n.openOrCreateRecent=function(){var e=(0,i.default)(o.default.mark(function e(t){t.account,t.type;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,s)}));return function(t){return e.apply(this,arguments)}}(),n.getRealFilePath=function(e){e.filePath},n.imgForward=function(e){e.messageId},n.imgGoToMessage=function(e){e.messageId},n.checkEditorBeforeLogout=function(){var e=(0,i.default)(o.default.mark(function e(t){t.showInfo,t.languageKey,t.isShowCloseBtn;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,s)}));return function(t){return e.apply(this,arguments)}}(),n.checkEditor=function(){var e=(0,i.default)(o.default.mark(function e(t){t.showInfo,t.languageKey,t.isShowCloseBtn;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,s)}));return function(t){return e.apply(this,arguments)}}(),n.checkFileTransFer=function(){var e=(0,i.default)(o.default.mark(function e(t){t.showInfo,t.languageKey,t.isShowCloseBtn,t.isShowAlert;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,s)}));return function(t){return e.apply(this,arguments)}}(),n.saveTeamSpace=function(){var e=(0,i.default)(o.default.mark(function e(t){t.file,t.message;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,s)}));return function(t){return e.apply(this,arguments)}}(),n.checkFileTransFerInRecent=function(){var e=(0,i.default)(o.default.mark(function e(t){t.owner,t.showInfo;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,s)}));return function(t){return e.apply(this,arguments)}}(),n.initStatusUpdateTaskQueue=(0,i.default)(o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,s)})),n.UnReadMessageFlashSetting=(0,i.default)(o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,s)})),n.subscribeRecentList=function(){var e=(0,i.default)(o.default.mark(function e(t){t.recentList;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,s)}));return function(t){return e.apply(this,arguments)}}(),n.detectContactStatus=function(){var e=(0,i.default)(o.default.mark(function e(t){t.accountList;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,s)}));return function(t){return e.apply(this,arguments)}}(),n.autoTranslateByElement=function(){var e=(0,i.default)(o.default.mark(function e(t){t.el,t.to,t.isEscapeScreenshot,t.isEscapeAtText,t.isEscapeLink;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,s)}));return function(t){return e.apply(this,arguments)}}(),n.getKnowledUrlCode=(0,i.default)(o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,s)})),a=r,(0,p.default)(n,a)}return(0,_.default)(t,e),t}(coreCommon.Interface);t.default=h},1930:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.eserverLogout=void 0;var a=r(1),o=n(a),s=r(2),i=n(s),u=r(360),c=coreLogger.getLogger("im")("login"),l=coreLogger.getDataLogger("im")("login");t.eserverLogout=function(){var e=(0,i.default)(o.default.mark(function e(){var t;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(c.info("eserver logout"),!window.isEserverOnline){e.next=10;break}return e.next=4,coreTup.getIMInstance();case 4:return t=e.sent,e.next=7,t.logout();case 7:(0,u.setEServerOffline)("eserverLogout"),coreIm.setEServerResumeAble({flag:!1}),l.info("ecs logout");case 10:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}}()},1931:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.kickPCOut=void 0;var a=r(1),o=n(a),s=r(3),i=n(s),u=r(2),c=n(u),l=r(228),d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(l),f=coreLogger.getLogger("im")("login");t.kickPCOut=function(){var e=(0,c.default)(o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.CLIENTCONFIG.ISMOBILE){e.next=4;break}return f.info("handle kick pc out"),setTimeout(function(){return i.default.resolve({result:1})},5e3),e.abrupt("return",d.kickOut());case 4:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}}()},1932:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.setUserInfo=t.publishStatusToServer=void 0;var a=r(1),o=n(a),s=r(2),i=n(s),u=coreLogger.getLogger("im")("eserver/status");t.publishStatusToServer=function(){var e=(0,i.default)(o.default.mark(function e(t){var r,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,u.info("publishStatusToServer"),e.next=4,coreTup.getIMInstance();case 4:return r=e.sent,e.next=7,r.publishstatus(t);case 7:return n=e.sent,e.abrupt("return",n);case 11:e.prev=11,e.t0=e.catch(0),u.error("publishStatusToServer",e.t0.toString());case 14:case"end":return e.stop()}},e,void 0,[[0,11]])}));return function(t){return e.apply(this,arguments)}}(),t.setUserInfo=function(){var e=(0,i.default)(o.default.mark(function e(t){var r,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,u.info("setUserInfo"),e.next=4,coreTup.getIMInstance();case 4:return r=e.sent,e.next=7,r.setuserinfo(t);case 7:return n=e.sent,e.abrupt("return",n);case 11:e.prev=11,e.t0=e.catch(0),u.error("setUserInfo",e.t0.toString());case 14:case"end":return e.stop()}},e,void 0,[[0,11]])}));return function(t){return e.apply(this,arguments)}}()},1933:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.openOrCreateRecent=t.createGroupRecent=t.createContactRecent=void 0;var n=r(1934);Object.defineProperty(t,"createContactRecent",{enumerable:!0,get:function(){return n.createContactRecent}});var a=r(1935);Object.defineProperty(t,"createGroupRecent",{enumerable:!0,get:function(){return a.createGroupRecent}});var o=coreLogger.getLogger("im")("recent/recentOpen");t.openOrCreateRecent=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;try{if(e){switch(t){case constant.CHAT_TYPE.SINGLE_CHAT:return o.info("openOrCreateRecent,open SINGLE_CHAT, chat_type = "+t),(0,n.openContactRecent)(e);case constant.CHAT_TYPE.GROUP_CHAT:case constant.CHAT_TYPE.DISCUSSION_GROUP:return o.info("openOrCreateRecent,open GROUP_CHAT, chat_type = "+t),(0,a.openGroupRecent)(e)}o.info("openOrCreateRecent,no recent chat_type open , chat_type = "+t)}else o.error("openOrCreateRecent, chat_type or owner is empty,chat_type = "+t)}catch(e){o.error("openOrCreateRecent,",t,e)}}},1934:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.createContactRecent=t.openContactRecent=void 0;var a=r(1),o=n(a),s=r(2),i=n(s),u=r(1033),c=coreLogger.getLogger("im")("recent/recentOpen"),l=(t.openContactRecent=function(){var e=(0,i.default)(o.default.mark(function e(t){var r,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,c.info("openContactRecent"),window.CLIENTCONFIG.USE_IM){e.next=5;break}return c.info("openContactRecent,now is not UC env"),e.abrupt("return");case 5:if(!t){e.next=18;break}return e.next=8,coreContact.getContactByAccount(t);case 8:if(r=e.sent){e.next=12;break}return c.info("openContactRecent,contact info is null"),e.abrupt("return");case 12:return window.CLIENTCONFIG.ISMOBILE||coreCommon.switchNav("recent"),e.next=15,l(r);case 15:return n=e.sent,isNullOrEmpty(n)?c.error("openContactRecent recent is invalid:",n):coreIm.openRecentConversation(n),e.abrupt("return",n);case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(0),c.error("openContactRecent error:",e.t0);case 23:case"end":return e.stop()}},e,void 0,[[0,20]])}));return function(t){return e.apply(this,arguments)}}(),t.createContactRecent=function(){var e=(0,i.default)(o.default.mark(function e(t){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,c.info("createContactRecent"),e.next=4,(0,u.createOrUpdateRecent)({contact:t},null,r,n);case 4:return e.abrupt("return",e.sent);case 7:e.prev=7,e.t0=e.catch(0),c.error("createContactRecent",e.t0);case 10:case"end":return e.stop()}},e,void 0,[[0,7]])}));return function(t){return e.apply(this,arguments)}}())},1935:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.createGroupRecent=t.openGroupRecent=void 0;var a=r(1),o=n(a),s=r(2),i=n(s),u=r(1033),c=coreLogger.getLogger("im")("recent/recentOpen"),l=(t.openGroupRecent=function(){var e=(0,i.default)(o.default.mark(function e(t){var r,n,a;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,window.CLIENTCONFIG.USE_IM){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,l(t);case 5:if(r=e.sent,n=r.recent,a=r.group,c.info("openGroupRecent"),!a||!a.group_id){e.next=16;break}if(window.CLIENTCONFIG.ISMOBILE){e.next=13;break}return e.next=13,coreCommon.switchNav("recent");case 13:coreIm.openRecentConversation(n),e.next=17;break;case 16:c.error("openGroupRecent,group info is null or Empty");case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(0),c.error("openGroupRecent",e.t0);case 22:case"end":return e.stop()}},e,void 0,[[0,19]])}));return function(t){return e.apply(this,arguments)}}(),t.createGroupRecent=function(){var e=(0,i.default)(o.default.mark(function e(t){var r,n,a=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,coreGroup.getGroupInfoFromDB(t);case 3:if(r=e.sent,!isNullOrEmpty(r)){e.next=7;break}return c.error("createGroupRecent get group from db fail"),e.abrupt("return",{});case 7:return c.info("createGroupRecent"),e.next=10,(0,u.createOrUpdateRecent)({group:r},null,a,s);case 10:return n=e.sent,e.abrupt("return",{recent:n,group:r});case 14:e.prev=14,e.t0=e.catch(0),c.error("createGroupRecent",e.t0);case 17:case"end":return e.stop()}},e,void 0,[[0,14]])}));return function(t){return e.apply(this,arguments)}}())},1936:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.checkFileTransFerInRecent=t.checkFileTransFer=t.checkEditorBeforeLogout=t.checkEditor=void 0;var a=r(1),o=n(a),s=r(2),i=n(s),u=r(182),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(u),l=r(304),d=coreLogger.getLogger("logic")("IM/异常检查处理");t.checkEditor=function(){var e=(0,i.default)(o.default.mark(function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"LANG_NATIVE_CONFIRM_TITLE",a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,d.info("checkEditor"),!coreCommon.hasEditorContent()){e.next=7;break}return e.next=5,window.confirm(t,n,a);case 5:return r=e.sent,e.abrupt("return",r.ret);case 7:return e.abrupt("return",!0);case 10:return e.prev=10,e.t0=e.catch(0),d.error("checkEditor check异常，强制通过",e.t0.toString()),e.abrupt("return",!0);case 14:case"end":return e.stop()}},e,void 0,[[0,10]])}));return function(t){return e.apply(this,arguments)}}(),t.checkEditorBeforeLogout=function(){var e=(0,i.default)(o.default.mark(function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"LANG_NATIVE_CONFIRM_TITLE",a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,d.info("checkEditorBeforeLogout"),!coreCommon.hasEditorContent()){e.next=8;break}return e.next=5,window.confirm(t,n,a);case 5:return r=e.sent,r.ret&&(delegate.$getUmEditor=null),e.abrupt("return",r.ret);case 8:return e.abrupt("return",!0);case 11:return e.prev=11,e.t0=e.catch(0),d.error("checkEditor check异常，强制通过",e.t0.toString()),e.abrupt("return",!0);case 15:case"end":return e.stop()}},e,void 0,[[0,11]])}));return function(t){return e.apply(this,arguments)}}(),t.checkFileTransFer=function(){var e=(0,i.default)(o.default.mark(function e(t){var r,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"LANG_NATIVE_CONFIRM_TITLE",s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,d.info("checkFileTransFer"),r=c.getFileHandleMap(),!isNullOrEmpty(r)){e.next=6;break}return d.info("checkFileTransFer 没有正在传输的文件"),e.abrupt("return",!0);case 6:if(d.debug("checkFileTransFer",r),n=void 0,!i){e.next=14;break}return e.next=11,window.confirm(t,a,s);case 11:n=e.sent,e.next=15;break;case 14:n={ret:!0};case 15:if(!n.ret){e.next=19;break}return e.next=18,coreIm.stopAllFileReceive(r);case 18:c.initFileHandleMap();case 19:return e.abrupt("return",n);case 22:return e.prev=22,e.t0=e.catch(0),d.error("checkFileTransFer  check异常，强制通过",e.t0.toString()),c.initFileHandleMap(),e.abrupt("return",!0);case 27:case"end":return e.stop()}},e,void 0,[[0,22]])}));return function(t){return e.apply(this,arguments)}}(),t.checkFileTransFerInRecent=function(){var e=(0,i.default)(o.default.mark(function e(t,r){var n,a,s,i;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,l.checkFileTransferInCurrentRecent)(t);case 3:if(n=e.sent,a={ret:!0},s="LANG_NATIVE_CONFIRM_TITLE",i=!0,!n){e.next=11;break}return e.next=10,window.confirm(r,s,i);case 10:a=e.sent;case 11:return e.abrupt("return",a);case 14:return e.prev=14,e.t0=e.catch(0),d.error("checkFileTransFerInRecent  check异常，强制通过",e.t0.toString()),e.abrupt("return",{ret:!0});case 18:case"end":return e.stop()}},e,void 0,[[0,14]])}));return function(t,r){return e.apply(this,arguments)}}()},1937:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.detectContactStatus=void 0;var a=r(1),o=n(a),s=r(142),i=n(s),u=r(2),c=n(u),l=coreLogger.getLogger("im")("userStatus"),d=[],f=null,p=(t.detectContactStatus=function(){var e=(0,c.default)(o.default.mark(function e(t){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.CLIENTCONFIG.ENABLE_IT_MEETING&&window.isEserverOnline){e.next=2;break}return e.abrupt("return");case 2:try{f&&clearInterval(f),r=[],t.length>0&&(r=t.map(function(e){return{account:e}})),d=d.concat(r),d.length>20?d=[]:f=setTimeout(function(){d.length>0&&p({account_list:[].concat((0,i.default)(d))}),d=[]},200)}catch(e){l.error("detectContactStatus",e)}case 3:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),function(){var e=(0,c.default)(o.default.mark(function e(t){var r,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,l.info("detectUserStatus"),window.isEserverOnline){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,coreTup.getIMInstance();case 6:return r=e.sent,e.next=9,r.detectuserstatus(t);case 9:return n=e.sent,e.abrupt("return",n);case 13:e.prev=13,e.t0=e.catch(0),l.error("detectUserStatus",e.t0.toString());case 16:case"end":return e.stop()}},e,void 0,[[0,13]])}));return function(t){return e.apply(this,arguments)}}())},1938:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.autoTranslateByElement=t.detectLanguage=t.getTranslateLanguages=void 0;var a=r(3),o=n(a),s=r(69),i=n(s),u=r(155),c=n(u),l=r(1),d=n(l),f=r(135),p=n(f),g=r(2),_=n(g),h=coreLogger.getLogger("logic")("translate"),v=null,m=function(e){var t=/[^\x00-\xff]+$/,r=e.match(/[\x00-\xff]/g);return t.test(e)||isNullOrEmpty(r)?2*e.length:2*e.length-r.length},M=function(e,t){for(var r=0,n="",a=/[^\x00-\xff]/g,o="",s=e.replace(a,"**").length,i=0;i<s&&(o=e.charAt(i).toString(),null!==o.match(a)?r+=2:r++,!(r>t));i++)n+=o;return n},y=function(){var e=(0,_.default)(d.default.mark(function e(t){var r,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(v){e.next=4;break}return e.next=3,coreAccount.getLoginModel();case 3:v=e.sent;case 4:return r={url:t,type:a.type,header:a.headers||"",body:a.body||"",cipherlist:[50331695,50331701,50331708,50331709]},e.next=7,coreHttp.sendSyncRequest(r);case 7:if(n=e.sent,200!==n.param.resp_code){e.next=12;break}return e.abrupt("return",{result:0,data:JSON.parse(n.param.recv_body)});case 12:return e.abrupt("return",(0,p.default)({},n,{result:1}));case 13:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),E=function(){var e=(0,_.default)(d.default.mark(function e(t,r,n){var a;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y(t,{type:constant.REQUEST_TYPE.POST,headers:n,body:"object"===(void 0===r?"undefined":(0,c.default)(r))?(0,i.default)(r):r});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}},e,void 0)}));return function(t,r,n){return e.apply(this,arguments)}}(),S=function(){var e=(0,_.default)(d.default.mark(function e(t,r,n){var a;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y(t,{type:constant.REQUEST_TYPE.GET,headers:n,body:"object"===(void 0===r?"undefined":(0,c.default)(r))?(0,i.default)(r):r});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}},e,void 0)}));return function(t,r,n){return e.apply(this,arguments)}}(),I=function(e){return(0,p.default)({"Content-Type":"application/json"},{Cookie:"token="+e})},w=function(){var e=(0,_.default)(d.default.mark(function e(t){var r,n,a,s,i,u,c,l,f,g,_,y,S,w,T,b,L,O,N,R,x;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!isNullOrEmpty(t)&&Object.type(t)===Object.type.OBJECT){e.next=3;break}return e.abrupt("return",{result:1,data:"arguments error"});case 3:if(v){e.next=7;break}return e.next=6,coreAccount.getLoginModel();case 6:v=e.sent;case 7:if(r="https://"+v.middleEndAddress+"/mcloud/mag/ProxyForText/translate_text",n=v.crypt_token,a=I(n),s=r+"/client/translate/text/translate",i=3e3,u=[],c="",l="",f=t.text,g=m(f),_=parseInt(g/i)+(g%i==0?0:1),h.info("translateText text length:",g),!(g>i)){e.next=37;break}for(y=0;y<_;y++)S="",S=0===u.length?M(f,i):M(c,i),l+=S,c=f.slice(l.length),u.push(E(s,(0,p.default)({},t,{text:S}),a));return e.next=18,o.default.all(u);case 18:w=e.sent,T=null,b=0;case 21:if(!(b<w.length)){e.next=34;break}if(L=w[b],0===L.result&&!isNullOrEmpty(L.data)){e.next=27;break}return e.abrupt("return",{result:1});case 27:if(O=L.data.translates,200===Number(O.code)){e.next=30;break}return e.abrupt("return",{result:1});case 30:isNullOrEmpty(T)?T=(0,p.default)({},T,O):(N=""+T.message+O.message,T=(0,p.default)({},T,{message:N}));case 31:b++,e.next=21;break;case 34:return e.abrupt("return",{result:0,data:T});case 37:return e.next=39,E(s,t,a);case 39:if(R=e.sent,0===R.result&&!isNullOrEmpty(R.data)){e.next=44;break}return e.abrupt("return",{result:1});case 44:if(x=R.data.translates,200===Number(x.code)){e.next=47;break}return e.abrupt("return",{result:1});case 47:return e.abrupt("return",{result:0,data:R.data.translates});case 48:e.next=54;break;case 50:return e.prev=50,e.t0=e.catch(0),h.error("translateText error:",e.t0.toString()),e.abrupt("return",{result:1});case 54:case"end":return e.stop()}},e,void 0,[[0,50]])}));return function(t){return e.apply(this,arguments)}}(),T=function(){var e=(0,_.default)(d.default.mark(function e(t){var r,n,a,s,i,u,c,l,f,g,_,M,y,S,T,b,L,O;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!isNullOrEmpty(t)&&Object.type(t)===Object.type.OBJECT){e.next=3;break}return e.abrupt("return",{result:1,data:"arguments error"});case 3:if(v){e.next=7;break}return e.next=6,coreAccount.getLoginModel();case 6:v=e.sent;case 7:if(r="https://"+v.middleEndAddress+"/mcloud/mag/ProxyForText/translate_text",n=v.crypt_token,a=I(n),s=t.texts,i=3e3,u=s.join(""),c=[],h.error("translateTextArray text length:",m(u)),!(m(u)>i)){e.next=44;break}for(l=0;l<s.length;l++)f=s[l],c.push(w({from:t.from,to:t.to,text:f}));return e.next=19,o.default.all(c);case 19:g=e.sent,_={},M=0;case 22:if(!(M<g.length)){e.next=41;break}if(y=g[M],0===y.result){e.next=28;break}return e.abrupt("return",{result:1});case 28:if(S=y.data,T=Number(S.code),!isNullOrEmpty(_)){e.next=33;break}_=(0,p.default)({},_,{code:T,message:[S.message],providerCn:S.providerCn,providerEn:S.providerEn}),e.next=38;break;case 33:if(Object.type(_.message)===Object.type.ARRAY){e.next=37;break}return e.abrupt("return",{result:1});case 37:_.message.push(S.message);case 38:M++,e.next=22;break;case 41:return e.abrupt("return",{result:0,data:_});case 44:return b=r+"/client/translate/text/array",e.next=47,E(b,t,a);case 47:if(L=e.sent,0===L.result&&!isNullOrEmpty(L.data)){e.next=52;break}return e.abrupt("return",{result:1});case 52:if(O=L.data.translate_array,200===Number(O.code)&&-1===O.statuses.indexOf(2)){e.next=57;break}return e.abrupt("return",{result:1});case 57:return e.abrupt("return",{result:0,data:O});case 58:e.next=64;break;case 60:return e.prev=60,e.t0=e.catch(0),h.error("translateTextArray error:",e.t0.toString()),e.abrupt("return",{result:1});case 64:case"end":return e.stop()}},e,void 0,[[0,60]])}));return function(t){return e.apply(this,arguments)}}();t.getTranslateLanguages=function(){var e=(0,_.default)(d.default.mark(function e(){var t,r,n,a,o,s,i,u,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"zh";return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,v){e.next=5;break}return e.next=4,coreAccount.getLoginModel();case 4:v=e.sent;case 5:return t=["zh","en","auto"],-1===t.indexOf(c)&&(c="zh"),r="https://"+v.middleEndAddress+"/mcloud/mag/ProxyForText/translate_text",n=v.crypt_token,a=I(n),o=r+"/client/translate/text/languages",s={displayLang:c},e.next=14,E(o,s,a);case 14:if(i=e.sent,h.info("getTranslateLanguages result:",i.result),0===i.result&&!isNullOrEmpty(i.data)){e.next=18;break}return e.abrupt("return",{result:1});case 18:if(u=i.data.translate_languages,200===Number(u.code)){e.next=23;break}return e.abrupt("return",{result:1});case 23:return e.abrupt("return",{result:0,data:u});case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(0),h.error("getTranslateLanguages error:",e.t0.toString());case 29:case"end":return e.stop()}},e,void 0,[[0,26]])}));return function(){return e.apply(this,arguments)}}(),t.detectLanguage=function(){var e=(0,_.default)(d.default.mark(function e(){var t,r,n,a,o,s,i,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,v){e.next=5;break}return e.next=4,coreAccount.getLoginModel();case 4:v=e.sent;case 5:return t="https://"+v.middleEndAddress+"/mcloud/mag/ProxyForText/translate_text",r=v.crypt_token,n=I(r),a=t+"/translate/text/client/translate/text/detect",o={content:u},e.next=12,S(a,o,n);case 12:if(s=e.sent,h.info("detectLanguage result:",s.result),0===s.result&&!isNullOrEmpty(s.data)){e.next=16;break}return e.abrupt("return",{result:1});case 16:if(i=s.data.translate_detect,200===Number(i.code)){e.next=21;break}return e.abrupt("return",{result:1});case 21:return e.abrupt("return",{result:0,data:i});case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(0),h.error("detectLanguage error:",e.t0.toString());case 27:case"end":return e.stop()}},e,void 0,[[0,24]])}));return function(){return e.apply(this,arguments)}}(),t.autoTranslateByElement=function(){var e=(0,_.default)(d.default.mark(function e(t){var r,n,a,o,s,i,u,c,l,f,p,g,_;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=t.el,n=t.to,a=t.isEscapeScreenshot,o=void 0===a||a,s=t.isEscapeAtText,i=void 0===s||s,u=t.isEscapeLink,c=void 0===u||u,l=coreUi.createTranslateArr(r,o,i,c),h.info("autoTranslateByElement createTranslateArr:",l.result),f={from:"",to:n,texts:l.translateArr},e.next=7,T(f);case 7:if(p=e.sent,h.info("autoTranslateByElement translateTextArray:",p.result),0===p.result){e.next=11;break}return e.abrupt("return",{result:1});case 11:return g=p.data.messages,_=l.sourceArr.map(function(e){if("string"==typeof e)return e;var t=g[e.index]||l.translateArr[e.index];return t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;"):""}).join(""),p.data.message=_,e.abrupt("return",p);case 17:return e.prev=17,e.t0=e.catch(0),h.error("autoTranslateByElement error:",e.t0.toString()),e.abrupt("return",{result:1});case 21:case"end":return e.stop()}},e,void 0,[[0,17]])}));return function(t){return e.apply(this,arguments)}}()},1939:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.UmImpl=t.getUmApi=void 0;var a=r(1),o=n(a),s=r(2),i=n(s),u=r(131),c=n(u),l=r(4),d=n(l),f=r(132),p=n(f),g=r(133),_=n(g),h=r(3),v=n(h),m=r(1940),M=n(m),y=r(1941),E=r(1945),S=r(832),I=coreLogger.getLogger("Um")("impl"),w=void 0,T=(t.getUmApi=function(){return isNullOrEmpty(w)&&(w=new O),w},null),b=new coreCommon.AtomicAction("umserverLoginAtomic",y.umserverLogin),L=function(){return b.wait().then(function(){return T=null,v.default.resolve()}).catch(function(){return T=null,v.default.reject()})};window.addEventListener("umServerNotLogin",function(){I.info("umServerNotLogin,reset umServerLoginAtomic"),T?I.info("umServerNotLogin,umServer is in login process,wait the result"):(I.info("umServerNotLogin,umServer is not in login process,do reset"),b.reset())});var O=t.UmImpl=function(e){function t(){var e,r,n,a,s=this;(0,d.default)(this,t);for(var u=arguments.length,l=Array(u),f=0;f<u;f++)l[f]=arguments[f];return r=n=(0,p.default)(this,(e=t.__proto__||(0,c.default)(t)).call.apply(e,[this].concat(l))),n.umserverLogin=function(){return T?T.then(function(){return T=L()}).catch(function(){return T=L()}):T=L()},n.umserverLogout=(0,i.default)(o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.reset();case 2:return e.abrupt("return",(0,E.umserverLogout)());case 3:case"end":return e.stop()}},e,s)})),n.uploadFile=function(e){return n.umserverLogin().then(function(){return(0,S.uploadFile)(e)}).catch(function(){return v.default.resolve(!1)})},n.downloadFile=function(){var e=(0,i.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.umserverLogin().then(function(){return(0,S.downloadFile)(t)}).catch(function(){return v.default.resolve(!1)}));case 1:case"end":return e.stop()}},e,s)}));return function(t){return e.apply(this,arguments)}}(),n.releaseFile=function(){var e=(0,i.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.umserverLogin().then(function(){return(0,S.releaseFile)(t)}).catch(function(){return v.default.resolve(!1)}));case 1:case"end":return e.stop()}},e,s)}));return function(t){return e.apply(this,arguments)}}(),n.deleteFile=function(){var e=(0,i.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.umserverLogin().then(function(){return(0,S.deleteFile)(t)}).catch(function(){return v.default.resolve(!1)}));case 1:case"end":return e.stop()}},e,s)}));return function(t){return e.apply(this,arguments)}}(),n.getCloudSpaceUrl=function(){var e=(0,i.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.umserverLogin().then(function(){return(0,S.getCloudSpaceUrl)(t)}).catch(function(){return v.default.resolve(!1)}));case 1:case"end":return e.stop()}},e,s)}));return function(t){return e.apply(this,arguments)}}(),n.getGroupSpaceUrl=function(){var e=(0,i.default)(o.default.mark(function e(t){var r=t.token,a=t.teamspaceId,i=t.groupId;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.umserverLogin().then(function(){return(0,S.getGroupSpaceUrl)(r,a,i)}).catch(function(){return v.default.resolve(!1)}));case 1:case"end":return e.stop()}},e,s)}));return function(t){return e.apply(this,arguments)}}(),n.umCopyFile=function(){var e=(0,i.default)(o.default.mark(function e(t){var r=t.group_space_id,a=t.file_id,i=t.from_group,u=t.owner_id,c=t.link_code,l=t.plain_access_code;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.umserverLogin().then(function(){return(0,S.umCopyFile)({group_space_id:r,file_id:a,from_group:i,owner_id:u,link_code:c,plain_access_code:l})}).catch(function(){return v.default.resolve(!1)}));case 1:case"end":return e.stop()}},e,s)}));return function(t){return e.apply(this,arguments)}}(),n.queryShareLinkInfo=function(){var e=(0,i.default)(o.default.mark(function e(t){var r=t.linkCode,a=t.accessCode;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",n.umserverLogin().then(function(){return(0,S.queryShareLinkInfo)({linkCode:r,accessCode:a})}).catch(function(){return v.default.resolve(!1)}));case 1:case"end":return e.stop()}},e,s)}));return function(t){return e.apply(this,arguments)}}(),a=r,(0,p.default)(n,a)}return(0,_.default)(t,e),t}(M.default)},1940:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=r(131),o=n(a),s=r(4),i=n(s),u=r(132),c=n(u),l=r(133),d=n(l),f=function(e){function t(){var e,r,n,a;(0,i.default)(this,t);for(var s=arguments.length,u=Array(s),l=0;l<s;l++)u[l]=arguments[l];return r=n=(0,c.default)(this,(e=t.__proto__||(0,o.default)(t)).call.apply(e,[this].concat(u))),n.umserverLogin=function(){},n.umserverLogout=function(){},n.uploadFile=function(e){},n.downloadFile=function(e){},n.releaseFile=function(e){},n.deleteFile=function(e){},n.getCloudSpaceUrl=function(e){},n.getGroupSpaceUrl=function(e){e.token,e.teamspaceId,e.groupId},n.umCopyFile=function(e){e.group_space_id,e.file_id,e.from_group,e.owner_id,e.link_code,e.plain_access_code},n.queryShareLinkInfo=function(e){e.linkCode,e.accessCode},a=r,(0,c.default)(n,a)}return(0,d.default)(t,e),t}(coreCommon.Interface);t.default=f},1941:function(e,t,r){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.umserverLogin=void 0;var a=r(158),o=n(a),s=r(1),i=n(s),u=r(2),c=n(u),l=r(1942),d=coreLogger.getLogger("logic")("login/umserver"),f=(t.umserverLogin=function(){var t=(0,c.default)(i.default.mark(function t(){var r,n,a,o,s,u,c,l,h,v,m,M,y,E,S,I,w,T,b,L,O,N,R,x,A,C,k;return i.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return d.info("umserverLogin"),t.next=3,coreAccount.getLoginModel();case 3:return r=t.sent,n=r.account,a=r.authToken,o=r.umHttpServerUri,s=r.umHttpsServerUri,u=r.isSupportCACertCheck,c=r.isSupportAS,l=r.crypt_token,h=r.isResume,v=new e(a,"base64").toString(),m=v,M=2,y=u?2:1,E=0,S="",I=1,o&&o.map||(o=[]),s&&s.map||(s=[]),w={server_url:o.map(function(e){return e.um_server_addr?{ui_host_port:0,host_ip:e.um_server_addr.split("://")[1].split(":")[0],pc_url:e.um_server_addr}:(d.error("umserverLogin umHttpServerUri is empty"),{ui_host_port:0,host_ip:e.um_server_addr,pc_url:e.um_server_addr})})||[],ul_cnt:1},T={server_url:s.map(function(e){return e.um_server_addr?{ui_host_port:0,host_ip:e.um_server_addr.split("://")[1].split(":")[0],pc_url:e.um_server_addr}:(d.error("umserverLogin umHttpsServerUri is empty"),{ui_host_port:0,host_ip:e.um_server_addr,pc_url:e.um_server_addr})})||[],ul_cnt:1},b=window.EXEC_PATH,d.info("caPath is:  "+b),t.next=19,p();case 19:return L=t.sent,O=coreIm.getOfflineFileConfig(),N="espace",R=void 0,x="",A="",!1===O?(d.info("umserverLogin, uportal is not send the config"),coreCommon.isHuaweiCloudWeLink()&&(coreIm.setUmServerFlag(!1),M=1,E=1,S=l||"")):(M=1,E=1,S=v,coreCommon.isHuaweiCloudWeLink()&&(S=l),coreIm.setUmServerFlag(!1),d.info("umserverLogin uportal下发云盘参数，使用该参数登录云盘"),N=O.onebox_app_id,R=O.onebox_server_addr,A=c&&"Huawei Meeting"===window.CLIENTCONFIG.NEW_APP_NAME?O.corp_id:"",x=c?"":"CloudEC",w={server_url:[{ui_host_port:0,host_ip:R,pc_url:"http://"+R}],ul_cnt:1},T={server_url:[{ui_host_port:0,host_ip:R,pc_url:"https://"+R}],ul_cnt:1},I=0),t.next=25,_();case 25:return C=t.sent,1===M&&(C.reverse_proxy_ip="",C.reverse_proxy_port=0),k={login_name:n,device_type:g(),kia_disabled:1,device_os:navigator.platform,device_sn:coreCommon.zip(window.CLIENTCONFIG.PLATFORM+window.localIp+navigator.platform),app_name:N,pass_word:m,access_token:S,login_type:"4",en_server_mode:M,local_ip:window.localIp,ca_cert_path:b,server_domain:x,en_tls_mode:y,is_sso_login:E,http_ser_list:w,https_ser_list:T,corp_id:A,reverse_proxy:C,proxy:L,part_trans:I},t.abrupt("return",f(k,h));case 29:case"end":return t.stop()}},t,void 0)}));return function(){return t.apply(this,arguments)}}(),function(){var e=(0,c.default)(i.default.mark(function e(t,r){var n,a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return d.info("loginUmServer"),coreUt.utEventStart({eventId:constant.EVENT_ID.UT_LOGIN,extraTrackKey:constant.UT_LOGIN_SERVER_NAME.UT_UMSERVER_SERVER,params:[constant.UT_LOGIN_SERVER_NAME.UT_UMSERVER_SERVER]}),e.next=4,coreTup.getOfflineFileInstance();case 4:return n=e.sent,e.next=7,n.setOfflineFileErrorNotifyEvent({onOfflineErrorNotify:function(e){var t=e.param;coreUt.utHandleServerError({isLocalError:t.isLocalError,requestId:t.requestId,serverName:t.serverName,serverApiName:t.serverApiName,errorCode:t.errorCode,errorDescription:t.errorDescription})}});case 7:return e.next=9,(0,l.register)();case 9:return e.next=11,n.login(t);case 11:if(a=e.sent,0!==a.result){e.next=18;break}return d.info("loginUmServer success ",{result:a.result,login_type:t.login_type,en_server_mode:t.en_server_mode}),coreUt.utEventFinish({eventId:constant.EVENT_ID.UT_LOGIN,extraTrackKey:constant.UT_LOGIN_SERVER_NAME.UT_UMSERVER_SERVER,resultParams:[1,r?1:0],isTrackTimeCosts:!0}),e.abrupt("return",coreCommon.ATOMIC_ACTION_RESULT.SUCCESS);case 18:return coreUt.utEventFinish({eventId:constant.EVENT_ID.UT_LOGIN,extraTrackKey:constant.UT_LOGIN_SERVER_NAME.UT_UMSERVER_SERVER,resultParams:[0,a.result,r?1:0],isTrackTimeCosts:!0}),d.error("loginUmServer failed ",{result:a.result,login_type:t.login_type,en_server_mode:t.en_server_mode}),e.abrupt("return",coreCommon.ATOMIC_ACTION_RESULT.FAILED);case 21:case"end":return e.stop()}},e,void 0)}));return function(t,r){return e.apply(this,arguments)}}()),p=function(){var e=(0,c.default)(i.default.mark(function e(){var t,r,n,a,o,s,u,c;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,coreAccount.getLoginModel();case 2:return t=e.sent,r=t.isSupportProxy,n=t.proxyAddress,a=t.proxyPort,o=t.proxyAccount,s={proxy_ip:"",proxy_port:0,proxy_auth_mode:0,proxy_user_name:"",proxy_password:""},e.next=7,coreSecurity.getPasswordManager();case 7:return u=e.sent,e.next=10,u.getPassword("proxyPassword");case 10:return c=e.sent,r&&(s.proxy_ip=n||"",s.proxy_port=parseInt(a)||0,s.proxy_auth_mode=1,s.proxy_user_name=o||"",s.proxy_password=c||""),e.abrupt("return",s);case 13:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),g=function(){var e="";switch(window.CLIENTCONFIG.PLATFORM){case"win":case"mac":e="pc";break;case"android":e="android";break;case"ios":e="ios"}return e},_=function(){var e=(0,c.default)(i.default.mark(function e(){var t,r,n,a,s,u;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,coreAccount.getLoginModel();case 2:return t=e.sent,r=t.httpsProxy,n="",a="",r&&(s=r.split(":"),u=(0,o.default)(s,2),n=u[0],a=u[1],d.info("createReverseProxyParam http reverse proxy ip = "+handlePhoneNumber(n)+" port: "+a)),e.abrupt("return",{reverse_proxy_ip:n,reverse_proxy_port:a?parseInt(a):0});case 7:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}}()}).call(t,r(144).Buffer)},1942:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.register=void 0;var n=r(1943),a=function(e){return e&&e.__esModule?e:{default:e}}(n);t.register=a.default},1943:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(1),o=n(a),s=r(2),i=n(s),u=r(1944),c=coreLogger.getLogger("logic")("UM/Notify"),l=function(){var e=(0,i.default)(o.default.mark(function e(){var t;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return c.info("register"),e.next=3,coreTup.getOfflineFileInstance();case 3:return t=e.sent,e.next=6,t.setOfflineFileNotifyEvent({onOffLineRspNotify:function(e){c.debug("onOffLineRspNotify",e),(0,u.dealOffLineRspNotify)(e)},onOffLineProgNotify:function(e){c.debug("onOffLineProgNotify",e),(0,u.dealOffLineProgressNotify)(e)},onLoginError:function(e){c.debug("onLoginError",e),(0,u.onLoginError)(e)}});case 6:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}}();t.default=l},1944:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e,t,r,n){var a=E.getGroupFileByHandle(e.group_id+t.file_real_save_path),o=a.pre_file_id;if(o)return x.info("dealPreUploadResult 预上传完成确认"),E.deleteGroupFileByHandle(e.group_id+t.file_real_save_path),w.groupFileReportUploadResult({prefile_id:o,group_id:e.group_id,upload_user_account:e.origin,file_name:t.file_name,file_size:t.file_size,file_url:r,result:n})}function s(e){return e.split('onload="delegate.onImageLoad(this)"').join('onload="delegate.onImageLoad(this)" ondblclick="ShowImage(this)" ')}function i(e,t){var r=e?"photoDownloadSuccess":"photoDownloadError",n=new Event(r);n.data={screenShot:t},x.info("sendImgDownloadEvent 图片下载发送事件;",r),window.dispatchEvent(n)}Object.defineProperty(t,"__esModule",{value:!0}),t.onLoginError=t.dealOffLineRspNotify=t.dealOffLineProgressNotify=void 0;var u=r(139),c=a(u),l=r(149),d=a(l),f=r(69),p=a(f),g=r(1),_=a(g),h=r(2),v=a(h),m=function(){var e=(0,v.default)(_.default.mark(function e(t,r){var n,a,s,i,u,l,f,g,h,v,m,M,y,S,I;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:x.info("dealUploadRspNotify 处理上传文件传输结果"),n=t.param,a=n.file_handle,s=(0,T.checkOffLineRspNotify)(t),i={},coreIm.finishUploadTask(a),e.prev=6,u=0;case 8:if(!(u<5)){e.next=20;break}if(i=E.getSendingMessage(r.message_server_chat_id_str),!isNullOrEmpty(i)){e.next=16;break}return x.info("dealUploadRspNotify i:"+u),e.next=14,sleep(300);case 14:e.next=17;break;case 16:return e.abrupt("break",20);case 17:u++,e.next=8;break;case 20:e.next=26;break;case 22:e.prev=22,e.t0=e.catch(6),x.error("dealUploadRspNotify",e.t0.toString()),(0,R.clearFileHandle)(r);case 26:if(l=n.filersp,f=l.url,g=l.plain_access_code,o(i,r,(0,p.default)({downloadUrl:f,fileAccessCode:g}),1),i.media_type!==constant.MEDIA_TYPE.PHOTO_TEXT){e.next=57;break}if(s){e.next=54;break}for(E.deleteSendingMessage(r.message_server_chat_id_str),h=i.file_list,v=!0,m=!1,M=void 0,e.prev=36,y=(0,d.default)(h);!(v=(S=y.next()).done);v=!0)I=S.value,o(i,I,"",0);e.next=44;break;case 40:e.prev=40,e.t1=e.catch(36),m=!0,M=e.t1;case 44:e.prev=44,e.prev=45,!v&&y.return&&y.return();case 47:if(e.prev=47,!m){e.next=50;break}throw M;case 50:return e.finish(47);case 51:return e.finish(44);case 52:return(0,R.dealScreenShotSendFailed)(i),e.abrupt("return");case 54:return x.info("dealOffLineRspNotify 截图",r.file_real_save_name),E.addUploadScreenShotFunc(function(){return C((0,c.default)({},r),n,i)}),e.abrupt("return");case 57:if(i.media_type!==constant.MEDIA_TYPE.VIDEO){e.next=65;break}if(s){e.next=63;break}return E.deleteSendingMessage(i.client_chat_id),o(i,r,"",0),(0,R.dealVideoSendFailed)(i,r),e.abrupt("return");case 63:return E.addUploadScreenShotFunc(function(){return k((0,c.default)({},r),n,i)}),e.abrupt("return");case 65:if(x.info("dealOffLineRspNotify 文件"),s){e.next=71;break}return E.deleteSendingMessage(r.message_server_chat_id_str),o(i,r,"",0),(0,R.dealFileSendFailed)((0,c.default)({},r),i),e.abrupt("return");case 71:return e.abrupt("return",P((0,c.default)({},r),n,i));case 72:case"end":return e.stop()}},e,this,[[6,22],[36,40,44,52],[45,,47,51]])}));return function(t,r){return e.apply(this,arguments)}}(),M=function(){var e=(0,v.default)(_.default.mark(function e(t,r){var n,a,o,s,u,l,d,f,p,g,h;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return x.info("dealDownloadRspNotify 处理下载文件传输结果"),n=t.param,a=n.file_handle,o=(0,T.checkOffLineRspNotify)(t),e.next=6,coreDb.queryMessage({server_chat_id_str:r.message_server_chat_id_str});case 6:if(s=e.sent,isNullOrEmpty(r.file_real_save_name)||(isNullOrEmpty(r.isThumbnail)&&(r.isThumbnail=!1),E.deleteUnDownloadedPhoto(r.isThumbnail.toString().toLocaleUpperCase()+"_"+r.file_real_save_name)),!o||!r){e.next=40;break}if(u=r.file_real_save_path?r.file_real_save_path.slice(0,-(r.file_real_save_name.length+1)):"",l=r.file_path?r.file_path.slice(0,-(r.file_name.length+1)):"",d=r.um_url?r.um_url.split("/")[r.um_url.split("/").length-1]:"",f="file://"+u,p="file://"+l,g=s.media_type===constant.MEDIA_TYPE.VIDEO,h=s.media_type===constant.MEDIA_TYPE.PHOTO||s.media_type===constant.MEDIA_TYPE.photo_text,!(g||h&&r.isThumbnail||s.media_type!==constant.MEDIA_TYPE.PHOTO)){e.next=27;break}return e.next=19,appService.isFileExist(r.file_real_save_path+"."+d+constant.TEMP_FILE_SUFFIX);case 19:if(!e.sent){e.next=27;break}if(!window.CLIENTCONFIG.ISMOBILE){e.next=25;break}return e.next=23,appService.renameFile(f,r.file_real_save_name+"."+d+constant.TEMP_FILE_SUFFIX,r.file_real_save_name);case 23:e.next=27;break;case 25:return e.next=27,appService.renameFile(u,r.file_real_save_name+"."+d+constant.TEMP_FILE_SUFFIX,r.file_real_save_name);case 27:return e.next=29,appService.isFileExist(r.file_path+"."+d+constant.TEMP_FILE_SUFFIX);case 29:if(e.t0=e.sent,!e.t0){e.next=32;break}e.t0=!r.isThumbnail;case 32:if(!e.t0){e.next=40;break}if(!window.CLIENTCONFIG.ISMOBILE){e.next=38;break}return e.next=36,appService.renameFile(p,r.file_name+"."+d+constant.TEMP_FILE_SUFFIX,r.file_name);case 36:e.next=40;break;case 38:return e.next=40,appService.renameFile(l,r.file_name+"."+d+constant.TEMP_FILE_SUFFIX,r.file_name);case 40:if(E.deleteFileByHandleList([a,s.client_chat_id]),s.media_type!==constant.MEDIA_TYPE.PHOTO_TEXT){e.next=50;break}if(o){e.next=46;break}return x.debug("dealOffLineRspNotify 失败 截图"),i(!1,(0,c.default)({},r)),e.abrupt("return",(0,R.dealDownloadScreenShotFailed)((0,c.default)({},r),s));case 46:x.info("dealOffLineRspNotify 截图",r.file_real_save_name),E.addDownloadScreenShotFunc(function(){return F((0,c.default)({},r),a,s)}),e.next=70;break;case 50:if(!(s.media_type===constant.MEDIA_TYPE.PHOTO||s.media_type===constant.MEDIA_TYPE.SHARE&&N.isShareImage(s.card_type))){e.next=58;break}if(o){e.next=54;break}return i(!1,(0,c.default)({},r)),e.abrupt("return",(0,R.dealDownloadScreenShotFailed)((0,c.default)({},r),s));case 54:return x.info("dealOffLineRspNotify 图片",r.file_real_save_name),e.abrupt("return",D((0,c.default)({},r),a,s));case 58:if(s.media_type!==constant.MEDIA_TYPE.CARD){e.next=62;break}i(o,(0,c.default)({},r)),e.next=70;break;case 62:if(o){e.next=66;break}return x.debug("dealOffLineRspNotify 失败"),(0,R.dealDownloadFileFailed)((0,c.default)({},r),s),e.abrupt("return");case 66:if(s.media_type!==constant.MEDIA_TYPE.VIDEO){e.next=68;break}return e.abrupt("return",A((0,c.default)({},r),s));case 68:return x.info("dealOffLineRspNotify 文件"),e.abrupt("return",U((0,c.default)({},r),s));case 70:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),y=r(182),E=n(y),S=r(357),I=r(228),w=n(I),T=r(1025),b=r(190),L=n(b),O=r(171),N=n(O),R=r(337),x=coreLogger.getLogger("logic")("IM/offlineFileNotify"),A=(t.dealOffLineProgressNotify=function(){var e=(0,v.default)(_.default.mark(function e(t){var r,n,a;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{r=t.param,n=r.file_handle,a=100*r.now/r.total,L.updateProgressMap(n,a)}catch(e){x.error("dealOffLineProgressNotify",e.toString())}case 1:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.dealOffLineRspNotify=function(){var e=(0,v.default)(_.default.mark(function e(t){var r,n,a;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,x.info("dealOffLineRspNotify"),r=t.param,n=r.file_handle,a=E.getFileByHandle(n),isNullOrEmpty(a)&&x.error("dealOffLineRspNotify:","file is null or empty"),a.file_deal_type!==constant.FILE_DEAL_TYPE.UPLOAD){e.next=9;break}return a.file_id=r.filersp.file_id,e.abrupt("return",m(t,a));case 9:return(0,R.clearFileHandle)(a),E.deleteReceivingMessage(a.um_url),e.abrupt("return",M(t,a));case 14:e.prev=14,e.t0=e.catch(0),x.error("dealOffLineRspNotify",e.t0.toString());case 17:case"end":return e.stop()}},e,void 0,[[0,14]])}));return function(t){return e.apply(this,arguments)}}(),function(){var e=(0,v.default)(_.default.mark(function e(t,r){var n,a;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,x.info("dealDownloadFileRspNotify"),t.is_downloaded=constant.IS_DOWNLOADED.YES,n=[],a=r.file_list,N.isQuoteFile(t)&&n.push(t),t.file_type!==constant.FILE_MEDIA_TYPE.Img){e.next=12;break}return e.next=8,coreDb.saveScreenShot((0,c.default)({},t));case 8:a[1]=t,(0,R.dealDownloadVideoImageSuccess)(r,a,n),e.next=16;break;case 12:return e.next=14,coreDb.saveFile((0,c.default)({},t));case 14:a[0]=t,(0,R.dealDownloadSuccess)(r,a,n);case 16:G(t,r),B(r),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(0),x.error("dealDownloadFileRspNotify",e.t0.toString());case 23:case"end":return e.stop()}},e,void 0,[[0,20]])}));return function(t,r){return e.apply(this,arguments)}}()),C=function(){var e=(0,v.default)(_.default.mark(function e(t,r,n){var a,o,i,u,l,d;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,x.info("dealUploadScreenShotRspNotify"),a=r.filersp,o=a.url,i=a.plain_access_code,t.is_uploaded=constant.IS_UPLOADED.YES,t.um_url=o,t.um_plain_access_code=i,e.next=9,coreDb.saveScreenShot((0,c.default)({},t));case 9:return e.next=11,coreDb.queryScreenShotList({message_server_chat_id_str:t.message_server_chat_id_str});case 11:if(u=e.sent,!isNullOrEmpty(u)){e.next=15;break}return x.error("dealUploadScreenShotRspNotify db没有查询到截图信息，终止处理"),e.abrupt("return");case 15:l=0;case 16:if(!(l<u.length)){e.next=23;break}if(u[l].is_uploaded!==constant.IS_UPLOADED.NO){e.next=20;break}return x.info("dealUploadScreenShotRspNotify 尚未上传完成"),e.abrupt("return");case 20:l++,e.next=16;break;case 23:return E.deleteSendingMessage(n.client_chat_id),n.content=(0,S.createPhotoTextMessageContent)(n,u),n.show_html=s(n.show_html),isNullOrEmpty(n.quote)||(n.content=(0,S.createQuotePhotoTextMessageContent)(n,u,n.quote)),n.display_name=getContactNameByMessage(n),d=(0,R.dealUploadSuccess)(n,u),e.abrupt("return",w.sendImMessage((0,c.default)({},d)));case 32:e.prev=32,e.t0=e.catch(0),x.error("dealUploadScreenShotRspNotify",e.t0.toString());case 35:case"end":return e.stop()}},e,void 0,[[0,32]])}));return function(t,r,n){return e.apply(this,arguments)}}(),k=function(){var e=(0,v.default)(_.default.mark(function e(t,r,n){var a,o,s,i,u,l,d,f;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,x.info("dealUploadScreenShotRspNotify"),a=r.filersp,o=a.url,s=a.plain_access_code,t.is_uploaded=constant.IS_UPLOADED.YES,t.um_url=o,t.um_plain_access_code=s,!t.isVideoImage){e.next=11;break}coreDb.saveScreenShot((0,c.default)({},t)),e.next=13;break;case 11:return e.next=13,coreDb.saveFile((0,c.default)({},t));case 13:return e.next=15,coreDb.queryFileList({message_server_chat_id_str:t.message_server_chat_id_str});case 15:return i=e.sent,e.next=18,coreDb.queryScreenShotList({message_server_chat_id_str:t.message_server_chat_id_str});case 18:if(u=e.sent,l=i.concat(u),!isNullOrEmpty(l)){e.next=23;break}return x.error("dealUploadVideoRspNotify, Db did not query the video information"),e.abrupt("return");case 23:d=0;case 24:if(!(d<l.length)){e.next=31;break}if(l[d].is_uploaded!==constant.IS_UPLOADED.NO){e.next=28;break}return x.info("dealUploadVideoRspNotify, Not uploaded completed"),e.abrupt("return");case 28:d++,e.next=24;break;case 31:return isNullOrEmpty(n.quote)||(n.content=(0,S.createVideoMessageContent)(n,l,n.quote)),n.content=(0,S.createVideoMessageContent)(n,l),n.display_name=getContactNameByMessage(n),f=(0,R.dealUploadSuccess)(n,l),e.abrupt("return",w.sendImMessage((0,c.default)({},f)));case 38:e.prev=38,e.t0=e.catch(0),x.error("dealUploadScreenShotRspNotify",e.t0.toString());case 41:case"end":return e.stop()}},e,void 0,[[0,38]])}));return function(t,r,n){return e.apply(this,arguments)}}(),P=function(){var e=(0,v.default)(_.default.mark(function e(t,r,n){var a,o,s,i;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,x.info("dealUploadFileRspNotify"),a=r.filersp,o=a.url,s=a.plain_access_code,t.is_uploaded=constant.IS_UPLOADED.YES,t.um_url=o,t.um_plain_access_code=s,n.media_type!==constant.MEDIA_TYPE.PHOTO){e.next=12;break}return e.next=10,coreDb.saveScreenShot((0,c.default)({},t));case 10:e.next=14;break;case 12:return e.next=14,coreDb.saveFile((0,c.default)({},t));case 14:return n.content=(0,S.createFileMessageContent)(t),n.display_name=getContactName(n),i=(0,R.dealUploadSuccess)(n,[t]),e.abrupt("return",w.sendImMessage((0,c.default)({},i)));case 20:e.prev=20,e.t0=e.catch(0),x.error("dealUploadFileRspNotify",e.t0.toString());case 23:case"end":return e.stop()}},e,void 0,[[0,20]])}));return function(t,r,n){return e.apply(this,arguments)}}(),F=function(){var e=(0,v.default)(_.default.mark(function e(t){var r,n,a,o,s=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments[2]);return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,coreIm.updateImgList(s,"update"),i(!0,t),t.is_downloaded=constant.IS_DOWNLOADED.YES,isNullOrEmpty(t.type)||"origin"!==t.type){e.next=7;break}return L.setCurrentImg(t),e.abrupt("return");case 7:return e.next=9,coreDb.saveScreenShot((0,c.default)({},t));case 9:return e.next=11,coreDb.queryScreenShotList({message_server_chat_id_str:t.message_server_chat_id_str});case 11:for(r=e.sent,n=[],a=[],o=0;o<r.length;o++)r[o].is_downloaded===constant.IS_DOWNLOADED.YES&&(N.isQuoteFile(r[o])?n.push(r[o]):a.push(r[o]));(0,R.dealDownloadSuccess)(s,a,n),G(t,s),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),x.error("dealDownloadScreenShotRspNotify",e.t0.toString());case 21:case"end":return e.stop()}},e,void 0,[[0,18]])}));return function(t){return e.apply(this,arguments)}}(),D=function(){var e=(0,v.default)(_.default.mark(function e(t){var r,n,a=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments[2]);return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,coreIm.updateImgList(a,"update"),i(!0,t),t.is_downloaded=constant.IS_DOWNLOADED.YES,isNullOrEmpty(t.type)||"origin"!==t.type){e.next=7;break}return L.setCurrentImg(t),e.abrupt("return");case 7:return e.next=9,coreDb.saveScreenShot((0,c.default)({},t));case 9:r=[],n=[],t.is_downloaded===constant.IS_DOWNLOADED.YES&&(N.isQuoteFile(t)?r.push(t):n.push(t)),(0,R.dealDownloadSuccess)(a,n,r),G(t,a),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),x.error("dealDownloadScreenShotRspNotify",e.t0.toString());case 18:case"end":return e.stop()}},e,void 0,[[0,15]])}));return function(t){return e.apply(this,arguments)}}(),U=function(){var e=(0,v.default)(_.default.mark(function e(t,r){var n,a;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,x.info("dealDownloadFileRspNotify"),t.is_downloaded=constant.IS_DOWNLOADED.YES,e.next=5,coreDb.saveFile((0,c.default)({},t));case 5:n=[],a=[],t.is_downloaded===constant.IS_DOWNLOADED.YES&&(N.isQuoteFile(t)?n.push(t):a.push(t)),(0,R.dealDownloadSuccess)(r,a,n),G(t,r),B(r),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),x.error("dealDownloadFileRspNotify",e.t0.toString());case 15:case"end":return e.stop()}},e,void 0,[[0,12]])}));return function(t,r){return e.apply(this,arguments)}}(),G=function(e,t){x.info("dealSaveAsDownload 另存下载的处理");var r=$getState().recent.saveAsFileMessageMap;isNullOrEmpty(r[t.server_chat_id_str])||appService.saveAs(e.file_real_save_path,r[t.server_chat_id_str]).then(function(){L.deleteSaveAsFileMessageMap(t.server_chat_id_str),window.ToastNew(language.SAVE_SUCCESS)})},B=function(e){x.info("dealOpenFileOrFolderDownload 下载后自动打开");var t=$getState().recent,r=t.openFileMessageMap,n=t.openFolderMessageMap;isNullOrEmpty(r[e.server_chat_id_str])||(appService.openFileOrFolder(r[e.server_chat_id_str]),L.deleteOpenFileMessageMap(e.server_chat_id_str)),isNullOrEmpty(n[e.server_chat_id_str])||(appService.openFolder(n[e.server_chat_id_str]),L.deleteOpenFolderMessageMap(e.server_chat_id_str))};t.onLoginError=function(){var e=(0,v.default)(_.default.mark(function e(t){var r,n,a;return _.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.param,n=void 0===r?{}:r,x.error("umServerLoginErrorNotify,"+n.error_code),window.dispatchEvent(new Event("umServerNotLogin")),401!==n.error_code||!coreCommon.isHuaweiCloudWeLink()){e.next=11;break}return e.next=6,coreAccount.refreshMiddleEndToken();case 6:if(a=e.sent,x.info("now umServerLogin error code is 401, do refresh sso ,result is ",a),!a){e.next=11;break}return e.next=11,coreAccount.makeLoginCancelable({promise:coreIm.umserverLogin(),name:"umserverLogin",loginPromiseKey:constant.LOGIN_PROMISE_KEY.umserver_login});case 11:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}()},1945:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.umserverLogout=void 0;var a=r(1),o=n(a),s=r(2),i=n(s),u=coreLogger.getLogger("logic")("login/umserver");t.umserverLogout=function(){var e=(0,i.default)(o.default.mark(function e(){var t;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u.info("umserverLogout"),e.next=3,coreTup.getOfflineFileInstance();case 3:return t=e.sent,e.next=6,t.logout();case 6:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}}()},217:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.setIsTwoToThree=t.showCurrentRecentDetail=t.changeHintsShow=t.refreshPhoneRecent=t.markRecentAsRead=t.updateRecent=t.dealRecentByAddGroup=t.hasRecentFixedToTop=t.fixGroupToTop=t.hasGroupFixedToTop=t.fixRecentToTop=t.onTabClick=t.updateMessageToRecent=t.refreshRecentList=t.refreshRecentIsMute=t.selectRecentItem=t.deleteUnReadApplyGroupNotifyNumMap=t.updateUnReadApplyGroupNotifyNumMap=t.deleteUnReadNumMap=t.updateUnReadNumMap=t.deleteAtMap=t.updateAtMap=t.setMessageNotifyClose=t.initNewConversationUI=t.openRecentConversation=t.initOpenRecentData=t.toggleRecent=t.dealRecentByDeleteGroup=t.deleteRecent=t.dealServerRecentList=t.dealRecentLastMessageInfo=void 0;var a=r(358),o=n(a),s=r(597),i=n(s),u=r(998),c=n(u);t.dealRecentLastMessageInfo=i.dealRecentLastMessageInfo,t.dealServerRecentList=o.dealServerRecentList,t.deleteRecent=o.deleteRecent,t.dealRecentByDeleteGroup=o.dealRecentByDeleteGroup,t.toggleRecent=o.toggleRecent,t.initOpenRecentData=o.initOpenRecentData,t.openRecentConversation=o.openRecentConversation,t.initNewConversationUI=o.initNewConversationUI,t.setMessageNotifyClose=o.setMessageNotifyClose,t.updateAtMap=o.updateAtMap,t.deleteAtMap=o.deleteAtMap,t.updateUnReadNumMap=o.updateUnReadNumMap,t.deleteUnReadNumMap=o.deleteUnReadNumMap,t.updateUnReadApplyGroupNotifyNumMap=o.updateUnReadApplyGroupNotifyNumMap,t.deleteUnReadApplyGroupNotifyNumMap=o.deleteUnReadApplyGroupNotifyNumMap,t.selectRecentItem=o.selectRecentItem,t.refreshRecentIsMute=o.refreshRecentIsMute,t.refreshRecentList=o.refreshRecentList,t.updateMessageToRecent=o.updateMessageToRecent,t.onTabClick=o.onTabClick,t.fixRecentToTop=o.fixRecentToTop,t.hasGroupFixedToTop=o.hasGroupFixedToTop,t.fixGroupToTop=o.fixGroupToTop,t.hasRecentFixedToTop=o.hasRecentFixedToTop,t.dealRecentByAddGroup=o.dealRecentByAddGroup,t.updateRecent=o.updateRecent,t.markRecentAsRead=o.markRecentAsRead,t.refreshPhoneRecent=i.refreshPhoneRecent,t.changeHintsShow=o.changeHintsShow,t.showCurrentRecentDetail=c.showCurrentRecentDetail,t.setIsTwoToThree=c.setIsTwoToThree},218:function(e,t){var r={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==r.call(e)}},228:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.tupGetRecentConversation=t.delRecentConversation=t.deleteHistoryMessage=t.toppingConversation=t.kickOut=t.getMuteForMobile=t.setMuteForMobile=t.groupFileQuery=t.groupFileReportDeleteResult=t.groupFilePreDelete=t.groupFileReportUploadResult=t.groupFilePreUpload=t.withdrawIm=t.registerPush=t.clientRepot=t.queryHistoryMessage=t.sendImMessage=void 0;var o=r(3),s=a(o),i=r(155),u=a(i),c=r(1),l=a(c),d=r(135),f=a(d),p=r(2),g=a(p),_=r(190),h=n(_),v=r(182),m=n(v),M=r(338),y=r(171),E=n(y),S=r(217),I=coreLogger.getLogger("logic")("IM/Tup参数规范层"),w=(t.sendImMessage=function(){var e=(0,g.default)(l.default.mark(function e(t){var r,n,a,o,s,i,u,c,d;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,I.info("sendImMessage"),r=new Blob([t.content],{type:"text/plain"}),!(r.size>1024*parseInt(window.CLIENTCONFIG["Device.ComCfg.IM.limitBody"]))){e.next=8;break}I.error("sendImMessage",language.CHECK_IM_MESSAGE_CONTENT_SIZE+window.CLIENTCONFIG["Device.ComCfg.IM.limitBody"]+"KB"),window.alert(language.CHECK_IM_MESSAGE_CONTENT_SIZE+window.CLIENTCONFIG["Device.ComCfg.IM.limitBody"]+"KB"),e.next=36;break;case 8:return coreUt.utCustomEvent({eventId:constant.EVENT_ID.UT_IM_SEND_MESSAGE,params:[handlePhoneNumber(t.recent_owner),t.media_type,window.CLIENTCONFIG.PLATFORM]}),n=["chat_type","client_chat_id","content","content_type","group_id","media_type","origin","source_flag","target","display_name","utc_stamp","at_user_list","sub_msg_type","origin_app_id","origin_app_name"],e.next=12,coreTup.getIMInstance();case 12:return a=e.sent,o=(0,f.default)({},t,{source_flag:constant.SOURCE_FLAG.IM,content_type:constant.CONTENT_TYPE.TEXT}),s={},n.forEach(function(e){if("display_name"===e)return s[e]=o.name;s[e]=o[e]}),s=w(s),e.next=19,coreAccount.getLoginModel();case 19:return i=e.sent,u=i.isSupportAS,u&&(s.origin_app_id="WeLink"===window.CLIENTCONFIG.NEW_APP_NAME?"1":"2"),c=o.send_status===constant.SEND_STATUS.resend?o.send_status:constant.SEND_STATUS.sending,o.send_status=constant.SEND_STATUS.error,o.utc_time=M.localTimeService.getLocalTime(),e.next=27,coreDb.saveMessage(o);case 27:return o=e.sent,o.send_status=c,m.setSendingMessage(o.client_chat_id,o),(0,S.updateMessageToRecent)(o),E.isBelongToCurrentRecent(o)&&((0,_.initLoadMore)(),(0,_.addNewMessage)(o)),e.next=34,a.sendim(s);case 34:d=e.sent,d&&d.result===constant.ERROR_CODE.Success||(I.error("sendImMessage fail, result: "),m.deleteSendingMessage(o.client_chat_id,o),o.send_status=constant.SEND_STATUS.error,(0,S.updateMessageToRecent)(o),E.isBelongToCurrentRecent(o)&&h.updateMessageList(o));case 36:e.next=41;break;case 38:e.prev=38,e.t0=e.catch(0),I.error("sendImMessage",e.t0);case 41:case"end":return e.stop()}},e,void 0,[[0,38]])}));return function(t){return e.apply(this,arguments)}}(),function(e){try{var t={chat_type:"number",client_chat_id:"both",content:"string",content_type:"number",group_id:"string",media_type:"number",origin:"string",source_flag:"number",target:"string",display_name:"string",utc_stamp:"both"},r=" ",n="",a=" ";for(var o in t){var s=(0,u.default)(e[o]);s!==t[o]&&("both"!==t[o]||"number"!==s&&"string"!==s)&&(n=o+": required "+t[o]+", but got "+(0,u.default)(e[o])+";  ",r+=n,"both"===t[o]||"string"===t[o]?e[o]="":"number"===t[o]?e[o]=0:"object"===t[o]&&(e[o]={}))}return" "!==r&&I.info("sendImMessage  arguments type error: ",r),"number"!=typeof e.sub_msg_type&&(e.sub_msg_type=0,a+="sub_msg_type, "),"string"!=typeof e.origin_app_id&&(e.origin_app_id="",a+="origin_app_id, "),"string"!=typeof e.origin_app_name&&(e.origin_app_name="",a+="origin_app_name, ")," "!==a&&I.info("sendImMessage  "+a+" has been modified"),e}catch(t){return I.error("sendImArgsCheck",t),e}});t.queryHistoryMessage=function(e){try{return I.info("queryHistoryMessage"),coreIm.checkEServerOnlineNoToast("queryHistoryMessage")?coreTup.getIMInstance().then(function(t){return t.queryhistorymessage({operation_type:e.operation_type,msg_type:e.message_type,sender:e.sender,msg_id:0,str_msgid:e.server_chat_id_str||"0",count:e.count||(window.CLIENTCONFIG.ISMOBILE?window.CLIENTCONFIG.MOBILE_MESSAGE_LIST_PAGE_SIZE:window.CLIENTCONFIG.MESSAGE_LIST_PAGE_SIZE)})}).then(function(e){if(e){var t=e.param;if(e.result===constant.ERROR_CODE.Success){var r=t.chat_info_list;return s.default.resolve(r||[])}}return s.default.resolve([])}):s.default.resolve([])}catch(e){return I.error("queryHistoryMessage",e.toString()),s.default.resolve([])}},t.clientRepot=function(){var e=(0,g.default)(l.default.mark(function e(t){var r,n;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,coreTup.getIMInstance();case 2:return r=e.sent,e.next=5,r.clientReport(t);case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.registerPush=function(){var e=(0,g.default)(l.default.mark(function e(t){var r,n;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,coreTup.getIMInstance();case 2:return r=e.sent,e.next=5,r.registerPush(t);case 5:return n=e.sent,e.abrupt("return",n);case 7:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.withdrawIm=function(){var e=(0,g.default)(l.default.mark(function e(t){var r,n,a;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,I.info("withdrawIm"),e.next=4,coreTup.getIMInstance();case 4:return r=e.sent,e.next=7,r.withdrawIm(t);case 7:n=e.sent,a=n?n.result:"",a!==constant.ERROR_WITHDRAW_CODE.SUCCESS&&(window.CLIENTCONFIG.ISMOBILE?window.Toast(language.WITHDRAW_ERROR,2,!1):window.Toast(language.WITHDRAW_ERROR,2,!1,"WhiteWarning"),I.error("withdrawIm 消息撤回失败",a)),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),I.error("withdrawIm",e.t0.toString());case 15:case"end":return e.stop()}},e,void 0,[[0,12]])}));return function(t){return e.apply(this,arguments)}}(),t.groupFilePreUpload=function(e){try{return I.info("groupFilePreUpload"),coreTup.getIMInstance().then(function(t){return t.groupFilePreUpload({group_id:e.group_id,file_name:e.file_name,file_size:e.file_size})}).then(function(e){if(e){var t=e.param,r=e.result;if(r===constant.ERROR_CODE.Success){var n=t.pre_file_id;return s.default.resolve(n||"")}I.error("groupFilePreUpload 预上传群共享文件失败",r.toString())}return s.default.resolve("")})}catch(e){return I.error("groupFilePreUpload",e.toString()),s.default.resolve("")}},t.groupFileReportUploadResult=function(e){try{return I.info("groupFileReportUploadResult"),coreTup.getIMInstance().then(function(t){return t.groupFileReportUploadResult({prefile_id:e.prefile_id,group_id:e.group_id,upload_user_account:e.upload_user_account,file_name:e.file_name,file_size:e.file_size,file_url:e.file_url,result:e.result})}).then(function(e){if(e){var t=e.param,r=e.result;if(r===constant.ERROR_CODE.Success)return s.default.resolve(t||"");I.error("groupFileReportUploadResult 通知服务器群共享上传文件的结果失败",r.toString())}return s.default.resolve({})})}catch(e){return I.error("groupFileReportUploadResult",e.toString()),s.default.resolve({})}},t.groupFilePreDelete=function(e){try{return I.info("groupFilePreDelete"),coreTup.getIMInstance().then(function(t){return t.groupFilePreDelete({file_id:e.file_id,group_id:e.group_id})}).then(function(e){if(e){var t=e.param;return s.default.resolve(t||{})}return s.default.resolve({})})}catch(e){return I.error("groupFilePreDelete",e.toString()),s.default.resolve({})}},t.groupFileReportDeleteResult=function(e){try{return I.info("groupFileReportDeleteResult"),coreTup.getIMInstance().then(function(t){return t.groupFileReportDeleteResult({file_id:e.file_id,group_id:e.group_id})}).then(function(e){if(e){var t=e.param;return s.default.resolve(t||{})}return s.default.resolve({})})}catch(e){return I.error("groupFileReportDeleteResult",e.toString()),s.default.resolve({})}},t.groupFileQuery=function(e){try{return I.info("groupFileQuery"),coreTup.getIMInstance().then(function(t){return t.groupFileQuery({group_id:e.group_id,query_key:e.query_key,query_type:e.query_type,offset:e.offset,count:e.count})}).then(function(e){if(e){var t=e.param;return s.default.resolve(t||{})}return s.default.resolve({})})}catch(e){return I.error("groupFileQuery",e.toString()),s.default.resolve({})}},t.setMuteForMobile=function(){var e=(0,g.default)(l.default.mark(function e(){var t,r,n,a,o;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,coreIm.checkEserverOnline("setMuteForMobile")){e.next=3;break}return e.abrupt("return");case 3:return t=$getState().setting.isReceiveMobileMessage,r="1",t&&(r="0"),e.next=8,coreTup.getIMInstance();case 8:return n=e.sent,e.next=11,n.setMuteForMobile({mute_flag:r});case 11:if(a=e.sent,!(o=0===a.result&&1===a.param.result)){e.next=16;break}return e.next=16,$dispatch(coreUi.bReceiveMobileMessage(!t));case 16:return I.info("setMuteForMobile result = ",a),e.abrupt("return",o);case 20:e.prev=20,e.t0=e.catch(0),I.error("setMuteForMobile error",e.t0.toJSON());case 23:case"end":return e.stop()}},e,void 0,[[0,20]])}));return function(){return e.apply(this,arguments)}}(),t.getMuteForMobile=function(){var e=(0,g.default)(l.default.mark(function e(){var t,r;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,coreIm.checkEServerOnlineNoToast("queryHistoryMessage")){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,coreTup.getIMInstance();case 5:return t=e.sent,e.next=8,t.getMuteForMobile();case 8:if(r=e.sent,0!==r.result||1!==r.param.result){e.next=18;break}if("0"!==r.param.mute_flag){e.next=15;break}return e.next=13,$dispatch(coreUi.bReceiveMobileMessage(!1));case 13:e.next=18;break;case 15:if("1"!==r.param.mute_flag){e.next=18;break}return e.next=18,$dispatch(coreUi.bReceiveMobileMessage(!0));case 18:return I.info("getMuteForMobile result = ",r),e.abrupt("return",r);case 22:e.prev=22,e.t0=e.catch(0),I.error("getMuteForMobile error",e.t0.toJSON());case 25:case"end":return e.stop()}},e,void 0,[[0,22]])}));return function(){return e.apply(this,arguments)}}(),t.kickOut=function(){var e=(0,g.default)(l.default.mark(function e(){var t,r;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,I.info("kickOut"),e.next=4,coreTup.getIMInstance();case 4:return t=e.sent,e.next=7,t.kickOut();case 7:return r=e.sent,e.abrupt("return",r);case 11:e.prev=11,e.t0=e.catch(0),I.error("kickOut",e.t0.toString());case 14:case"end":return e.stop()}},e,void 0,[[0,11]])}));return function(){return e.apply(this,arguments)}}(),t.toppingConversation=function(){var e=(0,g.default)(l.default.mark(function e(t){var r,n;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,I.info("toppingConversation"),e.next=4,coreTup.getIMInstance();case 4:return r=e.sent,e.next=7,r.toppingConversation(t);case 7:return n=e.sent,e.abrupt("return",n);case 11:e.prev=11,e.t0=e.catch(0),I.error("toppingConversation",e.t0.toString());case 14:case"end":return e.stop()}},e,void 0,[[0,11]])}));return function(t){return e.apply(this,arguments)}}(),t.deleteHistoryMessage=function(){var e=(0,g.default)(l.default.mark(function e(t){var r,n;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,I.info("deleteHistoryMessage"),e.next=4,coreTup.getIMInstance();case 4:return r=e.sent,e.next=7,r.deleteHistoryMessage(t);case 7:return n=e.sent,e.abrupt("return",n);case 11:e.prev=11,e.t0=e.catch(0),I.error("deleteHistoryMessage",e.t0.toString());case 14:case"end":return e.stop()}},e,void 0,[[0,11]])}));return function(t){return e.apply(this,arguments)}}(),t.delRecentConversation=function(){var e=(0,g.default)(l.default.mark(function e(t){var r,n;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,I.info("delRecentConversation"),e.next=4,coreTup.getIMInstance();case 4:return r=e.sent,e.next=7,r.delRecentConversation(t);case 7:return n=e.sent,e.abrupt("return",n);case 11:e.prev=11,e.t0=e.catch(0),I.error("delRecentConversation",e.t0.toString());case 14:case"end":return e.stop()}},e,void 0,[[0,11]])}));return function(t){return e.apply(this,arguments)}}(),t.tupGetRecentConversation=function(){var e=(0,g.default)(l.default.mark(function e(t){var r,n;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,I.info("tupGetRecentConversation"),e.next=4,coreTup.getIMInstance();case 4:return r=e.sent,e.next=7,r.getRecentConversation(t);case 7:return n=e.sent,e.abrupt("return",n);case 11:e.prev=11,e.t0=e.catch(0),I.error("tupGetRecentConversation",e.t0.toString());case 14:case"end":return e.stop()}},e,void 0,[[0,11]])}));return function(t){return e.apply(this,arguments)}}()},232:function(e,t,r){e.exports=r(0)(43)},234:function(e,t,r){"use strict";function n(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");return-1===r&&(r=t),[r,r===t?0:4-r%4]}function a(e){var t=n(e),r=t[0],a=t[1];return 3*(r+a)/4-a}function o(e,t,r){return 3*(t+r)/4-r}function s(e){for(var t,r=n(e),a=r[0],s=r[1],i=new f(o(e,a,s)),u=0,c=s>0?a-4:a,l=0;l<c;l+=4)t=d[e.charCodeAt(l)]<<18|d[e.charCodeAt(l+1)]<<12|d[e.charCodeAt(l+2)]<<6|d[e.charCodeAt(l+3)],i[u++]=t>>16&255,i[u++]=t>>8&255,i[u++]=255&t;return 2===s&&(t=d[e.charCodeAt(l)]<<2|d[e.charCodeAt(l+1)]>>4,i[u++]=255&t),1===s&&(t=d[e.charCodeAt(l)]<<10|d[e.charCodeAt(l+1)]<<4|d[e.charCodeAt(l+2)]>>2,i[u++]=t>>8&255,i[u++]=255&t),i}function i(e){return l[e>>18&63]+l[e>>12&63]+l[e>>6&63]+l[63&e]}function u(e,t,r){for(var n,a=[],o=t;o<r;o+=3)n=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),a.push(i(n));return a.join("")}function c(e){for(var t,r=e.length,n=r%3,a=[],o=0,s=r-n;o<s;o+=16383)a.push(u(e,o,o+16383>s?s:o+16383));return 1===n?(t=e[r-1],a.push(l[t>>2]+l[t<<4&63]+"==")):2===n&&(t=(e[r-2]<<8)+e[r-1],a.push(l[t>>10]+l[t>>4&63]+l[t<<2&63]+"=")),a.join("")}t.byteLength=a,t.toByteArray=s,t.fromByteArray=c;for(var l=[],d=[],f="undefined"!=typeof Uint8Array?Uint8Array:Array,p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",g=0,_=p.length;g<_;++g)l[g]=p[g],d[p.charCodeAt(g)]=g;d["-".charCodeAt(0)]=62,d["_".charCodeAt(0)]=63},235:function(e,t){t.read=function(e,t,r,n,a){var o,s,i=8*a-n-1,u=(1<<i)-1,c=u>>1,l=-7,d=r?a-1:0,f=r?-1:1,p=e[t+d];for(d+=f,o=p&(1<<-l)-1,p>>=-l,l+=i;l>0;o=256*o+e[t+d],d+=f,l-=8);for(s=o&(1<<-l)-1,o>>=-l,l+=n;l>0;s=256*s+e[t+d],d+=f,l-=8);if(0===o)o=1-c;else{if(o===u)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,n),o-=c}return(p?-1:1)*s*Math.pow(2,o-n)},t.write=function(e,t,r,n,a,o){var s,i,u,c=8*o-a-1,l=(1<<c)-1,d=l>>1,f=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,g=n?1:-1,_=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(i=isNaN(t)?1:0,s=l):(s=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-s))<1&&(s--,u*=2),t+=s+d>=1?f/u:f*Math.pow(2,1-d),t*u>=2&&(s++,u/=2),s+d>=l?(i=0,s=l):s+d>=1?(i=(t*u-1)*Math.pow(2,a),s+=d):(i=t*Math.pow(2,d-1)*Math.pow(2,a),s=0));a>=8;e[r+p]=255&i,p+=g,i/=256,a-=8);for(s=s<<a|i,c+=a;c>0;e[r+p]=255&s,p+=g,s/=256,c-=8);e[r+p-g]|=128*_}},302:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.transformGroupNotifyMessage=t.transformHtmlLike=t.transformHtmlEmotion=t.transformMessageContentEmotion=t.createVideoMessageContent=t.createLikeMessage=t.createMobileLikeMessage=t.createCallRecordMessage=t.createGroupMemberChgMessage=t.createGroupNotifyMessage=t.createFileMessageContent=t.formatSendImgInfo=t.createQuotePhotoTextMessageContent=t.createPhotoTextMessageContent=t.createFileMessage=t.createPhotoTextMessage=t.createMobileTextMessage=t.createNormalMessage=void 0;var a=r(826),o=n(a),s=r(990),i=n(s);t.createNormalMessage=i.createNormalMessage,t.createMobileTextMessage=i.createMobileTextMessage,t.createPhotoTextMessage=i.createPhotoTextMessage,t.createFileMessage=i.createFileMessage,t.createPhotoTextMessageContent=i.createPhotoTextMessageContent,t.createQuotePhotoTextMessageContent=i.createQuotePhotoTextMessageContent,t.formatSendImgInfo=i.formatSendImgInfo,t.createFileMessageContent=i.createFileMessageContent,t.createGroupNotifyMessage=i.createGroupNotifyMessage,t.createGroupMemberChgMessage=i.createGroupMemberChgMessage,t.createCallRecordMessage=i.createCallRecordMessage,t.createMobileLikeMessage=i.createMobileLikeMessage,t.createLikeMessage=i.createLikeMessage,t.createVideoMessageContent=i.createVideoMessageContent,t.transformMessageContentEmotion=o.transformMessageContentEmotion,t.transformHtmlEmotion=o.transformHtmlEmotion,t.transformHtmlLike=o.transformHtmlLike,t.transformGroupNotifyMessage=o.transformGroupNotifyMessage},303:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.copyFile=t.rightMenuRelayMessage=t.clearMessageFromMessageList=t.clearNewMessageFromMessageList=t.addNewMessageIntoMessageList=t.setAndroidNotifyNewMessageNum=t.setUnreadNewMessageNum=t.showMessageToast=t.hideMessageToast=void 0;var o=r(1),s=a(o),i=r(2),u=a(i),c=r(190),l=n(c),d=r(596),f=n(d),p=coreLogger.getLogger("logic")("IM/uiController"),g=null;window.isAppInBackground=!1,window.CLIENTCONFIG.ENABLE_IT_MEETING&&!window.CLIENTCONFIG.IS_LINK_IT_SMC_MEETING&&(window.isConfPluginInBackground=!0),window.isAppInactive=!1,window.updateAppActiveState=function(e){window.isAppInactive!==e&&(window.isAppInactive=e,p.info("updateAppActiveState isAppInactive: "+e))},window.updateAppBackgourndMode=function(){var e=(0,u.default)(s.default.mark(function e(t){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(window.isAppInBackground!==t){e.next=2;break}return e.abrupt("return");case 2:if(window.isAppInBackground=t,p.info("updateAppBackgourndMode isAppInBackground: "+t),t){e.next=18;break}if(p.info("switch to foreground"),!window.getCurrentNetWorkType){e.next=10;break}return e.next=9,window.getCurrentNetWorkType();case 9:coreCommon.setIsNetworkOk({flag:window.netWorkType!==constant.NETWORK_TYPE.TYPE_NONE,info:"switch to foreground getCurrentNetWorkType"});case 10:appService.getStatusBarHeight(),appService.getScreenSize(),appService.getMobileInfo(),p.info("window.socketReadyState: ",window.socketReadyState),window.CLIENTCONFIG.ENABLE_IT_MEETING||window.isPluginEnv||(0!==coreCall.getCallCount()||coreConf.isInConf())&&(coreCommon.isSupportNativeProtocol()||"OPEN"!==window.socketReadyState)||coreAccount.doSipResumeAndEserverDetect({message:"switch to foreground do sipResume"}),v(0),e.next=19;break;case 18:p.info("switch to background");case 19:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}();var _=t.hideMessageToast=function(){$dispatch(coreUi.hideMessageToast()),g=null,delegate.UmFocus()},h=(t.showMessageToast=function(e){$dispatch(coreUi.showMessageToast(e)),g=setTimeout(_,window.CLIENTCONFIG.MESSAGE_TOAST_TIMEOUT)},t.setUnreadNewMessageNum=function(e){return $dispatch(coreUi.setUnreadNewMessageNum(e))}),v=t.setAndroidNotifyNewMessageNum=function(e){return $dispatch(coreUi.setAndroidNotifyNewMessageNum(e))};t.addNewMessageIntoMessageList=function(e){var t=$getState(),r=t.recent.isLoadMore;if(window.isAppInBackground){var n=t.IM.androidNotifyNewMessageNum;n++,v(n)}else v(0);var a=t.IM.newMessageNum;if(r){p.info("addNewMessageIntoMessageList 显示新消息数量");var o=t.IM.unReadNewMessageNum;o++,h(o),l.setBackwardLoadMessage(),coreIm.updateImgList(e,"update")}else p.info("addNewMessageIntoMessageList 加载新消息"),l.addNewMessage(e);a++,$dispatch(coreUi.setNewMessageNum(a))},t.clearNewMessageFromMessageList=function(){h(0),coreIm.initLoadMore(),f.loadHistoryMessageList()},t.clearMessageFromMessageList=function(){var e=(0,u.default)(s.default.mark(function e(){var t,r,n,a,o,i,u,c,l;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t=$getState().recent.messageList,r=$getState().IM,n=r.unReadMessageNumTop,a=r.newMessageNum,o=t.length,i=9999999999999,u=n-(o-a),c="0",!(u<=0)){e.next=11;break}return $dispatch(coreUi.setUnreadMessageNumTop(0)),$dispatch(coreUi.setNewMessageNum(0)),e.abrupt("return");case 11:return o>0&&(i=t[0].utc_stamp,c=t[0].server_chat_id_str),u>window.CLIENTCONFIG.MESSAGE_LIST_MAX_PAGE_SIZE&&(u=window.CLIENTCONFIG.MESSAGE_LIST_MAX_PAGE_SIZE),p.info("clearMessageFromMessageList loadLen",u),e.next=16,coreIm.loadOneClickJumpMessageList(u,i,c);case 16:l=$getState().recent.messageList,l.length>window.CLIENTCONFIG.MESSAGE_LIST_PAGE_SIZE&&(p.info("clearMessageFromMessageList setMessageDividingLine",l[0].server_chat_id_str),$dispatch(coreUi.setMessageDividingLine(l[0].server_chat_id_str))),$dispatch(coreUi.setTopJump(!0)),$dispatch(coreUi.setUnreadMessageNumTop(0)),$dispatch(coreUi.setNewMessageNum(0)),e.next=26;break;case 23:e.prev=23,e.t0=e.catch(0),p.error("clearMessageFromMessageList",e.t0.toString());case 26:case"end":return e.stop()}},e,void 0,[[0,23]])}));return function(){return e.apply(this,arguments)}}(),t.rightMenuRelayMessage=function(e,t){return function(){try{p.info("userClick  IM rightclick relay"),p.info("relayMessage"),coreUi.initShowSelectBox(t)}catch(e){p.error("relayMessage",e.toString())}}},t.copyFile=function(e){return function(){try{p.info("userClick  IM rightclick copy file");var t=e.replace(/\\/g,"/"),r=clipBoard(t),n=r===e;p.info("Copy file/audio/video:",{result:n})}catch(e){p.error("copyFile",e.toString())}}}},304:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(){try{k.info("dealOfflineFileSendFail stop any file sending when offline");var e=O.querySendingMessageMap();!isNullOrEmpty(e)&&(0,v.default)(e).forEach(function(t){var r=e[t];if(O.deleteSendingMessage(r.client_chat_id),r.send_status=constant.SEND_STATUS.error,r.status=constant.MEDIA_STATUS.CANCEL_SEND,!isNullOrEmpty(r.file_list)&&r.file_list.length>0){for(var n=0;n<r.file_list.length;n++){var a=r.file_list[n];coreDb.saveFile(a)}return b(r,r.file_list)}return b(r,[])})}catch(e){k.error("dealOfflineFileSendFail",e)}}function s(e,t){try{if(k.info("dealDownloadFileFailed"),O.deleteFileByHandleList([e.file_handle,t.client_chat_id]),p(e),t.media_type===constant.MEDIA_TYPE.VIDEO&&e.file_type===constant.FILE_MEDIA_TYPE.Img)return void k.info("dealDownloadFileFailed: Download video first frame picture failed");coreDb.saveFile(e);var r=[e];return t.media_type===constant.MEDIA_TYPE.VIDEO&&t.file_list[1]&&(k.info("dealDownloadFileFailed: Download video failed"),r.push(t.file_list[1])),A.isQuoteFile(e)?l(t,[],r):l(t,r,[])}catch(e){k.error("dealDownloadFileFailed",e.toString())}}function i(e,t){try{if(k.info("dealDownloadScreenShotFailed 处理截图下载失败 message:"+Object.type(t)),isNullOrEmpty(t))return void k.error("dealDownloadScreenShotFailed 不存在此消息，忽略");var r=t.file_list;return e=r.query({file_name:e.file_name}),O.deleteFileByHandleList([e.file_handle,t.client_chat_id]),p(e),coreDb.saveScreenShot(e),l(t,r,[])}catch(e){k.error("dealDownloadScreenShotFailed 处理截图下载失败",e.toString())}}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return k.info("dealDownloadVideoImageSuccess 下载成功后处理"),T(e,t,r,e.status)}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return k.info("dealDownloadSuccess 下载成功后处理"),T(e,t,r,constant.MEDIA_STATUS.RECEIVE_SUCCESS)}function l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return k.info("dealDownloadFailed 下载失败后处理"),(e.media_type===constant.MEDIA_TYPE.FILE||e.media_type===constant.MEDIA_TYPE.VIDEO||coreIm.isShareFile(e.card_type))&&window.ToastNew(language.PC_DOWNLOAD_FAILED),T(e,t,r,constant.MEDIA_STATUS.RECEIVE_ERROR)}function d(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return k.info("dealUploadSuccess 上传成功后处理"),O.deleteFileByHandleList([t[0].file_handle,e.client_chat_id]),p(t[0]),e.status=constant.MEDIA_STATUS.SEND_SUCCESS,f(e,t)}function f(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return k.info("dealUpload 上传后处理"),e.file_list=t,R.updateMessageList(e),e}function p(e){k.info("clearFileHandle 清理文件handle和进度handle"),O.deleteFileByHandle(e.file_handle),R.deleteProgressMap(e.file_handle),delete e.file_handle}Object.defineProperty(t,"__esModule",{value:!0}),t.checkFileTransferInCurrentRecent=t.dealUploadFailed=t.dealScreenShotSendFailed=t.dealOfflineFileSendOrReceiveFail=t.dealVideoSendFailed=t.dealFileSendFailed=void 0;var g=r(149),_=a(g),h=r(147),v=a(h),m=r(1),M=a(m),y=r(139),E=a(y),S=r(2),I=a(S),w=(t.dealFileSendFailed=function(){var e=(0,I.default)(M.default.mark(function e(t,r){return M.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,k.info("dealFileSendFailed, File upload failed"),r.media_type!==constant.MEDIA_TYPE.PHOTO){e.next=8;break}return e.next=5,coreDb.saveScreenShot((0,E.default)({},t));case 5:e.t0=e.sent,e.next=11;break;case 8:return e.next=10,coreDb.saveFile((0,E.default)({},t));case 10:e.t0=e.sent;case 11:return t=e.t0,r.send_status=constant.SEND_STATUS.error,r.status=constant.MEDIA_STATUS.SEND_ERROR,e.abrupt("return",b(r,[t]));case 17:e.prev=17,e.t1=e.catch(0),k.error("dealFileSendFailed, File upload failed",e.t1.toString());case 20:case"end":return e.stop()}},e,this,[[0,17]])}));return function(t,r){return e.apply(this,arguments)}}(),t.dealVideoSendFailed=function(){var e=(0,I.default)(M.default.mark(function e(t,r){var n;return M.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,k.info("dealVideoSendFailed  处理视频上传失败"),n=t.file_list,!/\.png$/.test(r.file_real_save_name.toLocaleLowerCase())){e.next=9;break}return e.next=6,coreDb.saveScreenShot(r);case 6:n[1]=e.sent,e.next=12;break;case 9:return e.next=11,coreDb.saveFile(r);case 11:n[0]=e.sent;case 12:return t.send_status=constant.SEND_STATUS.error,t.status=constant.MEDIA_STATUS.SEND_ERROR,e.abrupt("return",b(t,n));case 17:e.prev=17,e.t0=e.catch(0),k.error("dealVideoSendFailed  处理视频上传失败",e.t0.toString());case 20:case"end":return e.stop()}},e,this,[[0,17]])}));return function(t,r){return e.apply(this,arguments)}}(),t.dealOfflineFileSendOrReceiveFail=function(){var e=(0,I.default)(M.default.mark(function e(){return M.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:o(),w();case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),function(){var e=(0,I.default)(M.default.mark(function e(){var t;return M.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,k.info("dealOfflineFileDownloadFail stop any file downloading when offline"),t=O.getFileHandleMap,!isNullOrEmpty(t)){e.next=5;break}return e.abrupt("return");case 5:coreIm.stopAllFileReceive(t),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),k.error("dealOfflineFileDownloadFail",e.t0);case 11:case"end":return e.stop()}},e,this,[[0,8]])}));return function(){return e.apply(this,arguments)}}()),T=(t.dealScreenShotSendFailed=function(){var e=(0,I.default)(M.default.mark(function e(t){var r,n,a,o,s,i,u;return M.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(k.info("dealScreenShotSendFailed 处理截图上传失败"),r=t.file_list,n=!0,a=!1,o=void 0,e.prev=5,s=(0,_.default)(r);!(n=(i=s.next()).done);n=!0)u=i.value,O.deleteFileByHandle(u.file_handle),p(r[0]);e.next=13;break;case 9:e.prev=9,e.t0=e.catch(5),a=!0,o=e.t0;case 13:e.prev=13,e.prev=14,!n&&s.return&&s.return();case 16:if(e.prev=16,!a){e.next=19;break}throw o;case 19:return e.finish(16);case 20:return e.finish(13);case 21:return t.send_status=constant.SEND_STATUS.error,t.status=constant.MEDIA_STATUS.SEND_ERROR,e.next=25,coreDb.saveMessage(t);case 25:t=e.sent,(0,C.updateMessageToRecent)(t),R.updateMessageList(t);case 28:case"end":return e.stop()}},e,this,[[5,9,13,21],[14,,16,20]])}));return function(t){return e.apply(this,arguments)}}(),function(){var e=(0,I.default)(M.default.mark(function e(t){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:constant.MEDIA_STATUS.RECEIVE_SUCCESS;return M.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return k.info("dealDownload 下载后处理"),isNullOrEmpty(a)||(r=(0,E.default)({},t.quote),r.file_list=a,r.status=o,t.quote=r,coreDb.saveMessage(t.quote)),t.status=o,e.next=5,coreDb.saveMessage(t);case 5:t=e.sent,t.file_list=n,R.updateMessageList(t);case 8:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),b=t.dealUploadFailed=function(){var e=(0,I.default)(M.default.mark(function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return M.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return k.info("dealUploadFailed 上传失败后处理"),r.forEach(function(e){O.deleteFileByHandleList([e.file_handle,t.client_chat_id]),p(e)}),e.next=4,coreDb.saveMessage(t);case 4:return t=e.sent,(0,C.updateMessageToRecent)(t),e.abrupt("return",f(t,r));case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}();t.checkFileTransferInCurrentRecent=function(){var e=(0,I.default)(M.default.mark(function e(t){var r,n,a,o,s,i,u,c,l,d,f,p,g,h,m,y,E,S,I;return M.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=O.querySendingMessageMap(),isNullOrEmpty(r)){e.next=30;break}n=(0,v.default)(r),a=!0,o=!1,s=void 0,e.prev=6,i=(0,_.default)(n);case 8:if(a=(u=i.next()).done){e.next=16;break}if(c=u.value,l=r[c],l.recent_owner!==t){e.next=13;break}return e.abrupt("return",!0);case 13:a=!0,e.next=8;break;case 16:e.next=22;break;case 18:e.prev=18,e.t0=e.catch(6),o=!0,s=e.t0;case 22:e.prev=22,e.prev=23,!a&&i.return&&i.return();case 25:if(e.prev=25,!o){e.next=28;break}throw s;case 28:return e.finish(25);case 29:return e.finish(22);case 30:if(d=O.getFileHandleMap(),!isNullOrEmpty(d)){e.next=33;break}return e.abrupt("return",!1);case 33:f=(0,v.default)(d),p=!0,g=!1,h=void 0,e.prev=37,m=(0,_.default)(f);case 39:if(p=(y=m.next()).done){e.next=51;break}if(E=y.value,S=d[E],S.file_deal_type!==constant.FILE_DEAL_TYPE.DOWNLOAD&&S.file_deal_type!==constant.FILE_DEAL_TYPE.RE_DOWNLOAD){e.next=48;break}return e.next=45,coreDb.queryMessage({server_chat_id_str:S.message_server_chat_id_str});case 45:if(I=e.sent,I.recent_owner!==t){e.next=48;break}return e.abrupt("return",!0);case 48:p=!0,e.next=39;break;case 51:e.next=57;break;case 53:e.prev=53,e.t1=e.catch(37),g=!0,h=e.t1;case 57:e.prev=57,e.prev=58,!p&&m.return&&m.return();case 60:if(e.prev=60,!g){e.next=63;break}throw h;case 63:return e.finish(60);case 64:return e.finish(57);case 65:return e.abrupt("return",!1);case 66:case"end":return e.stop()}},e,this,[[6,18,22,30],[23,,25,29],[37,53,57,65],[58,,60,64]])}));return function(t){return e.apply(this,arguments)}}();t.dealOfflineFileSendFail=o,t.dealDownloadFileFailed=s,t.dealDownloadScreenShotFailed=i,t.dealDownloadVideoImageSuccess=u,t.dealDownloadSuccess=c,t.dealDownloadFailed=l,t.dealUploadSuccess=d,t.dealUpload=f,t.clearFileHandle=p;var L=r(182),O=n(L),N=r(190),R=n(N),x=r(171),A=n(x),C=r(217),k=coreLogger.getLogger("logic")("IM/file/libs");window.offlineFail=o},322:function(e,t,r){e.exports={default:r(323),__esModule:!0}},323:function(e,t,r){r(324),e.exports=r(8).Object.values},324:function(e,t,r){var n=r(10),a=r(325)(!1);n(n.S,"Object",{values:function(e){return a(e)}})},325:function(e,t,r){var n=r(164),a=r(232),o=r(326).f;e.exports=function(e){return function(t){for(var r,s=a(t),i=n(s),u=i.length,c=0,l=[];u>c;)o.call(s,r=i[c++])&&l.push(e?[r,s[r]]:s[r]);return l}}},326:function(e,t,r){e.exports=r(0)(83)},337:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.cancelUploadTask=t.finishUploadTask=t.stopAllFileReceive=t.downloadPhoto=t.groupFilePreUpload=t.downloadUMOriginPicture=t.saveTeamSpace=t.dealOfflineFileSendFail=t.clearFileHandle=t.dealDownloadVideoImageSuccess=t.dealDownloadSuccess=t.dealUploadSuccess=t.dealScreenShotSendFailed=t.dealDownloadFileFailed=t.dealDownloadScreenShotFailed=t.dealVideoSendFailed=t.dealFileSendFailed=t.chooseUploadFile=t.openFolder=t.openFile=t.cancelSendFile=t.downloadMobileFile=t.saveAsImg=t.saveAsFile=t.rejectFile=t.receiveQuoteFile=t.receiveFile=t.reSendScreenShot=t.reSendFile=t.copyImageToCache=t.sendMobileMedia=t.sendAudio=t.sendMyVoice=t.sendFiles=void 0;var a=r(987),o=n(a),s=r(645),i=n(s),u=r(637),c=n(u),l=r(1013),d=n(l),f=r(1014),p=n(f),g=r(1015),_=n(g),h=r(1016),v=n(h),m=r(304),M=n(m),y=r(599),E=n(y),S=r(643),I=n(S),w=r(1017),T=n(w),b=r(1919),L=n(b),O=r(1012),N=n(O);t.sendFiles=o.sendFiles,t.sendMyVoice=o.sendMyVoice,t.sendAudio=o.sendAudio,t.sendMobileMedia=o.sendMobileMedia,t.copyImageToCache=o.copyImageToCache,t.reSendFile=d.reSendFile,t.reSendScreenShot=d.reSendScreenShot,t.receiveFile=i.receiveFile,t.receiveQuoteFile=i.receiveQuoteFile,t.rejectFile=i.rejectFile,t.saveAsFile=i.saveAsFile,t.saveAsImg=i.saveAsImg,t.downloadMobileFile=c.downloadMobileFile,t.cancelSendFile=p.cancelSendFile,t.openFile=_.openFile,t.openFolder=_.openFolder,t.chooseUploadFile=v.chooseUploadFile,t.dealFileSendFailed=M.dealFileSendFailed,t.dealVideoSendFailed=M.dealVideoSendFailed,t.dealDownloadScreenShotFailed=M.dealDownloadScreenShotFailed,t.dealDownloadFileFailed=M.dealDownloadFileFailed,t.dealScreenShotSendFailed=M.dealScreenShotSendFailed,t.dealUploadSuccess=M.dealUploadSuccess,t.dealDownloadSuccess=M.dealDownloadSuccess,t.dealDownloadVideoImageSuccess=M.dealDownloadVideoImageSuccess,t.clearFileHandle=M.clearFileHandle,t.dealOfflineFileSendFail=M.dealOfflineFileSendFail,t.saveTeamSpace=T.saveTeamSpace,t.downloadUMOriginPicture=c.downloadUMOriginPicture,t.groupFilePreUpload=E.groupFilePreUpload,t.downloadPhoto=I.downloadPhoto,t.stopAllFileReceive=L.stopAllFileReceive,t.finishUploadTask=N.finishUploadTask,t.cancelUploadTask=N.cancelUploadTask},338:function(e,t,r){"use strict";function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";coreLogger.getLogger("model")("localTimeService").info(e+" initService"),o.default.initLocalTimeService()}Object.defineProperty(t,"__esModule",{value:!0}),t.localTimeService=void 0,t.initLocalTimeService=n;var a=r(1912),o=function(e){return e&&e.__esModule?e:{default:e}}(a);t.localTimeService=o.default},357:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.dealWithdrawMessageNotify=t.dealWithdrawMessageAck=t.withdrawMessage=t.goToConversationMessage=t.goToMessage=t.transformGroupNotifyMessage=t.createVideoMessageContent=t.createFileMessage=t.createQuotePhotoTextMessageContent=t.createFileMessageContent=t.createPhotoTextMessageContent=t.formatSendImgInfo=t.createCallRecordMessage=t.createGroupMemberChgMessage=t.createGroupNotifyMessage=t.deleteMessage=t.relayMessage=t.reSendMessage=t.dealRelativeEmotionPath=t.saveMessageListInfo=t.dealRecentLastMessageList=t.dealHistoryMessageList=t.dealReceiveMessage=t.getMessageShowText=t.getMessageShowHtml=t.reSendScreenShots=t.sendScreenShots=t.sendMobileTextMessage=t.sendNormalMessage=void 0;var a=r(988),o=n(a),s=r(1001),i=n(s),u=r(1005),c=n(u),l=r(1006),d=n(l),f=r(1007),p=n(f),g=r(302),_=n(g),h=r(831),v=n(h),m=r(1008),M=n(m);t.sendNormalMessage=o.sendNormalMessage,t.sendMobileTextMessage=o.sendMobileTextMessage,t.sendScreenShots=o.sendScreenShots,t.reSendScreenShots=o.reSendScreenShots,t.getMessageShowHtml=i.getMessageShowHtml,t.getMessageShowText=i.getMessageShowText,t.dealReceiveMessage=i.dealReceiveMessage,t.dealHistoryMessageList=i.dealHistoryMessageList,t.dealRecentLastMessageList=i.dealRecentLastMessageList,t.saveMessageListInfo=i.saveMessageListInfo,t.dealRelativeEmotionPath=i.dealRelativeEmotionPath,t.reSendMessage=c.reSendMessage,t.relayMessage=d.relayMessage,t.deleteMessage=p.deleteMessage,t.createGroupNotifyMessage=_.createGroupNotifyMessage,t.createGroupMemberChgMessage=_.createGroupMemberChgMessage,t.createCallRecordMessage=_.createCallRecordMessage,t.formatSendImgInfo=_.formatSendImgInfo,t.createPhotoTextMessageContent=_.createPhotoTextMessageContent,t.createFileMessageContent=_.createFileMessageContent,t.createQuotePhotoTextMessageContent=_.createQuotePhotoTextMessageContent,t.createFileMessage=_.createFileMessage,t.createVideoMessageContent=_.createVideoMessageContent,t.transformGroupNotifyMessage=_.transformGroupNotifyMessage,t.goToMessage=v.goToMessage,t.goToConversationMessage=v.goToConversationMessage,t.withdrawMessage=M.withdrawMessage,t.dealWithdrawMessageAck=M.dealWithdrawMessageAck,t.dealWithdrawMessageNotify=M.dealWithdrawMessageNotify},358:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.updateMessageToRecent=t.onTabClick=t.markRecentAsRead=t.hasGroupFixedToTop=t.fixGroupToTop=t.hasRecentFixedToTop=t.fixRecentToTop=t.updateRecent=t.refreshRecentList=t.refreshRecentIsMute=t.selectRecentItem=t.deleteUnReadApplyGroupNotifyNumMap=t.updateUnReadApplyGroupNotifyNumMap=t.deleteUnReadNumMap=t.updateUnReadNumMap=t.deleteAtMap=t.updateAtMap=t.setMessageNotifyClose=t.initNewConversationUI=t.initOpenRecentData=t.openRecentConversation=t.changeHintsShow=t.toggleRecent=t.dealRecentByAddGroup=t.dealRecentByDeleteGroup=t.deleteRecent=t.dealServerRecentList=void 0;var o=r(1),s=a(o),i=r(2),u=a(i),c=r(827),l=n(c),d=r(642),f=n(d),p=r(994),g=n(p),_=r(359),h=n(_);r(995);var v=r(996),m=n(v),M=r(997),y=n(M),E=(t.dealServerRecentList=f.dealServerRecentList,t.deleteRecent=l.deleteRecent,t.dealRecentByDeleteGroup=l.dealRecentByDeleteGroup,t.dealRecentByAddGroup=l.dealRecentByAddGroup,t.toggleRecent=g.toggleRecent,t.changeHintsShow=g.changeHintsShow,t.openRecentConversation=g.openRecentConversation,t.initOpenRecentData=g.initOpenRecentData,t.initNewConversationUI=g.initNewConversationUI,t.setMessageNotifyClose=g.setMessageNotifyClose,t.updateAtMap=h.updateAtMap,t.deleteAtMap=h.deleteAtMap,t.updateUnReadNumMap=h.updateUnReadNumMap,t.deleteUnReadNumMap=h.deleteUnReadNumMap,t.updateUnReadApplyGroupNotifyNumMap=h.updateUnReadApplyGroupNotifyNumMap,t.deleteUnReadApplyGroupNotifyNumMap=h.deleteUnReadApplyGroupNotifyNumMap,t.selectRecentItem=h.selectRecentItem,t.refreshRecentIsMute=h.refreshRecentIsMute,t.refreshRecentList=h.refreshRecentList);t.updateRecent=h.updateRecent,t.fixRecentToTop=m.fixRecentToTop,t.hasRecentFixedToTop=m.hasRecentFixedToTop,t.fixGroupToTop=m.fixGroupToTop,t.hasGroupFixedToTop=m.hasGroupFixedToTop,t.markRecentAsRead=y.markRecentAsRead,t.onTabClick=function(e){var t=$getState().recent,r=t.selectedTagList,n=t.searchVal,a=r?r.length:0;"history"!==e?0!==a||null!==n&&""!==n||coreUi.clickToolbar("",!1):$dispatch(coreUi.onHistoryMenu()),$dispatch(coreUi.tabClick(e))},t.updateMessageToRecent=function(){var e=(0,u.default)(s.default.mark(function e(t){var r,n;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=$getState().recent.currentRecentInfo,e.next=3,coreIm.getLocalRecent({owner:t.recent_owner});case 3:return n=e.sent,n=coreIm.dealRecentLastMessageInfo(n,t),e.next=7,coreDb.saveRecent(n);case 7:n=e.sent,E(n),r.owner===t.recent_owner&&coreUi.showRecentIntoView(n.owner);case 10:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}()},359:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.setCurrentRecentImgList=t.getInitUserInfoStatus=t.initChangeShowRecentInfo=t.changeShowRecentInfo=t.updateRecent=t.refreshRecentList=t.refreshRecentIsMute=t.selectRecentItem=t.deleteUnReadApplyGroupNotifyNumMap=t.updateUnReadApplyGroupNotifyNumMap=t.deleteUnReadNumMap=t.updateUnReadNumMap=t.deleteAtMap=t.updateAtMap=void 0;var a=r(147),o=n(a),s=r(1),i=n(s),u=r(139),c=n(u),l=r(2),d=n(l),f=r(828),p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(f),g=coreLogger.getLogger("logic")("recent/list"),_={key:[],val:[]},h=null,v={key:[],val:[]},m=null,M={key:[],val:[]},y=null,E=(t.updateAtMap=function(e,t){clearTimeout(h),_.key.push(e),_.val.push(t),h=setTimeout(function(){p.updateAtMap(_.key,_.val),$dispatch(coreUi.updateRecent([])),_={key:[],val:[]}},50)},t.deleteAtMap=function(e){p.deleteAtMap(e),$dispatch(coreUi.updateRecent([]))},t.updateUnReadNumMap=function(e,t){clearTimeout(m),v.key.push(e),v.val.push(t),p.updateUnReadNumMap(v.key,v.val),v={key:[],val:[]},m=setTimeout(function(){$dispatch(coreUi.updateRecent([]))},50)},t.deleteUnReadNumMap=function(e){p.deleteUnReadNumMap(e),$dispatch(coreUi.updateRecent([]))},t.updateUnReadApplyGroupNotifyNumMap=function(e,t){clearTimeout(y),M.key.push(e),M.val.push(t),p.updateUnReadApplyGroupNotifyNumMap(M.key,M.val),M={key:[],val:[]},y=setTimeout(function(){$dispatch(coreUi.updateRecent([]))},50)},t.deleteUnReadApplyGroupNotifyNumMap=function(e){p.deleteUnReadApplyGroupNotifyNumMap(e),$dispatch(coreUi.updateRecent([]))},t.selectRecentItem=function(e){if(!isNullOrEmpty(e)){e.unread_num=0,e.set_unread_num=0,e.is_at=!1,g.debug("selectRecentItem","Clear unread messages and at information of the selected recent",e.id),p.deleteUnReadNumMap(e.owner),p.deleteAtMap(e.owner);var t=$getState().recent.atMessageList,r=[];t.map(function(t){t.recent_owner!==e.owner&&r.push(t)}),$dispatch(coreUi.setAtMessageList(r))}$dispatch(coreUi.selectRecentItem(e))},t.refreshRecentIsMute=function(){var e=(0,d.default)(i.default.mark(function e(t){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=$getState().recent.recentList,r.forEach(function(e){e.group_id===t&&(e.isMute=!e.isMute,$dispatch(coreUi.updateRecent((0,c.default)({},e))))});case 2:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.refreshRecentList=function(e){var t=$getState().recent.recentList;if(Object.type(e)===Object.type.ARRAY){var r=[],n=[];e.forEach(function(e){if(e.is_delete!==constant.IS_DELETE.YES){-1!==t.findIndex(function(t){return t.owner===e.owner})?n.push(e):r.push(e)}}),0!==n.length&&$dispatch(coreUi.updateRecent(n)),0!==r.length&&$dispatch(coreUi.addRecent(r))}else{if(e.is_delete===constant.IS_DELETE.YES)return;var a=t.findIndex(function(t){return t.owner===e.owner});-1!==a?(g.info("updateRecent",a),$dispatch(coreUi.updateRecent(e,a))):(g.info("addRecent"),$dispatch(coreUi.addRecent(e)))}},t.updateRecent=function(e){$dispatch(coreUi.updateRecent(e))},t.changeShowRecentInfo=function(){var e=(0,d.default)(i.default.mark(function e(){var t,r,n,a;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=$getState().recent.showRecentInfo,g.info("userClick changeShowRecentInfo",t),r=!t,$dispatch(coreUi.changeShowRecentInfo(r)),n=r.toString(),e.next=7,coreDb.saveUserConfig({key:"userInfoStatus",value:n});case 7:a=new Event("resize"),window.dispatchEvent(a);case 9:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),t.initChangeShowRecentInfo=function(){var e=(0,d.default)(i.default.mark(function e(){var t;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E();case 2:t=e.sent,$dispatch(coreUi.changeShowRecentInfo(t));case 4:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),t.getInitUserInfoStatus=function(){var e=(0,d.default)(i.default.mark(function e(){var t;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,coreDb.queryUserConfig({key:"userInfoStatus"});case 2:return t=e.sent,t=0===(0,o.default)(t).length||JSON.parse(t.value),e.abrupt("return",t);case 5:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}}());t.setCurrentRecentImgList=function(){var e=(0,d.default)(i.default.mark(function e(t){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:$dispatch(coreUi.setCurrentRecentImgList(t));case 1:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}()},360:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.checkEServerIsOnline=t.setEServerOffline=t.resumeToeServer=t.getEServerResumeAble=t.setEServerResumeAble=void 0;var a=r(1),o=n(a),s=r(2),i=n(s),u=r(1029),c=r(1030),l=r(833),d=coreLogger.getLogger("im")("resume"),f=coreLogger.getDataLogger("im")("resume"),p=!1,g=(t.setEServerResumeAble=function(e){d.info("setEServerResumeAble",e),p=e},t.getEServerResumeAble=function(){return d.info("getEServerResumeAble",p),p}),_=t.resumeToeServer=function(){var e=(0,i.default)(o.default.mark(function e(){var t,r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=getClientId(),h(n),g()){e.next=5;break}return(0,l.printEServerResumeLog)(t,n,"0 now _resumeAble is false ,not do resume"),e.abrupt("return");case 5:if(coreCommon.getIsNetworkOk()){e.next=8;break}return(0,l.printEServerResumeLog)(t,n,"0 now _networkIsOk is false ,not do resume"),e.abrupt("return");case 8:return e.next=10,coreAccount.getLoginModel();case 10:if(r=e.sent,!r.userSelectOffline){e.next=14;break}return(0,l.printEServerResumeLog)(t,n,"0 now user has select offline, not do resume,wait user click online"),e.abrupt("return");case 14:if(r.socketMode!==constant.IM_STG_MODE.USE_STG){e.next=21;break}return(0,l.printEServerResumeLog)(t,n,"0 now socketMode is USE_STG ,do checkStgReConnect"),e.next=18,coreAccount.checkStgReConnect();case 18:if(r.isBuildStgSuc){e.next=21;break}return(0,l.printEServerResumeLog)(t,n,"0 socketMode is USE_STG,but isBuildStgSuc is false"),e.abrupt("return",!1);case 21:return(0,l.printEServerResumeLog)(t,n,"0 resumeToeServer start"),e.next=24,I(n,t);case 24:return e.abrupt("return",coreAccount.makeLoginCancelable({promise:(0,u.eserverLogin)({descrition:n,id:t,resume:!0}),name:"<eserver_resume>",loginPromiseKey:constant.LOGIN_PROMISE_KEY.eserver_login}).then(function(){var e=(0,i.default)(o.default.mark(function e(r){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=6;break}if((0,l.printEServerResumeLog)(t,n,"eServerRet.result is "+r.result),!r.result){e.next=6;break}return f.info("ecs resume success"),e.next=6,coreAccount.makeLoginCancelable({promise:(0,c.afterEServerLoginSuccess)(r.param),name:"<eserver_resume> afterEServerResumeLoginSuccess",loginPromiseKey:constant.LOGIN_PROMISE_KEY.eserver_login});case 6:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){(0,l.printEServerResumeLog)(t,n,"error is "+e)}));case 25:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),h=t.setEServerOffline=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";d.info("setEServerOffline "+e),window.isEserverOnline=!1,coreAccount.setLocalOfflineStatus({info:"setEServerOffline "+e})},v=(t.checkEServerIsOnline=function(){var e=(0,i.default)(o.default.mark(function e(){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:h("checkEServerIsOnline"),window.dispatchEvent(new Event("eServerNotLogin"));case 2:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),function(){d.info("eServerNotLogin"),_("eServerNotLogin")}),m=function(){d.info(constant.RESUME_EVENT.SESSION_TIMEOUT),_(constant.RESUME_EVENT.SESSION_TIMEOUT)},M=function(){d.info("tlsStateChange"),_("tlsStateChange")},y=function(){d.info("heartBeatMiss"),_("heartBeatMiss")},E=function(){coreCommon.isPc()&&window.CLIENTCONFIG.USE_IM&&(d.info("netWorkChange"),_("netWorkChange"))},S=function(){var e=(0,i.default)(o.default.mark(function e(){var t;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(d.info("stgDisConnect"),!window.CLIENTCONFIG.USE_IM){e.next=6;break}return e.next=4,coreAccount.getLoginModel();case 4:t=e.sent,t.socketMode===constant.IM_STG_MODE.USE_STG&&_("stgDisConnect");case 6:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),I=function(){var e=(0,i.default)(o.default.mark(function e(t,r){var n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(0,l.printEServerResumeLog)(r,t,"0 clearImTupTask"),e.next=3,coreTup.getIMInstance();case 3:return n=e.sent,e.next=6,n.logoutForce();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}},e,void 0)}));return function(t,r){return e.apply(this,arguments)}}(),w=function(){d.info("eServerApiTimeout"),h("eServerApiTimeout")},T=function(){coreCommon.getIsNetworkOk()||h("networkIsOkChange")};window.addEventListener(constant.RESUME_EVENT.SESSION_TIMEOUT,m),window.addEventListener("eServerNotLogin",v),window.addEventListener("tlsStateChange",M),window.addEventListener("eServerApiTimeout",w),window.addEventListener("heartBeatMiss",y),window.addEventListener("networkchange",E),window.addEventListener("stgTunnelDisconnected",S),window.addEventListener("networkIsOkChange",T)},596:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.forwardQueryMessage=t.loadOneClickJumpMessageList=t.isLocalHas=t.dealMessageSign=t.firstGetImgList=t.lazyGetImgList=t.updateImgList=t.getImgList=t.loadServerMessage=t.updateMessageQueryInfo=t.backwardQueryMessage=t.getServerHistoryMessage=t.onlyLoadLocalHistoryMessageList=t.refreshMessageList=t.loadHistoryMessageList=void 0;var a=r(1913);Object.defineProperty(t,"loadOneClickJumpMessageList",{enumerable:!0,get:function(){return a.loadOneClickJumpMessageList}}),Object.defineProperty(t,"forwardQueryMessage",{enumerable:!0,get:function(){return a.forwardQueryMessage}});var o=r(1916),s=n(o),i=r(1917),u=n(i),c=r(992),l=n(c),d=r(641),f=n(d),p=r(1918),g=n(p);t.loadHistoryMessageList=s.loadHistoryMessageList,t.refreshMessageList=s.refreshMessageList,t.onlyLoadLocalHistoryMessageList=s.onlyLoadLocalHistoryMessageList,t.getServerHistoryMessage=s.getServerHistoryMessage,t.backwardQueryMessage=u.backwardQueryMessage,t.updateMessageQueryInfo=f.updateMessageQueryInfo,t.loadServerMessage=f.loadServerMessage,t.getImgList=g.getImgList,t.updateImgList=g.updateImgList,t.lazyGetImgList=g.lazyGetImgList,t.firstGetImgList=g.firstGetImgList,t.dealMessageSign=l.dealMessageSign,t.isLocalHas=l.isLocalHas},597:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.refreshPhoneRecent=t.getLocalRecent=t.dealUnreadMessageNum=t.dealRecentLastMessageInfo=t.createOrGetRecentByMessage=t.openGroupConversationByConf=t.openGroupConversation=t.createGroupConversation=t.createOrUpdateRecent=t.getImExtendInfo=void 0;var o=r(3),s=a(o),i=r(139),u=a(i),c=r(1),l=a(c),d=r(2),f=a(d),p=r(359),g=n(p),_=r(171),h=n(_),v=r(640),m=n(v),M=r(358),y=r(338),E=r(217),S=n(E),I=r(829),w=n(I),T=r(830),b=coreLogger.getLogger("logic")("recent/list/dealData"),L=(t.getImExtendInfo=function(){var e=(0,f.default)(l.default.mark(function e(t){var r,n;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,b.info("getImExtendInfo 获取右推信息",t.id,handlePhoneNumber(t.owner)),e.next=4,coreGroup.getMemberListByGroupIdInQueue(t.owner);case 4:if(r=e.sent,b.debug("getImExtendInfo",r),n=$getState().recent.currentRecentInfo,n.owner!==t.owner){e.next=12;break}return b.info("getImExtendInfo is currentRecent,update ducks data,recent.id="+t.id+",memberList.length="+r.length),coreUi.freshImExtMemberList(r),coreContact.downloadContactListAvatar({accountList:r.map(function(e){return e.account}),highPriority:!0}),e.abrupt("return");case 12:b.info("getImExtendInfo is not currentRecent,do nothing,recent.id="+t.id+",memberList.length="+r.length),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),b.error("getImExtendInfo",t.id,e.t0.toString());case 18:case"end":return e.stop()}},e,void 0,[[0,15]])}));return function(t){return e.apply(this,arguments)}}(),t.createOrUpdateRecent=function(){var e=(0,f.default)(l.default.mark(function e(){var t,r,n,a,o,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{contact:null,group:null},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,c=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,b.info("createOrUpdateRecent",c,d),t=$getState().recent.recentList,r=void 0,n=s.contact,a=s.group,!isNullOrEmpty(a)){e.next=18;break}if(!isNullOrEmpty(n)){e.next=10;break}return e.abrupt("return",{});case 10:return coreDb.saveContact((0,u.default)({},n)),e.next=13,O({owner:n.account});case 13:r=e.sent,isNullOrEmpty(r)&&(r={chat_type:constant.CHAT_TYPE.SINGLE_CHAT,owner:n.account,account:n.account,time_stamp:y.localTimeService.getLocalTime(),contact:n,stick_on_top:0,is_delete:constant.IS_DELETE.NO}),(0,T.subscribeRecentList)([r]);case 16:e.next=22;break;case 18:return e.next=20,O({owner:a.group_id});case 20:r=e.sent,isNullOrEmpty(r)&&(r={chat_type:m.getChatTypeByGroup(a),owner:a.group_id,group_id:a.group_id,time_stamp:y.localTimeService.getLocalTime(),stick_on_top:0,is_delete:constant.IS_DELETE.NO,group:a,unread_group_notify_num:0});case 22:if(r.is_delete=constant.IS_DELETE.NO,c&&((0,M.deleteUnReadNumMap)(r.owner),r.unread_num=0),isNullOrEmpty(r.last_message)?(r.last_message={},r.time_stamp=y.localTimeService.getLocalTime()):d&&(b.info("force to update timestamp by out"),r.time_stamp=y.localTimeService.getLocalTime()),isNullOrEmpty(i)||(r.id=i),""!==r.owner){e.next=28;break}return e.abrupt("return");case 28:return e.next=30,coreDb.saveRecent(r);case 30:return r=e.sent,o=t.find(function(e){return e.owner===r.owner}),o&&(r.last_message=o.last_message),e.abrupt("return",r);case 36:return e.prev=36,e.t0=e.catch(0),b.error("createOrUpdateRecent",c,d,e.t0),e.abrupt("return",{});case 40:case"end":return e.stop()}},e,void 0,[[0,36]])}));return function(){return e.apply(this,arguments)}}(),t.createGroupConversation=function(){var e=(0,f.default)(l.default.mark(function e(t){var r,n,a,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=t.group_id,e.next=4,coreGroup.getGroupInfoFromDB(r);case 4:return n=e.sent,isNullOrEmpty(n)&&b.error("createGroupConversation get group from db fail"),e.next=8,coreIm.createOrUpdateRecent({group:n},null,o,s);case 8:return a=e.sent,b.info("createGroupConversation"),e.abrupt("return",{recent:a,group:n});case 13:e.prev=13,e.t0=e.catch(0),b.error("createGroupConversation",e.t0);case 16:case"end":return e.stop()}},e,void 0,[[0,13]])}));return function(t){return e.apply(this,arguments)}}(),t.openGroupConversation=function(){var e=(0,f.default)(l.default.mark(function e(t){var r,n,a;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,coreIm.createGroupConversation(t);case 3:if(r=e.sent,n=r.recent,a=r.group,!a.id&&!a.group_id){e.next=11;break}if(window.CLIENTCONFIG.ISMOBILE){e.next=10;break}return e.next=10,coreCommon.switchNav("recent");case 10:coreIm.openRecentConversation(n);case 11:b.info("打开群组会话"),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),b.error("openGroupConversation",e.t0);case 17:case"end":return e.stop()}},e,void 0,[[0,14]])}));return function(t){return e.apply(this,arguments)}}(),t.openGroupConversationByConf=function(){var e=(0,f.default)(l.default.mark(function e(t){var r,n,a,o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,coreIm.createGroupConversation(t,!0);case 3:if(r=e.sent,n=r.recent,a=r.group,!a.group_id||!n){e.next=12;break}if(!s||window.CLIENTCONFIG.ISMOBILE){e.next=10;break}return e.next=10,coreCommon.switchNav("recent");case 10:coreIm.toggleRecent(n,o),b.info("openGroupConversationByConf");case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),b.error("openGroupConversationByConf",e.t0);case 17:case"end":return e.stop()}},e,void 0,[[0,14]])}));return function(t){return e.apply(this,arguments)}}(),t.createOrGetRecentByMessage=function(){var e=(0,f.default)(l.default.mark(function e(t,r){var n,a,o,i,u,c,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,b.info("createOrGetRecentByMessage",d),n=void 0,a=void 0,o=!1,coreCommon.isSelfAccount(t.origin)&&(o=!0),!h.isGroup(t.chat_type)){e.next=15;break}return e.next=7,s.default.all([O({owner:t.group_id}),coreGroup.getGroupInfoFromDB(void 0===t?"":t.group_id)]);case 7:i=e.sent,n=i[0],a=i[1],isNullOrEmpty(n)&&(n={chat_type:t.chat_type,owner:t.group_id,time_stamp:t.utc_stamp,last_message:t,group:a,stick_on_top:0,is_delete:constant.IS_DELETE.NO,is_disable:isNullOrEmpty(a)}),u=$getState().recent.currentRecentInfo,u&&u.owner===n.owner||h.isAtMessage(t)&&(n.is_at=!0,S.updateAtMap(n.owner,!0),w.addAtMessage(t)),e.next=24;break;case 15:return c=o?t.target:t.origin,e.next=18,O({owner:c});case 18:if(n=e.sent,!isNullOrEmpty(n)){e.next=24;break}return e.next=22,coreContact.getContactByAccount(c,!0);case 22:r=e.sent,n={chat_type:t.chat_type,owner:r.account,time_stamp:t.utc_stamp,last_message:t,contact:r,stick_on_top:0,is_delete:constant.IS_DELETE.NO,is_disable:!1};case 24:return o||(n.unread_num=L(n,d)),n.is_delete=constant.IS_DELETE.NO,e.abrupt("return",n);case 29:e.prev=29,e.t0=e.catch(0),b.error("createOrGetRecentByMessage",d,e.t0.toString());case 32:case"end":return e.stop()}},e,void 0,[[0,29]])}));return function(t,r){return e.apply(this,arguments)}}(),t.dealRecentLastMessageInfo=function(e,t){try{if(b.info("dealRecentLastMessageInfo 刷新会话最后一条消息"),isNullOrEmpty(e.time_stamp)||isNullOrEmpty(e.last_message)||e.time_stamp<=t.utc_stamp){if(t.show_html===constant.DEAL_ERROR)return b.error("dealRecentLastMessageInfo 消息处理出错，忽略"),e;e.time_stamp=t.utc_stamp}return e.last_message=t,e.last_message_server_chat_id_str=t.server_chat_id_str,e}catch(t){return b.error("dealRecentLastMessageInfo",t.toString()),e}},t.dealUnreadMessageNum=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;try{b.info("dealUnreadMessageNum",t);var r=$getState().recent.currentRecentInfo;if(b.info("dealUnreadMessageNum recentId 匹配当前会话",r.owner===e.owner),r.owner!==e.owner){if(-1!==t)return(0,M.updateUnReadNumMap)(e.owner,t),b.info("dealUnreadMessageNum 指定更新数量",t),t;var n=e.unread_num;return isNullOrEmpty(n)?((0,M.updateUnReadNumMap)(e.owner,1),b.info("dealUnreadMessageNum 1"),1):(b.info("dealUnreadMessageNum 正常加一",n+1),(0,M.updateUnReadNumMap)(e.owner,n+1),n+1)}return(0,M.deleteUnReadNumMap)(e.owner),0}catch(r){return b.error("dealUnreadMessageNum 错误",t,r.toString()),(0,M.deleteUnReadNumMap)(e.owner),0}}),O=t.getLocalRecent=function(){var e=(0,f.default)(l.default.mark(function e(t){var r,n;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,b.info("getLocalRecent"),r=$getState().recent.recentList,n=r.query(t),isNullOrEmpty(n)){e.next=6;break}return e.abrupt("return",n);case 6:return e.next=8,coreDb.queryRecent(t);case 8:if(n=e.sent,!isNullOrEmpty(n)){e.next=11;break}return e.abrupt("return",{});case 11:return e.abrupt("return",(0,u.default)({},n));case 14:return e.prev=14,e.t0=e.catch(0),b.error("getLocalRecent",e.t0.toString()),e.abrupt("return",{});case 18:case"end":return e.stop()}},e,void 0,[[0,14]])}));return function(t){return e.apply(this,arguments)}}(),N=(t.refreshPhoneRecent=function(){var e=(0,f.default)(l.default.mark(function e(t){var r;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O({owner:t.num});case 2:r=e.sent,isNullOrEmpty(r)?r=N(t):r.time_stamp<t.time_stamp&&(r.time_stamp=t.time_stamp,coreDb.saveRecent(r)),g.refreshRecentList(r);case 5:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),function(){var e=(0,f.default)(l.default.mark(function e(t){var r;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={chat_type:constant.CHAT_TYPE.CUSTOM_CHAT,owner:t.num,time_stamp:t.time_stamp},coreDb.saveRecent(r),e.abrupt("return",r);case 3:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}())},598:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e){try{var t=e.content,r=coreCommon.String2MessageXML(t),n=JSON.parse(r.querySelector("c").textContent.split("<![CDATA[")[1].split("]]>")[0]),a=n.title,o=n.cardContext,s=n.cardType;isNullOrEmpty(a)&&(a=""),isNullOrEmpty(o)&&(o={});var i=M.getCardBubbleType(s,o.customSubCardType),u=$getState().login.account===e.origin;switch(i){case constant.BUBBLE_TYPE.SHARE_FILE:case constant.BUBBLE_TYPE.SHARE_KNOWLEDGE:return"["+language.EDITOR_TOOLS_TITLE_CARD+"]"+a;case constant.BUBBLE_TYPE.BUSINESS_CARD:return"["+language.BUSINESS_CARD+"]"+a;case constant.BUBBLE_TYPE.COMBINE_TRANSMIT:case constant.BUBBLE_TYPE.OUT_SHARE:return"["+language.EDITOR_TOOLS_TITLE_CARD+"]"+a;case constant.BUBBLE_TYPE.RED_PACKET:return"["+(u?language.RED_PACKET_MESSAGE:language.RED_PACKET)+"]"+a;case constant.BUBBLE_TYPE.WE_CODE:return"["+language.WE_CODE_MESSAGE+"]";case constant.BUBBLE_TYPE.MAKE_COMPLAINTS:return"["+language.MAKE_COMPLAINTS_MESSAGE+"]";default:return"["+language.EDITOR_TOOLS_TITLE_CARD+"]"+a}}catch(e){return S.error("getCardShowText:",e.toString()),"["+language.EDITOR_TOOLS_TITLE_CARD+"]"}}Object.defineProperty(t,"__esModule",{value:!0}),t.dealRelativeEmotionPath=t.saveMessageListInfo=t.getMessageShowHtml=t.getMessageShowText=t.dealPcRecentListLastMessageInfo=t.dealPcMessageList=t.dealPcMessageInfo=void 0;var s=r(3),i=a(s),u=r(142),c=a(u),l=r(1),d=a(l),f=r(139),p=a(f),g=r(2),_=a(g),h=r(302),v=n(h),m=r(171),M=n(m),y=r(182),E=n(y),S=coreLogger.getLogger("logic")("IM/message/receive"),I=(t.dealPcMessageInfo=function(){var e=(0,_.default)(d.default.mark(function e(t,r,n){var a,o;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,S.debug("dealPcMessageInfo"),a=E.getMessageWithdrawServerId({server_chat_id_str:t.server_chat_id_str}),!1!==(o=b(t))){e.next=9;break}return S.error("dealPcMessageInfo 消息格式不正确，不解析",t.server_chat_id_str),e.abrupt("return",{});case 9:isNullOrEmpty(a)||S.error("dealPcMessageInfo 该消息已撤回，不显示",t.server_chat_id_str);case 10:return t=x(t,r,n),t=L(t,o),t=P(t,o),e.next=15,N((0,p.default)({},t),o);case 15:return t.quote=e.sent,e.abrupt("return",t);case 19:e.prev=19,e.t0=e.catch(0),S.error("dealPcMessageInfo",e.t0.toString());case 22:case"end":return e.stop()}},e,void 0,[[0,19]])}));return function(t,r,n){return e.apply(this,arguments)}}(),t.dealPcMessageList=function(){var e=(0,_.default)(d.default.mark(function e(t,r){var n,a,o,s,i,u,c;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(e.prev=0,S.debug("dealPcMessageList"),n=[],a=[],o=[],s=0;s<t.length;s++)i=E.getMessageWithdrawServerId({server_chat_id_str:t[s].server_chat_id_str}),u=b(t[s]),isNullOrEmpty(i)?!1===u?S.error("dealPcMessageList 消息格式不正确，不解析",t[s].server_chat_id_str):(n.push(t[s].origin),a.push(t[s]),o.push(u)):S.error("dealPcMessageList 该消息已撤回，不显示",t[s].server_chat_id_str);return showDealTime("  1.1 开始批量查询联系人信息"),e.next=9,coreContact.getContactListByAccountList(n);case 9:return c=e.sent,showDealTime("  1.2 开始批量处理消息基本信息"),a=A(a,r,c),showDealTime("  1.3 开始处理消息文件信息"),a=O(a,o),showDealTime("  1.4 开始处理消息展示信息"),a=F(a,o),showDealTime("  1.5 开始处理消息引用信息"),e.next=19,R(a,o);case 19:return a=e.sent,e.abrupt("return",a);case 23:return e.prev=23,e.t0=e.catch(0),S.error("dealPcMessageList",e.t0.toString()),e.abrupt("return",t);case 27:case"end":return e.stop()}},e,void 0,[[0,23]])}));return function(t,r){return e.apply(this,arguments)}}(),t.dealPcRecentListLastMessageInfo=function(){var e=(0,_.default)(d.default.mark(function e(t,r){var n,a,o,s,i,u,c;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(e.prev=0,S.debug("dealPcRecentListLastMessageInfo"),n=[],a=[],o=[],s=[],i=0;i<t.length;i++)u=b(t[i]),!1===u?S.error("dealPcRecentListLastMessageInfo 消息格式不正确，不解析",t[i].server_chat_id_str):(n.push(t[i].origin),a.push((0,p.default)({},t[i])),o.push((0,p.default)({},r[i])),s.push(u));return e.next=9,coreContact.getContactListByAccountList(n);case 9:return c=e.sent,a=A(a,o,c),a=O(a,s),a=F(a,s),e.next=15,R(a,s);case 15:return a=e.sent,e.abrupt("return",{messageList:a,recentList:o});case 19:return e.prev=19,e.t0=e.catch(0),S.error("dealPcRecentListLastMessageInfo",e.t0.toString()),e.abrupt("return",{messageList:t,recentList:r});case 23:case"end":return e.stop()}},e,void 0,[[0,19]])}));return function(t,r){return e.apply(this,arguments)}}(),t.getMessageShowText=function(e,t){try{S.debug("getMessageShowText");var r=void 0,n=void 0;switch(e.media_type){case constant.MEDIA_TYPE.TEXT:case constant.MEDIA_TYPE.LIKE:case constant.MEDIA_TYPE.AUTO_REPLY:if(isNullOrEmpty(t)&&!1===(t=b(e)))return S.error("getMessageShowText 处理消息体失败，直接返回空"),"";if((n=t.querySelector("content"))&&n.textContent)return n.textContent||"";if(r=T(e),r.includes("<content>")){var a=r.split("<content>")[1].split("</content>")[0];return S.debug("getMessageShowText 特殊处理无法解析XML的消息"),a}return S.debug("getMessageShowText 未解析内容"),"";case constant.MEDIA_TYPE.PHOTO:case constant.MEDIA_TYPE.SCREEN_SHOT:case constant.MEDIA_TYPE.PHOTO_TEXT:return"["+language.PHOTO+"]";case constant.MEDIA_TYPE.VIDEO:return"["+language.IDS_TEXT_CAMERA+"]";case constant.MEDIA_TYPE.AUDIO:return"["+language.MSG_TYPE_AUDIO+"]";case constant.MEDIA_TYPE.SHARE:case constant.MEDIA_TYPE.CARD:if(M.isShareImage(e.card_type))return"["+language.PHOTO+"]";if(M.isShareFile(e.card_type)){if(isNullOrEmpty(e.file_list)){var s=JSON.parse(e.show_html);coreIm.dealShareFileMessageFileList(e,s)}return"["+language.FILE+"]"+(e.file_list[0].file_real_save_name||e.file_list[0].file_name)}return o(e);case constant.MEDIA_TYPE.FILE:return isNullOrEmpty(e.file_list)?isNullOrEmpty(t)&&!1===(t=b(e))?(S.error("getMessageShowText 处理消息体失败，直接返回空"),""):(n=t.querySelector("content"),n&&e.media_type===constant.MEDIA_TYPE.FILE?"["+language.FILE+"]"+coreIm.resolveFileInfoByContent(n.textContent).file_name:"["+language.FILE+"]"):"["+language.FILE+"]"+(e.file_list[0].file_real_save_name||e.file_list[0].file_name);case constant.MEDIA_TYPE.SECRET:return"["+language.SECRET_MESSAGE+"]";case constant.MEDIA_TYPE.GROUP_MEMBERCHG_NOTIFY:case constant.MEDIA_TYPE.GROUP_NAME_CHANGE:case constant.MEDIA_TYPE.APPLY_JOIN_FIXED_GROUP_NOTIFY:case constant.MEDIA_TYPE.UPGRADE_TO_FIXED_GROUP_NOTIFY:case constant.MEDIA_TYPE.WITHDRAW_NOTIFY:return e.show_text;default:return S.error("message is null"),""}}catch(e){return S.error("getMessageShowText",e.toString()),""}}),w=t.getMessageShowHtml=function(e,t){try{if(isNullOrEmpty(t)&&!1===(t=b(e)))return S.error("getMessageShowHtml 处理消息体失败，直接返回空"),"";var r="",n=t.querySelector("html");if(n&&n.childNodes[0])r=n.childNodes[0].nodeValue;else{var a=T(e);a.includes("CDATA")&&(r=a.split("<![CDATA[")[1].split("]]>")[0])}var o=coreCommon.String2HTML(r);if(!isNullOrEmpty(o)&&("FONT"===o.nodeName||"font"===o.nodeName)){var s=o.getAttribute("face"),i=o.getAttribute("style");isNullOrEmpty(s)||(isNullOrEmpty(i)?i="font-family:"+s:i+=";font-family:"+s),o.setAttribute("style",i);var u=$getState().login.account;return coreCommon.XML2String(o).replaceAll(constant.SERVER_PUBLIC_PATH.IMAGE_PATH,appService.getScreenShotPath(u)).replaceAll('onmouseup="ShowImageMenu(this)"','onload="delegate.onImageLoad(this)" data-query-id="'+e.server_chat_id_str+'" onerror="delegate.onImageError(this)"').replaceAll("onmouseup=ShowImageMenu(this)",'onload="delegate.onImageLoad(this)" data-query-id="'+e.server_chat_id_str+'" onerror="delegate.onImageError(this)"')}""===r?r=v.transformHtmlEmotion(e.show_text):e.show_text.includes("]]>")&&r&&(r=v.transformHtmlEmotion(r));var c=$getState().login.account,l={width:0,height:0};if(e.media_type===constant.MEDIA_TYPE.PHOTO_TEXT){l=e.file_list[0]}return r.replaceAll(constant.SERVER_PUBLIC_PATH.IMAGE_PATH,(0,m.isShowOriginImg)(l)?appService.getOriginFilesPath(c):appService.getScreenShotPath(c)).replaceAll('onmouseup="ShowImageMenu(this)"','onload="delegate.onImageLoad(this)" data-query-id="'+e.server_chat_id_str+'" onerror="delegate.onImageError(this)"').replaceAll("onmouseup=ShowImageMenu(this)",'onload="delegate.onImageLoad(this)" data-query-id="'+e.server_chat_id_str+'" onerror="delegate.onImageError(this)"')}catch(e){return S.error("getMessageShowHtml",e.toString()),constant.DEAL_ERROR}},T=(t.saveMessageListInfo=function(){var e=(0,_.default)(d.default.mark(function e(t){var r,n,a,o,s,u,l,f,g;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,S.debug("saveMessageListInfo 批量保存消息及相关数据"),r=[],n=0;case 4:if(!(n<t.length)){e.next=13;break}return a=(0,p.default)({},t[n]),e.next=8,coreDb.queryMessage({server_chat_id_str:a.server_chat_id_str});case 8:o=e.sent,isNullOrEmpty(o)?r.push(a):S.debug("[saveMessageListInfo]","messageId:",a.server_chat_id_str,"is exist in local");case 10:n++,e.next=4;break;case 13:s=[],u=[],l=[],f=0;case 15:if(!(f<r.length)){e.next=26;break}if(g=(0,p.default)({},r[f]),!isNullOrEmpty(g)){e.next=19;break}return e.abrupt("continue",23);case 19:isNullOrEmpty(g.quote)||(s.push(g.quote),isNullOrEmpty(g.quote.file_list)||(M.hasScreenShot(g.quote.media_type)?l.push.apply(l,(0,c.default)(g.quote.file_list)):u.push.apply(u,(0,c.default)(g.quote.file_list)))),isNullOrEmpty(g.file_list)||(M.hasScreenShot(g.media_type)?l.push.apply(l,(0,c.default)(g.file_list)):u.push.apply(u,(0,c.default)(g.file_list))),s.push(g),coreIm.updateImgList(g,"update");case 23:f++,e.next=15;break;case 26:return e.next=28,i.default.all([coreDb.bulkPutMessage([].concat(s)),coreDb.bulkPutFile(u),coreDb.bulkPutScreenShot(l)]);case 28:e.next=33;break;case 30:e.prev=30,e.t0=e.catch(0),S.error("saveMessageListInfo",e.t0.toString());case 33:case"end":return e.stop()}},e,void 0,[[0,30]])}));return function(t){return e.apply(this,arguments)}}(),function(e){try{var t=e.content,r=/content.*\[CDATA\[.*content/g,n=void 0,a=void 0,o=coreCommon.String2MessageXML(t);return"1"===o.querySelector("g").textContent?(a=o.querySelector("c").textContent,n=coreCommon.unZip(a)):n=o.querySelector("c").textContent,r.test(n)&&(n=n.split("<![CDATA[").join(""),n=n.split("]]>").join("")),n}catch(e){return S.error("getMessageContentC 消息格式异常",e.toString()),constant.DEAL_ERROR}}),b=function(e){try{return coreCommon.String2HTML(T(e))}catch(e){return S.error("getMessageContentCXML 格式异常",e.toString()),!1}},L=function(e,t){try{switch(S.debug("getMessageFileInfo"),e.media_type){case constant.MEDIA_TYPE.PHOTO:case constant.MEDIA_TYPE.PHOTO_TEXT:case constant.MEDIA_TYPE.SCREEN_SHOT:e.file_list=U(e,t),e.file_list.length>1&&(e.media_type=constant.MEDIA_TYPE.PHOTO_TEXT);break;case constant.MEDIA_TYPE.VIDEO:e.file_list=D(e,t),e.file_list=e.file_list.concat(G(e,t));break;case constant.MEDIA_TYPE.AUDIO:case constant.MEDIA_TYPE.FILE:e.status=constant.MEDIA_STATUS.RECEIVE,coreCommon.isSelfAccount(e.origin)&&(e.status=constant.MEDIA_STATUS.SEND_SUCCESS),e.file_list=D(e,t);break;case constant.MEDIA_TYPE.CARD:e.file_list=Q(e,t)}return e}catch(t){return S.error("getMessageFileInfo",t.toString()),e}},O=function(e,t){try{return S.debug("getMessageListFileInfo"),e.map(function(e,r){return L(e,t[r])}),e}catch(t){return S.error("getMessageListFileInfo",t.toString()),e}},N=function(){var e=(0,_.default)(d.default.mark(function e(t,r){var n,a,o,s,i,u,c;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,S.debug("getQuote"),n={},a=r.querySelector("quote"),isNullOrEmpty(a)){e.next=26;break}for(S.info("getQuote 有引用消息"),o=$getState(),s=o.myInfo,i=coreCommon.unZip(a.textContent);coreCommon.isZipStr(i);)i=coreCommon.unZip(i);if(n={origin:a.getAttribute("origin"),media_type:parseInt(a.getAttribute("mediatype")),content:i,client_chat_id:getClientId(),utc_stamp:t.utc_stamp},n.server_chat_id_str=n.client_chat_id.toString(),S.debug("getQuote 引用消息"),u=s,n.origin===u.account){e.next=18;break}return e.next=17,coreContact.getContactByAccount(n.origin);case 17:u=e.sent;case 18:if(!1!==(c=b(n))){e.next=22;break}return S.error("getQuote 引用消息的格式不正确，不解析"),e.abrupt("return",{});case 22:n=C(n,u),n=Y(n,c,t),n.show_text=I(n,c),n=P(n,c);case 26:return e.abrupt("return",n);case 29:return e.prev=29,e.t0=e.catch(0),S.error("getQuote",e.t0.toString()),e.abrupt("return",t);case 33:case"end":return e.stop()}},e,void 0,[[0,29]])}));return function(t,r){return e.apply(this,arguments)}}(),R=function(){var e=(0,_.default)(d.default.mark(function e(t,r){var n,a,o,s,i,u,c,l,f,p,g,_,h;return d.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,n=[],a=[],o=[],s=[],i=[],u=0;case 7:if(!(u<t.length)){e.next=24;break}if(c=t[u],l=r[u],f={},p=l.querySelector("quote"),!isNullOrEmpty(p)){e.next=14;break}return e.abrupt("continue",21);case 14:for(S.info("getMessageListQuote 有引用消息"),g=coreCommon.unZip(p.textContent);coreCommon.isZipStr(g);)g=coreCommon.unZip(g);f={origin:p.getAttribute("origin"),media_type:parseInt(p.getAttribute("mediatype")),content:g,client_chat_id:getClientId(),utc_stamp:p.getAttribute("time")||""},f.server_chat_id_str=f.client_chat_id.toString(),_=b(f),!1===_?S.error("getMessageListQuote 引用消息的格式不正确，不解析"):(a.push(_),o.push(f.origin),s.push(u),i.push(c),n.push(f));case 21:u++,e.next=7;break;case 24:return showDealTime("    1.5.1 批量获取引用消息联系人"),e.next=27,coreContact.getContactListByAccountList(o);case 27:return h=e.sent,showDealTime("    1.5.2 处理引用基本信息"),n=k(n,h),showDealTime("    1.5.3 处理引用文件信息"),n=$(n,a,i),showDealTime("    1.5.4 处理引用显示信息"),n=F(n,a),s.forEach(function(e,r){t[e].quote=n[r]}),showDealTime("处理引用消息完成"),e.abrupt("return",t);case 39:return e.prev=39,e.t0=e.catch(0),S.error("getMessageListQuote",e.t0.toString()),e.abrupt("return",t);case 43:case"end":return e.stop()}},e,void 0,[[0,39]])}));return function(t,r){return e.apply(this,arguments)}}(),x=function(e,t,r){try{return S.debug("getMessageInfo 处理消息基本信息"),e.recent_owner=t.owner,e.recent_id=t.id,e.chat_type!==constant.CHAT_TYPE.PUBLIC_NO&&(e.native_name=r.native_name,e.name=r.name),e.is_delete=constant.IS_DELETE.NO,e.is_read=1,e.is_auto_reply=!1,M.checkClientChatId(e.client_chat_id)||(S.error("dealMessageList 错误的client",e.server_chat_id_str),e.client_chat_id=getClientId()),e.chat_type===constant.CHAT_TYPE.AUTO_REPLY&&(e.chat_type=constant.CHAT_TYPE.SINGLE_CHAT,e.is_auto_reply=!0),coreCommon.isSelfAccount(e.origin)&&(e.send_status=constant.SEND_STATUS.success),e.solid_m&&(e.media_type=constant.MEDIA_TYPE.SECRET),e}catch(t){return S.error("getMessageInfo",t.toString()),e}},A=function(e,t,r){try{var n=Object.type(t)===Object.type.ARRAY;return e.map(function(e,a){return n?x(e,t[a],r[a]):x(e,t,r[a])}),e}catch(t){return S.error("getMessageListInfo",t.toString()),e}},C=function(e,t){try{return S.debug("getQuoteInfo"),e.native_name=t.native_name,e.name=t.name,e}catch(t){return S.error("getQuoteInfo",t.toString()),e}},k=function(e,t){try{return e.map(function(e,r){return isNullOrEmpty(e)?e:C(e,t[r])}),e}catch(t){return S.error("getQuoteListInfo",t.toString()),e}},P=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];try{if(S.debug("getShowInfo isDealShowHtml",r),coreIm.isGroupNotifyMessage(e.media_type)||(e.show_text=I(e,t)),!r||e.media_type!==constant.MEDIA_TYPE.TEXT&&e.media_type!==constant.MEDIA_TYPE.PHOTO_TEXT&&e.media_type!==constant.MEDIA_TYPE.LIKE||(e.show_html=w(e,t)),r&&e.media_type===constant.MEDIA_TYPE.SHARE){var n=B(e,t);n.includes("CDATA")&&(n=n.split("[CDATA[")[1].split("]]")[0]);var a=JSON.parse(n),o=a.cardType;if(isNullOrEmpty(a.cardContext))o=constant.CARD_TYPE.UNDEFINED;else{var s=a.cardContext.isPCDisplay,i=a.cardContext.customSubCardType;0===s&&o!==constant.CARD_TYPE.ESpaceSharingType2ndRedPacketNew&&o!==constant.CARD_TYPE.WECodeCardType&&i!==constant.CARD_TYPE.WECodeCustomSubCardType&&o!==constant.CARD_TYPE.MakeComplaintsCardType&&i!==constant.CARD_TYPE.MakeComplaintsSubCardType&&(o=constant.CARD_TYPE.UNDEFINED)}e.show_html=n,e.card_type=o;var u=M.isShareImage(o);(u||M.isShareFile(o))&&M.dealShareFileMessageFileList(e,a,u)}if(r&&e.media_type===constant.MEDIA_TYPE.CARD){var c=B(e,t);c.includes("CDATA")&&(c=c.split("[CDATA[")[1].split("]]")[0]),e.show_html=c}return e}catch(t){return S.error("getShowInfo",t.toString()),e}},F=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];try{return e.map(function(e,n){return P(e,t[n],r)}),e}catch(t){return S.error("getMessageListShowInfo",t.toString()),e}},D=function(e,t){try{S.debug("getFileInfo");var r={};try{var n=t.querySelector("content").textContent;if(isNullOrEmpty(n))return S.error("getFileInfo 没有文件信息"),[];r=M.resolveFileInfoByContent(n)}catch(t){S.error("getFileInfo JSON格式的文件消息");var a=JSON.parse(e.content);r.um_plain_access_code=a.plain_access_code,r.um_url=a.url,r.file_size=a.file_size,r.file_name=a.file_name}if(isNullOrEmpty(r.um_url)||isNullOrEmpty(r.um_plain_access_code)||isNullOrEmpty(r.file_name))return S.error("getFileInfo 文件信息不正确"),[];var o=$getState().login.account;return r.file_real_save_path=appService.getReceiveFilesPath(o)+r.file_name,(r.file_real_save_name=r.file_name,r.is_downloaded=constant.IS_DOWNLOADED.NO,r.file_deal_type=constant.FILE_DEAL_TYPE.DOWNLOAD,Z(r))?null:(r=K(r,e),[r])}catch(e){return S.error("getFileInfo 没有文件信息",e.toString()),[]}},U=function(e,t){try{S.debug("getImageInfoList");var r=t.querySelectorAll("photo-item"),n=[],a=$getState().myInfo.account;if(isNullOrEmpty(r)){var o=W(t,e,a);isNullOrEmpty(o)||(n=[o])}else for(var s=0;s<r.length;s++){var i=r[s],u=V(i,e,a);isNullOrEmpty(u)||n.push(u)}return n}catch(e){return S.error("getImageInfoList",e.toString()),null}},G=function(e,t){var r=$getState().myInfo.account,n=t.querySelector("content").textContent;try{S.debug("resolveFileInfoByContent");var a=new RegExp("\\||;|{|}"),o=n.split(a),s=o[4].split(".").shift()+"."+Date.now()+".png";return o.length<14?[]:{um_url:o[11],file_type:"Img",file_size:0,file_name:s,duration:0,width:o[12],height:o[13],um_plain_access_code:o[14],is_downloaded:constant.IS_DOWNLOADED.NO,file_real_save_path:appService.getScreenShotPath(r)+s,file_path:appService.getOriginFilesPath(r)+s,file_deal_type:constant.FILE_DEAL_TYPE.DOWNLOAD,file_real_save_name:s,message_server_chat_id_str:e.server_chat_id_str}}catch(e){return S.error("resolveFileInfoByContent 文件信息解析失败",e.toString()),[]}},B=function(e,t){try{return S.debug("dealGroupSpaceFileInfo"),t.querySelector("content").childNodes[0].nodeValue}catch(e){return S.error("dealGroupSpaceFileinfo 没有文件信息",e.toString()),[]}},H=function(e,t){try{S.debug("getQuoteImageInfoList");var r=e.querySelectorAll("photo-item"),n=[],a=$getState().myInfo.account;if(isNullOrEmpty(r)){var o=z(e,a,t);isNullOrEmpty(o)||(n=[o])}else for(var s=0;s<r.length;s++){var i=r[s],u=X(i,a,t);isNullOrEmpty(u)||n.push(u)}return n}catch(e){return S.error("getQuoteImageInfoList",e.toString()),null}},Y=function(e,t,r){try{switch(S.debug("getQuoteFileInfo"),e.media_type){case constant.MEDIA_TYPE.PHOTO:case constant.MEDIA_TYPE.PHOTO_TEXT:case constant.MEDIA_TYPE.SCREEN_SHOT:e.file_list=H(t,r),e.file_list.length>1&&(e.media_type=constant.MEDIA_TYPE.PHOTO_TEXT);break;case constant.MEDIA_TYPE.VIDEO:case constant.MEDIA_TYPE.AUDIO:case constant.MEDIA_TYPE.FILE:e.status=constant.MEDIA_STATUS.RECEIVE,coreCommon.isSelfAccount(r.origin)&&(e.status=constant.MEDIA_STATUS.SEND_SUCCESS),e.file_list=j(t,r);break;case constant.MEDIA_TYPE.SHARE:e.file_list=q(t,r)}return e}catch(t){return S.error("getQuoteFileInfo",t.toString()),e}},$=function(e,t,r){try{return S.debug("getQuoteListFileInfo"),e.map(function(e,n){var a=t[n],o=r[n];return Y(e,a,o)}),e}catch(t){return S.error("getQuoteListFileInfo",t.toString()),e}},j=function(e,t){try{S.debug("getQuoteFileInfoList");var r={};try{var n=e.querySelector("content").textContent;if(isNullOrEmpty(n))return S.error("getQuoteFileInfoList 没有文件信息"),[];r=M.resolveFileInfoByContent(n)}catch(e){return S.error("getQuoteFileInfoList 异常信息"),[]}if(isNullOrEmpty(r.um_url)||isNullOrEmpty(r.um_plain_access_code)||isNullOrEmpty(r.file_name))return S.error("getQuoteFileInfoList 文件信息不正确"),[];var a=$getState().login.account;return r.file_real_save_path=appService.getReceiveFilesPath(a)+r.file_name,r.file_real_save_name=r.file_name,r.is_downloaded=constant.IS_DOWNLOADED.NO,r.file_deal_type=constant.FILE_DEAL_TYPE.DOWNLOAD,r=J(r,t),[r]}catch(e){return S.error("getQuoteFileInfoList 没有文件信息",e.toString()),[]}},q=function(e,t){try{S.debug("getQuoteGroupSpaceFileInfo");var r={},n=JSON.parse(e.querySelector("content").childNodes[0].nodeValue);return r.um_url=n.cardContext.sourceUrl,(r.file_size=n.cardContext.fileSize,r.file_name=n.title,isNullOrEmpty(r.um_url)||isNullOrEmpty(r.file_name))?(S.error("getQuoteGroupSpaceFileInfo 没有文件信息"),[]):(r.is_downloaded=constant.IS_DOWNLOADED.NO,r.file_deal_type=constant.FILE_DEAL_TYPE.DOWNLOAD,r=J(r,t),[r])}catch(e){return S.error("getQuoteGroupSpaceFileInfo 没有文件信息",e.toString()),[]}},Q=(t.dealRelativeEmotionPath=function(e){try{var t=e;if(e&&-1!==e.indexOf(constant.SERVER_PUBLIC_PATH.EMOTION_PATH)){var r=e.split(constant.SERVER_PUBLIC_PATH.EMOTION_PATH);t=r[0];for(var n=1;n<r.length;n++){var a=r[n].indexOf(".");t=t+window.EMOTION_PATH+r[n].slice(0,a)+".png"+r[n].slice(a+4,r[n].length)}}return t}catch(e){S.error("dealRelativeEmotionPath",e.toString())}},function(e,t){var r=B(e,t);r.includes("CDATA")&&(r=r.split("[CDATA[")[1].split("]]")[0]);var n=JSON.parse(r),a=n.imgUrl,o=document.createElement("p");o.innerHTML="<content>"+a+"</content>";var s=$getState().myInfo.account,i=W(o,e,s);return isNullOrEmpty(i)?[]:[i]}),W=function(e,t,r){try{S.debug("getImageInfoByContent");var n=e.querySelector("content").textContent,a=M.resolveFileInfoByContent(n);return a.is_downloaded=constant.IS_DOWNLOADED.NO,a.file_real_save_path=appService.getScreenShotPath(r)+a.file_name,a.file_path=appService.getOriginFilesPath(r)+a.file_name,a.file_deal_type=constant.FILE_DEAL_TYPE.DOWNLOAD,a.file_real_save_name=a.file_name,Z(a)?null:K(a,t)}catch(e){S.error("getImageInfoByContent",e.toString())}},V=function(e,t,r){try{S.debug("getImageInfoByPhotoItem");var n={file_name:e.getAttribute("name"),file_size:e.getAttribute("size"),height:e.getAttribute("height"),width:e.getAttribute("width"),um_url:e.getAttribute("url"),um_plain_access_code:e.getAttribute("plain-access-code")};return n.is_downloaded=constant.IS_DOWNLOADED.NO,n.file_real_save_path=appService.getScreenShotPath(r)+n.file_name,n.file_path=appService.getOriginFilesPath(r)+n.file_name,n.file_deal_type=constant.FILE_DEAL_TYPE.DOWNLOAD,n.file_real_save_name=n.file_name,Z(n)?null:K(n,t)}catch(e){S.error("getImageInfoByPhotoItem",e.toString())}},z=function(e,t,r){try{S.debug("getQuoteImageInfoByContent");var n=e.querySelector("content").textContent,a=M.resolveFileInfoByContent(n);return a.is_downloaded=constant.IS_DOWNLOADED.NO,a.file_real_save_path=appService.getScreenShotPath(t)+a.file_name,a.file_deal_type=constant.FILE_DEAL_TYPE.DOWNLOAD,a.file_real_save_name=a.file_name,J(a,r)}catch(e){S.error("getQuoteImageInfoByContent",e.toString())}},X=function(e,t,r){try{S.debug("getQuoteImageInfoByPhotoItem");var n={file_name:e.getAttribute("name"),file_size:e.getAttribute("size"),height:e.getAttribute("height"),width:e.getAttribute("width"),um_url:e.getAttribute("url"),um_plain_access_code:e.getAttribute("plain-access-code")};return n.is_downloaded=constant.IS_DOWNLOADED.NO,n.file_real_save_path=appService.getScreenShotPath(t)+n.file_name,n.file_deal_type=constant.FILE_DEAL_TYPE.DOWNLOAD,n.file_real_save_name=n.file_name,J(n,r)}catch(e){S.error("getQuoteImageInfoByPhotoItem",e.toString())}},K=function(e,t){try{return S.debug("bindMessageInfoToFile"),e.recent_id=t.recent_id,e.recent_owner=t.recent_owner,e.message_id=t.id,e.message_server_chat_id_str=t.server_chat_id_str,e.time_stamp=t.utc_stamp,e.is_quote=constant.IS_QUOTE.NO,e}catch(e){return S.error("bindMessageInfoToFile",e.toString()),null}},J=function(e,t){if(!Z(e))return e.recent_id=t.recent_id,e.recent_owner=t.recent_owner,e.message_id=t.id,e.message_server_chat_id_str=t.server_chat_id_str,e.time_stamp=t.utc_stamp,e.is_quote=constant.IS_QUOTE.YES,e},Z=function(e){return!!(isNullOrEmpty(e.um_url)||isNullOrEmpty(e.um_plain_access_code)||isNullOrEmpty(e.file_name))&&(S.error("checkFileInfoError"),!0)}},599:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e,t){try{return d.info("groupFilePreUpload"),u.groupFilePreUpload({group_id:t.group_id,file_name:e.file_name,file_size:e.file_size||0}).then(function(r){return""!==r?l.setGroupFileByHandle(t.group_id+e.file_real_save_path,{pre_file_id:r}):d.error("groupFilePreUpload im预上传失败"),s.default.resolve(r)})}catch(e){return d.error("groupFilePreUpload",e.toString()),s.default.resolve("")}}Object.defineProperty(t,"__esModule",{value:!0});var o=r(3),s=function(e){return e&&e.__esModule?e:{default:e}}(o);t.groupFilePreUpload=a;var i=r(228),u=n(i),c=r(182),l=n(c),d=coreLogger.getLogger("logic")("IM/groupFile")},636:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.calcImgSize=t.correctStatusDesc=void 0,t.randomLikeImg=t.sendLike=t.sendMobileLike=t.dealCopy=t.getCurrentStatus=t.setTipPosition=t.setCurrentPlayVideo=t.updateMessageList=t.updateMessageListByClientId=t.optionBtn=t.clearScreen=t.addNewMessage=t.deleteAtMessage=t.addAtMessage=t.tipLiten=t.getMuteForMobile=t.setMuteForMobile=t.clientRepot=t.registerPush=t.changeIndexOpt=t.downloadMobileFileLogic=t.downLoadOrginImageLogic=t.previewOption=t.copyFile=t.rightMenuRelayMessage=t.setUnreadNewMessageNum=t.clearNewMessageFromMessageList=t.hideMessageToast=t.showMessageToast=t.readCurrentRecentInfo=t.storeCurrentRecent=t.dealGroupNotify=t.removeUnReadMessageFlash=t.dealUnDealMessageList=t.dealTopRecentConversation=t.dealMsgRead=t.dealSysBulletinRead=t.dealSystemBulletin=t.dealChatList=t.dealCodeChat=t.dealSendMessageAck=t.isLocalHas=t.loadServerMessage=t.dealMessageSign=t.firstGetImgList=t.lazyGetImgList=t.updateImgList=t.getImgList=t.backwardQueryMessage=t.forwardQueryMessage=t.refreshMessageList=t.onlyLoadLocalHistoryMessageList=t.loadHistoryMessageList=t.copyImageToCache=t.cancelUploadTask=t.finishUploadTask=t.stopAllFileReceive=t.saveTeamSpace=t.sendMobileMedia=t.dealOfflineFileSendFail=t.reSendScreenShot=t.downloadMobileFile=t.chooseUploadFile=t.openFolder=t.openFile=t.saveAsImg=t.saveAsFile=t.rejectFile=t.receiveQuoteFile=t.receiveFile=t.reSendFile=t.cancelSendFile=t.sendMyVoice=t.sendFiles=t.downloadUMOriginPicture=t.transformGroupNotifyMessage=t.dealWithdrawMessageNotify=t.dealWithdrawMessageAck=t.withdrawMessage=t.goToConversationMessage=t.goToMessage=t.createCallRecordMessage=t.createGroupMemberChgMessage=t.createGroupNotifyMessage=t.getMessageShowText=t.getMessageShowHtml=t.dealRecentLastMessageList=t.deleteMessage=t.relayMessage=t.reSendMessage=t.sendScreenShots=t.sendMobileTextMessage=t.sendNormalMessage=t.savePublicNoIncrementTime=t.getPublicNOUrlCode=t.publicNoMsgParse=t.getSubscribePublicNO=t.parsePublicNoContent=t.getOfflinePublicNoMsg=t.getAllSubscribePublicNo=void 0;var a=r(978);Object.defineProperty(t,"getAllSubscribePublicNo",{enumerable:!0,get:function(){return a.getAllSubscribePublicNo}}),Object.defineProperty(t,"getOfflinePublicNoMsg",{enumerable:!0,get:function(){return a.getOfflinePublicNoMsg}}),Object.defineProperty(t,"parsePublicNoContent",{enumerable:!0,get:function(){return a.parsePublicNoContent}}),Object.defineProperty(t,"getSubscribePublicNO",{enumerable:!0,get:function(){return a.getSubscribePublicNO}}),Object.defineProperty(t,"publicNoMsgParse",{enumerable:!0,get:function(){return a.publicNoMsgParse}}),Object.defineProperty(t,"getPublicNOUrlCode",{enumerable:!0,get:function(){return a.getPublicNOUrlCode}}),Object.defineProperty(t,"savePublicNoIncrementTime",{enumerable:!0,get:function(){return a.savePublicNoIncrementTime}});var o=r(824);Object.defineProperty(t,"previewOption",{enumerable:!0,get:function(){return o.previewOption}}),Object.defineProperty(t,"downLoadOrginImageLogic",{enumerable:!0,get:function(){return o.downLoadOrginImageLogic}}),Object.defineProperty(t,"downloadMobileFileLogic",{enumerable:!0,get:function(){return o.downloadMobileFileLogic}}),Object.defineProperty(t,"changeIndexOpt",{enumerable:!0,get:function(){return o.changeIndexOpt}});var s=r(644),i=n(s),u=r(357),c=n(u),l=r(596),d=n(l),f=r(337),p=n(f),g=r(303),_=n(g),h=r(228),v=n(h),m=r(1018),M=n(m),y=r(829),E=n(y),S=r(190),I=n(S),w=r(1019),T=n(w),b=r(1021),L=n(b),O=r(1023),N=n(O),R=r(1024),x=n(R);t.sendNormalMessage=c.sendNormalMessage,t.sendMobileTextMessage=c.sendMobileTextMessage,t.sendScreenShots=c.sendScreenShots,t.reSendMessage=c.reSendMessage,t.relayMessage=c.relayMessage,t.deleteMessage=c.deleteMessage,t.dealRecentLastMessageList=c.dealRecentLastMessageList,t.getMessageShowHtml=c.getMessageShowHtml,t.getMessageShowText=c.getMessageShowText,t.createGroupNotifyMessage=c.createGroupNotifyMessage,t.createGroupMemberChgMessage=c.createGroupMemberChgMessage,t.createCallRecordMessage=c.createCallRecordMessage,t.goToMessage=c.goToMessage,t.goToConversationMessage=c.goToConversationMessage,t.withdrawMessage=c.withdrawMessage,t.dealWithdrawMessageAck=c.dealWithdrawMessageAck,t.dealWithdrawMessageNotify=c.dealWithdrawMessageNotify,t.transformGroupNotifyMessage=c.transformGroupNotifyMessage,t.downloadUMOriginPicture=p.downloadUMOriginPicture,t.sendFiles=p.sendFiles,t.sendMyVoice=p.sendMyVoice,t.cancelSendFile=p.cancelSendFile,t.reSendFile=p.reSendFile,t.receiveFile=p.receiveFile,t.receiveQuoteFile=p.receiveQuoteFile,t.rejectFile=p.rejectFile,t.saveAsFile=p.saveAsFile,t.saveAsImg=p.saveAsImg,t.openFile=p.openFile,t.openFolder=p.openFolder,t.chooseUploadFile=p.chooseUploadFile,t.downloadMobileFile=p.downloadMobileFile,t.reSendScreenShot=p.reSendScreenShot,t.dealOfflineFileSendFail=p.dealOfflineFileSendFail,t.sendMobileMedia=p.sendMobileMedia,t.saveTeamSpace=p.saveTeamSpace,t.stopAllFileReceive=p.stopAllFileReceive,t.finishUploadTask=p.finishUploadTask,t.cancelUploadTask=p.cancelUploadTask,t.copyImageToCache=p.copyImageToCache,t.loadHistoryMessageList=d.loadHistoryMessageList,t.onlyLoadLocalHistoryMessageList=d.onlyLoadLocalHistoryMessageList,t.refreshMessageList=d.refreshMessageList,t.forwardQueryMessage=d.forwardQueryMessage,t.backwardQueryMessage=d.backwardQueryMessage,t.getImgList=d.getImgList,t.updateImgList=d.updateImgList,t.lazyGetImgList=d.lazyGetImgList,t.firstGetImgList=d.firstGetImgList,t.dealMessageSign=d.dealMessageSign,t.loadServerMessage=d.loadServerMessage,t.isLocalHas=d.isLocalHas,t.dealSendMessageAck=i.dealSendMessageAck,t.dealCodeChat=i.dealCodeChat,t.dealChatList=i.dealChatList,t.dealSystemBulletin=i.dealSystemBulletinMessage,t.dealSysBulletinRead=i.dealSysBulletinRead,t.dealMsgRead=i.dealMsgRead,t.dealTopRecentConversation=i.dealTopRecentConversation,t.dealUnDealMessageList=i.dealUnDealMessageList,t.removeUnReadMessageFlash=i.removeUnReadMessageFlash,t.dealGroupNotify=i.dealGroupNotify,t.storeCurrentRecent=i.storeCurrentRecent,t.readCurrentRecentInfo=i.readCurrentRecentInfo,t.showMessageToast=_.showMessageToast,t.hideMessageToast=_.hideMessageToast,t.clearNewMessageFromMessageList=_.clearNewMessageFromMessageList,t.setUnreadNewMessageNum=_.setUnreadNewMessageNum,t.rightMenuRelayMessage=_.rightMenuRelayMessage,t.copyFile=_.copyFile,t.registerPush=v.registerPush,t.clientRepot=v.clientRepot,t.setMuteForMobile=v.setMuteForMobile,t.getMuteForMobile=v.getMuteForMobile,t.tipLiten=M.tipLiten,t.addAtMessage=E.addAtMessage,t.deleteAtMessage=E.deleteAtMessage,t.addNewMessage=I.addNewMessage,t.clearScreen=I.clearScreen,t.optionBtn=I.optionBtn,t.updateMessageListByClientId=I.updateMessageListByClientId,t.updateMessageList=I.updateMessageList,t.setCurrentPlayVideo=I.setCurrentPlayVideo,t.setTipPosition=T.setTipPosition,t.getCurrentStatus=T.getCurrentStatus,t.dealCopy=T.dealCopy,t.sendMobileLike=L.sendMobileLike,t.sendLike=L.sendLike,t.randomLikeImg=L.randomLikeImg,t.correctStatusDesc=N.correctStatusDesc,t.calcImgSize=x.calcImgSize},637:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.downloadMobileFile=t.downloadUMOriginPicture=t.isExistOfOriginImage=void 0;var o=r(135),s=a(o),i=r(1),u=a(i),c=r(2),l=a(c),d=r(182),f=n(d),p=r(171),g=n(p),_=r(337),h=coreLogger.getLogger("logic")("IM/file/downloadMobilePhoto");t.isExistOfOriginImage=function(){var e=(0,l.default)(u.default.mark(function e(t){var r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,appService.isFileExist(t.file_path);case 2:r=e.sent,t.is_downloaded=r?constant.IS_DOWNLOADED.YES:constant.IS_DOWNLOADED.NO;case 4:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.downloadUMOriginPicture=function(){var e=(0,l.default)(u.default.mark(function e(t){var r,n,a,o,i,c,l,d,p;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,h.info("downloadUMOriginPicture 下载原图"),r=$getState().myInfo.account,e.next=5,appService.isFileExist(t.file_path);case 5:if(n=e.sent,a=f.getUnDownloadedPhoto("FALSE_"+t.file_real_save_name),isNullOrEmpty(a)){e.next=10;break}return h.info("downloadUMOriginPicture is downloading"),e.abrupt("return");case 10:if(n){e.next=38;break}return h.info("downloadUMOriginPicture 截图图片开始下载"),t.is_downloaded=constant.DOWNLOAD_IMAGE_STATE.DOWNLOADING,t.file_deal_type=constant.FILE_DEAL_TYPE.DOWNLOAD,t.file_path&&(t.file_path=coreIm.getRealFilePath({filePath:t.file_path}).replace("file://","")),f.setUnDownloadedPhoto("FALSE_"+t.file_real_save_name,(0,s.default)({},t,{isThumbnail:!1})),e.next=18,coreIm.downloadFile({access_code:t.um_plain_access_code,url:t.um_url,path:t.file_path||appService.getOriginFilesPath(r)+t.file_name,isThumbnail:!1,isDownloadFile:!0});case 18:if(!1!==(o=e.sent)){e.next=27;break}return f.deleteUnDownloadedPhoto("FALSE_"+t.file_real_save_name),e.next=23,coreDb.queryMessage({server_chat_id_str:t.message_server_chat_id_str});case 23:return i=e.sent,e.next=26,(0,_.dealDownloadScreenShotFailed)(t,i);case 26:return e.abrupt("return");case 27:return t.file_handle=o.param.pcfile_handle.toString(),f.setFileByHandle(t.file_handle,(0,s.default)({},t,{isThumbnail:!1})),e.next=31,coreDb.queryMessage({server_chat_id_str:t.message_server_chat_id_str});case 31:c=e.sent,l=g.findFileIndex(c,t),c.file_list[l].is_downloaded=constant.DOWNLOAD_IMAGE_STATE.DOWNLOADING,c.file_list[l].file_handle=o.param.pcfile_handle.toString(),coreIm.updateImgList(c,"update"),e.next=46;break;case 38:return h.debug("downloadUMOriginPicture 截图图片已存在"),t.is_downloaded=constant.IS_DOWNLOADED.YES,e.next=42,coreDb.queryMessage({server_chat_id_str:t.message_server_chat_id_str});case 42:d=e.sent,p=g.findFileIndex(d,t),d.file_list[p].is_downloaded=constant.IS_DOWNLOADED.YES,coreIm.updateImgList(d,"update");case 46:if(coreCommon.getMediaType(t.file_name)!==constant.MEDIA_TYPE.PHOTO){e.next=51;break}return e.next=49,coreDb.saveFile(t);case 49:e.next=53;break;case 51:return e.next=53,coreDb.saveScreenShot(t);case 53:e.next=59;break;case 55:e.prev=55,e.t0=e.catch(0),f.deleteUnDownloadedPhoto("FALSE_"+t.file_real_save_name),h.error("downloadUMOriginPicture",e.t0.toString());case 59:case"end":return e.stop()}},e,void 0,[[0,55]])}));return function(t){return e.apply(this,arguments)}}(),t.downloadMobileFile=function(e){try{h.info("downloadMobileFile 下载图片"),appService.saveImgToPhotos(e),window.Toast(language.SAVE_TO_ALBUM_SUCCESS,2)}catch(e){h.error("downloadMobileFile",e.toString())}}},638:function(e,t,r){"use strict";function n(){var e={};this.__proto__={init:function(){e={}},set:function(t,r){e[t]=r},get:function(t){return e[t]},getAll:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return isNullOrEmpty(t)?e:Object.queryAll(e,t)},delete:function(t){delete e[t]}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},639:function(e,t,r){"use strict";function n(){function e(){if(!n&&(n=coreLogger.getLogger("model")("IMService/screenShotUploadNotify")),0===t.length)return n.debug("dealPromiseQueue function's queue deal over"),r=!1,o.default.resolve(!0);var a=t.shift();n.debug("dealPromiseQueue function's queue is dealing"),a().then(e)}var t=[],r=!1,n=void 0;this.__proto__={addQueueFunc:function(e){t.push(e)},runQueueFunc:function(){r||(r=!0,e())}}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(3),o=function(e){return e&&e.__esModule?e:{default:e}}(a);t.default=n},640:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=coreLogger.getLogger("service")("IM/recentUtil");t.getRecentOwner=function(e){try{return isNullOrEmpty(e.owner)?coreIm.isGroup(e.chat_type)?e.group.group_id:e.contact.account:e.owner}catch(e){return n.error("getRecentOwner",e.toString()),null}},t.isShowRecent=function(e){var t=e.is_delete,r=e.contact,n=e.group,a=e.chat_type,o=e.last_message;if(t===constant.IS_DELETE.YES)return!1;if(a===constant.CHAT_TYPE.SYSTEM_NOTIFICATION||a===constant.CHAT_TYPE.PUBLIC_NO)return!0;if(coreIm.isGroup(a)){if(isNullOrEmpty(n)&&isNullOrEmpty(o))return!1}else if(isNullOrEmpty(r)&&isNullOrEmpty(o))return!1;return!0},t.getChatTypeByGroup=function(e){return e.group_type===constant.GROUP_TYPE.FIXED_GROUP?constant.CHAT_TYPE.GROUP_CHAT:constant.CHAT_TYPE.DISCUSSION_GROUP}},641:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.checkOnlyLoadLocalMessage=t.updateMessageQueryInfo=t.loadDbMessage=t.loadServerMessage=t.initAddMoreHistoryMessage=t.initLoadHistoryMessage=void 0;var o=r(1),s=a(o),i=r(139),u=a(i),c=r(2),l=a(c),d=r(190),f=n(d),p=r(357),g=n(p),_=r(991),h=coreLogger.getLogger("logic")("IM/historyMessageDeal"),v=(t.initLoadHistoryMessage=function(){h.info("initLoadHistoryMessage"),$dispatch(coreUi.initLoadHistoryMessage())},t.initAddMoreHistoryMessage=function(){h.info("initAddMoreHistoryMessage"),$dispatch(coreUi.initAddMoreHistoryMessage())},t.loadServerMessage=function(){var e=(0,l.default)(s.default.mark(function e(t,r,n){var a,o,i,c,l,d,f;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,a=n.chat_type,o=n.id,i=n.owner,h.info("loadServerMessage","historyMessageList count:"+t.length,"recent id:"+o),c=$getState(),l=c.recent.currentRecentInfo,l.owner===i){e.next=8;break}return h.info("loadServerMessage Not in the current recent"),e.abrupt("return");case 8:if(a!==constant.CHAT_TYPE.SYSTEM_NOTIFICATION){e.next=12;break}M(t),e.next=14;break;case 12:return e.next=14,g.dealHistoryMessageList(t,n);case 14:return h.info("loadServerMessage Query local messages",o),e.next=17,coreDb.limitMessageList((0,u.default)({},r));case 17:return d=e.sent,isNullOrEmpty(d)&&(h.info("loadServerMessage No local messages",o),$dispatch(coreUi.haveNoMoreLocalMessage())),f=!1,9999999999999!==r.utc_stamp&&(f=!0),e.next=23,v(n,d,f);case 23:h.info("loadServerMessage Load completion message",o),e.next=29;break;case 26:e.prev=26,e.t0=e.catch(0),h.error("loadServerMessage error",e.t0);case 29:case"end":return e.stop()}},e,void 0,[[0,26]])}));return function(t,r,n){return e.apply(this,arguments)}}(),t.loadDbMessage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];try{var a=e.owner,o=e.id;h.info("loadDbMessage","messageList count:"+t.length,"recent id:"+o),isNullOrEmpty(t)||(t=t.filter(function(e,t,r){if(e.chat_type===constant.CHAT_TYPE.SYSTEM_NOTIFICATION||e.media_type===constant.MEDIA_TYPE.PUBLIC_NUMBER)return!0;var n=e.card_type,a=coreIm.isShareImage(n);if((a||coreIm.isShareFile(n))&&!e.file_list.length){var o=JSON.parse(e.show_html);coreIm.dealShareFileMessageFileList(e,o,a)}return!(isNullOrEmpty(e.media_type)||isNullOrEmpty(e.show_text))})),(0,_.modifyMessageListStatus)(t);if($getState().recent.currentRecentInfo.owner!==a)return void h.info("loadDbMessage Not in the current recent");r?n?$dispatch(coreUi.addBackwardMessage(t,!1)):$dispatch(coreUi.addHistoryMessage(t,!1)):f.loadHistoryMessage(t,e),m();for(var s=0;s<t.length;s++)coreIm.updateImgList(t[s],"update");h.info("loadDbMessage Load completion message",o)}catch(e){h.error("loadDbMessage(加载本地消息) 加载完成消息",e.toString())}}),m=t.updateMessageQueryInfo=function(){try{var e=$getState().recent.messageList;if(!e||0===e.length)return void h.info("updateMessageQueryInfo 没有消息");var t={smallQueryMessageServerId:e[0].server_chat_id_str,smallQueryMessageUtcStamp:e[0].utc_stamp,bigQueryMessageServerId:e[e.length-1].server_chat_id_str,bigQueryMessageUtcStamp:e[e.length-1].utc_stamp};h.info("updateMessageQueryInfo 设置消息查询信息"),$dispatch(coreUi.setHistoryMessageQueryInfo(t))}catch(e){h.error("updateMessageQueryInfo 设置消息查询信息",e.toString())}},M=(t.checkOnlyLoadLocalMessage=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{if(!coreIm.checkEServerOnlineNoToast("checkOnlyLoadLocalMessage"))return h.info("checkOnlyLoadLocalMessage Currently offline, only loading local messages",e.id),!0;if(e.is_disable)return h.info("checkOnlyLoadLocalMessage Recent not available, only load local messages",e.id),!0;if(e.chat_type===constant.CHAT_TYPE.PUBLIC_NO)return h.info("checkOnlyLoadLocalMessage Recent is Official Accounts, only load local messages",e.id),!0;var r=$getState().recent.moreSeverMessage;return t&&!r?(h.info("checkOnlyLoadLocalMessage No more sever messages",e.id),!0):(h.info("checkOnlyLoadLocalMessage Synchronization server message",e.id),!1)}catch(t){return h.error("checkOnlyLoadLocalMessage error，only load local messages",e.id,t),!0}},function(e){h.info("deal system bulletin from server, data length : ",e&&e.length),e.map(function(e){e.recent_owner=e.origin,e.show_text=e.content}),g.saveMessageListInfo(e)})},642:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.dealServerPublicNoList=t.dealServerRecentList=t.loadLocalRecentList=void 0;var o=r(142),s=a(o),i=r(147),u=a(i),c=r(139),l=a(c),d=r(1),f=a(d),p=r(2),g=a(p),_=r(993),h=n(_),v=r(171),m=n(v),M=r(182),y=n(M),E=coreLogger.getLogger("logic")("recent/list"),S=(t.loadLocalRecentList=function(){var e=(0,g.default)(f.default.mark(function e(t){var r;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.CLIENTCONFIG.ENABLE_IT_MEETING){e.next=3;break}return E.info("loadLocalRecentList ENABLE_IT_MEETING return"),e.abrupt("return");case 3:return E.info("loadLocalRecentList queryAllRecent Pre"),showDealTime("loadLocalRecentList queryAllRecent Pre"),e.next=7,coreDb.queryAllRecent();case 7:r=e.sent,E.info("loadLocalRecentList render all local recent count:"+r.length),b(r);case 10:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.dealServerRecentList=function(){var e=(0,g.default)(f.default.mark(function e(){var t;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,E.info("dealServerRecentList"),!window.CLIENTCONFIG.ENABLE_IT_MEETING){e.next=5;break}return E.info("dealServerRecentList ENABLE_IT_MEETING return"),e.abrupt("return");case 5:if(y.setRecentListReady(!1),"WeLink"===window.CLIENTCONFIG.NEW_APP_NAME&&S(),window.isEserverOnline){e.next=12;break}return E.error("dealServerRecentList isEserverOnline ",window.isEserverOnline),e.next=11,coreIm.dealUnDealMessageList();case 11:return e.abrupt("return");case 12:return e.next=14,h.getRecentConversation();case 14:if(t=e.sent,!isNullOrEmpty(t)){e.next=21;break}return E.error("dealServerRecentList serverRecentList is empty"),e.next=19,coreIm.dealUnDealMessageList();case 19:return coreIm.subscribeRecentList({}),e.abrupt("return");case 21:I(t.map(function(e){return L(e)})),e.next=29;break;case 24:return e.prev=24,e.t0=e.catch(0),E.error("dealServerRecentList",e.t0),e.next=29,coreIm.dealUnDealMessageList();case 29:case"end":return e.stop()}},e,void 0,[[0,24]])}));return function(){return e.apply(this,arguments)}}(),t.dealServerPublicNoList=function(){var e=(0,g.default)(f.default.mark(function e(){var t;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,coreIm.savePublicNoIncrementTime();case 3:if(t=e.sent,!isNullOrEmpty(t)){e.next=7;break}return E.error("dealServerPublicNoList serverRecentList is empty"),e.abrupt("return");case 7:I(t.map(function(e){return L(e)})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),E.error("dealServerPublicNoList",e.t0);case 13:case"end":return e.stop()}},e,void 0,[[0,10]])}));return function(){return e.apply(this,arguments)}}()),I=function(){var e=(0,g.default)(f.default.mark(function e(t){var r,n,a;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,E.info("saveNewRecentList count","server:"+t.length),r=[],e.next=5,coreDb.queryAllRecent();case 5:return n=e.sent,e.next=8,w(t,n);case 8:return t=e.sent,t.forEach(function(e){if(isNullOrEmpty(e.owner))return void r.push(e);var t=n.query({owner:e.owner});if(isNullOrEmpty(t))return void r.push(e);e.last_message!==t.last_message&&r.push(e)}),e.next=12,T(r);case 12:return a=e.sent,t.update(["owner"],a),e.next=16,$dispatch(coreUi.updateRecent(t));case 16:return e.next=18,coreIm.dealUnDealMessageList();case 18:coreIm.subscribeRecentList({}),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(0),E.error("saveNewRecentList",e.t0);case 24:case"end":return e.stop()}},e,void 0,[[0,21]])}));return function(t){return e.apply(this,arguments)}}(),w=function(){var e=(0,g.default)(f.default.mark(function e(t,r){var n,a,o,s,i,c,d;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,E.info("dealRecentContactOrGroupInfo"),n=[],a={},o=[],s={},t=t.map(function(e){if(isNullOrEmpty(e.owner))return E.error("saveNewRecentList serverRecent has no owner，no deal"),e;var t=r.query({owner:e.owner});if(!isNullOrEmpty(t)){var i=(0,l.default)({},t);return(t.time_stamp<e.time_stamp||isNullOrEmpty(t.owner))&&(i.time_stamp=e.time_stamp,i.last_message=e.last_message,i.stick_on_top=e.stick_on_top),m.isGroup(i.chat_type)?isNullOrEmpty(i.group)&&(n.push(i.owner),a[i.owner]=i):isNullOrEmpty(i.contact)&&(o.push(i.owner),s[i.owner]=i),i}return m.isGroup(e.chat_type)?(n.push(e.owner),a[e.owner]=e):(o.push(e.owner),s[e.owner]=e),e}),e.next=7,coreContact.getContactListByAccountList(o,!0);case 7:return i=e.sent,i.forEach(function(e){if(!isNullOrEmpty(e)){var r=s[e.account];r.contact=(0,l.default)({},e),delete s[e.account],t=t.update(["owner"],r)}}),e.next=11,coreGroup.queryGroupListByIdList(n.join(","));case 11:return c=e.sent,c.forEach(function(e){var r=a[e.group_id];r.group=(0,l.default)({},e),delete a[e.group_id],t=t.update(["owner"],r)}),d=(0,u.default)(a),d.forEach(function(e){var r=a[e];r.is_disable=!0,delete a[e],t=t.update(["owner"],r)}),e.abrupt("return",t);case 18:return e.prev=18,e.t0=e.catch(0),E.error("dealRecentContactOrGroupInfo",e.t0),e.abrupt("return",t);case 22:case"end":return e.stop()}},e,void 0,[[0,18]])}));return function(t,r){return e.apply(this,arguments)}}(),T=function(){var e=(0,g.default)(f.default.mark(function e(t){var r,n,a,o;return f.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(e.prev=0,E.info("dealLastMessage"),r=[],n=[],a=0;a<t.length;a++)t[a].last_message&&(r.push(t[a].last_message),n.push(t[a]));return e.next=7,coreIm.dealRecentLastMessageList(r,n);case 7:return o=e.sent,t=t.update(["owner"],o),e.abrupt("return",t);case 12:e.prev=12,e.t0=e.catch(0),E.error("dealLastMessage",e.t0);case 15:case"end":return e.stop()}},e,void 0,[[0,12]])}));return function(t){return e.apply(this,arguments)}}(),b=function(e){try{E.info("loadHistoryRecentList");var t=[].concat((0,s.default)(e)),r=t.map(function(e){return m.isGroup(e.chat_type)?"":e.owner}).filter(function(e){return!!e});coreContact.downloadContactListAvatar({accountList:r}),$dispatch(coreUi.loadRecentList(t))}catch(e){E.error("loadHistoryRecentList",e)}},L=function(e){var t=e.chat_info,r=t&&t.server_chat_id_str&&"-1"!==t.server_chat_id_str?t:{},n={chat_type:e.type,owner:e.account,time_stamp:e.utc_time,last_message:r,stick_on_top:e.top_state?e.top_time:0,is_delete:constant.IS_DELETE.NO,is_disable:!1};return m.isGroup(n.chat_type)?(n.group_id=n.owner,n.group={},m.isAtMessage(e.chat_info)&&(n.is_at=!0)):n.chat_type===constant.CHAT_TYPE.PUBLIC_NO?(n.publicNoInfo={},Object.type(e.publicNoInfo)===Object.type.OBJECT&&(n.publicNoInfo={nodeName:e.publicNoInfo.native_name,nodeNameEn:e.publicNoInfo.name}),n.unread_num=e.unread_num):(n.account=n.owner,n.contact={name:e.name,native_name:e.native_name}),n}},643:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.downloadPhotoError=t.downloadPhotoSuccess=t.downloadPhoto=void 0;var o=r(139),s=a(o),i=r(3),u=a(i),c=r(182),l=n(c),d=r(337),f=n(d),p=coreLogger.getLogger("logic")("IM/downloadPhoto");p.debug("downloadPhoto");t.downloadPhoto=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return new u.default(function(n,a){if(isNullOrEmpty(e))return void p.error("downloadPhoto 文件信息不存在",t.client_chat_id);e.file_path&&(e.file_path=coreIm.getRealFilePath({filePath:e.file_path}).replace("file://","")),e.file_real_save_path&&(e.file_real_save_path=coreIm.getRealFilePath({filePath:e.file_real_save_path}).replace("file://",""));var o=e.file_real_save_path,i=e.file_path,u=e.file_real_save_name;o===i&&(p.info("origin image and thumbnail are under save path, do not download thumbnail"),r=!1);var c=r?o:i,d=l.getUnDownloadedPhoto(r.toString().toLocaleUpperCase()+"_"+u);if(!isNullOrEmpty(d))return p.error("该图片已在下载列表中,flag:",r.toString().toLocaleUpperCase()+"_"+u),n({result:2,data:"图片已在下载列表中"});l.setUnDownloadedPhoto(r.toString().toLocaleUpperCase()+"_"+u,e);var g={access_code:e.um_plain_access_code,url:e.um_url,path:c,isThumbnail:r,isDownloadFile:!0,total_length:e.file_size};coreIm.downloadFile(g).then(function(a){!1===a&&(f.dealDownloadScreenShotFailed(e,t),n({result:1,data:"下载失败"})),p.debug("downloadPhoto downloadFile 下载成功 "),t.status=constant.MEDIA_STATUS.RECEIVING,e.file_handle=a.param.pcfile_handle.toString(),e.isThumbnail=r,e.file_deal_type=constant.FILE_DEAL_TYPE.DOWNLOAD,l.setReceivingMessage(e.um_url,t),l.setFileByHandle(e.file_handle,(0,s.default)({},e)),n({result:0,data:"success"})}).catch(function(e){l.deleteUnDownloadedPhoto(r.toString().toLocaleUpperCase()+"_"+u),p.error("downloadPhotos",e&&e.toString()),n({result:3,data:"下载出错"})})})},t.downloadPhotoSuccess=function(e){if(isNullOrEmpty(e))return void p.error("onPhotoDownloadSuccess 文件信息不存在");var t=e.file_real_save_path,r=e.file_path,n=e.isThumbnail,a=e.file_real_save_name;e.isThumbnail;l.deleteUnDownloadedPhoto(n.toString().toLocaleUpperCase()+"_"+a)},t.downloadPhotoError=function(e){if(isNullOrEmpty(e))return void p.error("onPhotoDownloadError 文件信息不存在");var t=e.file_real_save_path,r=e.file_path,n=e.isThumbnail,a=e.file_real_save_name;e.isThumbnail;l.deleteUnDownloadedPhoto(n.toString().toLocaleUpperCase()+"_"+a)}},644:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e){F.info("dealMobileNotify");var t=$getState().recent.currentRecentInfo,r=$getState().setting,n=r.isMessageNotifyRing,a=r.isMessageNotifyShock,o=window.getRoute(),s=window.isAppInBackground,i=t.owner===e.owner;try{var u=0,c=e.unread_num,l=e.owner,d=e.unreadSystemBulletinCount,f=e.chat_type,p=$getState().IM.androidNotifyNewMessageNum,g="",_="",h=f===constant.CHAT_TYPE.SYSTEM_NOTIFICATION;c=h?d:c,p=h?d:p,e.group&&(_=e.group.name),e.contact&&(_=e.contact.name),h&&(_=language.SYSTEM_NOTIFICATION);var v=$getState().setting.hasOpenPush,m=$getState().setting.isReceiveMobileMessage,M=$getState().login.isMultiDeviceLogined;if(!v||!m&&M)return;if(!isNullOrEmpty(e.group)&&e.group.msg_policy_type===constant.MESSAGE_NOT_DISTURB.NOT_DISTURB)return;"android"===window.CLIENTCONFIG.PLATFORM?!i||s?(u=!isNullOrEmpty(e.chat_type)&&x.isGroup(e.chat_type)?1:2,!isNullOrEmpty(c)&&c>1?(g=language.NOTIFICATION_BAR_UNREAD.format(c),e.is_at&&(g+=language.SOMEONE_AT_ME)):!isNullOrEmpty(p)&&p>1&&(g=language.NOTIFICATION_BAR_UNREAD.format(p),e.is_at&&(g+=language.SOMEONE_AT_ME)),h&&(g+=e.last_message.content.split("\n")[0]),isNullOrEmpty(e.last_message)||isNullOrEmpty(e.last_message.show_text)||(g=e.last_message.media_type===constant.MEDIA_TYPE.LIKE?""+g+language.EDITOR_TOOLS_TITLE_LIKE:g+(e.is_at?language.SOMEONE_AT_ME:"")+e.last_message.show_text.substring(0,50)),appService.showNotification(u,l,_,g)):("conversation"===o&&!s||"main/recent"===o&&!s)&&window.webView.cancelNotification(l):(u=1,isNullOrEmpty(e.last_message)||isNullOrEmpty(e.last_message.show_text)||(e.last_message.media_type===constant.MEDIA_TYPE.LIKE?g=""+g+language.EDITOR_TOOLS_TITLE_LIKE:(g+=e.last_message.show_text.substring(0,50),e.is_at&&(g=language.SOMEONE_AT_ME+g))),h&&(g=e.last_message.content.split("\n")[0]),appService.showNotification(u,l,_,g),i||s||appService.showInnerNotification(n,a))}catch(e){F.error("window.webView.showNotification",e.toString())}}function s(e){var t=$getState(),r=t.recent,n=t.IM,a=r.currentRecentInfo,o=r.messageList,s=n.unReadNewMessageNum;e.recent_owner===a.owner&&(F.info("dealMessageToRecent 新消息属于当前会话"),e.media_type===constant.MEDIA_TYPE.TEXT||e.media_type===constant.MEDIA_TYPE.PHOTO_TEXT||e.media_type===constant.MEDIA_TYPE.PHOTO||e.media_type===constant.MEDIA_TYPE.SCREEN_SHOT?(0!==s&&N.clearNewMessageFromMessageList(),-1===o.findIndex(function(t){return t.client_chat_id===e.client_chat_id})?(F.info("dealMessageToRecent 添加新消息"),L.addNewMessage(e)):(F.info("dealMessageToRecent 更新消息列表"),L.updateMessageListByClientId(e))):-1===o.findIndex(function(t){return t.client_chat_id===e.client_chat_id})?L.addNewMessage(e):(F.info("dealMessageToRecent 更新消息列表"),L.updateMessageListByClientId(e)))}Object.defineProperty(t,"__esModule",{value:!0}),t.dealPublicMarkMessage=t.dealSystemBulletinMessage=t.clickTrayUnReadFlash=t.removeUnReadMessageFlash=t.readCurrentRecentInfo=t.storeCurrentRecent=t.dealGroupNotify=t.dealTopRecentConversation=t.dealMsgRead=t.dealSysBulletinRead=t.dealSystemBulletin=t.dealChatList=t.dealCodeChat=t.dealUnDealMessageList=t.openImDetailByUrl=t.handleImDetail=t.dealSendMessageAck=void 0;var i=r(135),u=a(i),c=r(69),l=a(c),d=r(149),f=a(d),p=r(1),g=a(p),_=r(2),h=a(_),v=function(){var e=(0,h.default)(g.default.mark(function e(t){var r,n,a,o,s,i,u;return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.CLIENTCONFIG.ISMOBILE){e.next=2;break}return e.abrupt("return");case 2:if(r=t.owner,n=t.group,isNullOrEmpty(n)){e.next=6;break}if(n.msg_policy_type!==constant.MESSAGE_NOT_DISTURB.NOT_DISTURB){e.next=6;break}return e.abrupt("return");case 6:if(F.info("addUnReadMessageFlash",handleAccountPrint(t.owner)),a=P.default.getInstance(),o=a.unReadMessageFlashList,s=void 0,!((i=o.findIndex(function(e){return e.owner===r}))>-1)){e.next=17;break}if(i+1!==o.length){e.next=13;break}return e.abrupt("return");case 13:s=o.splice(i,1)[0],o.push(s),e.next=19;break;case 17:s={owner:r,recent:t,image:""},P.default.getInstance().push(s);case 19:if(s.recent.chat_type!==constant.CHAT_TYPE.SYSTEM_NOTIFICATION){e.next=25;break}return e.next=22,coreUi.getAvatarImage({isSysBulletin:!0});case 22:s.image=e.sent,e.next=48;break;case 25:if(s.recent.chat_type!==constant.CHAT_TYPE.PUBLIC_NO){e.next=31;break}return e.next=28,coreUi.getAvatarImage({isPublicNo:!0});case 28:s.image=e.sent,e.next=48;break;case 31:if(x.isGroup(s.recent.chat_type)){e.next=38;break}return u=getContactName(t.contact)||r,e.next=35,coreUi.getAvatarImage({owner:r,contactName:u});case 35:s.image=e.sent,e.next=48;break;case 38:if(t.group.group_type!==constant.GROUP_TYPE.FIXED_GROUP){e.next=44;break}return e.next=41,coreUi.getAvatarImage({contactName:r,isGroup:!0});case 41:e.t0=e.sent,e.next=47;break;case 44:return e.next=46,coreUi.getDiscussGroupAvatarImage({group:t.group});case 46:e.t0=e.sent;case 47:s.image=e.t0;case 48:window.flashTray(s.image,H),B();case 50:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),m=r(217),M=n(m),y=r(182),E=n(y),S=r(828),I=n(S),w=r(357),T=n(w),b=r(190),L=n(b),O=r(303),N=n(O),R=r(171),x=n(R),A=r(1009),C=r(596),k=r(1011),P=a(k),F=coreLogger.getLogger("logic")("IM/imNotify"),D=(t.dealSendMessageAck=function(){var e=(0,h.default)(g.default.mark(function e(t){var r,n,a,o,i,u;return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F.info("dealSendMessageAck 消息发送成功"),r=t.param,n=r.chat_id,a=r.server_chat_id_str,o=r.utc_stamp,i=r.result,u=E.getSendingMessage(n),E.deleteSendingMessage(n),!isNullOrEmpty(u)){e.next=9;break}return F.error("dealSendMessageAck message is null or empty"),e.abrupt("return");case 9:return u.utc_stamp=o,0===i?u.send_status=constant.SEND_STATUS.error:(u.send_status=constant.SEND_STATUS.success,u.status=constant.MEDIA_STATUS.SEND_SUCCESS),e.next=13,Y(u,a);case 13:u=e.sent,s(u),(0,m.updateMessageToRecent)(u),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),F.error("dealSendMessageAck",e.t0.toString());case 21:case"end":return e.stop()}},e,void 0,[[0,18]])}));return function(t){return e.apply(this,arguments)}}(),t.handleImDetail=function(e){"android"===window.CLIENTCONFIG.PLATFORM&&(window.handleImDetailUrl=e)},function(){var e=(0,h.default)(g.default.mark(function e(){return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(isNullOrEmpty(window.handleImDetailUrl)){e.next=4;break}return e.next=3,U(window.handleImDetailUrl);case 3:window.handleImDetailUrl=null;case 4:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}}()),U=t.openImDetailByUrl=function(){var e=(0,h.default)(g.default.mark(function e(t){var r,n,a,o;return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:isNullOrEmpty(t)||(r=coreCommon.getUrlVars(t),F.info("openImDetailByUrl urlValues:",r),n=r.data,a=-1,r.chat_type?(n=r.data,o=r.chat_type,"1"===o?a=constant.CHAT_TYPE.GROUP_CHAT:"2"===o?a=constant.CHAT_TYPE.SINGLE_CHAT:F.warn("chat_type send by server not illegal, the value is:",o)):r.hasOwnProperty("origin")&&r.origin?(n=r.origin,a=constant.CHAT_TYPE.SINGLE_CHAT):r.hasOwnProperty("account")&&r.account?(n=r.account,a=constant.CHAT_TYPE.SINGLE_CHAT):r.hasOwnProperty("groupId")&&r.groupId?(n=r.groupId,a=constant.CHAT_TYPE.GROUP_CHAT):F.warn("new as chat_type send by server not illegal"),coreIm.openOrCreateRecent({owner:n,chat_type:a}),F.info("openImDetailByUrl imData:",n),F.info("openImDetailByUrl chattype:",a));case 1:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),G=(t.dealUnDealMessageList=function(){var e=(0,h.default)(g.default.mark(function e(){var t,r;return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,F.info("dealUnDealMessageList 处理待处理列表"),E.setRecentListReady(!0),t=E.getUnDealMessageList(),r=$getState().recent.currentRecentInfo,isNullOrEmpty(r)||(0,C.getServerHistoryMessage)(r),e.next=8,D();case 8:if(!isNullOrEmpty(t)){e.next=11;break}return F.info("dealUnDealMessageList 无待处理列表"),e.abrupt("return");case 11:E.setReceiveMessageQueueList(t),E.getIsReceiveMessageQueueDealing()||G(),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),F.error("dealUnDealMessageList",e.t0.toString());case 18:case"end":return e.stop()}},e,void 0,[[0,15]])}));return function(){return e.apply(this,arguments)}}(),t.dealCodeChat=function(e){try{E.getRecentListReady()?(F.info("dealCodeChat 直接处理，不放入待处理列表"),E.setReceiveMessageQueue([e.param]),F.info("dealCodeChat",E.getIsReceiveMessageQueueDealing()),E.getIsReceiveMessageQueueDealing()||G()):(F.info("dealCodeChat 放入待处理列表"),E.setUnDealMessage([e.param]))}catch(e){F.error("dealCodeChat",e.toString())}},t.dealChatList=function(e){try{var t=$getState();F.info("dealChatList 处理未读消息数");var r=t.recent,n=r.isLoadMore,a=r.currentRecentInfo;n&&L.initLoadMore();var o=e.param.chat_list,s=e.param.total;if(o&&o.length){var i=x.getRecentOwnerByMessage(o[0]);a.owner!==i&&(M.updateUnReadNumMap(i,s),coreIm.setRecentUnReadMessageList(i,o),1===e.param.is_at&&M.updateAtMap(i,!0)),E.getRecentListReady()?(F.info("dealChatList 直接处理，不放入待处理列表"),E.setReceiveMessageQueue([o[0],s]),F.info("dealChatList",E.getIsReceiveMessageQueueDealing()),E.getIsReceiveMessageQueueDealing()||G()):(F.info("dealChatList 放入待处理列表"),E.setUnDealMessage([o[0],s]))}}catch(e){F.error("dealChatList",e.toString())}},t.dealSystemBulletin=function(){var e=(0,h.default)(g.default.mark(function e(t){return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:F.info("deal systemBulletin"),coreIm.dealCodeChat(t);case 2:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.dealSysBulletinRead=function(){var e=(0,h.default)(g.default.mark(function e(t){var r,n;return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!t.server_chat_id){e.next=8;break}return r=[{msg_type:3,msg_id:t.server_chat_id,sender:$getState().myInfo.account}],e.next=5,coreCommon.setMessageRead(r);case 5:return n=e.sent,F.info("dealSysBulletinRead",n),e.abrupt("return",n);case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),F.error("dealSystemBulletinRead",e.t0.toString());case 13:case"end":return e.stop()}},e,void 0,[[0,10]])}));return function(t){return e.apply(this,arguments)}}(),t.dealMsgRead=function(){var e=(0,h.default)(g.default.mark(function e(t){var r,n,a,o,s;return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,F.info("dealMsgRead 聊天消息已读通知"),r=t.param,n=r.from,a=r.msg_type,o=r.target,s=void 0,e.next=7,coreIm.getLocalRecent({owner:n});case 7:return s=e.sent,e.next=10,coreCommon.setMessageNotifyRead(s,{noTup:!0});case 10:s=e.sent,(0,m.refreshRecentList)(s),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(0),F.error("dealMsgRead",e.t0.toString());case 17:case"end":return e.stop()}},e,void 0,[[0,14]])}));return function(t){return e.apply(this,arguments)}}(),t.dealTopRecentConversation=function(){var e=(0,h.default)(g.default.mark(function e(t){var r,n,a,o,s,i,u,c,l,d,p,_,h;return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,F.info("dealTopRecentConversation"),r=t.param,n=r.conversation_list,a=r.operate_type,o=r.operate_time,!isNullOrEmpty(n)){e.next=5;break}return e.abrupt("return");case 5:s=!0,i=!1,u=void 0,e.prev=8,c=(0,f.default)(n);case 10:if(s=(l=c.next()).done){e.next=37;break}return d=l.value,e.next=14,coreIm.getLocalRecent({owner:d.conversation_id});case 14:if(p=e.sent,!isNullOrEmpty(p)){e.next=30;break}if(d.type!==constant.CHAT_TYPE.SINGLE_CHAT){e.next=25;break}return e.next=19,coreContact.getContactByAccount(d.conversation_id);case 19:return _=e.sent,e.next=22,coreContact.createContactConversation(_);case 22:p=e.sent,e.next=30;break;case 25:if(!coreIm.isGroup(d.type)){e.next=30;break}return e.next=28,coreGroup.getGroupInfoFromServer(d.conversation_id);case 28:h=e.sent,p={chat_type:d.type,owner:h.group_id,time_stamp:o,last_message:{},group:h,is_delete:constant.IS_DELETE.NO,is_disable:isNullOrEmpty(h),group_name:h.group_name,group_id:h.group_id};case 30:return a===constant.TOPPING_OPER_TYPE.TOPPING?(p.stick_on_top=o,p.is_delete===constant.IS_DELETE.YES&&(p.is_delete=constant.IS_DELETE.NO)):a===constant.TOPPING_OPER_TYPE.CANCLE_TOPPING&&(p.stick_on_top=0),(0,m.refreshRecentList)(p),e.next=34,coreDb.saveRecent(p);case 34:s=!0,e.next=10;break;case 37:e.next=43;break;case 39:e.prev=39,e.t0=e.catch(8),i=!0,u=e.t0;case 43:e.prev=43,e.prev=44,!s&&c.return&&c.return();case 46:if(e.prev=46,!i){e.next=49;break}throw u;case 49:return e.finish(46);case 50:return e.finish(43);case 51:e.next=56;break;case 53:e.prev=53,e.t1=e.catch(0),F.error("dealMsgRead",e.t1.toString());case 56:case"end":return e.stop()}},e,void 0,[[0,53],[8,39,43,51],[44,,46,50]])}));return function(t){return e.apply(this,arguments)}}(),t.dealGroupNotify=function(){var e=(0,h.default)(g.default.mark(function e(t,r,n,a){var o,i,u,c,l;return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,o=$getState().recent.currentRecentInfo,e.next=4,coreIm.getLocalRecent({owner:t});case 4:return i=e.sent,e.next=7,coreCommon.getGroupNotifyMemberList(r,n);case 7:if(u=e.sent,c=void 0,isNullOrEmpty(i)){e.next=24;break}if(c=T.createGroupMemberChgMessage(i.group,u,n,a),o.owner===i.owner?(F.info("dealGroupNotify 在当前会话"),L.addNewMessage(c)):F.info("dealGroupNotify 不在当前会话"),c.media_type!==constant.MEDIA_TYPE.APPLY_JOIN_FIXED_GROUP_NOTIFY){e.next=15;break}return e.next=15,coreCommon.addUnReadApplyGroupNotifyNum(c);case 15:i.unread_group_notify_num=I.getUnReadApplyGroupNotifyNumMap()[c.group_id]||0,coreDb.saveMessage(c),i=(0,m.dealRecentLastMessageInfo)(i,c),F.info("dealGroupNotify 更新recent"),coreDb.saveRecent(i),s(c),(0,m.refreshRecentList)(i),e.next=40;break;case 24:return e.next=26,coreGroup.getGroupInfoFromDB(t);case 26:if(l=e.sent,c=T.createGroupMemberChgMessage(l,u,n),coreDb.saveMessage(c),c.media_type!==constant.MEDIA_TYPE.APPLY_JOIN_FIXED_GROUP_NOTIFY){e.next=32;break}return e.next=32,coreCommon.addUnReadApplyGroupNotifyNum(c);case 32:if(l.group_type!==constant.GROUP_TYPE.DISCUSS_GROUP){e.next=34;break}return e.abrupt("return");case 34:return e.next=36,coreIm.createOrGetRecentByMessage(c);case 36:i=e.sent,i.unread_group_notify_num=I.getUnReadApplyGroupNotifyNumMap()[c.group_id]||0,coreDb.saveRecent(i),(0,m.refreshRecentList)(i);case 40:e.next=45;break;case 42:e.prev=42,e.t0=e.catch(0),F.error("dealGroupNotify",e.t0.toString());case 45:case"end":return e.stop()}},e,void 0,[[0,42]])}));return function(t,r,n,a){return e.apply(this,arguments)}}(),function(){var e=(0,h.default)(g.default.mark(function e(){var t,r,n,a,s,i,u,c,l,d,f,p;return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,F.info("dealReceiveMessageQueue"),E.setIsReceiveMessageQueueDealing(!0),t=E.getFirstReceiveMessageQueue(),r=$getState().myInfo.account;case 5:if(!t){e.next=36;break}n=1;case 7:if(!(n<31)||window.isEserverOnline){e.next=18;break}return F.info("dealReceiveMessageQueue 接收消息队列处理 离线，等待"+n+"s继续处理"),e.next=11,sleep(1e3);case 11:if(n++,r===$getState().myInfo.account){e.next=16;break}return F.info("dealReceiveMessageQueue 不是当前登录用户的消息"),E.setIsReceiveMessageQueueDealing(!1),e.abrupt("return");case 16:e.next=7;break;case 18:if(coreIm.checkEServerOnlineNoToast("dealReceiveMessageQueue")){e.next=22;break}return E.setIsReceiveMessageQueueDealing(!1),F.info("dealReceiveMessageQueue 接收消息队列处理 离线，不再继续处理消息"),e.abrupt("return");case 22:if(2!==t.length){e.next=28;break}return e.next=25,T.dealReceiveMessage(t[0],t[1]);case 25:e.t0=e.sent,e.next=31;break;case 28:return e.next=30,T.dealReceiveMessage(t[0]);case 30:e.t0=e.sent;case 31:a=e.t0,a&&(s=$getState(),i=s.recent.currentRecentInfo,u=a.recent,c=a.message,F.info("dealReceiveMessageQueue 返回值类型 recent:"+Object.type(u)+" message:"+Object.type(c)),coreConf.setUnreadNumber({account:u&&u.contact?u.contact.account:"",group_id:u&&u.group?u.group.group_id:""},1),window.CLIENTCONFIG.ISMOBILE||coreCommon.isShowMessageNotify(i,u),(0,m.refreshRecentList)(u),coreIm.subscribeRecentList({recentList:[u]}),x.isNewFileMessage(c)&&E.setUnReadFileMessage(c),s.recent.currentRecentInfo.owner===c.recent_owner?(N.addNewMessageIntoMessageList(c),E.setCurrentRecentUnReadMessage(c),coreCommon.setImMessageListRead(c.server_chat_id_str),(isNullOrEmpty(u.group)||u.group&&u.group.msg_policy_type!==constant.MESSAGE_NOT_DISTURB.NOT_DISTURB)&&B()):(E.setRecentUnReadMessage(c.recent_owner,c),!(l=coreCommon.isSelfAccount(c.origin))&&v(u)),window.CLIENTCONFIG.ISMOBILE&&!coreCommon.isSelfAccount(c.origin)&&(d=$(t))&&o(u),!1===c.is_auto_reply&&(f=$getState().myInfo.isAutoResponseConf,p=coreCommon.isSelfAccount(c.origin),F.info("autoReply is open or close",f),f&&!p&&(0,A.sendAutoReply)(c))),t=E.getFirstReceiveMessageQueue(),e.next=5;break;case 36:E.setIsReceiveMessageQueueDealing(!1),E.initUnDealMessageList(),e.next=45;break;case 40:e.prev=40,e.t1=e.catch(0),F.error("dealReceiveMessageQueue",e.t1.toString()),E.setIsReceiveMessageQueueDealing(!1),E.initUnDealMessageList();case 45:case"end":return e.stop()}},e,void 0,[[0,40]])}));return function(){return e.apply(this,arguments)}}()),B=function(){var e=(0,h.default)(g.default.mark(function e(){return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:window.CLIENTCONFIG.ISMOBILE||win.isFocused()||win.flashFrame(!0);case 1:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}}();t.storeCurrentRecent=function(){try{var e=$getState(),t=e.recent.currentRecentInfo;isNullOrEmpty(t)||(F.info("storeCurrentRecent clear recent"),$dispatch(coreUi.updateLastCurrentRecentInfo(t.owner)),$dispatch(coreUi.clearCurrentRecentInfo()))}catch(e){F.error("storeCurrentRecent error",(0,l.default)(e))}},t.readCurrentRecentInfo=function(){try{var e=$getState(),t=e.recent.lastCurrentRecentInfo,r=e.recent.recentList;if(!isNullOrEmpty(t)){F.info("readCurrentRecentInfo reopen recent");var n=r.query({owner:t});M.openRecentConversation(n)}}catch(e){F.error("readCurrentRecentInfo error",(0,l.default)(e))}},t.removeUnReadMessageFlash=function(e){var t=P.default.getInstance(),r=t.unReadMessageFlashList,n=r.findIndex(function(t){return t.owner===e.owner});-1!==n&&(r.splice(n,1)[0],r.length>0?window.flashTray(r[r.length-1].image,H):(window.endFlashTray(),win.flashFrame(!1)))};window.clearUnReadMessageFlashList=function(){P.default.getInstance().init(),window.endFlashTray()};var H=t.clickTrayUnReadFlash=function(){var e=P.default.getInstance(),t=e.unReadMessageFlashList,r=t[t.length-1];if(r&&r.recent){var n=r.recent;F.info("userClick tray",handleAccountPrint(n.owner)),$dispatch(coreUi.updateLastCurrentRecentInfo("")),appService.showMainWindow(!0),M.openRecentConversation(n),coreCommon.switchNav("recent")}else window.clearUnReadMessageFlashList()},Y=function(){var e=(0,h.default)(g.default.mark(function e(t,r){var n,a,o,s;return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,F.info("updateMessageServerId 更新消息相关文件、截图的message id"),n=[],a=[],o=[],e.t0=t.media_type,e.next=e.t0===constant.MEDIA_TYPE.PHOTO_TEXT?6:e.t0===constant.MEDIA_TYPE.PHOTO?12:e.t0===constant.MEDIA_TYPE.SCREEN_SHOT?12:e.t0===constant.MEDIA_TYPE.FILE?26:e.t0===constant.MEDIA_TYPE.AUDIO?26:e.t0===constant.MEDIA_TYPE.VIDEO?32:e.t0===constant.MEDIA_TYPE.SHARE?44:55;break;case 6:return e.next=8,coreDb.queryScreenShotList({message_server_chat_id_str:t.server_chat_id_str});case 8:return n=e.sent,n.map(function(e){return e.message_server_chat_id_str=r,e.time_stamp=t.utc_stamp,e}),coreDb.bulkPutScreenShot(n),e.abrupt("break",56);case 12:return e.next=14,coreDb.queryFileList({message_server_chat_id_str:t.server_chat_id_str});case 14:if(n=e.sent,!isNullOrEmpty(n)){e.next=23;break}return e.next=18,coreDb.queryScreenShotList({message_server_chat_id_str:t.server_chat_id_str});case 18:n=e.sent,n.map(function(e){return e.message_server_chat_id_str=r,e.time_stamp=t.utc_stamp,e}),coreDb.bulkPutScreenShot(n),e.next=25;break;case 23:n.map(function(e){return e.message_server_chat_id_str=r,e.time_stamp=t.utc_stamp,e}),coreDb.bulkPutFile(n);case 25:return e.abrupt("break",56);case 26:return e.next=28,coreDb.queryFileList({message_server_chat_id_str:t.server_chat_id_str});case 28:return n=e.sent,n.map(function(e){return e.message_server_chat_id_str=r,e}),coreDb.bulkPutFile(n),e.abrupt("break",56);case 32:return e.next=34,coreDb.queryFileList({message_server_chat_id_str:t.server_chat_id_str});case 34:return o=e.sent,o.map(function(e){return e.message_server_chat_id_str=r,e.time_stamp=t.utc_stamp,e}),e.next=38,coreDb.queryScreenShotList({message_server_chat_id_str:t.server_chat_id_str});case 38:return a=e.sent,a.map(function(e){return e.message_server_chat_id_str=r,e.time_stamp=t.utc_stamp,e}),coreDb.bulkPutFile(o),coreDb.bulkPutScreenShot(a),n=o.concat(a),e.abrupt("break",56);case 44:if(!coreIm.isShareFile(t.card_type)){e.next=50;break}return e.next=47,coreDb.queryFileList({message_server_chat_id_str:t.server_chat_id_str});case 47:n=e.sent,e.next=54;break;case 50:if(!coreIm.isShareImage(t.card_type)){e.next=54;break}return e.next=53,coreDb.queryScreenShotList({message_server_chat_id_str:t.server_chat_id_str});case 53:n=e.sent;case 54:case 55:return e.abrupt("break",56);case 56:return s=t.server_chat_id_str,t.file_list=n,t.server_chat_id_str=r,coreIm.updateImgList(t,"serverId",s),coreDb.saveMessage(t),e.abrupt("return",t);case 64:return e.prev=64,e.t1=e.catch(0),F.error("updateMessageServerId",e.t1.toString()),e.abrupt("return",t);case 68:case"end":return e.stop()}},e,void 0,[[0,64]])}));return function(t,r){return e.apply(this,arguments)}}(),$=(t.dealSystemBulletinMessage=function(e){var t=e.param,r=$getState().recent.unreadSystemBulletinCount;r++,t.recent_owner=e.param.origin,t.native_name="",t.name=e.param.origin,t.is_delete=constant.IS_DELETE.NO,t.media_type=constant.MEDIA_TYPE.TEXT,t.show_text=e.param.content;var n={chat_type:e.param.chat_type,owner:e.param.origin,time_stamp:e.param.utc_stamp,last_message:t,contact:{},stick_on_top:0,is_delete:constant.IS_DELETE.NO,server_chat_id:parseInt(e.param.server_chat_id_str),last_message_server_chat_id_str:e.param.server_chat_id_str,unreadSystemBulletinCount:r};$dispatch(coreUi.updateUnreadSystemBulletin(r)),T.saveMessageListInfo([t]),coreDb.saveRecent(n),$getState().recent.currentRecentInfo.owner===t.recent_owner?(N.addNewMessageIntoMessageList(t),$dispatch(coreUi.updateUnreadSystemBulletin(0)),coreIm.dealSysBulletinRead(n)):v(n),(0,m.refreshRecentList)(n),window.CLIENTCONFIG.ISMOBILE&&o(n)},t.dealPublicMarkMessage=function(){var e=(0,h.default)(g.default.mark(function e(t){var r,n,a,s,i,c,l,d,f,p,_;return g.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=$getState().recent,n=r.currentRecentInfo,a=r.recentList,e.prev=1,F.info("dealPublicMarkMessage 接收到公众号消息处理"),s=[],i={},c={},t.length>0&&coreDb.saveUserConfig({key:"publicNoIncrementTime",value:t[0].sentTime.toString()}),t.forEach(function(e){e.media_type=constant.MEDIA_TYPE.PUBLIC_NUMBER;var t=e.serviceNodeId,r=e.serviceNodeName,n=e.serviceNodeName;c.nodeName=r,c.nodeNameEn=n,c.nodeID=t,e.MSGCONTENT=e.content,e.SENDTIME=e.sentTime,e.MESSAGEID=e.messageId,s.push(e)}),i.msgContent=s,i.publicNo=c,l=coreIm.publicNoMsgParse(i),0!==l.length){e.next=11;break}return e.abrupt("return");case 11:if(d=coreIm.getUnReadNumMap(),f=d[c.nodeID]||0,f+=l.length,coreIm.updateUnReadNumMap(c.nodeID,f),p=l[l.length-1],_=a.query({owner:c.nodeID}),!isNullOrEmpty(_)){e.next=27;break}return e.next=20,coreIm.getSubscribePublicNO([{serviceNodeId:c.nodeID,systemVersion:""}]);case 20:if(_=e.sent,0===_.result){e.next=23;break}return e.abrupt("return",{result:1});case 23:_=_.data[0],_.publicNoInfo={nodeName:_.nodeName,nodeNameEn:_.nodeNameEn},e.next=28;break;case 27:_.publicNoInfo={nodeName:p.native_name,nodeNameEn:p.name};case 28:_=(0,u.default)({},_,{time_stamp:p.utc_stamp,last_message:p,lastservermessageid:p.server_chat_id_str,chat_type:constant.CHAT_TYPE.PUBLIC_NO,stick_on_top:0,owner:c.nodeID}),T.saveMessageListInfo(l),l.forEach(function(e){n.owner===e.recent_owner?(N.addNewMessageIntoMessageList(e),coreIm.updateUnReadNumMap(e.recent_owner,0)):v(_)}),d=coreIm.getUnReadNumMap(),f=d[_.owner]||0,_.unread_num=f,coreDb.saveRecent(_),(0,m.refreshRecentList)(_),window.CLIENTCONFIG.ISMOBILE&&o(_),e.next=42;break;case 39:e.prev=39,e.t0=e.catch(1),F.error("dealPublicMarkMessage",e.t0.toString());case 42:case"end":return e.stop()}},e,void 0,[[1,39]])}));return function(t){return e.apply(this,arguments)}}(),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(coreCommon.isPc())return!0;for(var t=!1,r=[],n=$getState().recent.hasNotifyMessageList,a=0;a<e.length;a++){var o=e[a].server_chat_id_str;o&&-1===n.indexOf(o)&&(t=!0,r.push(o))}return window.$dispatch(coreUi.updateHasNotifyMessage(r)),t})},645:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.receiveQuoteFile=t.saveAsImg=t.saveAsFile=t.rejectFile=t.receiveVideoImage=t.receiveFile=void 0;var o=r(139),s=a(o),i=r(1),u=a(i),c=r(2),l=a(c),d=function(){var e=(0,l.default)(u.default.mark(function e(t,r){var n,a,o;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.file_deal_type===constant.FILE_DEAL_TYPE.UPLOAD&&(n=$getState().login.account,t.file_real_save_path=appService.getReceiveFilesPath(n)+t.file_name,t.file_deal_type=constant.FILE_DEAL_TYPE.DOWNLOAD,v.info("download the files self send")),e.next=3,appService.dealSaveFileName(t.file_real_save_path);case 3:if(a=e.sent,t.file_real_save_name=a.name,t.file_real_save_path=a.path,t.file_deal_type!==constant.FILE_DEAL_TYPE.DOWNLOAD&&t.file_deal_type!==constant.FILE_DEAL_TYPE.RE_DOWNLOAD){e.next=18;break}return t.file_real_save_path=coreIm.getRealFilePath({filePath:t.file_real_save_path}).replace("file://",""),e.next=10,coreIm.downloadFile({access_code:t.um_plain_access_code,url:t.um_url,path:t.file_real_save_path,isDownloadFile:!0,total_length:t.file_size});case 10:if(!1!==(o=e.sent)){e.next=14;break}return(0,h.dealDownloadFileFailed)(t,r),e.abrupt("return",!1);case 14:return t.file_handle=o.param.pcfile_handle.toString(),p.setFileByHandle(t.file_handle,t),coreDb.saveFile((0,s.default)({},t)),e.abrupt("return",t);case 18:return v.info("dealDownloadFile  not deal download,file.file_deal_type="+t.file_deal_type),e.abrupt("return",!1);case 20:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}(),f=r(182),p=n(f),g=r(190),_=n(g),h=r(304),v=coreLogger.getLogger("logic")("IM/fileReceive"),m=t.receiveFile=function(){var e=(0,l.default)(u.default.mark(function e(t){var r,n,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,v.info("userCLick  点击了接收文件"),!a){e.next=4;break}return e.abrupt("return",M(t));case 4:if(v.info("receiveFile"),r=t.file_list[0],t.status!==constant.MEDIA_STATUS.RECEIVING){e.next=8;break}return e.abrupt("return");case 8:return isNullOrEmpty(r)||coreUt.utCustomEvent({eventId:constant.EVENT_ID.UT_IM_RECEIVE_FILE,params:[getSuffix(r.file_real_save_name),r.file_size]}),e.next=11,d(r,t);case 11:if(!1!==(n=e.sent)){e.next=14;break}return e.abrupt("return");case 14:return e.next=16,coreDb.saveMessage(t);case 16:t=e.sent,t.status=constant.MEDIA_STATUS.RECEIVING,p.setReceivingMessage(r.um_url,t),v.info("receiveFile updateProgressMap"),$dispatch(coreUi.updateProgressMap(r.file_handle,0)),$dispatch(coreUi.updateMessageList(t)),e.next=27;break;case 24:e.prev=24,e.t0=e.catch(0),v.error("receiveFile",e.t0.toString());case 27:case"end":return e.stop()}},e,void 0,[[0,24]])}));return function(t){return e.apply(this,arguments)}}(),M=(t.receiveVideoImage=function(){var e=(0,l.default)(u.default.mark(function e(t){var r,n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,v.info("Download video first frame"),(r=t.file_list[1])||!r.downloading){e.next=5;break}return e.abrupt("return");case 5:return r.downloading=!0,r.file_real_save_path=coreIm.getRealFilePath({filePath:r.file_real_save_path}).replace("file://",""),e.next=9,coreIm.downloadFile({access_code:r.um_plain_access_code,url:r.um_url,path:r.file_real_save_path});case 9:if(!1!==(n=e.sent)){e.next=13;break}return r.is_downloaded=constant.IS_DOWNLOADED.NO,e.abrupt("return",!1);case 13:r.file_handle=n.param.pcfile_handle.toString(),p.setFileByHandle(r.file_handle,r),$dispatch(coreUi.updateProgressMap(r.file_handle,0)),$dispatch(coreUi.updateMessageList(t)),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(0),v.error("receiveFile",e.t0.toString());case 22:case"end":return e.stop()}},e,void 0,[[0,19]])}));return function(t){return e.apply(this,arguments)}}(),t.rejectFile=function(){var e=(0,l.default)(u.default.mark(function e(t){var r;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,v.info("rejectFile"),r=t.file_list[0],t.status=constant.MEDIA_STATUS.RECEIVE_ERROR,r.file_deal_type!==constant.FILE_DEAL_TYPE.DOWNLOAD&&r.file_deal_type!==constant.FILE_DEAL_TYPE.RE_DOWNLOAD){e.next=7;break}return e.next=7,coreIm.releaseFile({file_handle:parseInt(r.file_handle)});case 7:return p.deleteFileByHandleList([r.file_handle,t.client_chat_id]),p.deleteReceivingMessage(r.um_url),$dispatch(coreUi.deleteProgressMap(r.file_handle)),delete r.file_handle,e.next=13,coreDb.saveFile(r);case 13:return r=e.sent,t.file_list=[r],e.next=17,coreDb.saveMessage(t);case 17:t=e.sent,$dispatch(coreUi.updateMessageList(t)),(t.media_type===constant.MEDIA_TYPE.FILE||coreIm.isShareFile(t.card_type))&&window.ToastNew(language.PC_DOWNLOAD_FAILED),e.next=25;break;case 22:e.prev=22,e.t0=e.catch(0),v.error("rejectFile",e.t0.toString());case 25:case"end":return e.stop()}},e,void 0,[[0,22]])}));return function(t){return e.apply(this,arguments)}}(),t.saveAsFile=function(){var e=(0,l.default)(u.default.mark(function e(t){var r,n,a,o,s,i;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{r=t.file_list,n=t.server_chat_id_str,a=r[0],o=a.file_real_save_path,s=a.is_downloaded,i={},i.defaultPath=o,window.electron.remote.dialog.showSaveDialog(i,function(e){isNullOrEmpty(e)||(e=e.replaceAll("\\","/"),appService.deleteFile(e),t.file_list[0].file_real_save_path=e,t.file_list[0].file_real_save_name=getFileName(e),$dispatch(coreUi.updateSaveAsFileMessageMap(n,e)),m(t))})}catch(e){v.error("saveAsFile",e.toString())}case 1:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.saveAsImg=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{var r={filters:[{name:"Images",extensions:["jpg","png","gif"]}],properties:["openFile","openDirectory","promptToCreate"]};r.defaultPath=e,window.fs.stat(e,function(n,a){if(n)throw n;a&&a.isFile()&&window.electron.remote.dialog.showSaveDialog(r,function(r){isNullOrEmpty(r)||appService.saveAs(e,r).then(function(){t||window.ToastNew(language.SAVE_SUCCESS,2)})})})}catch(e){v.error("saveAsImg",e.toString())}},t.receiveQuoteFile=function(){var e=(0,l.default)(u.default.mark(function e(t){var r,n;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,v.info("receiveQuoteFile"),isNullOrEmpty(t.quote.file_list)){e.next=16;break}return r=t.quote.file_list[0],t.quote.status=constant.MEDIA_STATUS.RECEIVING,e.next=7,d(r,t,t);case 7:if(!1!==(n=e.sent)){e.next=10;break}return e.abrupt("return");case 10:return t.quote.file_list=[r],t.quote=(0,s.default)({},t.quote),e.next=14,coreDb.saveMessage(t);case 14:_.updateProgressMap(r.file_handle,0),_.updateMessageList(t);case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),v.error("receiveFile",e.t0.toString());case 21:case"end":return e.stop()}},e,void 0,[[0,18]])}));return function(t){return e.apply(this,arguments)}}())},69:function(e,t,r){e.exports={default:r(70),__esModule:!0}},70:function(e,t,r){var n=r(8),a=n.JSON||(n.JSON={stringify:JSON.stringify});e.exports=function(e){return a.stringify.apply(a,arguments)}},72:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.HwImSdk=void 0;var o=r(135),s=a(o),i=r(4),u=a(i),c=r(636),l=n(c),d=r(829),f=n(d),p=r(1009),g=n(p),_=r(190),h=n(_),v=r(1018),m=n(v),M=r(1014),y=n(M),E=r(637),S=n(E),I=r(599),w=n(I),T=r(337),b=n(T),L=r(304),O=n(L),N=r(1015),R=n(N),x=r(645),A=n(x),C=r(1013),k=n(C),P=r(1016),F=n(P),D=r(596),U=n(D),G=r(644),B=n(G),H=r(1021),Y=n(H),$=r(1022),j=n($),q=r(1024),Q=n(q),W=r(1007),V=n(W),z=r(357),X=n(z),K=r(831),J=n(K),Z=r(1003),ee=n(Z),te=r(1001),re=n(te),ne=r(598),ae=n(ne),oe=r(1002),se=n(oe),ie=r(1004),ue=n(ie),ce=r(1006),le=n(ce),de=r(1005),fe=n(de),pe=r(988),ge=n(pe),_e=r(989),he=n(_e),ve=r(1e3),me=n(ve),Me=r(302),ye=n(Me),Ee=r(826),Se=n(Ee),Ie=r(990),we=n(Ie),Te=r(1008),be=n(Te),Le=r(1019),Oe=n(Le),Ne=r(832),Re=n(Ne),xe=r(824),Ae=n(xe),Ce=r(1010),ke=n(Ce),Pe=r(228),Fe=n(Pe),De=r(303),Ue=n(De),Ge=r(1023),Be=n(Ge),He=r(998),Ye=n(He),$e=r(999),je=n($e),qe=r(217),Qe=n(qe),We=r(359),Ve=n(We),ze=r(597),Xe=n(ze),Ke=r(996),Je=n(Ke),Ze=r(358),et=n(Ze),tt=r(995),rt=n(tt),nt=r(997),at=n(nt),ot=r(827),st=n(ot),it=r(642),ut=n(it),ct=r(994),lt=n(ct),dt=r(993),ft=n(dt),pt=r(980),gt=n(pt),_t=r(182),ht=n(_t),vt=r(825),mt=n(vt),Mt=r(638),yt=n(Mt),Et=r(979),St=n(Et),It=r(1922),wt=n(It),Tt=r(984),bt=n(Tt),Lt=r(986),Ot=n(Lt),Nt=r(985),Rt=n(Nt),xt=r(981),At=n(xt),Ct=r(639),kt=n(Ct),Pt=r(983),Ft=n(Pt),Dt=r(982),Ut=n(Dt),Gt=r(338),Bt=n(Gt),Ht=r(1026),Yt=n(Ht),$t=r(1027),jt=n($t),qt=r(1923),Qt=n(qt),Wt=r(1028),Vt=n(Wt),zt=r(828),Xt=n(zt),Kt=r(171),Jt=n(Kt),Zt=r(640),er=n(Zt);r(1924),r(360);var tr=r(1928),rr=r(1939);t.HwImSdk=function e(){(0,u.default)(this,e),(0,s.default)(this,f),(0,s.default)(this,g),(0,s.default)(this,h),(0,s.default)(this,m),(0,s.default)(this,y),(0,s.default)(this,S),(0,s.default)(this,w),(0,s.default)(this,b),(0,s.default)(this,O),(0,s.default)(this,R),(0,s.default)(this,A),(0,s.default)(this,k),(0,s.default)(this,F),(0,s.default)(this,U),(0,s.default)(this,B),(0,s.default)(this,l),(0,s.default)(this,Y),(0,s.default)(this,j),(0,s.default)(this,Q),(0,s.default)(this,V),(0,s.default)(this,X),(0,s.default)(this,J),(0,s.default)(this,ee),(0,s.default)(this,re),(0,s.default)(this,ae),(0,s.default)(this,se),(0,s.default)(this,ue),(0,s.default)(this,le),(0,s.default)(this,fe),(0,s.default)(this,ge),(0,s.default)(this,he),(0,s.default)(this,me),(0,s.default)(this,ye),(0,s.default)(this,Se),(0,s.default)(this,we),(0,s.default)(this,be),(0,s.default)(this,Oe),(0,s.default)(this,Re),(0,s.default)(this,Ae),(0,s.default)(this,ke),(0,s.default)(this,Fe),(0,s.default)(this,Ue),(0,s.default)(this,Be),(0,s.default)(this,Ye),(0,s.default)(this,je),(0,s.default)(this,Qe),(0,s.default)(this,Ve),(0,s.default)(this,Xe),(0,s.default)(this,Je),(0,s.default)(this,et),(0,s.default)(this,rt),(0,s.default)(this,at),(0,s.default)(this,st),(0,s.default)(this,ut),(0,s.default)(this,lt),(0,s.default)(this,ft),(0,s.default)(this,gt),(0,s.default)(this,ht),(0,s.default)(this,mt),(0,s.default)(this,yt),(0,s.default)(this,St),(0,s.default)(this,wt),(0,s.default)(this,bt),(0,s.default)(this,Ot),(0,s.default)(this,Rt),(0,s.default)(this,At),(0,s.default)(this,kt),(0,s.default)(this,Ft),(0,s.default)(this,Ut),(0,s.default)(this,Bt),(0,s.default)(this,Yt),(0,s.default)(this,jt),(0,s.default)(this,Qt),(0,s.default)(this,Vt),(0,s.default)(this,Xt),(0,s.default)(this,Jt),(0,s.default)(this,er),(0,s.default)(this,(0,tr.getImApi)().getApiList()),(0,s.default)(this,(0,rr.getUmApi)().getApiList())}},824:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.downloadMobileFileLogic=t.imgForward=t.getIndex=t.changeIndexOpt=t.downLoadOrginImageLogic=t.previewOption=void 0;var a=r(1),o=n(a),s=r(2),i=n(s),u=r(637),c=r(643),l=r(190),d=coreLogger.getLogger("logic")("IM/preview");t.previewOption=function(){var e=(0,i.default)(o.default.mark(function e(t){var r,n,a,s;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(d.info("previewOption"),r=$getState().recent.currentRecentImgList,!isNullOrEmpty(r)&&0!==r.length){e.next=5;break}return d.info("Preview image  image list is empty, do not enter preview"),e.abrupt("return");case 5:return t.file_path&&(t.file_path=coreIm.getRealFilePath({filePath:t.file_path})),t.file_real_save_path&&(t.file_real_save_path=coreIm.getRealFilePath({filePath:t.file_real_save_path})),n=coreIm.isShowOriginImg(t)?t.file_path:t.file_real_save_path,e.next=10,appService.isFileExist(n);case 10:if(a=e.sent){e.next=18;break}return d.info("previewOption,can not show big photo"),e.next=15,coreDb.queryMessage({server_chat_id_str:t.message_server_chat_id_str});case 15:return s=e.sent,window.CLIENTCONFIG.ISMOBILE?coreIm.isShowOriginImg(t)?(0,c.downloadPhoto)(t,s,!1):(0,c.downloadPhoto)(t,s,!0):(!coreIm.isShowOriginImg(t)&&(0,c.downloadPhoto)(t,s,!0),(0,c.downloadPhoto)(t,s,!1)),e.abrupt("return");case 18:return e.next=20,(0,u.isExistOfOriginImage)(t);case 20:t.type="origin",(0,l.setCurrentImg)(t),window.goRoute("previewList",!0);case 23:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.downLoadOrginImageLogic=function(){var e=(0,i.default)(o.default.mark(function e(t){return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,u.downloadUMOriginPicture)(t);case 2:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.changeIndexOpt=function(e){$dispatch(coreUi.setCurrentImgIndex(e))},t.getIndex=function(e,t){var r=void 0;return t.map(function(t,n){if(t.file_real_save_name===e)return void(r=n)}),-1!==r?r:0},t.imgForward=function(){var e=(0,i.default)(o.default.mark(function e(t){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(d.info("imgForward"),e.t0=$getState().recent.messageList.query({server_chat_id_str:t}),e.t0){e.next=6;break}return e.next=5,coreDb.queryMessage({server_chat_id_str:t});case 5:e.t0=e.sent;case 6:if(r=e.t0,coreIm.checkEserverOnline("imgForward")){e.next=9;break}return e.abrupt("return");case 9:coreUi.mInitShowSelectBox(constant.CONTACT_SELECT_DIALOG_TYPE.CONTACT_SELECT_DIALOG_RELAYMESSAGE,constant.SELECT_BOX_ACCESSPOINT.FORWARD_IN,r);case 10:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),t.downloadMobileFileLogic=function(e){(0,u.downloadMobileFile)(e)}},825:function(e,t,r){"use strict";function n(){var e=[];this.__proto__={init:function(){e=[]},set:function(t,r){e.update(t,r)},get:function(t){return e.query(t)},getList:function(t){return e.queryList(t)},getAll:function(){return[].concat((0,o.default)(e))},delete:function(t){e=e.delete(t)}}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(142),o=function(e){return e&&e.__esModule?e:{default:e}}(a);t.default=n},826:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.transformGroupNotifyMessage=t.transformMessageContentEmotion=t.createOldImageItem=t.createPhotoList=t.createFileRootElem=t.createMobileQuoteRootElem=t.createQuoteRootElem=t.createMobileRootElem=t.createRootElem=t.transformHtmlLike=t.transformHtmlEmotion=t.createFileContentText=t.createVideoContentText=t.createPhotoTextContentText=void 0;var n=r(171),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(n),o=coreLogger.getLogger("logic")("IM/message/transform"),s=function(){var e=["address","blockquote","center","dir","div","dl","fieldset","form","h1","h2","h3","h4","h5","h6","hr","isindex","menu","noframes","ol","p","pre","table","ul"],t={};return e.forEach(function(e){t[e]=1,t[e.toLocaleUpperCase()]=1}),t}(),i={img:1,IMG:1},u=function(e){return e.replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi,"\n").replace(/<br\/?>/gi,"\n").replace(/<([^>]+)>/g,function(e,t,r){var n="/"===t[0],a=t.split(/\s/)[0];return n&&(a=a.substr(1)),i[a]?e:n&&s[a]?"\n":""})},c=(t.createPhotoTextContentText=function(e,t,r){var n={};return t.forEach(function(e){n[e.file_name]=e}),r=r.replace(/\&nbsp;/g," "),u(r).replace(/<img [^>]*src=['"]([^'"]+)[^>]*>/gi,function(e,t,r,a){var o=getFileName(t),s=n[o];if(s)return"/:um_begin{"+s.um_url+"|Img|0|"+s.file_name+"|0|"+(s.width||"auto")+";"+(s.height||"auto")+";"+s.um_plain_access_code+"}/:um_end";var i=constant.emotion[o];return i?i.character:""})},t.createVideoContentText=function(e){var t=e[0],r=e[1],n="";return r&&(n="|isOriginalImg:0|solidType:0|"+r.um_url+";"+r.width+";"+r.height+";"+r.um_plain_access_code),"/:um_begin{"+t.um_url+"|Video|"+(t.size||0)+"|"+t.file_name+"|"+t.duration+"|"+(t.width||"auto")+";"+(t.height||"auto")+";"+t.um_plain_access_code+n+"}/:um_end"},t.createFileContentText=function(e){var t=0,r="",n="",o=a.getFileMediaType(e.file_name);return isNullOrEmpty(e.duration)||(t=e.duration),isNullOrEmpty(e.width)||(r=e.width),isNullOrEmpty(e.height)||(n=e.height),"/:um_begin{"+e.um_url+"|"+o+"|"+e.file_size+"|"+e.file_name+"|"+t+"|"+r+";"+n+";"+e.um_plain_access_code+"}/:um_end"}),l=(t.transformHtmlEmotion=function(e){var t=/\u2060\/[\S]{2}/g;if(t.test(e)){e.match(t).map(function(t){if(constant.emojiData[t]){var r=constant.SERVER_PUBLIC_PATH.EMOTION_PATH+constant.emojiData[t].file,n=constant.emojiData[t].ZH_CH,a="<img inline src='"+r+"' alt='"+n+"'/>";e=e.replace(t,a)}})}return e},t.transformHtmlLike=function(e){var t=/\u2061\/[\S]{2}/g,r=window.LIKE_PATH+e.split("_")[0];return-1!==e.indexOf(window.LIKE_PATH)?e:(t.test(e)&&(r=window.LIKE_PATH+"like-"+r.split(":")[1]+".svg"),"<img inline src='"+r+"' alt='"+language.EDITOR_TOOLS_TITLE_LIKE+"'/>")},t.createRootElem=function(e){o.debug("createRootElem");var t=e.isGZip,r=e.imageList,n=e.html,a=e.content,s=f();isNullOrEmpty(t)&&(t=1),isNullOrEmpty(n)&&(n=""),isNullOrEmpty(a)&&(a="");var i=void 0;return isNullOrEmpty(r)?(window.CLIENTCONFIG.ISMOBILE,i="<imbody><imagelist></imagelist><html><![CDATA["+n+"]]></html><content>"+a+"</content></imbody>"):(window.CLIENTCONFIG.ISMOBILE,i="<imbody><imagelist>"+d(r[0])+l(r)+"</imagelist><html><![CDATA["+n+"]]></html><content>"+a+"</content></imbody>"),o.debug("createRootElem imBody"),1===t?(i=coreCommon.zip(i),"<r><n>"+s+"</n><g>1</g><c>"+i+"</c></r>"):"<r><n>"+s+"</n><g>0</g><c>"+i+"</c></r>"},t.createMobileRootElem=function(e){o.debug("createMobileRootElem");var t=e.isGZip,r=e.content,n=f();isNullOrEmpty(t)&&(t=1),isNullOrEmpty(r)&&(r="");var a=void 0;return a="<imbody><imagelist></imagelist><html></html><content>"+r+"</content></imbody>",o.debug("createRootElem imBody"),1===t?(a=coreCommon.zip(a),"<r><n>"+n+"</n><g>1</g><c>"+a+"</c></r>"):"<r><n>"+n+"</n><g>0</g><c>"+a+"</c></r>"},t.createQuoteRootElem=function(e){o.debug("createRootElem");var t=e.isGZip,r=e.imageList,n=e.html,a=e.content,s=e.quote,i=f();isNullOrEmpty(t)&&(t=1),isNullOrEmpty(n)&&(n=""),isNullOrEmpty(a)&&(a="");var u=void 0;return u=isNullOrEmpty(r)?'<imbody><imagelist></imagelist><quote origin="'+s.origin+'" mediatype="'+s.media_type+'" time="'+s.utc_stamp+'">'+coreCommon.zip(s.content)+"</quote><html><![CDATA["+n+"]]></html><content>"+a+"</content></imbody>":"<imbody><imagelist>"+d(r[0])+l(r)+'</imagelist><quote origin="'+s.origin+'" mediatype="'+s.media_type+'"  time="'+s.utc_stamp+'">'+coreCommon.zip(s.content)+"</quote><html><![CDATA["+n+"]]></html><content>"+a+"</content></imbody>",o.debug("createRootElem imBody"),1===t?(u=coreCommon.zip(u),"<r><n>"+i+"</n><g>1</g><c>"+u+"</c></r>"):"<r><n>"+i+"</n><g>0</g><c>"+u+"</c></r>"},t.createMobileQuoteRootElem=function(e){o.debug("createRootElem");var t=e.isGZip,r=e.content,n=e.quote,a=f();isNullOrEmpty(t)&&(t=1),isNullOrEmpty(r)&&(r="");var s=void 0;return s='<imbody><imagelist></imagelist><quote origin="'+n.origin+'" mediatype="'+n.media_type+'" time="'+n.utc_stamp+'">'+coreCommon.zip(n.content)+"</quote><html></html><content>"+r+"</content></imbody>",o.debug("createRootElem imBody"),1===t?(s=coreCommon.zip(s),"<r><n>"+a+"</n><g>1</g><c>"+s+"</c></r>"):"<r><n>"+a+"</n><g>0</g><c>"+s+"</c></r>"},t.createFileRootElem=function(e){return"<r><n>"+f()+"</n><g>0</g><c><![CDATA[<imbody><content>"+c(e)+"</content></imbody>]]></c></r>"},t.createPhotoList=function(e){var t="";return e.forEach(function(e){t+='<photo-item name="'+e.file_name+'" size="'+e.file_size+'" height="'+e.height+'" width="'+e.width+'" url="'+e.um_url+'" plain-access-code="'+e.um_plain_access_code+'"></photo-item>'}),t}),d=t.createOldImageItem=function(e){return"<img><imgname>"+e.file_name+'</imgname><imgdata __type__="url">'+e.um_url+"</imgdata></img>"},f=(t.transformMessageContentEmotion=function(e){try{return e=e.replaceAll('src="'+window.EMOTION_PATH,'src="'+constant.SERVER_PUBLIC_PATH.EMOTION_PATH)}catch(e){o.error("transformMessageContentEmotion",e.toString())}},function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz1234567890=-",r=t.length,n="",a=0;a<e;a++)n+=t.charAt(Math.floor(Math.random()*r));return n});t.transformGroupNotifyMessage=function(e){try{var t="",r=JSON.parse(e),n=r.contacts||[],a=r.languageKey;if(isNullOrEmpty(n))return language[a];if(-1!==language[a].indexOf("{1}")){var s=n.shift().name,i=n.getKeyArr("name").join(",");t=language[a].format(s,i)}else t=language[a].format(n.getKeyArr("name").join(","));return t}catch(e){return o.error("transformGroupNotifyMessage error:",e),""}}},827:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.dealRecentByAddGroup=t.dealRecentByDeleteGroup=t.deleteRecent=void 0;var a=r(1),o=n(a),s=r(2),i=n(s),u=r(359),c=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(u),l=coreLogger.getLogger("logic")("recent/list/deleteRecent");t.deleteRecent=function(){var e=(0,i.default)(o.default.mark(function e(t){var r,n,a,s;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l.info("userClick  recent delete group recent"),e.next=4,coreIm.getLocalRecent({owner:t});case 4:if(r=e.sent,isNullOrEmpty(r)){e.next=17;break}return coreIm.deleteRecentUnReadMessage(r.owner),e.next=9,coreCommon.setMessageNotifyRead(r);case 9:return n=r.owner,a=r.chat_type,s={is_del_all:1,conversation_id:n,type:a},coreIm.delRecentConversation(s),r.is_delete=constant.IS_DELETE.YES,e.next=15,coreDb.saveRecent(r);case 15:$dispatch(coreUi.deleteRecent(n)),r.stick_on_top&&coreIm.fixRecentToTop(r);case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(0),l.error("deleteRecent",e.t0.toString());case 22:case"end":return e.stop()}},e,void 0,[[0,19]])}));return function(t){return e.apply(this,arguments)}}(),t.dealRecentByDeleteGroup=function(){var e=(0,i.default)(o.default.mark(function e(t){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l.info("dealRecentByDeleteGroup 删除群组后处理对话"),e.next=4,coreIm.getLocalRecent({owner:t});case 4:if(r=e.sent,isNullOrEmpty(r)){e.next=11;break}return r.is_disable=!0,r.group_name=r.group.name,e.next=10,coreDb.saveRecent(r);case 10:c.refreshRecentList(r);case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(0),l.error("dealRecentByDeleteGroup",e.t0.toString());case 16:case"end":return e.stop()}},e,void 0,[[0,13]])}));return function(t){return e.apply(this,arguments)}}(),t.dealRecentByAddGroup=function(){var e=(0,i.default)(o.default.mark(function e(t){var r;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l.info("dealRecentByDeleteGroup 删除群组后处理对话"),e.next=4,coreIm.getLocalRecent({owner:t});case 4:r=e.sent,isNullOrEmpty(r)||(r.is_disable=!1,coreDb.saveRecent(r),c.refreshRecentList(r)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),l.error("dealRecentByDeleteGroup",e.t0.toString());case 11:case"end":return e.stop()}},e,void 0,[[0,8]])}));return function(t){return e.apply(this,arguments)}}()},828:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";coreLogger.getLogger("model")("recentService").info(e+" initService"),c(),l(),d(),u.default.initRecentUpdateSubscribeMap()}Object.defineProperty(t,"__esModule",{value:!0}),t.getUnReadApplyGroupNotifyNumMap=t.deleteUnReadApplyGroupNotifyNumMap=t.updateUnReadApplyGroupNotifyNumMap=t.initUnReadApplyGroupNotifyNumMap=t.getUnReadNumMap=t.deleteUnReadNumMap=t.updateUnReadNumMap=t.initUnReadNumMap=t.deleteAtMap=t.getAtMap=t.updateAtMap=t.initAtMap=t.recentUpdateSubscribe=void 0,t.initRecentService=a;var o=r(1914),s=n(o),i=r(1915),u=n(i);t.recentUpdateSubscribe=u.default;var c=t.initAtMap=s.default.initAtMap,l=(t.updateAtMap=s.default.updateAtMap,t.getAtMap=s.default.getAtMap,t.deleteAtMap=s.default.deleteAtMap,t.initUnReadNumMap=s.default.initUnReadNumMap),d=(t.updateUnReadNumMap=s.default.updateUnReadNumMap,t.deleteUnReadNumMap=s.default.deleteUnReadNumMap,t.getUnReadNumMap=s.default.getUnReadNumMap,t.initUnReadApplyGroupNotifyNumMap=s.default.initUnReadApplyGroupNotifyNumMap);t.updateUnReadApplyGroupNotifyNumMap=s.default.updateUnReadApplyGroupNotifyNumMap,t.deleteUnReadApplyGroupNotifyNumMap=s.default.deleteUnReadApplyGroupNotifyNumMap,t.getUnReadApplyGroupNotifyNumMap=s.default.getUnReadApplyGroupNotifyNumMap;window.recentListService=s.default},829:function(e,t,r){"use strict";function n(e){$dispatch(coreUi.addAtMessage(e))}function a(e){$dispatch(coreUi.deleteAtMessage(e))}Object.defineProperty(t,"__esModule",{value:!0}),t.addAtMessage=n,t.deleteAtMessage=a},830:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.subscribeUserStatus=t.subscribeUserStatusByAccounts=t.subscribeRecentList=void 0;var a=r(142),o=n(a),s=r(1),i=n(s),u=r(149),c=n(u),l=r(2),d=n(l),f=coreLogger.getLogger("im")("userStatus"),p=(t.subscribeRecentList=function(){var e=(0,d.default)(i.default.mark(function e(){var t,r,n,a,o,s,u,l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.CLIENTCONFIG.ISMOBILE&&window.isEserverOnline){e.next=2;break}return e.abrupt("return");case 2:for(l=l.length>0?l:$getState().recent.recentList,t=[],r=!0,n=!1,a=void 0,e.prev=7,o=(0,c.default)(l);!(r=(s=o.next()).done);r=!0)u=s.value,u.chat_type===constant.CHAT_TYPE.SINGLE_CHAT&&(t.includes(u.owner)||t.push(u.owner));e.next=15;break;case 11:e.prev=11,e.t0=e.catch(7),n=!0,a=e.t0;case 15:e.prev=15,e.prev=16,!r&&o.return&&o.return();case 18:if(e.prev=18,!n){e.next=21;break}throw a;case 21:return e.finish(18);case 22:return e.finish(15);case 23:return e.abrupt("return",p(t));case 24:case"end":return e.stop()}},e,void 0,[[7,11,15,23],[16,,18,22]])}));return function(){return e.apply(this,arguments)}}(),t.subscribeUserStatusByAccounts=function(){var e=(0,d.default)(i.default.mark(function e(t){var r,n,a,s,u,l,d,f,p;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.CLIENTCONFIG.ISMOBILE&&window.isEserverOnline){e.next=2;break}return e.abrupt("return");case 2:if(Array.isArray(t)&&!(t.length<=0)){e.next=4;break}return e.abrupt("return");case 4:for(r=$getState().contactGroups.subAccountList,n=[],a=!0,s=!1,u=void 0,e.prev=9,l=(0,c.default)(t);!(a=(d=l.next()).done);a=!0)f=d.value,r.includes(f)||n.push({account:f});e.next=17;break;case 13:e.prev=13,e.t0=e.catch(9),s=!0,u=e.t0;case 17:e.prev=17,e.prev=18,!a&&l.return&&l.return();case 20:if(e.prev=20,!s){e.next=23;break}throw u;case 23:return e.finish(20);case 24:return e.finish(17);case 25:if(!(n.length<=0)){e.next=27;break}return e.abrupt("return");case 27:return e.next=29,g({account_list:n});case 29:p=e.sent,p&&0===p.result&&(r.push.apply(r,(0,o.default)(t)),$dispatch(coreUi.subscriptionAccountList(r)));case 31:case"end":return e.stop()}},e,void 0,[[9,13,17,25],[18,,20,24]])}));return function(t){return e.apply(this,arguments)}}()),g=t.subscribeUserStatus=function(){var e=(0,d.default)(i.default.mark(function e(t){var r,n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,f.info("subscribeUserStatus"),e.next=4,coreTup.getIMInstance();case 4:return r=e.sent,e.next=7,r.subscribeuserstatus(t);case 7:return n=e.sent,e.abrupt("return",n);case 11:e.prev=11,e.t0=e.catch(0),f.error("subscribeUserStatus",e.t0.toString());case 14:case"end":return e.stop()}},e,void 0,[[0,11]])}));return function(t){return e.apply(this,arguments)}}()},831:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.imgGoToMessage=t.goToConversationMessage=t.goToMessage=void 0;var o=r(1),s=a(o),i=r(2),u=a(i),c=r(190),l=n(c),d=r(217),f=n(d),p=r(303),g=n(p),_=r(596),h=r(991),v=coreLogger.getLogger("logic")("IM/message/positionFix"),m=t.goToMessage=function(){var e=(0,u.default)(s.default.mark(function e(t){var r;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,v.info("goToMessage 搜索结果跳转"),f.onTabClick("conversation"),e.next=5,coreUi.clickToolbar("",!1);case 5:return l.setLoadMore(),$dispatch(coreUi.setSearchHistory(!0)),l.setHistoryMessageLoading(),g.setUnreadNewMessageNum(0),f.changeHintsShow(!0),e.next=12,coreDb.limitMessageList({recent_owner:t.recent_owner,utc_stamp:t.utc_stamp,isPre:!1});case 12:r=e.sent,r.unshift(t),(0,h.modifyMessageListStatus)(r),l.loadHistoryMessage(r),l.setHistoryMessageNotLoading(),l.haveMoreLocalMessage(),l.haveMoreServerMessage(),l.setBackwardLoadMessage(),l.setFirstLoadMessage(!0),$dispatch(coreUi.setSearchHistory(!1)),(0,_.updateMessageQueryInfo)(),e.next=28;break;case 25:e.prev=25,e.t0=e.catch(0),v.error("goToMessage 搜索结果跳转",e.t0.toString());case 28:case"end":return e.stop()}},e,void 0,[[0,25]])}));return function(t){return e.apply(this,arguments)}}();t.goToConversationMessage=function(){var e=(0,u.default)(s.default.mark(function e(t){var r,n;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,v.info("goToConversationMessage 打开搜索到的消息所在的会话"),e.next=4,coreIm.getLocalRecent({owner:t.recent_owner});case 4:return r=e.sent,n=$getState().recent.currentRecentInfo,r.owner!==n.owner?coreIm.toggleRecent(r,!0,!0):v.info("goToConversationMessage","点击相同recent，不重复打开"),e.next=9,m(t);case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),v.error("goToConversationMessage 搜索结果跳转",e.t0.toString());case 14:case"end":return e.stop()}},e,void 0,[[0,11]])}));return function(t){return e.apply(this,arguments)}}(),t.imgGoToMessage=function(){var e=(0,u.default)(s.default.mark(function e(t){var r;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(v.info("imgGoTomessage"),e.t0=$getState().recent.messageList.query({server_chat_id_str:t}),e.t0){e.next=6;break}return e.next=5,coreDb.queryMessage({server_chat_id_str:t});case 5:e.t0=e.sent;case 6:return r=e.t0,e.next=9,m(r);case 9:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}()},832:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.queryShareLinkInfo=t.umCopyFile=t.getGroupSpaceUrl=t.getCloudSpaceUrl=t.deleteFile=t.releaseFile=t.downloadFile=t.uploadFile=void 0;var a=r(1),o=n(a),s=r(2),i=n(s),u=r(1025),c=r(182),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(c),d=coreLogger.getLogger("logic")("IM/offlineFileTup参数规范层"),f=(t.uploadFile=function(){var e=(0,i.default)(o.default.mark(function e(t){var r,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,d.info("uploadFile"),e.next=4,coreTup.getOfflineFileInstance();case 4:if(r=e.sent,t.group_id=t.group_id||"",t.file_type=t.file_type||"",t.file_name=t.file_name||"",t.file_path=t.file_path||"",t.operation_token=t.operation_token||"",""!==t.file_type&&t.file_type!==constant.UPLOAD_FILE_TYPE.NORMAL){e.next=14;break}t.group_id="",e.next=17;break;case 14:if(""!==t.group_id&&""!==t.operation_token){e.next=17;break}return d.error("uploadFile 上传群文件参数错误group_id:"+t.group_id),e.abrupt("return",!1);case 17:return coreUt.utCustomEvent({eventId:constant.EVENT_ID.UT_IM_SEND_FILE,params:[getSuffix(t.file_name)]}),e.next=20,r.uploadfile(t);case 20:return n=e.sent,e.abrupt("return",(0,u.checkOfflineFileRequest)(n));case 24:return e.prev=24,e.t0=e.catch(0),d.error("uploadFile",e.t0.toString()),e.abrupt("return",!1);case 28:case"end":return e.stop()}},e,void 0,[[0,24]])}));return function(t){return e.apply(this,arguments)}}(),t.downloadFile=function(){var e=(0,i.default)(o.default.mark(function e(t){var r,n,a,s,i,c,p,g,_,h,v,m;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,d.debug("downloadFile",t),d.info("downloadFile isThumbnail",t.isThumbnail),e.next=5,coreAccount.getLoginModel();case 5:return r=e.sent,n=t.path,a=n.replace(getFileName(n),""),e.next=10,appService.checkDownloadDirExist(a,r.account);case 10:return e.next=12,coreTup.getOfflineFileInstance();case 12:if(s=e.sent,i={},c="",c=(window.CLIENTCONFIG.ISMOBILE,isNullOrEmpty(t.isThumbnail)||!t.isThumbnail?"":"thumbnail"),""===c?i={access_code:t.access_code,url:t.url,path:t.path,pctype:"",pcheight:"",pcwidth:""}:window.CLIENTCONFIG.ISBIGWIN||window.CLIENTCONFIG.ISWIN||window.CLIENTCONFIG.ISMAC?(p=f(t.path),g=p?"":constant.PC_IMG_THUMBNAIL_SIZE,c=p?"":"thumbnail",i={access_code:t.access_code,url:t.url,path:t.path,pctype:c,pcheight:g+"",pcwidth:g+""}):(_=f(t.path),h=_?"":"340",c=_?"":"thumbnail",i={access_code:t.access_code,url:t.url,path:t.path,pctype:c,pcheight:h+"",pcwidth:h+""}),v=void 0,m=i.url.split("/")[i.url.split("/").length-1],i.path=i.path+"."+m+constant.TEMP_FILE_SUFFIX,!l.getUmServerFlag()&&!isNullOrEmpty(t.isDownloadFile)){e.next=26;break}return e.next=23,s.downloadfile(i);case 23:v=e.sent,e.next=31;break;case 26:return i.keep_download=1,i.total_length=t.total_length,e.next=30,s.downloadfile(i);case 30:v=e.sent;case 31:return e.abrupt("return",(0,u.checkOfflineFileRequest)(v));case 34:e.prev=34,e.t0=e.catch(0),d.error("downloadFile",e.t0.toString());case 37:case"end":return e.stop()}},e,void 0,[[0,34]])}));return function(t){return e.apply(this,arguments)}}(),function(e){if(isNullOrEmpty(e))return!1;var t=e.split(".");return/(gif|GIF)$/.test(t[t.length-1].toUpperCase())});t.releaseFile=function(){var e=(0,i.default)(o.default.mark(function e(t){var r,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,d.info("releaseFile"),coreIm.cancelUploadTask(t),e.next=5,coreTup.getOfflineFileInstance();case 5:return r=e.sent,e.next=8,r.release({file_handle:t.file_handle});case 8:return n=e.sent,e.abrupt("return",(0,u.checkOfflineFileRequest)(n));case 12:e.prev=12,e.t0=e.catch(0),d.error("releaseFile",e.t0.toString());case 15:case"end":return e.stop()}},e,void 0,[[0,12]])}));return function(t){return e.apply(this,arguments)}}(),t.deleteFile=function(){var e=(0,i.default)(o.default.mark(function e(t){var r,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,d.info("deleteFile"),e.next=4,coreTup.getOfflineFileInstance();case 4:return r=e.sent,e.next=7,r.deletefile({url:t.url});case 7:return n=e.sent,e.abrupt("return",(0,u.checkOfflineFileRequest)(n));case 11:e.prev=11,e.t0=e.catch(0),d.error("deleteFile",e.t0.toString());case 14:case"end":return e.stop()}},e,void 0,[[0,11]])}));return function(t){return e.apply(this,arguments)}}(),t.getCloudSpaceUrl=function(){var e=(0,i.default)(o.default.mark(function e(t){var r,n;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,d.info("getCloudSpaceUrl"),e.next=4,coreTup.getOfflineFileInstance();case 4:return r=e.sent,e.next=7,r.getCloudSpaceUrl({token:t,page:1,parent:0});case 7:return n=e.sent,e.abrupt("return",(0,u.checkOfflineFileRequest)(n));case 11:e.prev=11,e.t0=e.catch(0),d.error("getCloudSpaceUrl",e.t0.toString());case 14:case"end":return e.stop()}},e,void 0,[[0,11]])}));return function(t){return e.apply(this,arguments)}}(),t.getGroupSpaceUrl=function(){var e=(0,i.default)(o.default.mark(function e(t,r,n){var a,s;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,d.info("getGroupSpaceUrl"),e.next=4,coreTup.getOfflineFileInstance();case 4:return a=e.sent,e.next=7,a.getGroupSpaceUrl({token:t,teamspaceId:r,groupId:n});case 7:return s=e.sent,e.abrupt("return",(0,u.checkOfflineFileRequest)(s));case 11:e.prev=11,e.t0=e.catch(0),d.error("getGroupSpaceUrl",e.t0.toString());case 14:case"end":return e.stop()}},e,void 0,[[0,11]])}));return function(t,r,n){return e.apply(this,arguments)}}(),t.umCopyFile=function(){var e=(0,i.default)(o.default.mark(function e(t){var r,n,a,s=t.group_space_id,i=t.file_id,c=t.from_group,l=t.owner_id,f=t.link_code,p=t.plain_access_code;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,d.info("umCopyFile",i),r=0,e.next=5,coreTup.getOfflineFileInstance();case 5:return n=e.sent,e.next=8,n.copyfile({group_space_id:s,file_id:i,from_group:c,dest_parentid:r,owner_id:l,link_code:f,plain_access_code:p});case 8:return a=e.sent,e.abrupt("return",(0,u.checkOfflineFileRequest)(a));case 12:e.prev=12,e.t0=e.catch(0),d.error("umCopyFile",e.t0.toString());case 15:case"end":return e.stop()}},e,void 0,[[0,12]])}));return function(t){return e.apply(this,arguments)}}(),t.queryShareLinkInfo=function(){var e=(0,i.default)(o.default.mark(function e(t){var r,n,a=t.linkCode,s=t.accessCode;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,d.info("queryShareLinkInfo"),e.next=4,coreTup.getOfflineFileInstance();case 4:return r=e.sent,e.next=7,r.queryShareLinkInfo({linkCode:a,accessCode:s});case 7:return n=e.sent,e.abrupt("return",(0,u.checkOfflineFileRequest)(n));case 11:e.prev=11,e.t0=e.catch(0),d.error("queryShareLinkInfo",e.t0.toString());case 14:case"end":return e.stop()}},e,void 0,[[0,11]])}));return function(t){return e.apply(this,arguments)}}()},833:function(e,t,r){"use strict";function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=(arguments.length>1&&void 0!==arguments[1]&&arguments[1],arguments.length>2&&void 0!==arguments[2]?arguments[2]:"");o.info("<eserver_login> "+e+" "+t)}function a(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";o.info("<eserver_resume> "+e+" "+t+" "+r)}Object.defineProperty(t,"__esModule",{value:!0}),t.printEServerLog=n,t.printEServerResumeLog=a;var o=coreLogger.getLogger("im")("login")},978:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){try{var t=e.msgContent,r=e.publicNo,n=[],a=$getState().recent.messageList;return isNullOrEmpty(t)||Object.type(t)!==Object.type.ARRAY||isNullOrEmpty(r)||Object.type(r)!==Object.type.OBJECT?n:(t.forEach(function(e,t){var s={};s.client_chat_id=getClientId(),s.server_chat_id_str=e.MESSAGEID,s.native_name=r.nodeName,s.name=r.nodeNameEn,s.origin=r.nodeID,s.recent_owner=r.nodeID,s.chat_type=constant.CHAT_TYPE.PUBLIC_NO,s.media_type=constant.MEDIA_TYPE.PUBLIC_NUMBER,s.content=e.MSGCONTENT,s.contenttype=0,s.is_read=1,s.is_delete=constant.IS_DELETE.NO;var u=o(s.content);s=(0,i.default)({},s,u),s.utc_stamp=e.SENDTIME,s.time_stamp="",s.show_html="",s.show_text="",(isNullOrEmpty(a)||a.every(function(e){return e.server_chat_id_str!==s.server_chat_id_str}))&&"functionApp"===u.MsgType&&n.push(s)}),n)}catch(e){return M.error("publicNo publicNoMsgParse result:",e.toString()),[]}}function o(e){var t=String(e).isJSON()?JSON.parse(e):{};return"functionApp"===t.MsgType&&(t.Content=String(t.Content).isJSON()?JSON.parse(t.Content):t.Content,"[object Object]"===Object.prototype.toString.call(t.Content)?(t.Content.messageResult=String(t.Content.messageResult).isJSON()?JSON.parse(t.Content.messageResult):{},t.Content.title=String(t.Content.title).isJSON()?JSON.parse(t.Content.title):{},t.Content.appUrl=String(t.Content.appUrl).isJSON()?JSON.parse(t.Content.appUrl):{}):t.Content={},t.language=-1!==["zh_CN","CN"].indexOf(t.language)?"CN":t.language,t.chat_type=constant.CHAT_TYPE.PUBLIC_NO,t.media_type=constant.MEDIA_TYPE.PUBLIC_NUMBER),t}Object.defineProperty(t,"__esModule",{value:!0}),t.getKnowledUrlCode=t.getPublicNOUrlCode=t.savePublicNoIncrementTime=t.getOfflinePublicNoMsg=t.getSubscribePublicNO=t.getAllSubscribePublicNo=void 0;var s=r(135),i=n(s),u=r(69),c=n(u),l=r(155),d=n(l),f=r(1),p=n(f),g=r(2),_=n(g),h=t.getAllSubscribePublicNo=function(){var e=(0,_.default)(p.default.mark(function e(){var t,r,n,a,o,s,i,u,c;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,coreAccount.getLoginModel();case 3:return t=e.sent,r=t.crypt_token,n=w(r),a="https://"+t.middleEndAddress+"/mcloud/mag/ProxyForText/hxplatform/service/biz/weClientService/findSaved",o={language:"cn",resource:"PC",userType:"intranet",xsType:1},e.next=10,S(a,o,n);case 10:if(s=e.sent,M.info("publicNo getAllSubscribePublicNo result:",s.result),0===s.result&&!isNullOrEmpty(s.data)&&isNullOrEmpty(s.param)){e.next=14;break}return e.abrupt("return",{result:1});case 14:return i=s.data.result,u=[],i.forEach(function(e,t){u.push({serviceNodeId:e,systemVersion:""})}),e.next=19,v(u);case 19:return c=e.sent,M.info("publicNo get all service result:",c.result),e.abrupt("return",c);case 24:return e.prev=24,e.t0=e.catch(0),M.error("publicNo get all service result:",e.t0.toString()),e.abrupt("return",{result:1});case 28:case"end":return e.stop()}},e,this,[[0,24]])}));return function(){return e.apply(this,arguments)}}(),v=t.getSubscribePublicNO=function(){var e=(0,_.default)(p.default.mark(function e(t){var r,n,a,o,s,i,u;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,coreAccount.getLoginModel();case 3:return r=e.sent,n=r.crypt_token,a=w(n),o="https://"+r.middleEndAddress+"/mcloud/mag/ProxyForText/hxplatform/service/biz/serviceNoVersionService/getAllServiceNoInfo",s={serviceNoList:t},e.next=10,S(o,s,a);case 10:if(i=e.sent,M.info("publicNo getSubscribePublicNO result:",i.result),0===i.result&&isNullOrEmpty(i.param)){e.next=14;break}return e.abrupt("return",{result:1});case 14:return u=[],i.data&&i.data.forEach(function(e,t){1===Number(e.isVip)&&(e.native_name=e.nodeName,e.name=e.nodeNameEn,e.owner=e.nodeID,e.account=e.nodeID,e.top_time=0,e.type=constant.CHAT_TYPE.PUBLIC_NO,e.unread_num=0,e.is_delete=0,e.publicNoInfo={name:e.name,account:e.account,native_name:e.native_name},u.push({attentionAll:e.attentionAll,isRequired:e.isRequired,isSubscribe:e.isSubscribe,isVip:e.isVip,nodeID:e.nodeID,nodeIconUrl:e.nodeIcon,nodeName:e.nodeName,nodeNameEn:e.nodeNameEn,nodeType:e.nodeType,privateCode:e.privateCode,qrcodeBigUrl:e.qrcodeBigUrl,qrcodeSmallUrl:e.qrcodeSmallUrl,systemVersion:e.systemVersion,exparams:e.exparams,description:e.description,descriptionEn:e.descriptionEn}))}),coreDb.bulkSaveOfficialAccountsDetail(u),e.abrupt("return",{data:i.data,result:0});case 20:return e.prev=20,e.t0=e.catch(0),M.error("publicNo getSubscribePublicNO result:",e.t0.toString()),e.abrupt("return",{result:1});case 24:case"end":return e.stop()}},e,this,[[0,20]])}));return function(t){return e.apply(this,arguments)}}(),m=t.getOfflinePublicNoMsg=function(){var e=(0,_.default)(p.default.mark(function e(t){var r,n,o,s,i,u,c,l,d,f,g,_;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,coreAccount.getLoginModel();case 3:return r=e.sent,n=r.crypt_token,e.next=7,h();case 7:if(o=e.sent,0===o.result){e.next=10;break}return e.abrupt("return",{result:1});case 10:return o=o.data,s=w(n),i="https://"+r.middleEndAddress+"/mcloud/mag/ProxyForText/hxplatform/service/biz/msgIntegration/findAllMsgByTimeJid",e.next=15,coreAccount.getLoginModel();case 15:return u=e.sent,c={jid:u.account,logoutTime:t,language:"cn"},e.next=19,S(i,c,s);case 19:if(l=e.sent,0===l.result&&isNullOrEmpty(l.param)){e.next=22;break}return e.abrupt("return",{result:1});case 22:return d=l.data,f=[],g=[],_=[],M.info("publicNo findAllMsgByTimeJid result:",l.result),o.forEach(function(e,t){var r=d[e.nodeID];if(!isNullOrEmpty(r)&&r.length>0){if(g=a({msgContent:r,publicNo:e}),g.length>0){e.unread_num=g.length;var n=g[g.length-1];e.chat_info=g[g.length-1],e.utc_time=Number(n&&n.utc_stamp);var o=coreIm.getUnReadNumMap(),s=o[e.nodeID]||0;s+=g.length,coreIm.updateUnReadNumMap(e.nodeID,s),1===Number(e.isVip)&&(f.push(e),_=[].concat(_,g))}}}),M.info("publicNo getOfflinePublicNoMsg publicNo length:",f&&f.length),_.length>0&&coreIm.saveMessageListInfo(_),e.abrupt("return",{result:0,data:f,serverTime:d.SERVERTIME});case 30:return e.prev=30,e.t0=e.catch(0),M.error("publicNo getOfflinePublicNoMsg result:",e.t0.toString()),e.abrupt("return",{result:1});case 34:case"end":return e.stop()}},e,this,[[0,30]])}));return function(t){return e.apply(this,arguments)}}();t.savePublicNoIncrementTime=function(){var e=(0,_.default)(p.default.mark(function e(){var t,r,n,a;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,coreDb.queryUserConfig({key:"publicNoIncrementTime"});case 3:return t=e.sent,r=t.value,isNullOrEmpty(r)?r=0:(r=parseInt(r),isNaN(r)&&(r=0)),e.next=8,m(r);case 8:return n=e.sent,a=[],n.result===constant.ERROR_CODE.Success&&(a=n.data,a.length>0&&!isNullOrEmpty(n.serverTime)&&coreDb.saveUserConfig({key:"publicNoIncrementTime",value:n.serverTime.toString()})),e.abrupt("return",a);case 14:return e.prev=14,e.t0=e.catch(0),M.error("publicNo savePublicNoIncrementTime result:",e.t0.toString()),e.abrupt("return",[]);case 18:case"end":return e.stop()}},e,this,[[0,14]])}));return function(){return e.apply(this,arguments)}}(),t.getPublicNOUrlCode=function(){var e=(0,_.default)(p.default.mark(function e(){var t,r,n;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,coreAccount.getLoginModel();case 2:return t=e.sent,r="https://"+t.middleEndAddress+"/mcloud/mag/ProxyForText/ssoauth/v1/code",n=w(t.crypt_token),e.abrupt("return",S(r,{},n));case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t.getKnowledUrlCode=function(){var e=(0,_.default)(p.default.mark(function e(){var t,r,n;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,coreAccount.getLoginModel();case 2:return t=e.sent,r="https://"+t.middleEndAddress+"/mcloud/mag/ProxyForText/sso/auth/v1/terminal/code",n=w(t.crypt_token),e.abrupt("return",I(r,{},n));case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}();t.publicNoMsgParse=a,t.parsePublicNoContent=o;var M=coreLogger.getLogger("logic")("publicNO"),y=null,E=function(){var e=(0,_.default)(p.default.mark(function e(t){var r,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(y){e.next=4;break}return e.next=3,coreAccount.getLoginModel();case 3:y=e.sent;case 4:return r={url:t,type:a.type,header:a.headers||"",body:a.body||"",cipherlist:[50331695,50331701,50331708,50331709]},e.next=7,coreHttp.sendSyncRequest(r);case 7:if(n=e.sent,200!==n.param.resp_code){e.next=10;break}return e.abrupt("return",{result:0,data:JSON.parse(n.param.recv_body)});case 10:return e.abrupt("return",n);case 11:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),S=function(){var e=(0,_.default)(p.default.mark(function e(t,r,n){var a;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E(t,{type:constant.REQUEST_TYPE.POST,headers:n,body:"object"===(void 0===r?"undefined":(0,d.default)(r))?(0,c.default)(r):r});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}},e,void 0)}));return function(t,r,n){return e.apply(this,arguments)}}(),I=function(){var e=(0,_.default)(p.default.mark(function e(t,r,n){var a;return p.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E(t,{type:constant.REQUEST_TYPE.GET,headers:n,body:"object"===(void 0===r?"undefined":(0,d.default)(r))?(0,c.default)(r):r});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}},e,void 0)}));return function(t,r,n){return e.apply(this,arguments)}}(),w=function(e){return(0,i.default)({"Content-Type":"application/json"},{Cookie:"token="+e})}},979:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(147),o=n(a),s=r(139),i=n(s),u=r(142),c=n(u),l=r(825),d=n(l),f=r(638),p=n(f);t.default=function(){var e=!1,t={},r=!0,n=0,a=new p.default,s=new p.default,u=new d.default,l=new d.default,f=[],g=new p.default,_=!1,h=function(){};return h.prototype={initReceiveMessageQueue:function(){f=[],_=!1,coreLogger.getLogger("model")("IMService").info("initReceiveMessageQueue _receiveMessageQueue.length="+f.length)},setReceiveMessageQueue:function(e){f.push(e),coreLogger.getLogger("model")("IMService").info("setReceiveMessageQueue _receiveMessageQueue.length="+f.length)},setReceiveMessageQueueList:function(e){var t;(t=f).push.apply(t,(0,c.default)(e)),coreLogger.getLogger("model")("IMService").info("setReceiveMessageQueueList _receiveMessageQueue.length="+f.length)},getFirstReceiveMessageQueue:function(){return coreLogger.getLogger("model")("IMService").info("getFirstReceiveMessageQueue _receiveMessageQueue.length="+f.length),f.shift()},setIsReceiveMessageQueueDealing:function(e){_=e},getIsReceiveMessageQueueDealing:function(){return _},initUnReadFileMessageList:function(){l.init()},setUnReadFileMessage:function(e){l.set(["server_chat_id_str"],(0,i.default)({},e))},getUnReadFileMessage:function(e){return l.get(e)},getUnReadFileMessageList:function(e){return l.getList(e)},getAllUnReadFileMessageList:function(){return l.getAll()},deleteUnReadFileMessage:function(e){l.delete({server_chat_id_str:e.server_chat_id_str})},deleteUnReadFileMessageList:function(e){e.forEach(function(e){l.delete({server_chat_id_str:e.server_chat_id_str})})},initCurrentRecentUnReadMessageList:function(){u.init()},setCurrentRecentUnReadMessage:function(e){u.set(["server_chat_id_str"],(0,i.default)({},e))},getCurrentRecentAllUnReadMessageList:function(){return u.getAll()},initUnReadMessageList:function(){g.init()},setRecentUnReadMessage:function(e,t){var r=g.get(e)||[],n=r.query({server_chat_id_str:t.server_chat_id_str});isNullOrEmpty(n)&&g.set(e,[].concat((0,c.default)(r),[(0,i.default)({},t)]))},setRecentUnReadMessageList:function(e,t){var r=g.get(e)||[];g.set(e,[].concat((0,c.default)(r),(0,c.default)(t)))},getRecentUnReadMessage:function(e,t){return(g.get(e)||[]).query({server_chat_id_str:t})},deleteRecentUnReadMessage:function(e){g.delete(e)},deleteUnReadMessage:function(e,t){var r=g.get(e)||[];r.delete({server_chat_id_str:t}),g.set(e,[].concat((0,c.default)(r)))},initUnDealMessageList:function(){t={},coreLogger.getLogger("model")("IMService").info("initUnDealMessageList _unDealMessageMap.length="+(0,o.default)(t).length)},setUnDealMessage:function(e){var r=e[0];t[r.server_chat_id_str]=e,coreLogger.getLogger("model")("IMService").info("setUnDealMessage _unDealMessageMap.length="+(0,o.default)(t).length)},getUnDealMessageList:function(){var e=(0,o.default)(t),r=[];return e.forEach(function(e){r.push(t[e])}),coreLogger.getLogger("model")("IMService").info("getUnDealMessageList list.length="+r.length),r},setRecentListReady:function(t){var r=coreLogger.getLogger("model")("IMService/message");!0===t?(r.info("setRecentListReady 本地会话已准备好"),e=t):!1===t&&(r.info("setRecentListReady 本地会话尚未准备好"),e=t)},getRecentListReady:function(){return e},getPosition:function(){return n},setPosition:function(e){n=e},initSendingMessageMap:function(){a.init()},setSendingMessage:function(e,t){a.set(e,(0,i.default)({},t))},getSendingMessage:function(e){var t=a.get(e)||{};return(0,i.default)({},t)},deleteSendingMessage:function(e){a.delete(e)},getSendingMessageMap:function(){return a.getAll()},querySendingMessageMap:function(e){return a.getAll(e)},initReceivingMessageMap:function(){s.init()},setReceivingMessage:function(e,t){s.set(e,(0,i.default)({},t))},getReceivingMessage:function(e){var t=s.get(e)||{};return(0,i.default)({},t)},deleteReceivingMessage:function(e){s.delete(e)},getReceivingMessageMap:function(e){return s.getAll(e)},queryReceivingMessageMap:function(e){return s.getAll(e)},setUmServerFlag:function(e){r=e},getUmServerFlag:function(){return r}},new h}()},980:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(139),o=n(a),s=r(638),i=n(s),u=new i.default,c=new i.default;t.default={initFileHandleMap:function(){u.init()},setFileByHandle:function(e,t){u.set(e,(0,o.default)({},t))},getFileByHandle:function(e){var t=u.get(e)||{};return(0,o.default)({},t)},getFileHandleMap:function(){return u.getAll()},deleteFileByHandle:function(e){u.delete(e)},deleteFileByHandleList:function(e){e.forEach(function(e){u.delete(e)})},initGroupFileHandleMap:function(){c.init()},setGroupFileByHandle:function(e,t){c.set(e,(0,o.default)({},t))},getGroupFileByHandle:function(e){var t=c.get(e)||{};return(0,o.default)({},t)},deleteGroupFileByHandle:function(e){c.delete(e)}}},981:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(139),o=n(a),s=r(638),i=n(s),u=new i.default;t.default={initUnDownloadedPhotoMap:function(){u.init()},setUnDownloadedPhoto:function(e,t){u.set(e,(0,o.default)({},t))},getUnDownloadedPhoto:function(e){var t=u.get(e)||{};return(0,o.default)({},t)},getUnDownloadedPhotoMap:function(){return u.getAll()},deleteUnDownloadedPhoto:function(e){u.delete(e)}}},982:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(639),a=function(e){return e&&e.__esModule?e:{default:e}}(n),o=new a.default;t.default={addUploadScreenShotFunc:function(e){o.addQueueFunc(e),o.runQueueFunc()}}},983:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(639),a=function(e){return e&&e.__esModule?e:{default:e}}(n),o=new a.default;t.default={addDownloadScreenShotFunc:function(e){o.addQueueFunc(e),o.runQueueFunc()}}},984:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){l=!0;var t=d.getMessageWithdrawServerIdList();if(0===t.length)return void(l=!1);var r=Date.now();t.forEach(function(t){r-t.time>6e4&&d.deleteMessageWithdrawServerId({key:t[e]})}),setTimeout(function(){return a(e)},3e5)}Object.defineProperty(t,"__esModule",{value:!0});var o=r(139),s=n(o),i=r(825),u=n(i),c=new u.default,l=!1,d={initMessageWithdrawServerIdList:function(){c.init()},setMessageWithdrawServerId:function(e,t){t.time=Date.now(),c.set([e],(0,s.default)({},t)),l||a(e)},getMessageWithdrawServerId:function(e){var t=c.get(e)||{};return(0,s.default)({},t)},getMessageWithdrawServerIdList:function(){return c.getAll()},deleteMessageWithdrawServerId:function(e){c.delete(e)}};t.default=d},985:function(e,t,r){"use strict";function n(){var e=!1,t={};this.__proto__={initOfflineFileConfig:function(){e=!1,t={}},setOfflineFileConfig:function(r,n){r&&(e=!0,t=n)},getOfflineFileConfig:function(){return e?t:e}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=new n},986:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="";t.default=function(){var e=function(){};return e.prototype={initSendPhotoType:function(){n=""},setSendPhotoType:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";n=e},getSendPhotoType:function(){return n}},new e}()},987:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e){var t=getSuffix(e);return window.CLIENTCONFIG["Device.ComCfg.IM.forbidFileExt"].replace(/\./g,"").split(";").indexOf(t)>-1&&t}function s(e){return window.fs.lstatSync(e).isDirectory()}function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return isNullOrEmpty(t)&&(t=$getState()),l(t)>=e.size}function u(e){return 0!==e.size}function c(e){var t=e.name;return!isNullOrEmpty(t)&&246>=t.length}function l(e){var t=e.recent.currentRecentInfo,r=R.isGroup(t.chat_type),n=d();if(r){var a=f(t.group.single_file_space);return a<=n&&n?a:n}return n||1024*constant.AppConfig.UM.fileMaxSize*1024}function d(){if(!isNullOrEmpty(window.CLIENTCONFIG["Device.ComCfg.IM.fileTransferSize"]))return 1024*parseInt(window.CLIENTCONFIG["Device.ComCfg.IM.fileTransferSize"])*1024}function f(e){var t=1024*parseInt(window.CLIENTCONFIG.GROUP_MAX_FILE_SIZE)*1024;return e=e||t,D.info("getGroupFileSize:",e),e}Object.defineProperty(t,"__esModule",{value:!0}),t.sendVideo=t.sendMobileVideo=t.sendAudio=t.copyImageToCache=t.sendImage=t.sendNormalFile=t.sendMobileMedia=t.sendMyVoice=t.sendFiles=void 0;var p=r(139),g=a(p),_=r(149),h=a(_),v=r(1),m=a(v),M=r(2),y=a(M),E=r(147),S=a(E),I=r(357),w=n(I),T=r(190),b=n(T),L=r(599),O=n(L),N=r(171),R=n(N),x=r(304),A=r(217),C=r(182),k=n(C),P=r(338),F=(r(636),r(1012)),D=coreLogger.getLogger("logic")("IM/fileSend"),U=(t.sendFiles=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{if(!coreIm.checkEserverOnline("sendFiles"))return;isNullOrEmpty(t)&&(t=$getState()),D.info("sendFiles");var r=0,n={},a={},d={},f={},p={};!function g(){var _=e[r];if(r++,D.info("sendFiles 自执行顺次执行Promise",r),r-1===e.length){var h="",v=(0,S.default)(n);if(v.length>0&&(v.length===e.length?h+=language.ALL_FILESEND_BAN_FILE_TYPE.format(v.map(function(e){return" "+e+" "}).join(","))+"\n":h+=language.FILESEND_BAN_FILE_TYPE.format(v.map(function(e){return" "+e+" "}).join(","))+"\n"),(0,S.default)(a).length>0){var m=(0,S.default)(a).join(", "),M=formatFileSize(l(t));h+=language.FILESEND_BAN_FILE_SIZE.format(m,M)+"\n"}if((0,S.default)(f).length>0){var y=(0,S.default)(f).join(", ");h+=language.FILE_SEND_BAN_FILE_MIN_SIZE.format(y)+"\n"}if((0,S.default)(d).length>0){var E=(0,S.default)(d).join(", ");h+=language.FILE_SEND_BAN_FILENAME_LENGTH.format(E)+"\n"}return void(""!==h&&alert(h))}if(isNullOrEmpty(_))return g();if(s(_.path))return p[_.name]=!0,Toast(language.FlODERS_CANNOT_BE_TRANSMITTED),g();var I=o(_.name);return I?(n[I]=!0,g()):i(_,t)?u(_)?c(_)?(D.info("sendFiles 执行sendFile Promise",r),G(_,t).then(g)):(d[_.name]=!0,g()):(f[_.name]=!0,g()):(a[_.name]=!0,g())}()}catch(e){D.error("sendFiles",e.toString())}},t.sendMyVoice=function(){var e=(0,y.default)(m.default.mark(function e(t){var r,n;return m.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,D.info("sendMyVoice"),r=void 0,e.next=5,appService.getFileInfo(t);case 5:return n=e.sent,r={name:getFileName(t),path:t,size:n.size,file_type:constant.FILE_TYPE.VOICE},e.abrupt("return",$(r,$getState()));case 10:e.prev=10,e.t0=e.catch(0),D.error("sendMyVoice",e.t0.toString());case 13:case"end":return e.stop()}},e,void 0,[[0,10]])}));return function(t){return e.apply(this,arguments)}}(),function(e){var t=e.lastIndexOf("."),r=-1===t?"":e.substr(t+1);return constant.MESSAGE_VIDEO_SUFFIX.includes(r.toLocaleLowerCase())}),G=function(e,t){try{D.info("sendFile");var r=w.createFileMessage(t,e.name),n=e.type,a=e.size,o=n.startsWith("image");if(o&&a>1024*parseInt(window.CLIENTCONFIG["Device.ComCfg.IM.limitpic"]))return r.media_type=constant.MEDIA_TYPE.FILE,B(e,t,r);if(o)return H(e,t,r);if(n.startsWith("audio"))return $(e,t,r);n.startsWith("video");return U(e.path)?Q(e,t,r):B(e,t,r)}catch(e){D.error("sendFile",e.toString())}},B=(t.sendMobileMedia=function(){var e=(0,y.default)(m.default.mark(function e(t){var r,n,a,o,s,i,u,c,l,d;return m.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=t.media,D.info("sendMobileMedia"+r.length),n=$getState(),e.prev=3,a=0;case 5:if(!(a<r.length)){e.next=46;break}return o=r[a].filepath,o=o.startsWith("file://")?o.substr(7,o.length):o,e.next=10,appService.getFileInfo(o);case 10:if(s=e.sent,i={name:getFileName(o),path:o,size:s.size},u=w.createFileMessage(n,i.name),(c=coreCommon.getMediaType(i.name))!==constant.MEDIA_TYPE.VIDEO){e.next=36;break}if(void 0===(l=r[a].thumbnailpath)){e.next=32;break}if(""!==l){e.next=22;break}D.info("get thumbnailpath of the vedio failed"),i={name:getFileName(o),path:o,size:s.size,imgPath:l},e.next=27;break;case 22:return l=l.startsWith("file://")?l.substr(7,l.length):l,e.next=25,appService.getFileInfo(l);case 25:d=e.sent,i={name:getFileName(o),path:o,size:s.size,imgName:getFileName(l),imgPath:l,imgSize:d.size};case 27:return e.next=29,q(i,n,u);case 29:return e.abrupt("continue",43);case 32:return u.media_type=constant.MEDIA_TYPE.FILE,e.next=35,B(i,n,u);case 35:return e.abrupt("continue",43);case 36:if(!(i.size>1024*parseInt(window.CLIENTCONFIG["Device.ComCfg.IM.limitpic"]))){e.next=41;break}return u.media_type=constant.MEDIA_TYPE.FILE,e.next=40,B(i,n,u);case 40:return e.abrupt("continue",43);case 41:return e.next=43,H(i,n,u);case 43:a++,e.next=5;break;case 46:e.next=51;break;case 48:e.prev=48,e.t0=e.catch(3),D.error("sendMobileMedia",e.t0.toString());case 51:case"end":return e.stop()}},e,void 0,[[3,48]])}));return function(t){return e.apply(this,arguments)}}(),t.sendNormalFile=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$getState(),r=arguments[2];try{D.info("sendNormalFile");var n={file_size:e.size,file_name:e.name,message_id:r.id,message_server_chat_id_str:r.server_chat_id_str,recent_id:r.recent_id,recent_owner:r.recent_owner,file_real_save_path:e.path,time_stamp:P.localTimeService.getLocalTime(),file_type:e.file_type?e.file_type:null,send_from_local:1};return W(r,[n],t)}catch(e){D.error("sendNormalFile",e.toString())}}),H=t.sendImage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$getState(),r=arguments[2];try{return D.info("sendImage"),R.getImageInfo(e.path).then(function(n){Y(e.path).then(function(a){var o={file_size:e.size,width:n.width,height:n.height,file_name:getFileName(a),message_id:r.id,message_server_chat_id_str:r.server_chat_id_str,recent_id:r.recent_id,recent_owner:r.recent_owner,file_real_save_path:a,file_path:a,time_stamp:P.localTimeService.getLocalTime()};return(0,F.sendUmFileBySequence)(r,[o],t)}).catch(function(e){D.error("copyImageToCache",e&&e.toString())})})}catch(e){D.error("sendImage",e.toString())}},Y=t.copyImageToCache=function(){var e=(0,y.default)(m.default.mark(function e(t){var r,n,a,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$getState();return m.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=o.login.account,t.startsWith(appService.getScreenShotPath(r))){e.next=9;break}return n=appService.getScreenShotPath(r),a=Guid()+"."+getSuffix(getFileName(t)),n=coreCommon.isMobile()?n:n+a,t=coreCommon.isMobile()?"file://"+t:t,e.next=8,appService.saveAs(t,n,a);case 8:t=e.sent;case 9:return e.abrupt("return",t);case 10:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),$=t.sendAudio=function(e,t,r){try{return D.info("sendAudio"),r||(r=w.createFileMessage(t,e.name)),R.getAudioInfo(e.path).then(function(n){var a={file_size:e.size,duration:n.duration,file_name:e.name,message_id:r.id,message_server_chat_id_str:r.server_chat_id_str,recent_id:r.recent_id,recent_owner:r.recent_owner,file_real_save_path:e.path,time_stamp:P.localTimeService.getLocalTime()};return W(r,[a],t)})}catch(e){D.error("sendAudio",e.toString())}},j=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=document.createElement("video"),n=PromiseObject();return r.onloadeddata=function(){var t=document.createElement("canvas"),a=1;(r.videoWidth>constant.MESSAGE_VIDEO.MAX_WIDTH||r.videoHeight>constant.MESSAGE_VIDEO.MAX_HEIGHT)&&(a=r.videoWidth>r.videoHeight?constant.MESSAGE_VIDEO.MAX_WIDTH/r.videoWidth:constant.MESSAGE_VIDEO.MAX_HEIGHT/r.videoHeight),t.width=r.videoWidth*a,t.height=r.videoHeight*a,t.getContext("2d").drawImage(r,0,0,t.width,t.height);var o=t.toDataURL("image/png"),s=$getState().login.account,i=e.split(/\/|\\/).pop(),u=i.replace(/\.\w+$/,"")+"."+Date.now()+".png",c=appService.getScreenShotPath(s)+u;appService.saveBase64Img(o,c).then(function(a){n.resolve({duration:Math.ceil(r.duration),videoPath:e,videoName:i,videoWidth:r.videoWidth,videoHeight:r.videoHeight,imgWidth:t.width,imgHeight:t.height,imgName:u,imgPath:c})})},r.onerror=function(){t.message.media_type=constant.MEDIA_TYPE.FILE,B(t.file,t.state,t.message)},r.src=e,n},q=t.sendMobileVideo=function(){var e=(0,y.default)(m.default.mark(function e(t){var r,n,a,o,s,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:$getState(),u=arguments[2];return m.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,D.info("sendMobileVideo"),e.next=4,R.getVideoInfo(t.path);case 4:if(r=e.sent,n=P.localTimeService.getLocalTime(),a=[],""!==t.imgPath){e.next=12;break}o={file_size:t.size,width:r.width,height:r.height,file_name:t.name,message_id:u.id,message_server_chat_id_str:u.server_chat_id_str,recent_id:u.recent_id,recent_owner:u.recent_owner,file_real_save_path:t.path,file_path:t.path,time_stamp:n},a=[o],e.next=16;break;case 12:return e.next=14,R.getImageInfo(t.imgPath);case 14:s=e.sent,a=[{file_size:t.size,width:r.width,height:r.height,file_name:t.name,file_real_save_path:t.path,file_path:t.path,message_id:u.id,message_server_chat_id_str:u.server_chat_id_str,recent_id:u.recent_id,recent_owner:u.recent_owner,time_stamp:n},{file_size:t.imgSize,width:s.width,height:s.height,file_name:t.imgName,file_real_save_path:t.imgPath,file_path:t.imgPath,message_id:u.id,message_server_chat_id_str:u.server_chat_id_str,recent_id:u.recent_id,recent_owner:u.recent_owner,time_stamp:n,isVideoImage:!0}];case 16:return e.abrupt("return",W(u,a,i));case 19:e.prev=19,e.t0=e.catch(0),D.error("sendMobileVideo",e.t0.toString());case 22:case"end":return e.stop()}},e,void 0,[[0,19]])}));return function(t){return e.apply(this,arguments)}}(),Q=t.sendVideo=function(){var e=(0,y.default)(m.default.mark(function e(t,r,n){var a,o,s,i;return m.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,D.info("sendVideo"),a={file:t,state:r,message:n},e.next=5,j(t.path,a);case 5:return o=e.sent,s=P.localTimeService.getLocalTime(),i=[{file_name:o.videoName,file_real_save_path:o.videoPath,width:o.videoWidth,height:o.videoHeight,duration:o.duration,message_id:n.id,message_server_chat_id_str:n.server_chat_id_str,recent_id:n.recent_id,recent_owner:n.recent_owner,time_stamp:s},{file_name:o.imgName,file_real_save_path:o.imgPath,width:o.imgWidth,height:o.imgHeight,message_id:n.id,message_server_chat_id_str:n.server_chat_id_str,recent_id:n.recent_id,recent_owner:n.recent_owner,time_stamp:s,isVideoImage:!0}],e.abrupt("return",W(n,i,r));case 11:e.prev=11,e.t0=e.catch(0),D.error("sendVideo",e.t0.toString());case 14:case"end":return e.stop()}},e,void 0,[[0,11]])}));return function(t,r,n){return e.apply(this,arguments)}}(),W=function(){var e=(0,y.default)(m.default.mark(function e(t,r,n){var a,o,s,i,u,c,l,d,f,p,_,v,M,y;return m.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.prev=0,D.info("sendUmFile"),a=n.recent,o=a.isLoadMore,s=a.currentRecentInfo,t.status=constant.MEDIA_STATUS.SENDING,i=[],u=!0,c=!1,l=void 0,e.prev=10,d=(0,h.default)(r);case 12:if(u=(f=d.next()).done){e.next=49;break}if(p=f.value,p.is_uploaded=constant.IS_UPLOADED.NO,p.file_deal_type=constant.FILE_DEAL_TYPE.UPLOAD,_={file_name:p.file_name,file_path:p.file_real_save_path},p.file_real_save_name=p.file_name,!R.isGroup(s.chat_type)||!k.getUmServerFlag()){e.next=27;break}return _.group_id=s.group.group_id,_.file_type=constant.UPLOAD_FILE_TYPE.GROUP,e.next=23,O.groupFilePreUpload(p,t);case 23:if(""!==(v=e.sent)){e.next=26;break}return e.abrupt("return",(0,x.dealFileSendFailed)(p,t));case 26:_.operation_token=v;case 27:return e.next=29,coreIm.uploadFile(_);case 29:if(!1!==(M=e.sent)){e.next=33;break}return R.isBelongToCurrentRecent(t)&&(o&&b.initLoadMore(),t.file_list=[p],b.addNewMessage(t)),e.abrupt("return",(0,x.dealFileSendFailed)(p,t));case 33:if(p.file_handle=M.param.pfile_handle.toString(),k.setFileByHandle(p.file_handle,p),!p.isVideoImage&&t.media_type!==constant.MEDIA_TYPE.PHOTO){e.next=41;break}return e.next=38,coreDb.saveScreenShot((0,g.default)({},p));case 38:e.t0=e.sent,e.next=44;break;case 41:return e.next=43,coreDb.saveFile((0,g.default)({},p));case 43:e.t0=e.sent;case 44:y=e.t0,i.push(y);case 46:u=!0,e.next=12;break;case 49:e.next=55;break;case 51:e.prev=51,e.t1=e.catch(10),c=!0,l=e.t1;case 55:e.prev=55,e.prev=56,!u&&d.return&&d.return();case 58:if(e.prev=58,!c){e.next=61;break}throw l;case 61:return e.finish(58);case 62:return e.finish(55);case 63:return t.file_list=i,t.send_status=constant.SEND_STATUS.error,t.status=constant.MEDIA_STATUS.SEND_ERROR,e.next=68,coreDb.saveMessage(t);case 68:t=e.sent,t.send_status=constant.SEND_STATUS.sending,t.status=constant.MEDIA_STATUS.SENDING,k.setSendingMessage(t.client_chat_id,t),(0,A.updateMessageToRecent)(t),R.isBelongToCurrentRecent(t)&&(o&&b.initLoadMore(),b.addNewMessage(t),i.forEach(function(e){b.updateProgressMap(e.file_handle,0)})),e.next=79;break;case 76:e.prev=76,e.t2=e.catch(0),D.error("sendUmFile",e.t2&&e.t2.toString());case 79:case"end":return e.stop()}},e,void 0,[[0,76],[10,51,55,63],[56,,58,62]])}));return function(t,r,n){return e.apply(this,arguments)}}()},988:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.reSendScreenShots=t.sendScreenShots=t.sendMobileTextMessage=t.sendNormalMessage=void 0;var a=r(989),o=n(a),s=r(1e3),i=n(s);t.sendNormalMessage=o.sendNormalMessage,t.sendMobileTextMessage=o.sendMobileTextMessage,t.sendScreenShots=i.sendScreenShots,t.reSendScreenShots=i.reSendScreenShots},989:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.sendMobileTextMessage=t.sendNormalMessage=void 0;var a=r(139),o=function(e){return e&&e.__esModule?e:{default:e}}(a),s=r(302),i=n(s),u=r(228),c=n(u),l=r(190),d=(n(l),coreLogger.getLogger("logic")("IM/messageSend"));window.tup=c;t.sendNormalMessage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{return d.info("sendNormalMessage"),coreUi.clearDoc().then(function(){coreCommon.isIos()&&delegate.$getUmEditor&&delegate.$getUmEditor().focus()}),i.createNormalMessage(e,t).then(function(t){return 1===e.sub_msg_type&&(t.sub_msg_type=e.sub_msg_type),c.sendImMessage((0,o.default)({},t))})}catch(e){d.error("sendNormalMessage",e.toString())}},t.sendMobileTextMessage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{return d.info("sendMobileTextMessage"),i.createMobileTextMessage(e,t).then(function(t){return 1===e.sub_msg_type&&(t.sub_msg_type=e.sub_msg_type),c.sendImMessage((0,o.default)({},t))})}catch(e){d.error("sendNormalMessage",e.toString())}}},990:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}function o(e){var t=_.formatImgUrl(e.getAttribute("src"));if(!1===t)return!1;if(-1===t.indexOf(constant.SERVER_PUBLIC_PATH.EMOTION_PATH.replace("file:///",""))){var r=getFileName(t);e.src=constant.SERVER_PUBLIC_PATH.IMAGE_PATH+r,e.setAttribute("onmouseup","ShowImageMenu(this)"),e.setAttribute("ondblclick","ShowImage(this)"),e.setAttribute("id",r.substring(0,r.lastIndexOf("."))),e.removeAttribute("onload")}return!0}Object.defineProperty(t,"__esModule",{value:!0}),t.createCallRecordMessage=t.createGroupMemberChgMessage=t.createGroupNotifyMessage=t.formatSendImgInfo=t.createFileMessageContent=t.createQuotePhotoTextMessageContent=t.createVideoMessageContent=t.createPhotoTextMessageContent=t.createMobileLikeMessage=t.createLikeMessage=t.createFileMessage=t.createPhotoTextMessage=t.createMobileTextMessage=t.createNormalMessage=void 0;var s=r(142),i=a(s),u=r(1),c=a(u),l=r(2),d=a(l),f=r(826),p=n(f),g=r(171),_=n(g),h=r(640),v=n(h),m=r(338),M=coreLogger.getLogger("logic")("IM/message/transform"),y=(t.createNormalMessage=function(){var e=(0,d.default)(c.default.mark(function e(t){var r,n,a,o,s,i,u,l,d,f,p,g,h,E,I,w,T,b,L,O,N,R=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,x=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=$getState(),n=r.recent,a=r.myInfo,o=r.contactGroups,e.next=4,coreAccount.getLoginModel();case 4:return s=e.sent,i=n.recentList,u=n.currentRecentInfo,l=o.isShowGroupSlider,d=o.selectGroupInfo,u=t.mediaType===constant.MEDIA_TYPE.AUTO_REPLY?i.query({owner:x}):l?i.query({owner:d.group_id}):u,M.info("createNormalMessage"),f=y(t),isNullOrEmpty(R)||(M.info("createNormalMessage 有引用, 创建引用消息"),f=S(t,R)),p=$getState().common,g=p.userFontFamily,h=p.userFontSize,E=p.userFontColor,I=p.userFontStatus,w=$getState().IM.imSetFontEnable,T=I.bold?"bold":"normal",b=I.italic?"italic":"normal",L=I.underline?"underline":"none",h=4*h/3,O=t.html,N={at_user_list:window.at_list||[],chat_type:t.chatType||u.chat_type,origin:s.account,target:x||"",group_id:"",display_name:getContactName(a)||"",content:f,recent_id:x?1:u.id,recent_owner:x||v.getRecentOwner(u),media_type:t.mediaType,show_html:O,show_text:t.text,client_chat_id:getClientId(),time_stamp:m.localTimeService.getLocalTime(),name:a.name||"",native_name:a.native_name||"",is_read:1,source_flag:constant.SOURCE_FLAG.IM,content_type:constant.CONTENT_TYPE.TEXT,quote:R,is_delete:constant.IS_DELETE.NO},N.server_chat_id_str=N.client_chat_id.toString(),N.utc_stamp=N.time_stamp,_.isGroup(u.chat_type)?(N.group_id=u.owner,N.group_name=u.group.name):N.target=N.target?N.target:u.owner,e.abrupt("return",N);case 25:e.prev=25,e.t0=e.catch(0),M.error("createNormalMessage",e.t0.toString());case 28:case"end":return e.stop()}},e,void 0,[[0,25]])}));return function(t){return e.apply(this,arguments)}}(),t.createMobileTextMessage=function(){var e=(0,d.default)(c.default.mark(function e(t){var r,n,a,o,s,i,u,l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=$getState(),n=r.recent,a=r.myInfo,o=n.currentRecentInfo,e.next=5,coreAccount.getLoginModel();case 5:return s=e.sent,M.info("createMobileTextMessage"),i=E(t),isNullOrEmpty(l)||(M.info("createMobileTextMessage 有引用, 创建引用消息"),i=I(t,l)),u={at_user_list:window.at_list||[],chat_type:t.chatType||o.chat_type,origin:s.account,target:"",group_id:"",display_name:getContactName(a)||"",content:i,recent_id:o.id,recent_owner:v.getRecentOwner(o),media_type:t.mediaType,show_text:t.text,client_chat_id:getClientId(),time_stamp:m.localTimeService.getLocalTime(),name:a.name||"",native_name:a.native_name||"",is_read:1,source_flag:constant.SOURCE_FLAG.IM,content_type:constant.CONTENT_TYPE.TEXT,quote:l,is_delete:constant.IS_DELETE.NO},u.server_chat_id_str=u.client_chat_id.toString(),u.utc_stamp=u.time_stamp,_.isGroup(o.chat_type)?(u.group_id=o.group.group_id,u.group_name=o.group.name):u.target=o.contact.account||o.account,e.abrupt("return",u);case 16:e.prev=16,e.t0=e.catch(0),M.error("createNormalMessage",e.t0.toString());case 19:case"end":return e.stop()}},e,void 0,[[0,16]])}));return function(t){return e.apply(this,arguments)}}(),t.createPhotoTextMessage=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{var n=e.recent,a=e.myInfo,o=n.currentRecentInfo,s=coreAccount.getSyncLoginModel();M.info("createPhotoTextMessage");var i=t.html,u=t.text,c=t.mediaType,l=$getState().common,d=(l.userFontFamily,l.userFontSize),f=(l.userFontColor,l.userFontStatus);$getState().IM.imSetFontEnable,f.bold,f.italic,f.underline;d=4*d/3;var p={at_user_list:window.at_list||[],chat_type:o.chat_type,content_type:constant.CONTENT_TYPE.TEXT,group_id:"",media_type:c,display_name:getContactName(a)||"",name:a.name||"",native_name:a.native_name||"",origin:s.account,source_flag:0,target:"",time_stamp:m.localTimeService.getLocalTime(),recent_id:o.id,recent_owner:v.getRecentOwner(o),show_text:u,client_chat_id:getClientId(),is_read:1,is_delete:constant.IS_DELETE.NO,quote:r,show_html:i};return p.utc_stamp=p.time_stamp,p.server_chat_id_str=p.client_chat_id.toString(),_.isGroup(o.chat_type)?(p.group_id=o.group.group_id,p.group_name=o.group.name):p.target=o.contact.account||o.account,p}catch(e){M.error("createPhotoTextMessage",e.toString())}},t.createFileMessage=function(e,t){M.info("createFileMessage");var r=e.myInfo,n=e.recent,a=n.currentRecentInfo,o=coreAccount.getSyncLoginModel(),s={chat_type:a.chat_type,content_type:constant.CONTENT_TYPE.TEXT,target:"",group_id:"",display_name:getContactName(e.myInfo)||"",native_name:r.native_name||"",name:r.name||"",origin:o.account,source_flag:0,time_stamp:m.localTimeService.getLocalTime(),client_chat_id:getClientId(),media_type:coreCommon.getMediaType(t),recent_id:a.id,recent_owner:v.getRecentOwner(a),is_read:1,is_delete:constant.IS_DELETE.NO,status:constant.MEDIA_STATUS.SENDING,show_text:t};return s.server_chat_id_str=s.client_chat_id.toString(),s.utc_stamp=s.time_stamp,_.isGroup(a.chat_type)?(s.group_id=a.owner,s.group_name=a.group.name):s.target=a.owner,s},t.createLikeMessage=function(){var e=(0,d.default)(c.default.mark(function e(t){var r,n,a,o,s,i,u;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=$getState(),n=r.recent,a=r.myInfo,o=n.currentRecentInfo,e.next=5,coreAccount.getLoginModel();case 5:return s=e.sent,M.info("createMobileLikeMessage"),i=E(t),u={chat_type:o.chat_type,origin:s.account,target:"",group_id:"",display_name:getContactName(a)||"",content:i,recent_id:o.id,recent_owner:v.getRecentOwner(o),media_type:t.mediaType,show_html:t.html,show_text:t.text,client_chat_id:getClientId(),time_stamp:m.localTimeService.getLocalTime(),name:a.name||"",native_name:a.native_name||"",is_read:1,source_flag:constant.SOURCE_FLAG.IM,content_type:constant.CONTENT_TYPE.TEXT,is_delete:constant.IS_DELETE.NO},u.server_chat_id_str=u.client_chat_id.toString(),u.utc_stamp=u.time_stamp,_.isGroup(o.chat_type)?(u.group_id=o.group.group_id,u.group_name=o.group.name):u.target=o.contact.account||o.account,e.abrupt("return",u);case 15:e.prev=15,e.t0=e.catch(0),M.error("createLikeMessage",e.t0.toString());case 18:case"end":return e.stop()}},e,void 0,[[0,15]])}));return function(t){return e.apply(this,arguments)}}(),t.createMobileLikeMessage=function(){var e=(0,d.default)(c.default.mark(function e(t){var r,n,a,o,s,i,u;return c.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=$getState(),n=r.recent,a=r.myInfo,o=n.currentRecentInfo,e.next=5,coreAccount.getLoginModel();case 5:return s=e.sent,M.info("createMobileLikeMessage"),i=E(t),u={chat_type:o.chat_type,origin:s.account,target:"",group_id:"",display_name:getContactName(a)||"",content:i,recent_id:o.id,recent_owner:v.getRecentOwner(o),media_type:t.mediaType,show_text:t.text,client_chat_id:getClientId(),time_stamp:m.localTimeService.getLocalTime(),name:a.name||"",native_name:a.native_name||"",is_read:1,source_flag:constant.SOURCE_FLAG.IM,content_type:constant.CONTENT_TYPE.TEXT,is_delete:constant.IS_DELETE.NO},u.server_chat_id_str=u.client_chat_id.toString(),u.utc_stamp=u.time_stamp,_.isGroup(o.chat_type)?(u.group_id=o.group.group_id,u.group_name=o.group.name):u.target=o.contact.account||o.account,e.abrupt("return",u);case 15:e.prev=15,e.t0=e.catch(0),M.error("createMobileLikeMessage",e.t0.toString());case 18:case"end":return e.stop()}},e,void 0,[[0,15]])}));return function(t){return e.apply(this,arguments)}}(),function(e){try{M.info("createNormalMessageContent");var t=e.html,r=e.text,n=$getState().common,a=(n.userFontFamily,n.userFontSize),o=(n.userFontColor,n.userFontStatus);$getState().IM.imSetFontEnable,o.bold,o.italic,o.underline;a=4*a/3,t=p.transformMessageContentEmotion(t);var s={isGZip:1,imageList:[],html:t,content:r};return p.createRootElem(s)}catch(e){M.error("createNormalMessageContent",e.toString())}}),E=function(e){try{M.info("createMobileTextMessageContent");var t=e.text,r={isGZip:1,content:t};return p.createMobileRootElem(r)}catch(e){M.error("createMobileTextMessageContent",e.toString())}},S=function(e,t){try{M.info("createQuoteNormalMessageContent");var r=e.html,n=e.text;r=p.transformMessageContentEmotion(r);var a={isGZip:1,imageList:[],html:r,content:n,quote:t};return p.createQuoteRootElem(a)}catch(e){M.error("createQuoteNormalMessageContent",e.toString())}},I=function(e,t){try{M.info("createMobileQuoteTextMessageContent");var r=e.text,n={isGZip:1,content:r,quote:t};return p.createMobileQuoteRootElem(n)}catch(e){M.error("createMobileQuoteTextMessageContent",e.toString())}},w=(t.createPhotoTextMessageContent=function(e,t){try{M.info("createPhotoTextMessageContent");var r=e.show_html,n=(e.show_text,e.origin,e.media_type),a=w(r);a=p.transformMessageContentEmotion(a);var o={isGZip:1,imageList:[].concat((0,i.default)(t)),html:a,content:p.createPhotoTextContentText(n,t,r)};return p.createRootElem(o)}catch(e){M.error("createPhotoTextMessageContent",e.toString())}},t.createVideoMessageContent=function(e,t){try{M.info("createPhotoTextMessageContent");var r=(e.media_type,{isGZip:1,content:p.createVideoContentText(t)});return r.imageList=[],p.createRootElem(r)}catch(e){M.error("createPhotoTextMessageContent",e.toString())}},t.createQuotePhotoTextMessageContent=function(e,t,r){try{M.info("createQuotePhotoTextMessageContent");var n=e.show_html,a=(e.show_text,e.origin,w(n));a=p.transformMessageContentEmotion(a);var o={isGZip:1,imageList:[].concat((0,i.default)(t)),html:a,content:p.createPhotoTextContentText(t,n),quote:r};return p.createQuoteRootElem(o)}catch(e){M.error("createQuotePhotoTextMessageContent",e.toString())}},t.createFileMessageContent=function(e){try{return M.info("createFileMessageContent"),p.createFileRootElem(e)}catch(e){M.error("createFileMessageContent",e.toString())}},t.formatSendImgInfo=function(e){var t=coreCommon.String2HTML(e);if("text"===Object.type(t))return e;if("P"===t.tagName&&1===t.childNodes.length&&(t=t.childNodes[0]),"IMG"===t.tagName)o(t);else{t.querySelectorAll("img").forEach(function(e){o(e)})}return coreCommon.XML2String(t)});t.createGroupNotifyMessage=function(e){try{M.info("createGroupNotifyMessage");var t=$getState();if(isNullOrEmpty(e)||isNullOrEmpty(e.group))return void M.error("createGroupNotifyMessage 空群信息，不处理");var r=e.group,n=e.chat_type,a=e.id,o=e.owner,s=r.manifesto,i=t.myInfo,u=coreAccount.getSyncLoginModel(),c={chat_type:n,origin:u.account,target:"",group_id:o,display_name:getContactName(i)||"",content:"",recent_id:a,recent_owner:v.getRecentOwner(e),media_type:constant.MEDIA_TYPE.GROUP_NOTIFY,show_html:"",show_text:s,client_chat_id:getClientId(),time_stamp:m.localTimeService.getLocalTime(),name:i.name||"",native_name:i.native_name||"",is_read:1,source_flag:constant.SOURCE_FLAG.IM,content_type:constant.CONTENT_TYPE.TEXT,quote:{},is_delete:constant.IS_DELETE.NO,utc_stamp:m.localTimeService.getLocalTime()};return c.utc_stamp=c.time_stamp,c.server_chat_id_str=c.client_chat_id.toString(),c}catch(e){M.error("createGroupNotifyMessage",e.toString())}},t.createGroupMemberChgMessage=function(e,t,r,n){try{M.info("createGroupMemberChgMessage");var a=$getState(),o=a.myInfo,s=coreAccount.getSyncLoginModel(),i={chat_type:v.getChatTypeByGroup(e),origin:s.account,target:"",group_id:e.group_id,group_name:e.name,display_name:getContactName(o)||"",content:"",recent_owner:e.group_id,media_type:r,show_html:"",show_text:t,client_chat_id:getClientId(),time_stamp:n||m.localTimeService.getLocalTime(),name:o.name||"",native_name:o.native_name||"",is_read:1,source_flag:constant.SOURCE_FLAG.IM,content_type:constant.CONTENT_TYPE.TEXT,quote:{},is_delete:constant.IS_DELETE.NO,utc_stamp:n||m.localTimeService.getLocalTime(),is_dealed_apply:1};return i.utc_stamp=i.time_stamp,i.server_chat_id_str=i.client_chat_id.toString(),r===constant.MEDIA_TYPE.APPLY_JOIN_FIXED_GROUP_NOTIFY&&(i.is_dealed_apply=0),i}catch(e){M.error("createGroupMemberChgMessage",e.toString())}},t.createCallRecordMessage=function(e,t){try{M.info("createCallRecordMessage");var r=$getState();if(isNullOrEmpty(e)||!isNullOrEmpty(e.group))return void M.error("createCallRecordMessage 空信息，不处理");var n=(e.group,e.chat_type),a=e.id,o=(e.owner,e.contact),s=r.myInfo,i=coreAccount.getSyncLoginModel(),u={chat_type:n,origin:i.account,target:"",group_id:"",display_name:getContactName(s)||"",content:"",recent_id:a,recent_owner:v.getRecentOwner(e),media_type:constant.MEDIA_TYPE.CALL_RECORD_NOTIFY,show_html:"",show_text:t,client_chat_id:getClientId(),time_stamp:m.localTimeService.getLocalTime(),name:s.name||"",native_name:s.native_name||"",is_read:1,source_flag:constant.SOURCE_FLAG.IM,content_type:constant.CONTENT_TYPE.TEXT,quote:{},is_delete:constant.IS_DELETE.NO,utc_stamp:m.localTimeService.getLocalTime()};return u.utc_stamp=u.time_stamp,u.server_chat_id_str=u.client_chat_id.toString(),_.isGroup(e.chat_type)?(u.group_id=e.group.group_id,u.group_name=e.group.name):u.target=o.account||e.account,u}catch(e){M.error("createCallRecordMessage",e.toString())}}},991:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.modifyMessageListStatus=void 0;var n=r(147),a=function(e){return e&&e.__esModule?e:{default:e}}(n),o=coreLogger.getLogger("logic")("IM/mergeCacheToMessageList"),s=(t.modifyMessageListStatus=function(e){if(!isNullOrEmpty(e)){var t=$getState().recent.currentRecentInfo,r=t.chat_type,n=t.account,o=t.group_id,i=coreIm.isGroup(r),u=i?o:n,c=coreIm.querySendingMessageMap({recent_owner:u}),l=coreIm.queryReceivingMessageMap({recent_owner:u});!isNullOrEmpty(c)&&(0,a.default)(c).forEach(function(t){var r=s(e,c[t]);if(-1!==r){var n=e[r].media_type;n!==constant.MEDIA_TYPE.FILE&&n!==constant.MEDIA_TYPE.PHOTO_TEXT&&n!==constant.MEDIA_TYPE.PHOTO&&n!==constant.MEDIA_TYPE.VIDEO&&n!==constant.MEDIA_TYPE.AUDIO||(e[r].status=constant.MEDIA_STATUS.SENDING),e[r].send_status=constant.SEND_STATUS.sending}}),!isNullOrEmpty(l)&&(0,a.default)(l).forEach(function(t){var r=s(e,l[t]);-1!==r&&(e[r].status=constant.MEDIA_STATUS.RECEIVING,delete e[r].send_status)})}},function(e,t){try{var r=-1;return o.debug("queryMessageListIndex"),isNullOrEmpty(t)?(o.debug("queryMessageListIndex1"),r):isNullOrEmpty(t.server_chat_id_str)?!isNullOrEmpty(t.client_chat_id)&&t.client_chat_id>0?(r=e.findIndex(function(e){return e.client_chat_id===t.client_chat_id}),o.debug("queryMessageListIndex3"),r):(r=e.findIndex(function(e){return e.id===t.id}),o.debug("queryMessageListIndex4"),r):(r=e.findIndex(function(e){return e.server_chat_id_str===t.server_chat_id_str}),o.debug("queryMessageListIndex2"),r)}catch(e){o.error("queryMessageListIndex5",{message:t,e:e.toJSON()})}})},992:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t,r,n,a){for(var o=t;o<r;o++){if(n.smallTime>a[o].smallTime){if(d.debug("dealSmallSign 符合区间判断条件"),o===t){d.debug("dealSmallSign 只涉及一个区间");var s=p(a[t],n);e.splice.apply(e,[t,1].concat((0,c.default)(s)))}else{d.debug("dealSmallSign 涉及多个区间");var i=p(a[t],n),u=p(i[i.length-1],a[o]);i.splice.apply(i,[i.length-1,1].concat((0,c.default)(u))),e.splice.apply(e,[t,o-t+1].concat((0,c.default)(i))),d.debug("dealSmallSign 区间跳跃",t+" => "+o)}t=o;break}if(o===r-1){d.debug("dealSmallSign 直到最后一条都不符合区间判断条件");var l=p(a[t],n);e.splice.apply(e,[t,1].concat((0,c.default)(l))),t=o;break}}return{retMsgSignArr:e,newI:t}}function o(e,t,r,n,a){for(var o=t;o<r;o++){if(n.smallTime>a[o].smallTime){if(d.debug("mergeAndDealMessageSign 符合区间判断条件"),o===t){d.debug("mergeAndDealMessageSign 只涉及一个区间");var s=p(n,a[t]);e.splice.apply(e,[t,1].concat((0,c.default)(s)))}else{d.debug("mergeAndDealMessageSign 涉及多个区间");var i=p(n,a[o]);e.splice.apply(e,[t,o-t+1].concat((0,c.default)(i))),d.debug("mergeAndDealMessageSign 区间跳跃",t+" => "+o)}t=o;break}if(o===r-1){d.debug("mergeAndDealMessageSign 直到最后一条都不符合区间判断条件"),e.splice(t,1,n),t=o;break}}return{retMsgSignArr:e,newI:t}}Object.defineProperty(t,"__esModule",{value:!0}),t.isLocalHas=t.dealMessageSign=void 0;var s=r(139),i=n(s),u=r(142),c=n(u),l=r(217),d=(function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);t.default=e}(l),coreLogger.getLogger("logic")("IM/historyMessageDeal")),f=(t.dealMessageSign=function(e,t){try{d.debug("dealMessageSign");var r=t.messageSign,n=[];return n=isNullOrEmpty(r)?[e]:f(e,t),t.messageSign=n,t}catch(e){d.error("dealMessageSign",e.toString())}},t.isLocalHas=function(e,t){var r=t.messageSign,n=t.id;if(d.info("isLocalMessage",n),isNullOrEmpty(r))return!1;for(var a=!1,o=0;o<r.length;o++)if((r[o].queryTime>=e.queryTime||r[o].bigTime>=e.bigTime)&&r[o].smallTime<=e.smallTime){d.info("isLocalMessage In the scope, no additional processing is required",n),a=!0;break}return a},function(e,t){d.debug("mergeAndDealMessageSign");for(var r=t.messageSign,n=[],s=r.length,i=0;i<s;i++)if(e.queryTime<=r[i].queryTime)if(d.debug("mergeAndDealMessageSign 新区间小于当前区间"),i===s-1){var u;d.debug("mergeAndDealMessageSign 当前处于最后一条");var l=p(r[i],e);(u=n).splice.apply(u,[i,1].concat((0,c.default)(l)))}else{d.debug("mergeAndDealMessageSign 循环判断，寻找区间");var f=a(n,i,s,e,r);n=f.retMsgSignArr,i=f.newI}else if(d.debug("mergeAndDealMessageSign 新区间大于当前区间"),0===i)if(d.debug("mergeAndDealMessageSign 当前处于第一条"),e.smallTime>=r[i].smallTime){var g,_=p(e,r[i]);(g=n).splice.apply(g,[i,1].concat((0,c.default)(_)))}else{d.debug("mergeAndDealMessageSign 循环判断，寻找区间");var h=o(n,i,s,e,r);n=h.retMsgSignArr,i=h.newI}else d.debug("mergeAndDealMessageSign 当前不处于第一条"),n.push(r[i]);return n}),p=function(e,t){try{var r=[];if(d.debug("dealTwoSign"),t.bigTime>=e.smallTime||t.queryTime>=e.smallTime)if(t.smallTime>=e.smallTime)d.debug("dealTwoSign 大区域包含小区域"),r=[(0,i.default)({},e)];else{d.debug("dealTwoSign 小区域与大区域有交叉");var n=(0,i.default)({},e);n.smallTime=t.smallTime,r=[n]}else d.debug("dealTwoSign 小区域与大区域无交叉"),r=[e,t];return r}catch(r){return d.error("dealTwoSign 不合并标记",r.toString()),[e,t]}}},993:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.getRecentConversation=void 0;var a=r(1),o=n(a),s=r(2),i=n(s),u=coreLogger.getLogger("logic")("recent/list");t.getRecentConversation=function(){var e=(0,i.default)(o.default.mark(function e(){var t,r,n,a,s,i,c;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,u.info("getRecentConversation"),e.next=4,coreDb.queryUserConfig({key:"recentIncrementTime"});case 4:return t=e.sent,r=t.value,isNullOrEmpty(r)?r=0:(r=parseInt(r),isNaN(r)&&(r=0)),e.next=9,coreIm.tupGetRecentConversation({time_stamp:r,count:200});case 9:return n=e.sent,a=[],n&&(s=n.param,i=n.result,i===constant.ERROR_CODE.Success&&(c=s.time_stamp,a=s.recent_conversation_list,0!==c&&c!==r&&coreDb.saveUserConfig({key:"recentIncrementTime",value:c.toString()}))),e.abrupt("return",a);case 15:return e.prev=15,e.t0=e.catch(0),u.error("getRecentConversation",e.t0),e.abrupt("return",[]);case 19:case"end":return e.stop()}},e,void 0,[[0,15]])}));return function(){return e.apply(this,arguments)}}()},994:function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.setMessageNotifyClose=t.initNewConversationUI=t.changeHintsShow=t.openRecentConversation=t.toggleRecent=t.initOpenRecentData=void 0;var o=r(3),s=a(o),i=r(1),u=a(i),c=r(2),l=a(c),d=r(597),f=n(d),p=r(359),g=n(p),_=r(171),h=n(_),v=r(827),m=coreLogger.getLogger("logic")("recent/list"),M=[],y=!1,E=(t.initOpenRecentData=function(e){m.info("initOpenRecentData ",e),y=!1},function(e){y=!1;var t=M.length;if(m.info("dealOpenRecent length",e.id,t),0!==t){var r=M[t-1];M=[],r.owner!==e.owner&&S(r)}}),S=(t.toggleRecent=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];m.info("userClick toggleRecent "+handlePhoneNumber(e.owner)+" "+e.id),coreUi.updateSliderDetailShow(!1),coreUi.setShowGroupSlider(!1);var n=$getState(),a=n.recent.currentRecentInfo;if(t&&(h.isGroup(e.chat_type)?coreConf.setUnreadNumber({account:"",group_id:e.owner},0):coreConf.setUnreadNumber({account:e.owner,group_id:""},0)),!window.CLIENTCONFIG.ISMOBILE&&e.owner===a.owner)return Object.type(delegate.UmFocus)!==Object.type.FUNCTION||e.chat_type===constant.CHAT_TYPE.SYSTEM_NOTIFICATION&&e.chat_type===constant.CHAT_TYPE.PUBLIC_NO||delegate.UmFocus(),m.info("toggleRecent",e.id,"Open the same Recent"),void(y=!1);$dispatch(coreUi.setMessageDividingLine(""));var o=e.unread_num||0;m.info("toggleRecent set unReadMessageNumTop number = ",o),$dispatch(coreUi.setUnreadMessageNumTop(o)),$dispatch(coreUi.setNewMessageNum(0)),e.chat_type===constant.CHAT_TYPE.SYSTEM_NOTIFICATION?N(e):e.chat_type===constant.CHAT_TYPE.PUBLIC_NO?R(e):S(e,r)},t.openRecentConversation=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{m.info("openRecentConversation",e.id),$dispatch(coreUi.setUnreadMessageNumTop(e.unread_num)),$dispatch(coreUi.setNewMessageNum(0)),e.chat_type===constant.CHAT_TYPE.SYSTEM_NOTIFICATION&&$dispatch(coreUi.updateUnreadSystemBulletin(0)),e.is_disable?I(e):T(e,t)}catch(t){m.error("openRecentConversation",e.id,t.toString())}}),I=function(e){try{m.info("openDisableRecent",e.id),b(e).then(function(){var e=(0,l.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return $dispatch(coreUi.setHistoryMessageNotLoading()),e.next=3,coreIm.loadHistoryMessageList();case 3:E(t),L(t.owner);case 5:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){m.error("openDisableRecent 异常抛出",e)})}catch(t){m.error("openDisableRecent",e.id,t.toString())}},w=t.changeHintsShow=function(e){$dispatch(coreUi.changeHintsShowState(e))},T=function(){var e=(0,l.default)(u.default.mark(function e(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{m.info("openRecent",t.id),b(t).then(function(){var e=(0,l.default)(u.default.mark(function e(t){return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(coreUi.showRecentIntoView(t.owner),coreContact.updateSignatureByRecent(t),coreCommon.setMessageNotifyRead(t),$dispatch(coreUi.setMessageDividingLine("")),$dispatch(coreUi.setHistoryMessageNotLoading()),window.CLIENTCONFIG.ISMOBILE||Object.type(delegate.UmFocus)!==Object.type.FUNCTION||t.chat_type===constant.CHAT_TYPE.PUBLIC_NO||delegate.UmFocus(),r){e.next=9;break}return e.next=9,coreIm.loadHistoryMessageList(t);case 9:L(t.owner),E(t),O(t);case 12:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}()).catch(function(e){m.error("openRecent error",t.id,e)})}catch(e){m.error("openRecent",t.id,e.toString())}case 1:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),b=t.initNewConversationUI=function(e){try{if(m.info("initNewConversationUI",e.id),y)return M.push(e),new s.default(function(e,t){t("Wait for the last end")});$dispatch(coreUi.loadMessageList([])),coreUi.freshImExtMemberList([]),g.selectRecentItem(e),coreIm.setUnreadNewMessageNum(0),coreIm.deleteRecentUnReadMessage(e.owner);var t=window.getRoute();return window.CLIENTCONFIG.ISMOBILE?("callMain"!==t&&"mConfMemberPage"!==t&&window.goRoute("conversation"),window.webView&&window.webView.cancelAllMessageNotify()):($dispatch(coreUi.showEditor()),coreUi.clickToolbar("",!1),w(!0)),e.is_delete=constant.IS_DELETE.NO,y=!0,new s.default(function(t){setTimeout(function(){return t(e)},70)})}catch(t){return m.error("initNewConversationUI",e.id,t),new s.default(function(t){setTimeout(function(){return t(e)},70)})}},L=t.setMessageNotifyClose=function(e){var t=$getState(),r=t.notify.messageNotifyIsShow,n=t.notify.messageNotify,a=n.account||n.group_id;r&&a===e&&coreCommon.closeMessageNotifyLogic()},O=function(){var e=(0,l.default)(u.default.mark(function e(t){var r,n,a;return u.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,m.info("dealGroupRecentHas",t.id),r=t.chat_type,n=t.owner,!h.isGroup(r)){e.next=17;break}return m.info("dealGroupRecentHas, is group recent",t.id),e.next=7,coreGroup.getGroupInfoFromDB(n);case 7:if(a=e.sent,!isNullOrEmpty(a)){e.next=13;break}m.info("dealGroupRecentHas local groupInfo is empty,recent set disable",t.id),(0,v.dealRecentByDeleteGroup)(n),e.next=15;break;case 13:return e.next=15,f.getImExtendInfo(t);case 15:e.next=18;break;case 17:m.info("dealGroupRecentHas, is not group recent,do nothing",t.id);case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(0),m.error("dealGroupRecentHas",t.id,e.t0);case 23:case"end":return e.stop()}},e,void 0,[[0,20]])}));return function(t){return e.apply(this,arguments)}}(),N=function(e){m.info("openSystemNotificationRecent,open sysBulletin recent",e.id),$dispatch(coreUi.loadMessageList([])),coreUi.freshImExtMemberList([]),window.CLIENTCONFIG.ISMOBILE?window.goRoute("conversation"):coreIm.removeUnReadMessageFlash(e,!1),$dispatch(coreUi.setHistoryMessageNotLoading()),$dispatch(coreUi.selectRecentItem(e)),$dispatch(coreUi.updateUnreadSystemBulletin(0)),coreIm.dealSysBulletinRead(e),coreIm.loadHistoryMessageList(),E(e)},R=function(e){m.info("openPublicNoRecent,open publicNo recent",e.id,e.owner),$dispatch(coreUi.loadMessageList([])),coreUi.freshImExtMemberList([]),window.CLIENTCONFIG.ISMOBILE?window.goRoute("conversation"):coreIm.removeUnReadMessageFlash(e,!1),$dispatch(coreUi.setHistoryMessageNotLoading()),$dispatch(coreUi.selectRecentItem(e)),(coreIm.getUnReadNumMap()[e.owner]||0)>0&&(e.unread_num=0,coreDb.saveRecent(e)),coreIm.deleteUnReadNumMap(e.owner),$dispatch(coreUi.updateRecent(e)),coreIm.loadHistoryMessageList(),E(e)}},995:function(e,t,r){"use strict";function n(e){try{if(window.CLIENTCONFIG.ISMOBILE&&("/main/recent"===e.route||"main/recent"===e.route||"hashchange"===e.type&&e.newURL.includes("main/recent"))){s.info("onRouteChange 跳转到会话列表，清空当前会话");var t=$getState().recent.currentRecentInfo;isNullOrEmpty(t)||setTimeout(function(){o.selectRecentItem({})},0),o.setCurrentRecentImgList([]),coreUi.setSelectGroupMember([])}}catch(e){s.error("onRouteChange",e.toString())}}var a=r(359),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(a),s=coreLogger.getLogger("logic")("recent/listenEvent");s.debug("listenEvent"),window.removeEventListener("routechange",n),window.addEventListener("routechange",n),window.removeEventListener("hashchange",n),window.addEventListener("hashchange",n)},996:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.hasContactFixedToTop=t.hasGroupFixedToTop=t.hasRecentFixedToTop=t.fixContactToTop=t.fixGroupToTop=t.fixRecentToTop=void 0;var a=r(135),o=n(a),s=r(1),i=n(s),u=r(2),c=n(u),l=t.fixRecentToTop=function(){var e=(0,c.default)(i.default.mark(function e(t){var r,n,a,o,s,u,c,l,d,p,v,m,M,y,E,S,I;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("recent data is necesary!");case 2:if(e.prev=2,coreIm.checkEserverOnline("fixRecentToTop")){e.next=5;break}return e.abrupt("return");case 5:if(!(r=t.stick_on_top?0:Date.now())){e.next=12;break}if(n=$getState().recent.recentList,a=void 0===n?[]:n,o=a.filter(function(e){return e.stick_on_top}),s=parseInt(window.CLIENTCONFIG["Device.ComCfg.IM.MaxTopRecentSessionSize"]),!(o.length>=s)){e.next=12;break}return e.abrupt("return",window.ToastNew(language.TOPPING_MAX_LIMIT_TIP));case 12:return u=new Date,c=u.getFullYear(),l=_(u.getMonth()+1),d=_(u.getDate()),p=_(u.getHours()),v=_(u.getMinutes()),m=_(u.getSeconds()),M=t.group?t.group.group_id:t.contact.account,y=c+l+d+p+v+m,r?g.info("Conversation top"):g.info("Cancel conversation top"),E={conversation_list:[{type:t.chat_type,conversation_id:M}],operate_type:r?constant.TOPPING_OPER_TYPE.TOPPING:constant.TOPPING_OPER_TYPE.CANCLE_TOPPING,operate_time:parseInt(y)},e.next=25,coreIm.toppingConversation(E);case 25:if(S=e.sent,0===S.result&&S.param&&1===S.param.result){e.next=28;break}return e.abrupt("return",window.ToastNew(r?language.SET_TOPPING_FAILED:language.CANCEL_TOPPING_FAILED));case 28:return t.stick_on_top=r,(0,f.refreshRecentList)(t),h(t),e.next=33,coreDb.saveRecent(t);case 33:I=e.sent,I&&g.info("stick to top save recent info success"),e.next=40;break;case 37:e.prev=37,e.t0=e.catch(2),g.error("setRecentFixToTop",e.t0.toString());case 40:case"end":return e.stop()}},e,this,[[2,37]])}));return function(t){return e.apply(this,arguments)}}(),d=(t.fixGroupToTop=function(){var e=(0,c.default)(i.default.mark(function e(t){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:coreIm.getLocalRecent({owner:t.group_id}).then(function(e){return l(e)});case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.fixContactToTop=function(){var e=(0,c.default)(i.default.mark(function e(t){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.account,!isNullOrEmpty(r)){e.next=3;break}return e.abrupt("return",alert(language.CONTACT_HAS_NO_USERNAME));case 3:coreIm.getLocalRecent({owner:r}).then(function(e){return l(e)});case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.hasRecentFixedToTop=function(){var e=(0,c.default)(i.default.mark(function e(t){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,coreIm.getLocalRecent(t);case 2:return r=e.sent,e.abrupt("return",!(!r||!r.stick_on_top));case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()),f=(t.hasGroupFixedToTop=function(){var e=(0,c.default)(i.default.mark(function e(t){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",d({owner:t.group_id}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.hasContactFixedToTop=function(){var e=(0,c.default)(i.default.mark(function e(t){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",d({owner:t.account}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),r(358)),p=r(597),g=(function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);t.default=e}(p),coreLogger.getLogger("logic")("recent/list/fixToTop")),_=function(e,t){return isNullOrEmpty(t)&&(t=2),(e+Math.pow(10,t)+"").substring(1)},h=function(){var e=(0,c.default)(i.default.mark(function e(t){var r;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=(0,o.default)({},$getState().contactGroups.selectGroupInfo),t.group_id&&t.group_id===r.group_id&&(r.stick_on_top=t.stick_on_top,$dispatch(coreUi.setSelectGroupInfo(r)));case 2:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}()},997:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.markRecentAsRead=void 0;var a=r(1),o=n(a),s=r(2),i=n(s),u=(t.markRecentAsRead=function(){var e=(0,i.default)(o.default.mark(function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return o.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:try{0!==r?((0,u.updateUnReadNumMap)(t.owner,r),t.set_unread_num=0,coreDb.saveRecent(t)):0!==t.unread_num&&coreCommon.setMessageNotifyRead(t),(0,u.refreshRecentList)(t)}catch(e){c.error("markRecentAsRead",e.toString())}case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),r(358)),c=coreLogger.getLogger("logic")("recent/list/markread")},998:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setIsTwoToThree=t.openCloudSpace=t.openGroupSpace=t.showCurrentRecentDetail=void 0;var n=r(999),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(n);t.showCurrentRecentDetail=a.showCurrentRecentDetail,t.openGroupSpace=a.openGroupSpace,t.openCloudSpace=a.openCloudSpace,t.setIsTwoToThree=function(e){return $dispatch(coreUi.setIsTwoToThree(e))}},999:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){_.info("showCurrentRecentDetail",e);var t=$getState().recent.currentRecentInfo,r={};return g.isGroup(t.chat_type)?(r={group_id:t.owner},coreGroup.dispatchSliderIsMuteNotify(t.owner)):r=(0,l.default)({},t.contact),coreUi.loadSliderDetailInfo(r)}Object.defineProperty(t,"__esModule",{value:!0}),t.openTeamSpace=t.openCloudSpace=void 0;var o=r(1),s=n(o),i=r(2),u=n(i),c=r(139),l=n(c),d=(t.openCloudSpace=function(){var e=(0,u.default)(s.default.mark(function e(){var t,r;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d();case 2:t=e.sent;try{r=t.param.webUrl,_.info("openCloudSpace openUrl. url"),appService.openUrl(r)}catch(e){_.error("openCloudSpace error. ",t)}case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),function(){var e=(0,u.default)(s.default.mark(function e(){var t,r,n;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,coreAccount.getLoginModel();case 2:return t=e.sent,r=t.crypt_token,e.next=6,coreIm.getCloudSpaceUrl(r);case 6:return n=e.sent,e.abrupt("return",n);case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()),f=(t.openTeamSpace=function(){var e=(0,u.default)(s.default.mark(function e(t){var r,n,a,o;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.group_id,_.info("openGroupSpace group_id :",r),coreIm.checkEserverOnline("openTeamSpace")){e.next=4;break}return e.abrupt("return");case 4:if(n=(0,l.default)({},t),n.group_space_id){e.next=12;break}return e.next=8,coreGroup.createTeamSpace(t);case 8:if(n=e.sent,!isNullOrEmpty(n)){e.next=12;break}return _.error("openGroupSpace error.. "),e.abrupt("return",!1);case 12:return e.next=14,f(n.group_id,n.group_space_id);case 14:a=e.sent;try{o=a.param.webUrl,_.info("openGroupSpace openUrl. url"),appService.openUrl(o)}catch(e){_.error("openGroupSpace error. ",a)}case 16:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),function(){var e=(0,u.default)(s.default.mark(function e(t,r){var n,a,o,i;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,coreAccount.getLoginModel();case 2:return n=e.sent,a=n.crypt_token,o=parseInt(r),e.next=7,coreIm.getGroupSpaceUrl({token:a,teamspaceId:o,groupId:t});case 7:return i=e.sent,e.abrupt("return",i);case 9:case"end":return e.stop()}},e,this)}));return function(t,r){return e.apply(this,arguments)}}());t.showCurrentRecentDetail=a;var p=r(171),g=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(p),_=coreLogger.getLogger("logic")("detail/uiEvent")}});